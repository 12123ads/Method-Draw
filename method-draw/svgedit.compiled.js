(function(a){function o(f){if(typeof f.data==="string"){var c=f.handler,l=f.data.toLowerCase().split(" ");f.handler=function(n){if(!(this!==n.target&&(/textarea|select/i.test(n.target.nodeName)||n.target.type==="text"))){var b=n.type!=="keypress"&&a.hotkeys.specialKeys[n.which],d=String.fromCharCode(n.which).toLowerCase(),e="",m={};if(n.altKey&&b!=="alt")e+="alt+";if(n.ctrlKey&&b!=="ctrl")e+="ctrl+";if(n.metaKey&&!n.ctrlKey&&b!=="meta")e+="meta+";if(n.shiftKey&&b!=="shift")e+="shift+";if(b)m[e+b]=
true;else{m[e+d]=true;m[e+a.hotkeys.shiftNums[d]]=true;if(e==="shift+")m[a.hotkeys.shiftNums[d]]=true}b=0;for(d=l.length;b<d;b++)if(m[l[b]])return c.apply(this,arguments)}}}}a.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",
106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta",219:"[",221:"]"},shiftNums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}};a.each(["keydown","keyup","keypress"],function(){a.event.special[this]={add:o}})})(jQuery);(function(a,o){function f(da){return typeof da==="string"}function c(da){var Z=e.call(arguments,1);return function(){return da.apply(this,Z.concat(e.call(arguments)))}}function l(da,Z,Y,ma,ua){var ha;if(ma!==d){Z=Y.match(da?/^([^#]*)\#?(.*)$/:/^([^#?]*)\??([^#]*)(#?.*)/);Y=Z[3]||"";if(ua===2&&f(ma))ma=ma.replace(da?ba:X,"");else{ha=p(Z[2]);ma=f(ma)?p[da?R:P](ma):ma;ma=ua===2?ma:ua===1?a.extend({},ma,ha):a.extend({},ha,ma);ma=q(ma);if(da)ma=ma.replace(la,m)}da=Z[1]+(da?"#":ma||!Z[1]?"?":"")+ma+Y}else da=
Z(Y!==d?Y:o[ea][S]);return da}function n(da,Z,Y){if(Z===d||typeof Z==="boolean"){Y=Z;Z=q[da?R:P]()}else Z=f(Z)?Z.replace(da?ba:X,""):Z;return p(Z,Y)}function b(da,Z,Y,ma){if(!f(Y)&&typeof Y!=="object"){ma=Y;Y=Z;Z=d}return this.each(function(){var ua=a(this),ha=Z||aa()[(this.nodeName||"").toLowerCase()]||"",qa=ha&&ua.attr(ha)||"";ua.attr(ha,q[da](qa,Y,ma))})}var d,e=Array.prototype.slice,m=decodeURIComponent,q=a.param,v,p,I,V=a.bbq=a.bbq||{},M,H,aa,T=a.event.special,P="querystring",R="fragment",ea=
"location",S="href",X=/^.*\?|#.*$/g,ba=/^.*\#/,la,ka={};q[P]=c(l,0,function(da){return da.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,"$1")});q[R]=v=c(l,1,function(da){return da.replace(/^[^#]*#?(.*)$/,"$1")});v.noEscape=function(da){da=da||"";da=a.map(da.split(""),encodeURIComponent);la=RegExp(da.join("|"),"g")};v.noEscape(",/");a.deparam=p=function(da,Z){var Y={},ma={"true":true,"false":false,"null":null};a.each(da.replace(/\+/g," ").split("&"),function(ua,ha){var qa=ha.split("="),Ga=m(qa[0]),Ma=Y,Ra=
0,Qa=Ga.split("]["),Va=Qa.length-1;if(/\[/.test(Qa[0])&&/\]$/.test(Qa[Va])){Qa[Va]=Qa[Va].replace(/\]$/,"");Qa=Qa.shift().split("[").concat(Qa);Va=Qa.length-1}else Va=0;if(qa.length===2){qa=m(qa[1]);if(Z)qa=qa&&!isNaN(qa)?+qa:qa==="undefined"?d:ma[qa]!==d?ma[qa]:qa;if(Va)for(;Ra<=Va;Ra++){Ga=Qa[Ra]===""?Ma.length:Qa[Ra];Ma=Ma[Ga]=Ra<Va?Ma[Ga]||(Qa[Ra+1]&&isNaN(Qa[Ra+1])?{}:[]):qa}else if(a.isArray(Y[Ga]))Y[Ga].push(qa);else Y[Ga]=Y[Ga]!==d?[Y[Ga],qa]:qa}else if(Ga)Y[Ga]=Z?d:""});return Y};p[P]=c(n,
0);p[R]=I=c(n,1);a.elemUrlAttr||(a.elemUrlAttr=function(da){return a.extend(ka,da)})({a:S,base:S,iframe:"src",img:"src",input:"src",form:"action",link:S,script:"src"});aa=a.elemUrlAttr;a.fn[P]=c(b,P);a.fn[R]=c(b,R);V.pushState=M=function(da,Z){if(f(da)&&/^#/.test(da)&&Z===d)Z=2;var Y=da!==d;Y=v(o[ea][S],Y?da:{},Y?Z:2);o[ea][S]=Y+(/#/.test(Y)?"":"#")};V.getState=H=function(da,Z){return da===d||typeof da==="boolean"?I(da):I(Z)[da]};V.removeState=function(da){var Z={};if(da!==d){Z=H();a.each(a.isArray(da)?
da:arguments,function(Y,ma){delete Z[ma]})}M(Z,2)};T.hashchange=a.extend(T.hashchange,{add:function(da){function Z(ma){var ua=ma[R]=v();ma.getState=function(ha,qa){return ha===d||typeof ha==="boolean"?p(ua,ha):p(ua,qa)[ha]};Y.apply(this,arguments)}var Y;if(a.isFunction(da)){Y=da;return Z}else{Y=da.handler;da.handler=Z}}})})(jQuery,this);
(function(a,o,f){function c(v){v=v||o[b][d];return v.replace(/^[^#]*#?(.*)$/,"$1")}var l,n=a.event.special,b="location",d="href",e=document.documentMode,m=a.browser.msie&&(e===f||e<8),q="onhashchange"in o&&!m;a.hashchangeDelay=100;n.hashchange=a.extend(n.hashchange,{setup:function(){if(q)return false;a(l.start)},teardown:function(){if(q)return false;a(l.stop)}});l=function(){function v(){M=H=function(aa){return aa};if(m){V=a('<iframe src="javascript:0"/>').hide().insertAfter("body")[0].contentWindow;
H=function(){return c(V.document[b][d])};M=function(aa,T){if(aa!==T){var P=V.document;P.open().close();P[b].hash="#"+aa}};M(c())}}var p={},I,V,M,H;p.start=function(){if(!I){var aa=c();M||v();(function T(){var P=c(),R=H(aa);if(P!==aa){M(aa=P,R);a(o).trigger("hashchange")}else if(R!==aa)o[b][d]=o[b][d].replace(/#.*/,"")+"#"+R;I=setTimeout(T,a.hashchangeDelay)})()}};p.stop=function(){if(!V){I&&clearTimeout(I);I=0}};return p}()})(jQuery,this);(function(a){var o={},f;a.svgIcons=function(c,l){function n(da,Z){if(da!=="ajax"){if(aa)return;var Y=(V=S[0].contentDocument)&&V.getElementById("svg_eof");if(!Y&&!(Z&&Y)){T++;if(T<50)setTimeout(n,20);else{d();aa=true}return}aa=true}I=a(V.firstChild).children();if(l.no_img)setTimeout(function(){H||b()},500);else{Y=ea+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNzUiIGhlaWdodD0iMjc1Ij48L3N2Zz4%3D";M=a(new Image).attr({src:Y,width:0,height:0}).appendTo("body").load(function(){b(true)}).error(function(){b()})}}
function b(da,Z){if(!H){if(l.no_img)da=false;if(da){var Y=a(document.createElement("div"));Y.hide().appendTo("body")}if(Z){var ma=l.fallback_path?l.fallback_path:"";a.each(Z,function(Va,Xa){a("#"+Va);var Na=a(new Image).attr({"class":"svg_icon",src:ma+Xa,width:v,height:p,alt:"icon"});ka(Na,Va)})}else for(var ua=I.length,ha=0;ha<ua;ha++){var qa=I[ha],Ga=qa.id;if(Ga==="svg_eof")break;a("#"+Ga);qa=qa.getElementsByTagNameNS(m,"svg")[0];var Ma=document.createElementNS(m,"svg");Ma.setAttributeNS(m,"viewBox",
[0,0,v,p].join(" "));var Ra=qa.getAttribute("width"),Qa=qa.getAttribute("height");qa.removeAttribute("width");qa.removeAttribute("height");qa.getAttribute("viewBox")||qa.setAttribute("viewBox",[0,0,Ra,Qa].join(" "));Ma.setAttribute("xmlns",m);Ma.setAttribute("width",v);Ma.setAttribute("height",p);Ma.setAttribute("xmlns:xlink",q);Ma.setAttribute("class","svg_icon");R||(qa=qa.cloneNode(true));Ma.appendChild(qa);if(da){R||Ma.cloneNode(true);Y.empty().append(Ma);qa=ea+e(Y.html());qa=a(new Image).attr({"class":"svg_icon",
src:qa})}else qa=f(a(Ma),ha);ka(qa,Ga)}l.placement&&a.each(l.placement,function(Va,Xa){o[Xa]&&a(Va).each(function(Na){var Ha=o[Xa].clone();if(Na>0&&!da)Ha=f(Ha,Na,true);la(a(this),Ha,Xa)})});if(!Z){da&&Y.remove();S&&S.remove();M&&M.remove()}l.resize&&a.resizeSvgIcons(l.resize);H=true;l.callback&&l.callback(o)}}function d(){if(c.indexOf(".svgz")!=-1){var da=c.replace(".svgz",".svg");window.console&&console.log(".svgz failed, trying with .svg");a.svgIcons(da,l)}else l.fallback&&b(false,l.fallback)}
function e(da){if(window.btoa)return window.btoa(da);var Z=Array(Math.floor((da.length+2)/3)*4),Y,ma,ua,ha,qa,Ga,Ma=0,Ra=0;do{Y=da.charCodeAt(Ma++);ma=da.charCodeAt(Ma++);ua=da.charCodeAt(Ma++);ha=Y>>2;Y=(Y&3)<<4|ma>>4;qa=(ma&15)<<2|ua>>6;Ga=ua&63;if(isNaN(ma))qa=Ga=64;else if(isNaN(ua))Ga=64;Z[Ra++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(ha);Z[Ra++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(Y);Z[Ra++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(qa);
Z[Ra++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(Ga)}while(Ma<da.length);return Z.join("")}var m="http://www.w3.org/2000/svg",q="http://www.w3.org/1999/xlink",v=l.w?l.w:24,p=l.h?l.h:24,I,V,M,H=false,aa=false,T=0,P=navigator.userAgent,R=!!window.opera;P.indexOf("Safari/")>-1&&P.indexOf("Chrome/");var ea="data:image/svg+xml;charset=utf-8;base64,";if(l.svgz){var S=a('<object data="'+c+'" type=image/svg+xml>').appendTo("body").hide();try{V=S[0].contentDocument;S.load(n);
n(0,true)}catch(X){d()}}else{var ba=new DOMParser;a.ajax({url:c,dataType:"string",success:function(da){if(da){V=ba.parseFromString(da,"text/xml");a(function(){n("ajax")})}else a(d)},error:function(da){if(window.opera)a(function(){d()});else if(da.responseText){V=ba.parseFromString(da.responseText,"text/xml");V.childNodes.length||a(d);a(function(){n("ajax")})}else a(d)}})}var la=function(da,Z,Y,ma){R&&Z.css("visibility","hidden");if(l.replace){ma&&Z.attr("id",Y);(Y=da.attr("class"))&&Z.attr("class",
"svg_icon "+Y);da.replaceWith(Z)}else da.append(Z);R&&setTimeout(function(){Z.removeAttr("style")},1)},ka=function(da,Z){if(l.id_match===undefined||l.id_match!==false)la(holder,da,Z,true);o[Z]=da};f=function(da,Z){var Y=da.find("defs");if(!Y.length)return da;Y=R?Y.find("*").filter(function(){return!!this.id}):Y.find("[id]");var ma=da[0].getElementsByTagName("*"),ua=ma.length;Y.each(function(ha){var qa=this.id;a(V).find("#"+qa);this.id=ha="x"+qa+Z+ha;qa="url(#"+qa+")";var Ga="url(#"+ha+")";for(ha=
0;ha<ua;ha++){var Ma=ma[ha];Ma.getAttribute("fill")===qa&&Ma.setAttribute("fill",Ga);Ma.getAttribute("stroke")===qa&&Ma.setAttribute("stroke",Ga);Ma.getAttribute("filter")===qa&&Ma.setAttribute("filter",Ga)}});return da}};a.getSvgIcon=function(c,l){var n=o[c];if(l&&n)n=f(n,0,true).clone(true);return n};a.resizeSvgIcons=function(c){var l=!a(".svg_icon:first").length;a.each(c,function(n,b){var d=a.isArray(b),e=d?b[0]:b,m=d?b[1]:b;if(l)n=n.replace(/\.svg_icon/g,"svg");a(n).each(function(){this.setAttribute("width",
e);this.setAttribute("height",m);if(window.opera&&window.widget){this.parentNode.style.width=e+"px";this.parentNode.style.height=m+"px"}})})}})(jQuery);(function(){function a(c,l,n){c=document.createElementNS(o.svg,c);if(f)for(var b in l)c.setAttribute(b,l[b]);else for(b in l){var d=l[b],e=c[b];if(e&&e.constructor==="SVGLength")e.baseVal.value=d;else c.setAttribute(b,d)}n&&n.appendChild(c);return c}var o={svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"};if(!window.console)window.console=new function(){this.log=function(){};this.dir=function(){}};$.jGraduate={Paint:function(c){c=c||{};this.alpha=isNaN(c.alpha)?100:c.alpha;if(c.copy){this.type=
c.copy.type;this.alpha=c.copy.alpha;this.radialGradient=this.linearGradient=this.solidColor=null;switch(this.type){case "solidColor":this.solidColor=c.copy.solidColor;break;case "linearGradient":this.linearGradient=c.copy.linearGradient.cloneNode(true);break;case "radialGradient":this.radialGradient=c.copy.radialGradient.cloneNode(true)}}else if(c.linearGradient){this.type="linearGradient";this.radialGradient=this.solidColor=null;this.linearGradient=c.linearGradient.cloneNode(true)}else if(c.radialGradient){this.type=
"radialGradient";this.linearGradient=this.solidColor=null;this.radialGradient=c.radialGradient.cloneNode(true)}else if(c.solidColor){this.type="solidColor";this.solidColor=c.solidColor}else{this.type="none";this.radialGradient=this.linearGradient=this.solidColor=null}}};jQuery.fn.jGraduateDefaults={paint:new $.jGraduate.Paint,window:{pickerTitle:"Drag markers to pick a paint"},images:{clientPath:"images/"},newstop:"inverse"};var f=navigator.userAgent.indexOf("Gecko/")>=0;jQuery.fn.jGraduate=function(c){var l=
arguments;return this.each(function(){function n(ra,ia,va,Q,J){var ga=J||a("stop",{"stop-color":ia,"stop-opacity":va,offset:ra},ba);if(J){ia=J.getAttribute("stop-color");va=J.getAttribute("stop-opacity");ra=J.getAttribute("offset")}else ba.appendChild(ga);if(va===null)va=1;J=a("path",{d:"M-6.2,0.9c3.6-4,6.7-4.3,6.7-12.4c-0.2,7.9,3.1,8.8,6.5,12.4c3.5,3.8,2.9,9.6,0,12.3c-3.1,2.8-10.4,2.7-13.2,0C-9.6,9.9-9.4,4.4-6.2,0.9z",fill:"url(#jGraduate_trans)",transform:"translate("+(10+ra*R)+", 26)"},Ja);var Oa=
a("path",{d:"M-6.2,0.9c3.6-4,6.7-4.3,6.7-12.4c-0.2,7.9,3.1,8.8,6.5,12.4c3.5,3.8,2.9,9.6,0,12.3c-3.1,2.8-10.4,2.7-13.2,0C-9.6,9.9-9.4,4.4-6.2,0.9z",fill:ia,"fill-opacity":va,transform:"translate("+(10+ra*R)+", 26)",stroke:"#000","stroke-width":1.5},Ja);$(Oa).mousedown(function(Za){b(this);$a=tb;aa.mousemove(m).mouseup(d);Da=Jb.offset();Za.preventDefault();return false}).data("stop",ga).data("bg",J).dblclick(function(){$("div.jGraduate_LightBox").show();for(var Za=this,fb=+ga.getAttribute("stop-opacity")||
1,wb=ga.getAttribute("stop-color")||1,xb=(parseFloat(fb)*255).toString(16);xb.length<2;)xb="0"+xb;ia=wb.substr(1)+xb;$("#"+p+"_jGraduate_stopPicker").css({left:100,bottom:15}).jPicker({window:{title:"Pick the start color and opacity for the gradient"},images:{clientPath:v.images.clientPath},color:{active:ia,alphaSupport:true}},function(Db){wb=Db.val("hex")?"#"+Db.val("hex"):"none";fb=Db.val("a")!==null?Db.val("a")/256:1;Za.setAttribute("fill",wb);Za.setAttribute("fill-opacity",fb);ga.setAttribute("stop-color",
wb);ga.setAttribute("stop-opacity",fb);$("div.jGraduate_LightBox").hide();$("#"+p+"_jGraduate_stopPicker").hide()},null,function(){$("div.jGraduate_LightBox").hide();$("#"+p+"_jGraduate_stopPicker").hide()})});$(ba).find("stop").each(function(){var Za=$(this);if(+this.getAttribute("offset")>ra){if(!ia){var fb=this.getAttribute("stop-color"),wb=this.getAttribute("stop-opacity");ga.setAttribute("stop-color",fb);Oa.setAttribute("fill",fb);ga.setAttribute("stop-opacity",wb===null?1:wb);Oa.setAttribute("fill-opacity",
wb===null?1:wb)}Za.before(ga);return false}});Q&&b(Oa);return ga}function b(ra){tb&&tb.setAttribute("stroke","#000");ra.setAttribute("stroke","blue");tb=ra;tb.parentNode.appendChild(tb)}function d(){aa.unbind("mousemove",m);if(Ka.getAttribute("display")!=="none"){Ka.setAttribute("display","none");var ra=$(tb),ia=ra.data("stop");ra=ra.data("bg");$([tb,ia,ra]).remove()}$a=null}function e(){var ra=Sa?"rotate("+Sa+","+gb+","+Ia+") ":"";yb===1&&bb===1?ba.removeAttribute("gradientTransform"):ba.setAttribute("gradientTransform",
ra+"translate("+-gb*(yb-1)+","+-Ia*(bb-1)+") scale("+yb+","+bb+")")}function m(ra){var ia=ra.pageX-Da.left;ra=ra.pageY-Da.top;ia=ia<10?10:ia>R+10?R+10:ia;var va="translate("+ia+", 26)";if(ra<-60||ra>130){Ka.setAttribute("display","block");Ka.setAttribute("transform",va)}else Ka.setAttribute("display","none");$a.setAttribute("transform",va);$.data($a,"bg").setAttribute("transform",va);$.data($a,"stop").setAttribute("offset",(ia-10)/R);var Q=0;$(ba).find("stop").each(function(){var J=this.getAttribute("offset"),
ga=$(this);if(J<Q){ga.prev().before(ga);zb=$(ba).find("stop")}Q=J})}var q=$(this),v=$.extend(true,{},jQuery.fn.jGraduateDefaults,c),p=q.attr("id"),I="#"+q.attr("id")+" ";if(I){var V=function(){switch(q.paint.type){case "radialGradient":q.paint.linearGradient=null;break;case "linearGradient":q.paint.radialGradient=null;break;case "solidColor":q.paint.radialGradient=q.paint.linearGradient=null}$.isFunction(q.okCallback)&&q.okCallback(q.paint);q.hide()},M=function(){$.isFunction(q.cancelCallback)&&q.cancelCallback();
q.hide()};$.extend(true,q,{paint:new $.jGraduate.Paint({copy:v.paint}),okCallback:$.isFunction(l[1])&&l[1]||null,cancelCallback:$.isFunction(l[2])&&l[2]||null});q.position();var H=null,aa=$(window);if(q.paint.type=="none")q.paint=$.jGraduate.Paint({solidColor:"ffffff"});q.addClass("jGraduate_Picker");q.html('<ul class="jGraduate_tabs"><li class="jGraduate_tab_color jGraduate_tab_current" data-type="col">Solid Color</li><li class="jGraduate_tab_lingrad" data-type="lg">Linear Gradient</li><li class="jGraduate_tab_radgrad" data-type="rg">Radial Gradient</li></ul><div class="jGraduate_colPick"></div><div class="jGraduate_gradPick"></div><div class="jGraduate_LightBox"></div><div id="'+
p+'_jGraduate_stopPicker" class="jGraduate_stopPicker"></div>');var T=$(I+"> .jGraduate_colPick"),P=$(I+"> .jGraduate_gradPick");P.html('<div id="'+p+'_jGraduate_Swatch" class="jGraduate_Swatch"><h2 class="jGraduate_Title">'+v.window.pickerTitle+'</h2><div id="'+p+'_jGraduate_GradContainer" class="jGraduate_GradContainer"></div><div id="'+p+'_jGraduate_StopSlider" class="jGraduate_StopSlider"></div></div><div class="jGraduate_Form jGraduate_Points jGraduate_lg_field"><div class="jGraduate_StopSection"><label class="jGraduate_Form_Heading">Begin Point</label><div class="jGraduate_Form_Section"><label>x:</label><input type="text" id="'+
p+'_jGraduate_x1" size="3" title="Enter starting x value between 0.0 and 1.0"/><label> y:</label><input type="text" id="'+p+'_jGraduate_y1" size="3" title="Enter starting y value between 0.0 and 1.0"/></div></div><div class="jGraduate_StopSection"><label class="jGraduate_Form_Heading">End Point</label><div class="jGraduate_Form_Section"><label>x:</label><input type="text" id="'+p+'_jGraduate_x2" size="3" title="Enter ending x value between 0.0 and 1.0"/><label> y:</label><input type="text" id="'+
p+'_jGraduate_y2" size="3" title="Enter ending y value between 0.0 and 1.0"/></div></div></div><div class="jGraduate_Form jGraduate_Points jGraduate_rg_field"><div class="jGraduate_StopSection"><label class="jGraduate_Form_Heading">Center Point</label><div class="jGraduate_Form_Section"><label>x:</label><input type="text" id="'+p+'_jGraduate_cx" size="3" title="Enter x value between 0.0 and 1.0"/><label> y:</label><input type="text" id="'+p+'_jGraduate_cy" size="3" title="Enter y value between 0.0 and 1.0"/></div></div><div class="jGraduate_StopSection"><label class="jGraduate_Form_Heading">Focal Point</label><div class="jGraduate_Form_Section"><label>Match center: <input type="checkbox" checked="checked" id="'+
p+'_jGraduate_match_ctr"/></label><br/><label>x:</label><input type="text" id="'+p+'_jGraduate_fx" size="3" title="Enter x value between 0.0 and 1.0"/><label> y:</label><input type="text" id="'+p+'_jGraduate_fy" size="3" title="Enter y value between 0.0 and 1.0"/></div></div></div><div class="jGraduate_StopSection jGraduate_SpreadMethod"><label class="jGraduate_Form_Heading">Spread method</label><div class="jGraduate_Form_Section"><select class="jGraduate_spreadMethod"><option value=pad selected>Pad</option><option value=reflect>Reflect</option><option value=repeat>Repeat</option></select></div></div><div class="jGraduate_Form"><div class="jGraduate_Slider jGraduate_RadiusField jGraduate_rg_field"><label class="prelabel">Radius:</label><div id="'+
p+'_jGraduate_Radius" class="jGraduate_SliderBar jGraduate_Radius" title="Click to set radius"><img id="'+p+'_jGraduate_RadiusArrows" class="jGraduate_RadiusArrows" src="'+v.images.clientPath+'rangearrows2.gif"></div><label><input type="text" id="'+p+'_jGraduate_RadiusInput" size="3" value="100"/>%</label></div><div class="jGraduate_Slider jGraduate_EllipField jGraduate_rg_field"><label class="prelabel">Ellip:</label><div id="'+p+'_jGraduate_Ellip" class="jGraduate_SliderBar jGraduate_Ellip" title="Click to set Ellip"><img id="'+
p+'_jGraduate_EllipArrows" class="jGraduate_EllipArrows" src="'+v.images.clientPath+'rangearrows2.gif"></div><label><input type="text" id="'+p+'_jGraduate_EllipInput" size="3" value="0"/>%</label></div><div class="jGraduate_Slider jGraduate_AngleField jGraduate_rg_field"><label class="prelabel">Angle:</label><div id="'+p+'_jGraduate_Angle" class="jGraduate_SliderBar jGraduate_Angle" title="Click to set Angle"><img id="'+p+'_jGraduate_AngleArrows" class="jGraduate_AngleArrows" src="'+v.images.clientPath+
'rangearrows2.gif"></div><label><input type="text" id="'+p+'_jGraduate_AngleInput" size="3" value="0"/>\u00ba&nbsp;</label></div><div class="jGraduate_Slider jGraduate_OpacField"><label class="prelabel">Opac:</label><div id="'+p+'_jGraduate_Opac" class="jGraduate_SliderBar jGraduate_Opac" title="Click to set Opac"><img id="'+p+'_jGraduate_OpacArrows" class="jGraduate_OpacArrows" src="'+v.images.clientPath+'rangearrows2.gif"></div><label><input type="text" id="'+p+'_jGraduate_OpacInput" size="3" value="100"/>%</label></div></div><div class="jGraduate_OkCancel"><input type="button" id="'+
p+'_jGraduate_Ok" class="jGraduate_Ok" value="OK"/><input type="button" id="'+p+'_jGraduate_Cancel" class="jGraduate_Cancel" value="Cancel"/></div>');var R=256,ea=R-0,S=R-0,X,ba,la,ka={};$(".jGraduate_SliderBar").width(145);var da=$("#"+p+"_jGraduate_GradContainer")[0],Z=a("svg",{id:p+"_jgraduate_svg",width:R,height:R,xmlns:o.svg},da);X=X||q.paint.type;var Y=ba=q.paint[X],ma=q.paint.alpha,ua=X==="solidColor";switch(X){case "solidColor":case "linearGradient":if(!ua){ba.id=p+"_lg_jgraduate_grad";Y=
ba=Z.appendChild(ba)}a("radialGradient",{id:p+"_rg_jgraduate_grad"},Z);if(X==="linearGradient")break;case "radialGradient":if(!ua){ba.id=p+"_rg_jgraduate_grad";Y=ba=Z.appendChild(ba)}a("linearGradient",{id:p+"_lg_jgraduate_grad"},Z)}if(ua){Y=ba=$("#"+p+"_lg_jgraduate_grad")[0];H=q.paint[X];n(0,"#"+H,1);var ha=typeof v.newstop;if(ha==="string")switch(v.newstop){case "same":n(1,"#"+H,1);break;case "inverse":ha="";for(var qa=0;qa<6;qa+=2){H.substr(qa,2);var Ga=(255-parseInt(H.substr(qa,2),16)).toString(16);
if(Ga.length<2)Ga=0+Ga;ha+=Ga}n(1,"#"+ha,1);break;case "white":n(1,"#ffffff",1);break;case "black":n(1,"#000000",1)}else if(ha==="object")n(1,v.newstop.color||"#"+H,"opac"in v.newstop?v.newstop.opac:1)}H=parseFloat(Y.getAttribute("x1")||0);ha=parseFloat(Y.getAttribute("y1")||0);qa=parseFloat(Y.getAttribute("x2")||1);Ga=parseFloat(Y.getAttribute("y2")||0);var Ma=parseFloat(Y.getAttribute("cx")||0.5),Ra=parseFloat(Y.getAttribute("cy")||0.5),Qa=parseFloat(Y.getAttribute("fx")||Ma),Va=parseFloat(Y.getAttribute("fy")||
Ra);la=a("rect",{id:p+"_jgraduate_rect",x:0,y:0,width:ea,height:S,fill:"url(#"+p+"_jgraduate_grad)","fill-opacity":ma/100},Z);var Xa=$("<div/>").attr({"class":"grad_coord jGraduate_lg_field",title:"Begin Stop"}).text(1).css({top:ha*R,left:H*R}).data("coord","start").appendTo(da),Na=Xa.clone().text(2).css({top:Ga*R,left:qa*R}).attr("title","End stop").data("coord","end").appendTo(da),Ha=$("<div/>").attr({"class":"grad_coord jGraduate_rg_field",title:"Center stop"}).text("C").css({top:Ra*R,left:Ma*
R}).data("coord","center").appendTo(da),Pa=Ha.clone().text("F").css({top:Va*R,left:Qa*R,display:"none"}).attr("title","Focus point").data("coord","focus").appendTo(da);Pa[0].id=p+"_jGraduate_focusCoord";$(I+" .grad_coord");$.each(["x1","y1","x2","y2","cx","cy","fx","fy"],function(ra,ia){var va=ba.getAttribute(ia),Q=isNaN(ia[1]);va||(va=Q?"0.5":ia==="x2"?"1.0":"0.0");ka[ia]=$("#"+p+"_jGraduate_"+ia).val(va).change(function(){if(isNaN(parseFloat(this.value))||this.value<0)this.value=0;else if(this.value>
1)this.value=1;if(!(ia[0]==="f"&&!jb))if(Q&&X==="radialGradient"||!Q&&X==="linearGradient")ba.setAttribute(ia,this.value);var J=Q?ia[0]==="c"?Ha:Pa:ia[1]==="1"?Xa:Na,ga=ia.indexOf("x")>=0?"left":"top";J.css(ga,this.value*R)}).change()});var zb,Ja,Jb=$("#"+p+"_jGraduate_StopSlider"),tb,ab,$a,Ka=a("path",{d:"m9.75,-6l-19.5,19.5m0,-19.5l19.5,19.5",fill:"none",stroke:"#D00","stroke-width":5,display:"none"},ab),Da,yb=1,bb=1,Sa=0,gb=Ma,Ia=Ra;ab=a("svg",{width:"100%",height:45},Jb[0]);da=a("pattern",{width:16,
height:16,patternUnits:"userSpaceOnUse",id:"jGraduate_trans"},ab);a("image",{width:16,height:16},da).setAttributeNS(o.xlink,"xlink:href",v.images.clientPath+"map-opacity.png");$(ab).click(function(ra){Da=Jb.offset();if(ra.target.tagName!=="path"){var ia=ra.pageX-Da.left-8;ia=ia<10?10:ia>R+10?R+10:ia;n(ia/R,0,0,true);ra.stopPropagation()}});$(ab).mouseover(function(){ab.appendChild(Ka)});Ja=a("g",{},ab);a("line",{x1:10,y1:15,x2:R+10,y2:15,"stroke-width":2,stroke:"#000"},ab);var rb=P.find(".jGraduate_spreadMethod").change(function(){ba.setAttribute("spreadMethod",
$(this).val())}),sb=null,mb=function(ra){var ia=ra.pageX-Wa.left,va=ra.pageY-Wa.top;ia=ia<0?0:ia>R?R:ia;va=va<0?0:va>R?R:va;sb.css("left",ia).css("top",va);ia/=ea;va/=S;var Q=sb.data("coord"),J=ba;switch(Q){case "start":ka.x1.val(ia);ka.y1.val(va);J.setAttribute("x1",ia);J.setAttribute("y1",va);break;case "end":ka.x2.val(ia);ka.y2.val(va);J.setAttribute("x2",ia);J.setAttribute("y2",va);break;case "center":ka.cx.val(ia);ka.cy.val(va);J.setAttribute("cx",ia);J.setAttribute("cy",va);gb=ia;Ia=va;e();
break;case "focus":ka.fx.val(ia);ka.fy.val(va);J.setAttribute("fx",ia);J.setAttribute("fy",va);e()}ra.preventDefault()},hb=function(){sb=null;aa.unbind("mousemove",mb).unbind("mouseup",hb)};zb=ba.getElementsByTagNameNS(o.svg,"stop");if(La<2){for(;La<2;){ba.appendChild(document.createElementNS(o.svg,"stop"));++La}zb=ba.getElementsByTagNameNS(o.svg,"stop")}var La=zb.length;for(qa=0;qa<La;qa++)n(0,0,0,0,zb[qa]);rb.val(ba.getAttribute("spreadMethod")||"pad");var Wa,jb=false;la.setAttribute("fill-opacity",
ma/100);$("#"+p+" div.grad_coord").mousedown(function(ra){ra.preventDefault();sb=$(this);sb.offset();Wa=sb.parent().offset();aa.mousemove(mb).mouseup(hb)});$("#"+p+"_jGraduate_Ok").bind("click",function(){q.paint.type=X;q.paint[X]=ba.cloneNode(true);q.paint.solidColor=null;V()});$("#"+p+"_jGraduate_Cancel").bind("click",function(){M()});if(X==="radialGradient")if(jb)Pa.show();else{Pa.hide();ka.fx.val("");ka.fy.val("")}$("#"+p+"_jGraduate_match_ctr")[0].checked=!jb;var Eb,Fb;$("#"+p+"_jGraduate_match_ctr").change(function(){jb=
!this.checked;Pa.toggle(jb);ka.fx.val("");ka.fy.val("");var ra=ba;if(jb){var ia=Eb||0.5,va=Fb||0.5;ra.setAttribute("fx",ia);ra.setAttribute("fy",va);ka.fx.val(ia);ka.fy.val(va)}else{Eb=ra.getAttribute("fx");Fb=ra.getAttribute("fy");ra.removeAttribute("fx");ra.removeAttribute("fy")}});zb=ba.getElementsByTagNameNS(o.svg,"stop");La=zb.length;if(La<2){for(;La<2;){ba.appendChild(document.createElementNS(o.svg,"stop"));++La}zb=ba.getElementsByTagNameNS(o.svg,"stop")}var nb;ma=P=0;if(X==="radialGradient"){Z=
ba.gradientTransform.baseVal;if(Z.numberOfItems===2){La=Z.getItem(0);Z=Z.getItem(1);if(La.type===2&&Z.type===3){La=Z.matrix;if(La.a!==1)P=Math.round(-(1-La.a)*100);else if(La.d!==1)P=Math.round((1-La.d)*100)}}else if(Z.numberOfItems===3){da=Z.getItem(0);La=Z.getItem(1);Z=Z.getItem(2);if(da.type===4&&La.type===2&&Z.type===3){ma=Math.round(da.angle);La=Z.matrix;if(La.a!==1)P=Math.round(-(1-La.a)*100);else if(La.d!==1)P=Math.round((1-La.d)*100)}}}P={radius:{handle:"#"+p+"_jGraduate_RadiusArrows",input:"#"+
p+"_jGraduate_RadiusInput",val:(ba.getAttribute("r")||0.5)*100},opacity:{handle:"#"+p+"_jGraduate_OpacArrows",input:"#"+p+"_jGraduate_OpacInput",val:q.paint.alpha||100},ellip:{handle:"#"+p+"_jGraduate_EllipArrows",input:"#"+p+"_jGraduate_EllipInput",val:P},angle:{handle:"#"+p+"_jGraduate_AngleArrows",input:"#"+p+"_jGraduate_AngleInput",val:ma}};$.each(P,function(ra,ia){var va=$(ia.handle);va.mousedown(function(Q){var J=va.parent();nb={type:ra,elem:va,input:$(ia.input),parent:J,offset:J.offset()};
aa.mousemove(Gb).mouseup(Ob);Q.preventDefault()});$(ia.input).val(ia.val).change(function(){var Q=+this.value,J=0,ga=X==="radialGradient";switch(ra){case "radius":ga&&ba.setAttribute("r",Q/100);J=Math.pow(Q/100,0.4)/2*145;break;case "opacity":q.paint.alpha=Q;la.setAttribute("fill-opacity",Q/100);J=Q*1.45;break;case "ellip":yb=bb=1;if(Q===0){J=72.5;break}if(Q>99.5)Q=99.5;if(Q>0)bb=1-Q/100;else yb=-(Q/100)-1;J=145*((Q+100)/2)/100;ga&&e();break;case "angle":Sa=Q;J=Sa/180;J+=0.5;J*=145;ga&&e()}if(J>145)J=
145;else if(J<0)J=0;va.css({"margin-left":J-5})}).change()});var Gb=function(ra){var ia=ra.pageX-nb.offset.left-parseInt(nb.parent.css("border-left-width"));if(ia>145)ia=145;if(ia<=0)ia=0;var va=ia-5;ia/=145;switch(nb.type){case "radius":ia=Math.pow(ia*2,2.5);if(ia>0.98&&ia<1.02)ia=1;if(ia<=0.01)ia=0.01;ba.setAttribute("r",ia);break;case "opacity":q.paint.alpha=parseInt(ia*100);la.setAttribute("fill-opacity",ia);break;case "ellip":bb=yb=1;if(ia<0.5){ia/=0.5;yb=ia<=0?0.01:ia}else if(ia>0.5){ia/=0.5;
ia=2-ia;bb=ia<=0?0.01:ia}e();ia-=1;if(bb===ia+1)ia=Math.abs(ia);break;case "angle":ia-=0.5;Sa=ia*=180;e();ia/=100}nb.elem.css({"margin-left":va});ia=Math.round(ia*100);nb.input.val(ia);ra.preventDefault()},Ob=function(){aa.unbind("mousemove",Gb).unbind("mouseup",Ob);nb=null};for(P=(q.paint.alpha*255/100).toString(16);P.length<2;)P="0"+P;P=P.split(".")[0];H=q.paint.solidColor=="none"?"":q.paint.solidColor+P;ua||(H=zb[0].getAttribute("stop-color"));$.extend($.fn.jPicker.defaults.window,{alphaSupport:true,
effects:{type:"show",speed:0}});T.jPicker({window:{title:v.window.pickerTitle},images:{clientPath:v.images.clientPath},color:{active:H,alphaSupport:true}},function(ra){q.paint.type="solidColor";q.paint.alpha=ra.val("ahex")?Math.round(ra.val("a")/255*100):100;q.paint.solidColor=ra.val("hex")?ra.val("hex"):"none";q.paint.radialGradient=null;V()},null,function(){M()});var Kb=$(I+" .jGraduate_tabs li");Kb.click(function(){Kb.removeClass("jGraduate_tab_current");$(this).addClass("jGraduate_tab_current");
$(I+" > div").hide();var ra=$(this).attr("data-type");$(I+" .jGraduate_gradPick").show();if(ra==="rg"||ra==="lg"){$(".jGraduate_"+ra+"_field").show();$(".jGraduate_"+(ra==="lg"?"rg":"lg")+"_field").hide();$("#"+p+"_jgraduate_rect")[0].setAttribute("fill","url(#"+p+"_"+ra+"_jgraduate_grad)");X=ra==="lg"?"linearGradient":"radialGradient";$("#"+p+"_jGraduate_OpacInput").val(q.paint.alpha).change();var ia=$("#"+p+"_"+ra+"_jgraduate_grad")[0];if(ba!==ia){var va=$(ba).find("stop");$(ia).empty().append(va);
ba=ia;ia=rb.val();ba.setAttribute("spreadMethod",ia)}jb=ra==="rg"&&ba.getAttribute("fx")!=null&&!(Ma==Qa&&Ra==Va);$("#"+p+"_jGraduate_focusCoord").toggle(jb);if(jb)$("#"+p+"_jGraduate_match_ctr")[0].checked=false}else{$(I+" .jGraduate_gradPick").hide();$(I+" .jGraduate_colPick").show()}});$(I+" > div").hide();Kb.removeClass("jGraduate_tab_current");var Ub;switch(q.paint.type){case "linearGradient":Ub=$(I+" .jGraduate_tab_lingrad");break;case "radialGradient":Ub=$(I+" .jGraduate_tab_radgrad");break;
default:Ub=$(I+" .jGraduate_tab_color")}q.show();setTimeout(function(){Ub.addClass("jGraduate_tab_current").click()},10)}else alert("Container element must have an id attribute to maintain unique id strings for sub-elements.")})}})();$.fn.SpinButton=function(a){function o(f,c){for(var l=f[c],n=document.body;(f=f.offsetParent)&&f!=n;)if(!$.browser.msie||f.currentStyle.position!="relative")l+=f[c];return l}return this.each(function(){this.repeating=false;this.spinCfg={min:a&&!isNaN(parseFloat(a.min))?Number(a.min):null,max:a&&!isNaN(parseFloat(a.max))?Number(a.max):null,step:a&&a.step?Number(a.step):1,stepfunc:a&&a.stepfunc?a.stepfunc:false,page:a&&a.page?Number(a.page):10,upClass:a&&a.upClass?a.upClass:"up",downClass:a&&a.downClass?
a.downClass:"down",reset:a&&a.reset?a.reset:this.value,delay:a&&a.delay?Number(a.delay):500,interval:a&&a.interval?Number(a.interval):100,_btn_width:20,_direction:null,_delay:null,_repeat:null,callback:a&&a.callback?a.callback:null};this.spinCfg.smallStep=a&&a.smallStep?a.smallStep:this.spinCfg.step/2;this.adjustValue=function(f){f=isNaN(this.value)?this.spinCfg.reset:$.isFunction(this.spinCfg.stepfunc)?this.spinCfg.stepfunc(this,f):Number((Number(this.value)+Number(f)).toFixed(5));if(this.spinCfg.min!==
null)f=Math.max(f,this.spinCfg.min);if(this.spinCfg.max!==null)f=Math.min(f,this.spinCfg.max);this.value=f;$.isFunction(this.spinCfg.callback)&&this.spinCfg.callback(this)};$(this).addClass(a&&a.spinClass?a.spinClass:"spin-button").mousemove(function(f){var c=f.pageX||f.x,l=f.pageY||f.y;f=f.target||f.srcElement;var n=svgEditor.tool_scale||1,b=$(f).height()/2;c=c>o(f,"offsetLeft")+f.offsetWidth*n-this.spinCfg._btn_width?l<o(f,"offsetTop")+b*n?1:-1:0;if(c!==this.spinCfg._direction){switch(c){case 1:$(this).removeClass(this.spinCfg.downClass).addClass(this.spinCfg.upClass);
break;case -1:$(this).removeClass(this.spinCfg.upClass).addClass(this.spinCfg.downClass);break;default:$(this).removeClass(this.spinCfg.upClass).removeClass(this.spinCfg.downClass)}this.spinCfg._direction=c}}).mouseout(function(){$(this).removeClass(this.spinCfg.upClass).removeClass(this.spinCfg.downClass);this.spinCfg._direction=null;window.clearInterval(this.spinCfg._repeat);window.clearTimeout(this.spinCfg._delay)}).mousedown(function(f){if(f.button===0&&this.spinCfg._direction!=0){var c=this,
l=f.shiftKey?c.spinCfg.smallStep:c.spinCfg.step,n=function(){c.adjustValue(c.spinCfg._direction*l)};n();c.spinCfg._delay=window.setTimeout(function(){n();c.spinCfg._repeat=window.setInterval(n,c.spinCfg.interval)},c.spinCfg.delay)}}).mouseup(function(){window.clearInterval(this.spinCfg._repeat);window.clearTimeout(this.spinCfg._delay)}).dblclick(function(){$.browser.msie&&this.adjustValue(this.spinCfg._direction*this.spinCfg.step)}).keydown(function(f){switch(f.keyCode){case 38:this.adjustValue(this.spinCfg.step);
break;case 40:this.adjustValue(-this.spinCfg.step);break;case 33:this.adjustValue(this.spinCfg.page);break;case 34:this.adjustValue(-this.spinCfg.page)}}).keypress(function(f){if(this.repeating)switch(f.keyCode){case 38:this.adjustValue(this.spinCfg.step);break;case 40:this.adjustValue(-this.spinCfg.step);break;case 33:this.adjustValue(this.spinCfg.page);break;case 34:this.adjustValue(-this.spinCfg.page)}else this.repeating=true}).keyup(function(f){this.repeating=false;switch(f.keyCode){case 38:case 40:case 33:case 34:case 13:this.adjustValue(0)}}).bind("mousewheel",
function(f){if(f.wheelDelta>=120)this.adjustValue(this.spinCfg.step);else f.wheelDelta<=-120&&this.adjustValue(-this.spinCfg.step);f.preventDefault()}).change(function(){this.adjustValue(0)});this.addEventListener&&this.addEventListener("DOMMouseScroll",function(f){if(f.detail>0)this.adjustValue(-this.spinCfg.step);else f.detail<0&&this.adjustValue(this.spinCfg.step);f.preventDefault()},false)})};function touchHandler(a){var o=a.changedTouches,f=o[0],c="";switch(a.type){case "touchstart":c="mousedown";break;case "touchmove":c="mousemove";break;case "touchend":c="mouseup";break;default:return}var l=document.createEvent("MouseEvent");l.initMouseEvent(c,true,true,window,1,f.screenX,f.screenY,f.clientX,f.clientY,false,false,false,false,0,null);if(o.length<2){f.target.dispatchEvent(l);a.preventDefault()}};jQuery&&function(){var a=$(window),o=$(document);$.extend($.fn,{contextMenu:function(f,c){if(f.menu==undefined)return false;if(f.inSpeed==undefined)f.inSpeed=150;if(f.outSpeed==undefined)f.outSpeed=75;if(f.inSpeed==0)f.inSpeed=-1;if(f.outSpeed==0)f.outSpeed=-1;$(this).each(function(){var l=$(this),n=$(l).offset(),b=$("#"+f.menu);b.addClass("contextMenu");$(this).bind("mousedown",function(d){$(this).mouseup(function(e){var m=$(this);m.unbind("mouseup");$(".contextMenu").hide();if(d.button===2||f.allowLeft||
d.ctrlKey&&svgedit.browser.isMac()){e.stopPropagation();if(l.hasClass("disabled")||d.altKey)return false;var q=e.pageX,v=e.pageY;e=a.width()-b.width();var p=a.height()-b.height();if(q>e-15)q=e-15;if(v>p-30)v=p-30;o.unbind("click");b.css({top:v,left:q}).fadeIn(f.inSpeed);b.find("A").mouseover(function(){b.find("LI.hover").removeClass("hover");$(this).parent().addClass("hover")}).mouseout(function(){b.find("LI.hover").removeClass("hover")});o.keypress(function(I){switch(I.keyCode){case 38:if(b.find("LI.hover").length){b.find("LI.hover").removeClass("hover").prevAll("LI:not(.disabled)").eq(0).addClass("hover");
b.find("LI.hover").length||b.find("LI:last").addClass("hover")}else b.find("LI:last").addClass("hover");break;case 40:if(b.find("LI.hover").length==0)b.find("LI:first").addClass("hover");else{b.find("LI.hover").removeClass("hover").nextAll("LI:not(.disabled)").eq(0).addClass("hover");b.find("LI.hover").length||b.find("LI:first").addClass("hover")}break;case 13:b.find("LI.hover A").trigger("click");break;case 27:o.trigger("click")}});b.find("A").unbind("mouseup");b.find("LI:not(.disabled) A").mouseup(function(){o.unbind("click").unbind("keypress");
$(".contextMenu").hide();c&&c($(this).attr("href").substr(1),$(m),{x:q-n.left,y:v-n.top,docX:q,docY:v});return false});setTimeout(function(){o.click(function(){o.unbind("click").unbind("keypress");b.fadeOut(f.outSpeed);return false})},0)}})});if($.browser.mozilla)$("#"+f.menu).each(function(){$(this).css({MozUserSelect:"none"})});else $.browser.msie?$("#"+f.menu).each(function(){$(this).bind("selectstart.disableTextSelect",function(){return false})}):$("#"+f.menu).each(function(){$(this).bind("mousedown.disableTextSelect",
function(){return false})});$(l).add($("UL.contextMenu")).bind("contextmenu",function(){return false})});return $(this)},disableContextMenuItems:function(f){if(f==undefined){$(this).find("LI").addClass("disabled");return $(this)}$(this).each(function(){if(f!=undefined)for(var c=f.split(","),l=0;l<c.length;l++)$(this).find('A[href="'+c[l]+'"]').parent().addClass("disabled")});return $(this)},enableContextMenuItems:function(f){if(f==undefined){$(this).find("LI.disabled").removeClass("disabled");return $(this)}$(this).each(function(){if(f!=
undefined)for(var c=f.split(","),l=0;l<c.length;l++)$(this).find('A[href="'+c[l]+'"]').parent().removeClass("disabled")});return $(this)},disableContextMenu:function(){$(this).each(function(){$(this).addClass("disabled")});return $(this)},enableContextMenu:function(){$(this).each(function(){$(this).removeClass("disabled")});return $(this)},destroyContextMenu:function(){$(this).each(function(){$(this).unbind("mousedown").unbind("mouseup")});return $(this)}})}(jQuery);var svgedit=svgedit||{};
(function(){if(!svgedit.browser)svgedit.browser={};var a=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect;svgedit.browser.supportsSvg=function(){return a};if(svgedit.browser.supportsSvg()){var o=navigator.userAgent,f=document.createElementNS("http://www.w3.org/2000/svg","svg"),c=!!window.opera,l=o.indexOf("AppleWebKit")>=0,n=o.indexOf("Gecko/")>=0,b=o.indexOf("MSIE")>=0,d=o.indexOf("Chrome/")>=0,e=o.indexOf("Windows")>=0,m=o.indexOf("Macintosh")>=
0,q="ontouchstart"in window,v=!!f.querySelector,p=!!document.evaluate,I=function(){var ea=document.createElementNS("http://www.w3.org/2000/svg","path");ea.setAttribute("d","M0,0 10,10");var S=ea.pathSegList;ea=ea.createSVGPathSegLinetoAbs(5,5);try{S.replaceItem(ea,0);return true}catch(X){}return false}(),V=function(){var ea=document.createElementNS("http://www.w3.org/2000/svg","path");ea.setAttribute("d","M0,0 10,10");var S=ea.pathSegList;ea=ea.createSVGPathSegLinetoAbs(5,5);try{S.insertItemBefore(ea,
0);return true}catch(X){}return false}(),M=function(){var ea=document.createElementNS("http://www.w3.org/2000/svg","svg"),S=document.createElementNS("http://www.w3.org/2000/svg","svg");document.documentElement.appendChild(ea);S.setAttribute("x",5);ea.appendChild(S);var X=document.createElementNS("http://www.w3.org/2000/svg","text");X.textContent="a";S.appendChild(X);S=X.getStartPositionOfChar(0).x;document.documentElement.removeChild(ea);return S===0}(),H=function(){var ea=document.createElementNS("http://www.w3.org/2000/svg",
"svg");document.documentElement.appendChild(ea);var S=document.createElementNS("http://www.w3.org/2000/svg","path");S.setAttribute("d","M0,0 C0,0 10,10 10,0");ea.appendChild(S);S=S.getBBox();document.documentElement.removeChild(ea);return S.height>4&&S.height<5}(),aa=function(){var ea=document.createElementNS("http://www.w3.org/2000/svg","svg");document.documentElement.appendChild(ea);var S=document.createElementNS("http://www.w3.org/2000/svg","path");S.setAttribute("d","M0,0 10,0");var X=document.createElementNS("http://www.w3.org/2000/svg",
"path");X.setAttribute("d","M5,0 15,0");var ba=document.createElementNS("http://www.w3.org/2000/svg","g");ba.appendChild(S);ba.appendChild(X);ea.appendChild(ba);S=ba.getBBox();document.documentElement.removeChild(ea);return S.width==15}(),T=function(){var ea=document.createElementNS("http://www.w3.org/2000/svg","rect");ea.setAttribute("x",0.1);(ea=ea.cloneNode(false).getAttribute("x").indexOf(",")==-1)||$.alert("NOTE: This version of Opera is known to contain bugs in SVG-edit.\n\t\tPlease upgrade to the <a href='http://opera.com'>latest version</a> in which the problems have been fixed.");
return ea}(),P=function(){var ea=document.createElementNS("http://www.w3.org/2000/svg","rect");ea.setAttribute("style","vector-effect:non-scaling-stroke");return ea.style.vectorEffect==="non-scaling-stroke"}(),R=function(){var ea=document.createElementNS("http://www.w3.org/2000/svg","rect").transform.baseVal,S=f.createSVGTransform();ea.appendItem(S);return ea.getItem(0)==S}();svgedit.browser.isOpera=function(){return c};svgedit.browser.isWebkit=function(){return l};svgedit.browser.isGecko=function(){return n};
svgedit.browser.isIE=function(){return b};svgedit.browser.isChrome=function(){return d};svgedit.browser.isWindows=function(){return e};svgedit.browser.isMac=function(){return m};svgedit.browser.isTouch=function(){return q};svgedit.browser.supportsSelectors=function(){return v};svgedit.browser.supportsXpath=function(){return p};svgedit.browser.supportsPathReplaceItem=function(){return I};svgedit.browser.supportsPathInsertItemBefore=function(){return V};svgedit.browser.supportsPathBBox=function(){return H};
svgedit.browser.supportsHVLineContainerBBox=function(){return aa};svgedit.browser.supportsGoodTextCharPos=function(){return M};svgedit.browser.supportsEditableText=function(){return c};svgedit.browser.supportsGoodDecimals=function(){return T};svgedit.browser.supportsNonScalingStroke=function(){return P};svgedit.browser.supportsNativeTransformLists=function(){return R}}else window.location="browser-not-supported.html"})();svgedit=svgedit||{};
(function(){if(!svgedit.transformlist)svgedit.transformlist={};var a=document.createElementNS("http://www.w3.org/2000/svg","svg"),o={};svgedit.transformlist.SVGTransformList=function(f){this._elem=f||null;this._xforms=[];this._update=function(){var c="";a.createSVGMatrix();for(var l=0;l<this.numberOfItems;++l){var n=this._list.getItem(l);c=c;n=n;var b=n.matrix,d="";switch(n.type){case 1:d="matrix("+[b.a,b.b,b.c,b.d,b.e,b.f].join(",")+")";break;case 2:d="translate("+b.e+","+b.f+")";break;case 3:d=
b.a==b.d?"scale("+b.a+")":"scale("+b.a+","+b.d+")";break;case 4:var e=0;d=0;if(n.angle!=0){e=1-b.a;d=(e*b.f+b.b*b.e)/(e*e+b.b*b.b);e=(b.e-b.b*d)/e}d="rotate("+n.angle+" "+e+","+d+")"}c=c+(d+" ")}this._elem.setAttribute("transform",c)};this._list=this;this._init=function(){var c=this._elem.getAttribute("transform");if(c)for(var l=/\s*((scale|matrix|rotate|translate)\s*\(.*?\))\s*,?\s*/,n=true;n;){n=c.match(l);c=c.replace(l,"");if(n&&n[1]){var b=n[1].split(/\s*\(/),d=b[0];b=b[1].match(/\s*(.*?)\s*\)/);
b[1]=b[1].replace(/(\d)-/g,"$1 -");var e=b[1].split(/[, ]+/),m="abcdef".split(""),q=a.createSVGMatrix();$.each(e,function(I,V){e[I]=parseFloat(V);if(d=="matrix")q[m[I]]=e[I]});b=a.createSVGTransform();var v="set"+d.charAt(0).toUpperCase()+d.slice(1),p=d=="matrix"?[q]:e;if(d=="scale"&&p.length==1)p.push(p[0]);else if(d=="translate"&&p.length==1)p.push(0);else if(d=="rotate"&&p.length==1){p.push(0);p.push(0)}b[v].apply(b,p);this._list.appendItem(b)}}};this._removeFromOtherLists=function(c){if(c){var l=
false,n;for(n in o){for(var b=o[n],d=0,e=b._xforms.length;d<e;++d)if(b._xforms[d]==c){l=true;b.removeItem(d);break}if(l)break}}};this.numberOfItems=0;this.clear=function(){this.numberOfItems=0;this._xforms=[]};this.initialize=function(c){this.numberOfItems=1;this._removeFromOtherLists(c);this._xforms=[c]};this.getItem=function(c){if(c<this.numberOfItems&&c>=0)return this._xforms[c];throw{code:1};};this.insertItemBefore=function(c,l){var n=null;if(l>=0)if(l<this.numberOfItems){this._removeFromOtherLists(c);
n=Array(this.numberOfItems+1);for(var b=0;b<l;++b)n[b]=this._xforms[b];n[b]=c;for(var d=b+1;b<this.numberOfItems;++d,++b)n[d]=this._xforms[b];this.numberOfItems++;this._xforms=n;n=c;this._list._update()}else n=this._list.appendItem(c);return n};this.replaceItem=function(c,l){var n=null;if(l<this.numberOfItems&&l>=0){this._removeFromOtherLists(c);n=this._xforms[l]=c;this._list._update()}return n};this.removeItem=function(c){if(c<this.numberOfItems&&c>=0){for(var l=this._xforms[c],n=Array(this.numberOfItems-
1),b=0;b<c;++b)n[b]=this._xforms[b];for(c=b;c<this.numberOfItems-1;++c,++b)n[c]=this._xforms[b+1];this.numberOfItems--;this._xforms=n;this._list._update();return l}else throw{code:1};};this.appendItem=function(c){this._removeFromOtherLists(c);this._xforms.push(c);this.numberOfItems++;this._list._update();return c}};svgedit.transformlist.resetListMap=function(){o={}};svgedit.transformlist.removeElementFromListMap=function(f){f.id&&o[f.id]&&delete o[f.id]};svgedit.transformlist.getTransformList=function(f){if(svgedit.browser.supportsNativeTransformLists())if(f.transform)return f.transform.baseVal;
else if(f.gradientTransform)return f.gradientTransform.baseVal;else{if(f.patternTransform)return f.patternTransform.baseVal}else{var c=f.id;c||(c="temp");var l=o[c];if(!l||c=="temp"){o[c]=new svgedit.transformlist.SVGTransformList(f);o[c]._init();l=o[c]}return l}return null}})();svgedit=svgedit||{};
(function(){if(!svgedit.math)svgedit.math={};var a=document.createElementNS("http://www.w3.org/2000/svg","svg");svgedit.math.transformPoint=function(o,f,c){return{x:c.a*o+c.c*f+c.e,y:c.b*o+c.d*f+c.f}};svgedit.math.isIdentity=function(o){return o.a===1&&o.b===0&&o.c===0&&o.d===1&&o.e===0&&o.f===0};svgedit.math.matrixMultiply=function(){for(var o=arguments,f=o.length,c=o[f-1];f-- >1;)c=o[f-1].multiply(c);if(Math.abs(c.a)<1.0E-14)c.a=0;if(Math.abs(c.b)<1.0E-14)c.b=0;if(Math.abs(c.c)<1.0E-14)c.c=0;if(Math.abs(c.d)<
1.0E-14)c.d=0;if(Math.abs(c.e)<1.0E-14)c.e=0;if(Math.abs(c.f)<1.0E-14)c.f=0;return c};svgedit.math.hasMatrixTransform=function(o){if(!o)return false;for(var f=o.numberOfItems;f--;){var c=o.getItem(f);if(c.type==1&&!svgedit.math.isIdentity(c.matrix))return true}return false};svgedit.math.transformBox=function(o,f,c,l,n){var b={x:o,y:f},d={x:o+c,y:f};c={x:o+c,y:f+l};o={x:o,y:f+l};f=svgedit.math.transformPoint;b=f(b.x,b.y,n);var e=l=b.x,m=b.y,q=b.y;d=f(d.x,d.y,n);l=Math.min(l,d.x);e=Math.max(e,d.x);
m=Math.min(m,d.y);q=Math.max(q,d.y);o=f(o.x,o.y,n);l=Math.min(l,o.x);e=Math.max(e,o.x);m=Math.min(m,o.y);q=Math.max(q,o.y);c=f(c.x,c.y,n);l=Math.min(l,c.x);e=Math.max(e,c.x);m=Math.min(m,c.y);q=Math.max(q,c.y);return{tl:b,tr:d,bl:o,br:c,aabox:{x:l,y:m,width:e-l,height:q-m}}};svgedit.math.transformListToTransform=function(o,f,c){if(o==null)return a.createSVGTransformFromMatrix(a.createSVGMatrix());f=f==undefined?0:f;c=c==undefined?o.numberOfItems-1:c;f=parseInt(f);c=parseInt(c);if(f>c){var l=c;c=f;
f=l}l=a.createSVGMatrix();for(f=f;f<=c;++f){var n=f>=0&&f<o.numberOfItems?o.getItem(f).matrix:a.createSVGMatrix();l=svgedit.math.matrixMultiply(l,n)}return a.createSVGTransformFromMatrix(l)};svgedit.math.getMatrix=function(o){o=svgedit.transformlist.getTransformList(o);return svgedit.math.transformListToTransform(o).matrix};svgedit.math.snapToAngle=function(o,f,c,l){var n=Math.PI/4;c=c-o;var b=l-f;l=Math.sqrt(c*c+b*b);n=Math.round(Math.atan2(b,c)/n)*n;return{x:o+l*Math.cos(n),y:f+l*Math.sin(n),a:n}};
svgedit.math.rectsIntersect=function(o,f){return f.x<o.x+o.width&&f.x+f.width>o.x&&f.y<o.y+o.height&&f.y+f.height>o.y}})();svgedit=svgedit||{};
(function(){if(!svgedit.units)svgedit.units={};var a=["x","x1","cx","rx","width"],o=["y","y1","cy","ry","height"],f=$.merge(["r","radius"],a);$.merge(f,o);var c,l={px:1};svgedit.units.init=function(b){c=b;b=document.createElementNS("http://www.w3.org/2000/svg","svg");document.body.appendChild(b);var d=document.createElementNS("http://www.w3.org/2000/svg","rect");d.setAttribute("width","1em");d.setAttribute("height","1ex");d.setAttribute("x","1in");b.appendChild(d);d=d.getBBox();document.body.removeChild(b);
b=d.x;l.em=d.width;l.ex=d.height;l["in"]=b;l.cm=b/2.54;l.mm=b/25.4;l.pt=b/72;l.pc=b/6;l["%"]=0};svgedit.units.getTypeMap=function(){return l};svgedit.units.shortFloat=function(b){var d=c.getRoundDigits();if(isNaN(b)){if($.isArray(b))return svgedit.units.shortFloat(b[0])+","+svgedit.units.shortFloat(b[1])}else return+(+b).toFixed(d);return parseFloat(b).toFixed(d)-0};svgedit.units.convertUnit=function(b,d){d=d||c.getBaseUnit();return svgedit.unit.shortFloat(b/l[d])};svgedit.units.setUnitAttr=function(b,
d,e){isNaN(e)||b.getAttribute(d);b.setAttribute(d,e)};var n={line:["x1","x2","y1","y2"],circle:["cx","cy","r"],ellipse:["cx","cy","rx","ry"],foreignObject:["x","y","width","height"],rect:["x","y","width","height"],image:["x","y","width","height"],use:["x","y","width","height"],text:["x","y"]};svgedit.units.convertAttrs=function(b){var d=b.tagName,e=c.getBaseUnit();if(d=n[d])for(var m=d.length,q=0;q<m;q++){var v=d[q],p=b.getAttribute(v);if(p)isNaN(p)||b.setAttribute(v,p/l[e]+e)}};svgedit.units.convertToNum=
function(b,d){if(!isNaN(d))return d-0;if(d.substr(-1)==="%"){var e=d.substr(0,d.length-1)/100,m=c.getWidth(),q=c.getHeight();return a.indexOf(b)>=0?e*m:o.indexOf(b)>=0?e*q:e*Math.sqrt(m*m+q*q)/Math.sqrt(2)}else{m=d.substr(-2);e=d.substr(0,d.length-2);return e*l[m]}};svgedit.units.isValidUnit=function(b,d,e){var m=false;if(f.indexOf(b)>=0)if(isNaN(d)){d=d.toLowerCase();$.each(l,function(p){if(!m)if(RegExp("^-?[\\d\\.]+"+p+"$").test(d))m=true})}else m=true;else if(b=="id"){b=false;try{var q=c.getElement(d);
b=q==null||q===e}catch(v){}return b}else m=true;return m}})();svgedit=svgedit||{};
(function(){function a(b){if(svgedit.browser.supportsHVLineContainerBBox())try{return b.getBBox()}catch(d){}var e=$.data(b,"ref"),m=null;if(e){var q=$(e).children().clone().attr("visibility","hidden");$(n).append(q);m=q.filter("line, path")}else m=$(b).find("line, path");var v=false;if(m.length){m.each(function(){var p=this.getBBox();if(!p.width||!p.height)v=true});if(v){b=e?q:$(b).children();ret=getStrokedBBox(b)}else ret=b.getBBox()}else ret=b.getBBox();e&&q.remove();return ret}if(!svgedit.utilities)svgedit.utilities=
{};var o="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use".split(","),f=null,c=null,l=null,n=null;svgedit.utilities.init=function(b){f=b;c=b.getDOMDocument();l=b.getDOMContainer();n=b.getSVGRoot()};svgedit.utilities.toXml=function(b){return $("<p/>").text(b).html()};svgedit.utilities.fromXml=function(b){return $("<p/>").html(b).text()};svgedit.utilities.encode64=function(b){b=svgedit.utilities.convertToXMLReferences(b);if(window.btoa)return window.btoa(b);
var d=Array(Math.floor((b.length+2)/3)*4),e,m,q,v,p,I,V=0,M=0;do{e=b.charCodeAt(V++);m=b.charCodeAt(V++);q=b.charCodeAt(V++);v=e>>2;e=(e&3)<<4|m>>4;p=(m&15)<<2|q>>6;I=q&63;if(isNaN(m))p=I=64;else if(isNaN(q))I=64;d[M++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(v);d[M++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e);d[M++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(p);d[M++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(I)}while(V<
b.length);return d.join("")};svgedit.utilities.decode64=function(b){if(window.atob)return window.atob(b);var d="",e,m,q="",v,p="",I=0;b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(I++));m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(I++));v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(I++));p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(I++));
e=e<<2|m>>4;m=(m&15)<<4|v>>2;q=(v&3)<<6|p;d+=String.fromCharCode(e);if(v!=64)d+=String.fromCharCode(m);if(p!=64)d+=String.fromCharCode(q)}while(I<b.length);return unescape(d)};svgedit.utilities.convertToXMLReferences=function(b){for(var d="",e=0;e<b.length;e++){var m=b.charCodeAt(e);if(m<128)d+=b[e];else if(m>127)d+="&#"+m+";"}return d};svgedit.utilities.text2xml=function(b){if(b.indexOf("<svg:svg")>=0)b=b.replace(/<(\/?)svg:/g,"<$1").replace("xmlns:svg","xmlns");var d;try{var e=window.DOMParser?
new DOMParser:new ActiveXObject("Microsoft.XMLDOM");e.async=false}catch(m){throw Error("XML Parser could not be instantiated");}try{d=e.loadXML?e.loadXML(b)?e:false:e.parseFromString(b,"text/xml")}catch(q){throw Error("Error parsing XML string");}return d};svgedit.utilities.bboxToObj=function(b){return{x:b.x,y:b.y,width:b.width,height:b.height}};svgedit.utilities.walkTree=function(b,d){if(b&&b.nodeType==1){d(b);for(var e=b.childNodes.length;e--;)svgedit.utilities.walkTree(b.childNodes.item(e),d)}};
svgedit.utilities.walkTreePost=function(b,d){if(b&&b.nodeType==1){for(var e=b.childNodes.length;e--;)svgedit.utilities.walkTree(b.childNodes.item(e),d);d(b)}};svgedit.utilities.getUrlFromAttr=function(b){if(b)if(b.indexOf('url("')===0)return b.substring(5,b.indexOf('"',6));else if(b.indexOf("url('")===0)return b.substring(5,b.indexOf("'",6));else if(b.indexOf("url(")===0)return b.substring(4,b.indexOf(")"));return null};svgedit.utilities.getHref=function(b){return b.getAttributeNS("http://www.w3.org/1999/xlink",
"href")};svgedit.utilities.setHref=function(b,d){b.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d)};svgedit.utilities.findDefs=function(b){b=f.getSVGContent().documentElement;var d=b.getElementsByTagNameNS("http://www.w3.org/2000/svg","defs");return d=d.length>0?d[0]:b.insertBefore(b.ownerDocument.createElementNS("http://www.w3.org/2000/svg","defs"),b.firstChild.nextSibling)};svgedit.utilities.getPathBBox=function(b){var d=b.pathSegList,e=d.numberOfItems;b=[[],[]];var m=d.getItem(0),
q=[m.x,m.y];for(m=0;m<e;m++){var v=d.getItem(m);if(typeof v.x!="undefined"){b[0].push(q[0]);b[1].push(q[1]);if(v.x1){for(var p=[v.x1,v.y1],I=[v.x2,v.y2],V=[v.x,v.y],M=0;M<2;M++){v=function(R){return Math.pow(1-R,3)*q[M]+3*Math.pow(1-R,2)*R*p[M]+3*(1-R)*Math.pow(R,2)*I[M]+Math.pow(R,3)*V[M]};var H=6*q[M]-12*p[M]+6*I[M],aa=-3*q[M]+9*p[M]-9*I[M]+3*V[M],T=3*p[M]-3*q[M];if(aa==0){if(H!=0){H=-T/H;0<H&&H<1&&b[M].push(v(H))}}else{T=Math.pow(H,2)-4*T*aa;if(!(T<0)){var P=(-H+Math.sqrt(T))/(2*aa);0<P&&P<1&&
b[M].push(v(P));H=(-H-Math.sqrt(T))/(2*aa);0<H&&H<1&&b[M].push(v(H))}}}q=V}else{b[0].push(v.x);b[1].push(v.y)}}}d=Math.min.apply(null,b[0]);e=Math.max.apply(null,b[0])-d;m=Math.min.apply(null,b[1]);b=Math.max.apply(null,b[1])-m;return{x:d,y:m,width:e,height:b}};svgedit.utilities.getBBox=function(b){var d=b||f.geSelectedElements()[0];if(b.nodeType!=1)return null;b=null;var e=d.nodeName;switch(e){case "text":if(d.textContent===""){d.textContent="a";b=d.getBBox();d.textContent=""}else try{b=d.getBBox()}catch(m){}break;
case "path":if(svgedit.browser.supportsPathBBox())try{b=d.getBBox()}catch(q){}else b=svgedit.utilities.getPathBBox(d);break;case "g":case "a":b=a(d);break;default:if(e==="use")b=a(d,true);if(e==="use"){b||(b=d.getBBox());if(!svgedit.browser.isWebkit()){e={};e.width=b.width;e.height=b.height;e.x=b.x+parseFloat(d.getAttribute("x")||0);e.y=b.y+parseFloat(d.getAttribute("y")||0);b=e}}else if(~o.indexOf(e))try{b=d.getBBox()}catch(v){d=$(d).closest("foreignObject");if(d.length)try{b=d[0].getBBox()}catch(p){b=
null}else b=null}}if(b)b=svgedit.utilities.bboxToObj(b);return b};svgedit.utilities.getRotationAngle=function(b,d){var e=b||f.getSelectedElements()[0];e=svgedit.transformlist.getTransformList(e);if(!e)return 0;for(var m=e.numberOfItems,q=0;q<m;++q){var v=e.getItem(q);if(v.type==4)return d?v.angle*Math.PI/180:v.angle}return 0};svgedit.utilities.getElem=svgedit.browser.supportsSelectors()?function(b){return n.querySelector("#"+b)}:svgedit.browser.supportsXpath()?function(b){return c.evaluate('svg:svg[@id="svgroot"]//svg:*[@id="'+
b+'"]',l,function(){return"http://www.w3.org/2000/svg"},9,null).singleNodeValue}:function(b){return $(n).find("[id="+b+"]")[0]};svgedit.utilities.assignAttributes=function(b,d,e,m){e||(e=0);svgedit.browser.isOpera()||n.suspendRedraw(e);for(var q in d)if(e=q.substr(0,4)==="xml:"?"http://www.w3.org/XML/1998/namespace":q.substr(0,6)==="xlink:"?"http://www.w3.org/1999/xlink":null)b.setAttributeNS(e,q,d[q]);else m?svgedit.units.setUnitAttr(b,q,d[q]):b.setAttribute(q,d[q]);svgedit.browser.isOpera()||n.unsuspendRedraw(null)};
svgedit.utilities.cleanupElement=function(b){var d=n.suspendRedraw(60),e={"fill-opacity":1,"stop-opacity":1,opacity:1,stroke:"none","stroke-dasharray":"none","stroke-linejoin":"miter","stroke-linecap":"butt","stroke-opacity":1,"stroke-width":1,rx:0,ry:0},m;for(m in e){var q=e[m];b.getAttribute(m)==q&&b.removeAttribute(m)}n.unsuspendRedraw(d)}})();svgedit=svgedit||{};
(function(){if(!svgedit.sanitize)svgedit.sanitize={};var a={};a["http://www.w3.org/1999/xlink"]="xlink";a["http://www.w3.org/XML/1998/namespace"]="xml";a["http://www.w3.org/2000/xmlns/"]="xmlns";a["http://svg-edit.googlecode.com"]="se";a["http://www.w3.org/1999/xhtml"]="xhtml";a["http://www.w3.org/1998/Math/MathML"]="mathml";var o={};$.each(a,function(l,n){o[n]=l});var f={a:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","mask","opacity","stroke","stroke-dasharray",
"stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","xlink:href","xlink:title"],circle:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask","opacity","r","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],clipPath:["class",
"clipPathUnits","id"],defs:[],style:["type"],desc:[],ellipse:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],feGaussianBlur:["class","color-interpolation-filters","id","requiredFeatures","stdDeviation"],filter:["class","color-interpolation-filters",
"filterRes","filterUnits","height","id","primitiveUnits","requiredFeatures","width","x","xlink:href","y"],foreignObject:["class","font-size","height","id","opacity","requiredFeatures","style","transform","width","x","y"],g:["class","clip-path","clip-rule","id","display","fill","fill-opacity","fill-rule","filter","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage",
"transform","font-family","font-size","font-style","font-weight","text-anchor"],image:["class","clip-path","clip-rule","filter","height","id","mask","opacity","requiredFeatures","style","systemLanguage","transform","width","x","xlink:href","xlink:title","y"],line:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin",
"stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","x1","x2","y1","y2"],linearGradient:["class","id","gradientTransform","gradientUnits","requiredFeatures","spreadMethod","systemLanguage","x1","x2","xlink:href","y1","y2"],marker:["id","class","markerHeight","markerUnits","markerWidth","orient","preserveAspectRatio","refX","refY","systemLanguage","viewBox"],mask:["class","height","id","maskContentUnits","maskUnits","width","x","y"],metadata:["class","id"],path:["class",
"clip-path","clip-rule","d","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],pattern:["class","height","id","patternContentUnits","patternTransform","patternUnits","requiredFeatures","style","systemLanguage","viewBox","width","x","xlink:href","y"],polygon:["class",
"clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","id","class","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],polyline:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","marker-end","marker-mid","marker-start","mask","opacity","points",
"requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],radialGradient:["class","cx","cy","fx","fy","gradientTransform","gradientUnits","id","r","requiredFeatures","spreadMethod","systemLanguage","xlink:href"],rect:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray",
"stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","width","x","y"],stop:["class","id","offset","requiredFeatures","stop-color","stop-opacity","style","systemLanguage"],svg:["class","clip-path","clip-rule","filter","id","height","mask","preserveAspectRatio","requiredFeatures","style","systemLanguage","viewBox","width","x","xmlns","xmlns:se","xmlns:xlink","y"],"switch":["class","id","requiredFeatures","systemLanguage"],
symbol:["class","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","opacity","preserveAspectRatio","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","viewBox"],text:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity",
"requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","transform","x","xml:space","y"],textPath:["class","id","method","requiredFeatures","spacing","startOffset","style","systemLanguage","transform","xlink:href"],title:[],tspan:["class","clip-path","clip-rule","dx","dy","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight",
"id","mask","opacity","requiredFeatures","rotate","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","textLength","transform","x","xml:space","y"],use:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width",
"style","transform","width","x","xlink:href","y"],annotation:["encoding"],"annotation-xml":["encoding"],maction:["actiontype","other","selection"],math:["class","id","display","xmlns"],menclose:["notation"],merror:[],mfrac:["linethickness"],mi:["mathvariant"],mmultiscripts:[],mn:[],mo:["fence","lspace","maxsize","minsize","rspace","stretchy"],mover:[],mpadded:["lspace","width","height","depth","voffset"],mphantom:[],mprescripts:[],mroot:[],mrow:["xlink:href","xlink:type","xmlns:xlink"],mspace:["depth",
"height","width"],msqrt:[],mstyle:["displaystyle","mathbackground","mathcolor","mathvariant","scriptlevel"],msub:[],msubsup:[],msup:[],mtable:["align","columnalign","columnlines","columnspacing","displaystyle","equalcolumns","equalrows","frame","rowalign","rowlines","rowspacing","width"],mtd:["columnalign","columnspan","rowalign","rowspan"],mtext:[],mtr:["columnalign","rowalign"],munder:[],munderover:[],none:[],semantics:[]},c={};$.each(f,function(l,n){var b={};$.each(n,function(d,e){if(e.indexOf(":")>=
0){var m=e.split(":");b[m[1]]=o[m[0]]}else b[e]=e=="xmlns"?"http://www.w3.org/2000/xmlns/":null});c[l]=b});svgedit.sanitize.getNSMap=function(){return a};svgedit.sanitize.sanitizeSvg=function(l){if(l.nodeType==3){l.nodeValue=l.nodeValue.replace(/^\s+|\s+$/g,"");l.nodeValue.length||l.parentNode.removeChild(l)}if(l.nodeType==1){var n=l.parentNode;if(l.ownerDocument&&n){var b=f[l.nodeName],d=c[l.nodeName];if(b!=undefined){for(var e=[],m=l.attributes.length;m--;){var q=l.attributes.item(m),v=q.nodeName,
p=q.localName,I=q.namespaceURI;if(!(d.hasOwnProperty(p)&&I==d[p]&&I!="http://www.w3.org/2000/xmlns/")&&!(I=="http://www.w3.org/2000/xmlns/"&&a[q.nodeValue])){v.indexOf("se:")==0&&e.push([v,q.nodeValue]);l.removeAttributeNS(I,p)}if(svgedit.browser.isGecko())switch(v){case "transform":case "gradientTransform":case "patternTransform":p=q.nodeValue.replace(/(\d)-/g,"$1 -");l.setAttribute(v,p)}if(v=="style"){q=q.nodeValue.split(";");for(v=q.length;v--;){p=q[v].split(":");b.indexOf(p[0])>=0&&l.setAttribute(p[0],
p[1])}l.removeAttribute("style")}}$.each(e,function(V,M){l.setAttributeNS("http://svg-edit.googlecode.com",M[0],M[1])});if((m=svgedit.utilities.getHref(l))&&["filter","linearGradient","pattern","radialGradient","textPath","use"].indexOf(l.nodeName)>=0)if(m[0]!="#"){svgedit.utilities.setHref(l,"");l.removeAttributeNS("http://www.w3.org/1999/xlink","href")}if(l.nodeName=="use"&&!svgedit.utilities.getHref(l))n.removeChild(l);else{$.each(["clip-path","fill","filter","marker-end","marker-mid","marker-start",
"mask","stroke"],function(V,M){var H=l.getAttribute(M);if(H)if((H=svgedit.utilities.getUrlFromAttr(H))&&H[0]!=="#"){l.setAttribute(M,"");l.removeAttribute(M)}});for(m=l.childNodes.length;m--;)svgedit.sanitize.sanitizeSvg(l.childNodes.item(m))}}else{for(b=[];l.hasChildNodes();)b.push(n.insertBefore(l.firstChild,l));n.removeChild(l);for(m=b.length;m--;)svgedit.sanitize.sanitizeSvg(b[m])}}}}})();svgedit=svgedit||{};
(function(){if(!svgedit.history)svgedit.history={};svgedit.history.HistoryEventTypes={BEFORE_APPLY:"before_apply",AFTER_APPLY:"after_apply",BEFORE_UNAPPLY:"before_unapply",AFTER_UNAPPLY:"after_unapply"};svgedit.history.MoveElementCommand=function(a,o,f,c){this.elem=a;this.text=c?"Move "+a.tagName+" to "+c:"Move "+a.tagName;this.oldNextSibling=o;this.oldParent=f;this.newNextSibling=a.nextSibling;this.newParent=a.parentNode};svgedit.history.MoveElementCommand.type=function(){return"svgedit.history.MoveElementCommand"};svgedit.history.MoveElementCommand.prototype.type=
svgedit.history.MoveElementCommand.type;svgedit.history.MoveElementCommand.prototype.getText=function(){return this.text};svgedit.history.MoveElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);this.elem=this.newParent.insertBefore(this.elem,this.newNextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)};svgedit.history.MoveElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,
this);this.elem=this.oldParent.insertBefore(this.elem,this.oldNextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.MoveElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.InsertElementCommand=function(a,o){this.elem=a;this.text=o||"Create "+a.tagName;this.parent=a.parentNode;this.nextSibling=this.elem.nextSibling};svgedit.history.InsertElementCommand.type=function(){return"svgedit.history.InsertElementCommand"};svgedit.history.InsertElementCommand.prototype.type=
svgedit.history.InsertElementCommand.type;svgedit.history.InsertElementCommand.prototype.getText=function(){return this.text};svgedit.history.InsertElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);this.elem=this.parent.insertBefore(this.elem,this.nextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)};svgedit.history.InsertElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,
this);this.parent=this.elem.parentNode;this.elem=this.elem.parentNode.removeChild(this.elem);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.InsertElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.RemoveElementCommand=function(a,o,f,c){this.elem=a;this.text=c||"Delete "+a.tagName;this.nextSibling=o;this.parent=f;svgedit.transformlist.removeElementFromListMap(a)};svgedit.history.RemoveElementCommand.type=function(){return"svgedit.history.RemoveElementCommand"};
svgedit.history.RemoveElementCommand.prototype.type=svgedit.history.RemoveElementCommand.type;svgedit.history.RemoveElementCommand.prototype.getText=function(){return this.text};svgedit.history.RemoveElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);svgedit.transformlist.removeElementFromListMap(this.elem);this.parent=this.elem.parentNode;this.elem=this.parent.removeChild(this.elem);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,
this)};svgedit.history.RemoveElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);svgedit.transformlist.removeElementFromListMap(this.elem);this.nextSibling==null&&window.console&&console.log("Error: reference element was lost");this.parent.insertBefore(this.elem,this.nextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.RemoveElementCommand.prototype.elements=function(){return[this.elem]};
svgedit.history.ChangeElementCommand=function(a,o,f){this.elem=a;this.text=f?"Change "+a.tagName+" "+f:"Change "+a.tagName;this.newValues={};this.oldValues=o;for(var c in o)this.newValues[c]=c=="#text"?a.textContent:c=="#href"?svgedit.utilities.getHref(a):a.getAttribute(c)};svgedit.history.ChangeElementCommand.type=function(){return"svgedit.history.ChangeElementCommand"};svgedit.history.ChangeElementCommand.prototype.type=svgedit.history.ChangeElementCommand.type;svgedit.history.ChangeElementCommand.prototype.getText=
function(){return this.text};svgedit.history.ChangeElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);var o=false,f;for(f in this.newValues){if(this.newValues[f])if(f=="#text")this.elem.textContent=this.newValues[f];else f=="#href"?svgedit.utilities.setHref(this.elem,this.newValues[f]):this.elem.setAttribute(f,this.newValues[f]);else if(f=="#text")this.elem.textContent="";else{this.elem.setAttribute(f,"");this.elem.removeAttribute(f)}if(f==
"transform")o=true}if(!o)if(o=svgedit.utilities.getRotationAngle(this.elem)){f=elem.getBBox();o=["rotate(",o," ",f.x+f.width/2,",",f.y+f.height/2,")"].join("");o!=elem.getAttribute("transform")&&elem.setAttribute("transform",o)}a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this);return true};svgedit.history.ChangeElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);var o=false,f;for(f in this.oldValues){if(this.oldValues[f])if(f==
"#text")this.elem.textContent=this.oldValues[f];else f=="#href"?svgedit.utilities.setHref(this.elem,this.oldValues[f]):this.elem.setAttribute(f,this.oldValues[f]);else if(f=="#text")this.elem.textContent="";else this.elem.removeAttribute(f);if(f=="transform")o=true}if(!o)if(o=svgedit.utilities.getRotationAngle(this.elem)){f=elem.getBBox();o=["rotate(",o," ",f.x+f.width/2,",",f.y+f.height/2,")"].join("");o!=elem.getAttribute("transform")&&elem.setAttribute("transform",o)}svgedit.transformlist.removeElementFromListMap(this.elem);
a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this);return true};svgedit.history.ChangeElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.BatchCommand=function(a){this.text=a||"Batch Command";this.stack=[]};svgedit.history.BatchCommand.type=function(){return"svgedit.history.BatchCommand"};svgedit.history.BatchCommand.prototype.type=svgedit.history.BatchCommand.type;svgedit.history.BatchCommand.prototype.getText=function(){return this.text};svgedit.history.BatchCommand.prototype.apply=
function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);for(var o=this.stack.length,f=0;f<o;++f)this.stack[f].apply(a);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)};svgedit.history.BatchCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);for(var o=this.stack.length-1;o>=0;o--)this.stack[o].unapply(a);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,
this)};svgedit.history.BatchCommand.prototype.elements=function(){for(var a=[],o=this.stack.length;o--;)for(var f=this.stack[o].elements(),c=f.length;c--;)a.indexOf(f[c])==-1&&a.push(f[c]);return a};svgedit.history.BatchCommand.prototype.addSubCommand=function(a){this.stack.push(a)};svgedit.history.BatchCommand.prototype.isEmpty=function(){return this.stack.length==0};svgedit.history.UndoManager=function(a){this.handler_=a||null;this.undoStackPointer=0;this.undoStack=[];this.undoChangeStackPointer=
-1;this.undoableChangeStack=[]};svgedit.history.UndoManager.prototype.resetUndoStack=function(){this.undoStack=[];this.undoStackPointer=0};svgedit.history.UndoManager.prototype.getUndoStackSize=function(){return this.undoStackPointer};svgedit.history.UndoManager.prototype.getRedoStackSize=function(){return this.undoStack.length-this.undoStackPointer};svgedit.history.UndoManager.prototype.getNextUndoCommandText=function(){return this.undoStackPointer>0?this.undoStack[this.undoStackPointer-1].getText():
""};svgedit.history.UndoManager.prototype.getNextRedoCommandText=function(){return this.undoStackPointer<this.undoStack.length?this.undoStack[this.undoStackPointer].getText():""};svgedit.history.UndoManager.prototype.undo=function(){this.undoStackPointer>0&&this.undoStack[--this.undoStackPointer].unapply(this.handler_)};svgedit.history.UndoManager.prototype.redo=function(){this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0&&this.undoStack[this.undoStackPointer++].apply(this.handler_)};
svgedit.history.UndoManager.prototype.addCommandToHistory=function(a){if(this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0)this.undoStack=this.undoStack.splice(0,this.undoStackPointer);this.undoStack.push(a);this.undoStackPointer=this.undoStack.length};svgedit.history.UndoManager.prototype.beginUndoableChange=function(a,o){for(var f=++this.undoChangeStackPointer,c=o.length,l=Array(c),n=Array(c);c--;){var b=o[c];if(b!=null){n[c]=b;l[c]=b.getAttribute(a)}}this.undoableChangeStack[f]=
{attrName:a,oldValues:l,elements:n}};svgedit.history.UndoManager.prototype.finishUndoableChange=function(){for(var a=this.undoChangeStackPointer--,o=this.undoableChangeStack[a],f=o.elements.length,c=o.attrName,l=new svgedit.history.BatchCommand("Change "+c);f--;){var n=o.elements[f];if(n!=null){var b={};b[c]=o.oldValues[f];b[c]!=n.getAttribute(c)&&l.addSubCommand(new svgedit.history.ChangeElementCommand(n,b,c))}}this.undoableChangeStack[a]=null;return l}})();svgedit=svgedit||{};
(function(){if(!svgedit.select)svgedit.select={};var a,o,f;svgedit.select.Selector=function(c,l){this.id=c;this.selectedElement=l;this.locked=true;this.selectorGroup=a.createSVGElement({element:"g",attr:{id:"selectorGroup"+this.id}});this.selectorRect=this.selectorGroup.appendChild(a.createSVGElement({element:"path",attr:{id:"selectedBox"+this.id,fill:"none",stroke:"#4F80FF","stroke-width":"1","shape-rendering":"crispEdges",style:"pointer-events:none"}}));this.gripCoords={nw:null,n:null,ne:null,e:null,
se:null,s:null,sw:null,w:null};this.reset(this.selectedElement)};svgedit.select.Selector.prototype.reset=function(c){this.locked=true;this.selectedElement=c;this.resize();this.selectorGroup.setAttribute("display","inline")};svgedit.select.Selector.prototype.updateGripCursors=function(c){var l=[];c=Math.round(c/45);if(c<0)c+=8;for(var n in f.selectorGrips)l.push(n);for(;c>0;){l.push(l.shift());c--}c=0;for(n in f.selectorGrips){f.selectorGrips[n].setAttribute("style","cursor:"+l[c]+"-resize");c++}};
svgedit.select.Selector.prototype.showGrips=function(c){f.selectorGripsGroup.setAttribute("display",c?"inline":"none");var l=this.selectedElement;this.hasGrips=c;if(l&&c){this.selectorGroup.appendChild(f.selectorGripsGroup);this.updateGripCursors(svgedit.utilities.getRotationAngle(l))}};svgedit.select.Selector.prototype.resize=function(){var c=this.selectorRect,l=f,n=l.selectorGrips,b=this.selectedElement,d=b.getAttribute("stroke-width"),e=a.currentZoom(),m=1/e;if(b.getAttribute("stroke")!=="none"&&
!isNaN(d))m+=d/2;var q=b.tagName;if(q==="text")m+=2/e;d=svgedit.transformlist.getTransformList(b);d=svgedit.math.transformListToTransform(d).matrix;d.e*=e;d.f*=e;var v=svgedit.utilities.getBBox(b);if(q==="g"&&!$.data(b,"gsvg"))if(q=a.getStrokedBBox(b.childNodes))v=q;q=v.x;var p=v.y,I=v.width;v=v.height;m*=e;e=svgedit.math.transformBox(q*e,p*e,I*e,v*e,d);d=e.aabox;q=d.x-m;p=d.y-m;I=d.width+m*2;var V=d.height+m*2;d=q+I/2;v=p+V/2;if(b=svgedit.utilities.getRotationAngle(b)){q=a.svgRoot().createSVGTransform();
q.setRotate(-b,d,v);q=q.matrix;e.tl=svgedit.math.transformPoint(e.tl.x,e.tl.y,q);e.tr=svgedit.math.transformPoint(e.tr.x,e.tr.y,q);e.bl=svgedit.math.transformPoint(e.bl.x,e.bl.y,q);e.br=svgedit.math.transformPoint(e.br.x,e.br.y,q);q=e.tl;I=q.x;V=q.y;var M=q.x,H=q.y;q=Math.min;p=Math.max;I=q(I,q(e.tr.x,q(e.bl.x,e.br.x)))-m;V=q(V,q(e.tr.y,q(e.bl.y,e.br.y)))-m;M=p(M,p(e.tr.x,p(e.bl.x,e.br.x)))+m;H=p(H,p(e.tr.y,p(e.bl.y,e.br.y)))+m;q=I;p=V;I=M-I;V=H-V}m=a.svgRoot().suspendRedraw(100);c.setAttribute("d",
"M"+q+","+p+" L"+(q+I)+","+p+" "+(q+I)+","+(p+V)+" "+q+","+(p+V)+"z");this.selectorGroup.setAttribute("transform",b?"rotate("+[b,d,v].join(",")+")":"");q-=3.5;p-=3.5;this.gripCoords={nw:[q,p],ne:[q+I,p],sw:[q,p+V],se:[q+I,p+V],n:[q+I/2,p],w:[q,p+V/2],e:[q+I,p+V/2],s:[q+I/2,p+V]};for(var aa in this.gripCoords){c=this.gripCoords[aa];n[aa].setAttribute("x",c[0]);n[aa].setAttribute("y",c[1])}this.rotateCoords={nw:[q,p],ne:[q+I+8,p],sw:[q,p+V+8],se:[q+I+8,p+V+8]};for(aa in this.rotateCoords){c=this.rotateCoords[aa];
l.rotateGrips[aa].setAttribute("cx",c[0]);l.rotateGrips[aa].setAttribute("cy",c[1])}a.svgRoot().unsuspendRedraw(m)};svgedit.select.SelectorManager=function(){this.rubberBandBox=this.selectorParentGroup=null;this.selectors=[];this.selectorMap={};this.selectorGrips={nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null};this.selectorGripsGroup=null;this.rotateGrips={nw:null,ne:null,se:null,sw:null};this.initGroup()};svgedit.select.SelectorManager.prototype.initGroup=function(){this.selectorParentGroup&&
this.selectorParentGroup.parentNode&&this.selectorParentGroup.parentNode.removeChild(this.selectorParentGroup);this.selectorParentGroup=a.createSVGElement({element:"g",attr:{id:"selectorParentGroup"}});this.selectorGripsGroup=a.createSVGElement({element:"g",attr:{display:"none"}});this.selectorParentGroup.appendChild(this.selectorGripsGroup);a.svgRoot().appendChild(this.selectorParentGroup);this.selectorMap={};this.selectors=[];this.rubberBandBox=null;for(var c in this.rotateGrips){var l=a.createSVGElement({element:"circle",
attr:{id:"selectorGrip_rotate_"+c,fill:"#000",r:8,stroke:"#000","fill-opacity":0,"stroke-opacity":0,"stroke-width":0,style:"cursor:url("+o.imgPath+"rotate.png) 12 12, auto;"}});$.data(l,"dir",c);$.data(l,"type","rotate");this.rotateGrips[c]=this.selectorGripsGroup.appendChild(l)}for(c in this.selectorGrips){l=a.createSVGElement({element:"rect",attr:{id:"selectorGrip_resize_"+c,width:7,height:7,fill:"#4F80FF",stroke:"transparent","stroke-width":2,style:"cursor:"+c+"-resize","pointer-events":"all"}});
$.data(l,"dir",c);$.data(l,"type","resize");this.selectorGrips[c]=this.selectorGripsGroup.appendChild(l)}if(!$("#canvasBackground").length){c=o.dimensions;c=a.createSVGElement({element:"svg",attr:{id:"canvasBackground",width:c[0],height:c[1],x:0,y:0,overflow:svgedit.browser.isWebkit()?"none":"visible",style:"pointer-events:none"}});l=a.createSVGElement({element:"rect",attr:{width:"100%",height:"100%",x:0,y:0,"stroke-width":1,stroke:"#000",fill:"#FFF",style:"pointer-events:none"}});c.appendChild(l);
a.svgRoot().insertBefore(c,a.svgContent())}};svgedit.select.SelectorManager.prototype.requestSelector=function(c){if(c==null)return null;var l=this.selectors.length;if(typeof this.selectorMap[c.id]=="object"){this.selectorMap[c.id].locked=true;return this.selectorMap[c.id]}for(var n=0;n<l;++n)if(this.selectors[n]&&!this.selectors[n].locked){this.selectors[n].locked=true;this.selectors[n].reset(c);this.selectorMap[c.id]=this.selectors[n];return this.selectors[n]}this.selectors[l]=new svgedit.select.Selector(l,
c);this.selectorParentGroup.appendChild(this.selectors[l].selectorGroup);this.selectorMap[c.id]=this.selectors[l];return this.selectors[l]};svgedit.select.SelectorManager.prototype.releaseSelector=function(c){if(c!=null)for(var l=this.selectors.length,n=this.selectorMap[c.id],b=0;b<l;++b)if(this.selectors[b]&&this.selectors[b]==n){n.locked==false&&console.log("WARNING! selector was released but was already unlocked");delete this.selectorMap[c.id];n.locked=false;n.selectedElement=null;n.showGrips(false);
try{n.selectorGroup.setAttribute("display","none")}catch(d){}break}};svgedit.select.SelectorManager.prototype.getRubberBandBox=function(){if(!this.rubberBandBox)this.rubberBandBox=this.selectorParentGroup.appendChild(a.createSVGElement({element:"rect",attr:{id:"selectorRubberBand",fill:"transparent",stroke:"#666","stroke-width":1,"stroke-dasharray":"3,2",display:"none",style:"pointer-events:none"}}));return this.rubberBandBox};svgedit.select.init=function(c,l){o=c;a=l;f=new svgedit.select.SelectorManager};
svgedit.select.getSelectorManager=function(){return f}})();svgedit=svgedit||{};
(function(){if(!svgedit.draw)svgedit.draw={};var a="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use".split(","),o={LET_DOCUMENT_DECIDE:0,ALWAYS_RANDOMIZE:1,NEVER_RANDOMIZE:2},f=o.LET_DOCUMENT_DECIDE;svgedit.draw.Layer=function(c,l){this.name_=c;this.group_=l};svgedit.draw.Layer.prototype.getName=function(){return this.name_};svgedit.draw.Layer.prototype.getGroup=function(){return this.group_};svgedit.draw.randomizeIds=function(c,l){f=c==false?o.NEVER_RANDOMIZE:
o.ALWAYS_RANDOMIZE;if(f==o.ALWAYS_RANDOMIZE&&!l.getNonce())l.setNonce(Math.floor(Math.random()*100001));else f==o.NEVER_RANDOMIZE&&l.getNonce()&&l.clearNonce()};svgedit.draw.Drawing=function(c,l){if(!c||!c.tagName||!c.namespaceURI||c.tagName!="svg"||c.namespaceURI!="http://www.w3.org/2000/svg")throw"Error: svgedit.draw.Drawing instance initialized without a <svg> element";this.svgElem_=c;this.obj_num=0;this.idPrefix=l||"svg_";this.releasedNums=[];this.all_layers=[];this.current_layer=null;this.nonce_=
"";var n=this.svgElem_.getAttributeNS("http://svg-edit.googlecode.com","nonce");if(n&&f!=o.NEVER_RANDOMIZE)this.nonce_=n;else f==o.ALWAYS_RANDOMIZE&&this.setNonce(Math.floor(Math.random()*100001))};svgedit.draw.Drawing.prototype.getElem_=function(c){return this.svgElem_.querySelector?this.svgElem_.querySelector("#"+c):$(this.svgElem_).find("[id="+c+"]")[0]};svgedit.draw.Drawing.prototype.getSvgElem=function(){return this.svgElem_};svgedit.draw.Drawing.prototype.getNonce=function(){return this.nonce_};
svgedit.draw.Drawing.prototype.setNonce=function(c){this.svgElem_.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:se","http://svg-edit.googlecode.com");this.svgElem_.setAttributeNS("http://svg-edit.googlecode.com","se:nonce",c);this.nonce_=c};svgedit.draw.Drawing.prototype.clearNonce=function(){this.nonce_=""};svgedit.draw.Drawing.prototype.getId=function(){return this.nonce_?this.idPrefix+this.nonce_+"_"+this.obj_num:this.idPrefix+this.obj_num};svgedit.draw.Drawing.prototype.getNextId=function(){var c=
this.obj_num,l=false;if(this.releasedNums.length>0){this.obj_num=this.releasedNums.pop();l=true}else this.obj_num++;for(var n=this.getId();this.getElem_(n);){if(l){this.obj_num=c;l=false}this.obj_num++;n=this.getId()}if(l)this.obj_num=c;return n};svgedit.draw.Drawing.prototype.releaseId=function(c){var l=this.idPrefix+(this.nonce_?this.nonce_+"_":"");if(typeof c!="string"||c.indexOf(l)!=0)return false;c=parseInt(c.substr(l.length));if(typeof c!="number"||c<=0||this.releasedNums.indexOf(c)!=-1)return false;
this.releasedNums.push(c);return true};svgedit.draw.Drawing.prototype.getNumLayers=function(){return this.all_layers.length};svgedit.draw.Drawing.prototype.hasLayer=function(c){for(var l=0;l<this.getNumLayers();l++)if(this.all_layers[l][0]==c)return true;return false};svgedit.draw.Drawing.prototype.getLayerName=function(c){if(c>=0&&c<this.getNumLayers())return this.all_layers[c][0];return""};svgedit.draw.Drawing.prototype.getCurrentLayer=function(){return this.current_layer};svgedit.draw.Drawing.prototype.getCurrentLayerName=
function(){for(var c=0;c<this.getNumLayers();++c)if(this.all_layers[c][1]==this.current_layer)return this.getLayerName(c);return""};svgedit.draw.Drawing.prototype.setCurrentLayer=function(c){for(var l=0;l<this.getNumLayers();++l)if(c==this.getLayerName(l)){if(this.current_layer!=this.all_layers[l][1]){this.current_layer.setAttribute("style","pointer-events:none");this.current_layer=this.all_layers[l][1];this.current_layer.setAttribute("style","pointer-events:all")}return true}return false};svgedit.draw.Drawing.prototype.deleteCurrentLayer=
function(){if(this.current_layer&&this.getNumLayers()>1){var c=this.current_layer.parentNode.removeChild(this.current_layer);this.identifyLayers();return c}return null};svgedit.draw.Drawing.prototype.identifyLayers=function(){this.all_layers=[];for(var c=this.svgElem_.childNodes.length,l=[],n=[],b=null,d=false,e=0;e<c;++e){var m=this.svgElem_.childNodes.item(e);if(m&&m.nodeType==1)if(m.tagName=="g"){d=true;var q=$("title",m).text();if(!q&&svgedit.browser.isOpera()&&m.querySelectorAll)q=$(m.querySelectorAll("title")).text();
if(q){n.push(q);this.all_layers.push([q,m]);b=m;svgedit.utilities.walkTree(m,function(v){v.setAttribute("style","pointer-events:inherit")});b.setAttribute("style","pointer-events:none")}else l.push(m)}else if(~a.indexOf(m.nodeName)){svgedit.utilities.getBBox(m);l.push(m)}}c=this.svgElem_.ownerDocument;if(l.length>0||!d){for(e=1;n.indexOf("Layer "+e)>=0;)e++;n="Layer "+e;b=c.createElementNS("http://www.w3.org/2000/svg","g");d=c.createElementNS("http://www.w3.org/2000/svg","title");d.textContent=n;
b.appendChild(d);for(d=0;d<l.length;++d)b.appendChild(l[d]);this.svgElem_.appendChild(b);this.all_layers.push([n,b])}svgedit.utilities.walkTree(b,function(v){v.setAttribute("style","pointer-events:inherit")});this.current_layer=b;this.current_layer.setAttribute("style","pointer-events:all")};svgedit.draw.Drawing.prototype.createLayer=function(c){var l=this.svgElem_.ownerDocument,n=l.createElementNS("http://www.w3.org/2000/svg","g");l=l.createElementNS("http://www.w3.org/2000/svg","title");l.textContent=
c;n.appendChild(l);this.svgElem_.appendChild(n);this.identifyLayers();return n};svgedit.draw.Drawing.prototype.getLayerVisibility=function(c){for(var l=null,n=0;n<this.getNumLayers();++n)if(this.getLayerName(n)==c){l=this.all_layers[n][1];break}if(!l)return false;return l.getAttribute("display")!="none"};svgedit.draw.Drawing.prototype.setLayerVisibility=function(c,l){if(typeof l!="boolean")return null;for(var n=null,b=0;b<this.getNumLayers();++b)if(this.getLayerName(b)==c){n=this.all_layers[b][1];
break}if(!n)return null;n.getAttribute("display");n.setAttribute("display",l?"inline":"none");return n};svgedit.draw.Drawing.prototype.getLayerOpacity=function(c){for(var l=0;l<this.getNumLayers();++l)if(this.getLayerName(l)==c){(c=this.all_layers[l][1].getAttribute("opacity"))||(c="1.0");return parseFloat(c)}return null};svgedit.draw.Drawing.prototype.setLayerOpacity=function(c,l){if(!(typeof l!="number"||l<0||l>1))for(var n=0;n<this.getNumLayers();++n)if(this.getLayerName(n)==c){this.all_layers[n][1].setAttribute("opacity",
l);break}}})();svgedit=svgedit||{};
(function(){if(!svgedit.path)svgedit.path={};var a={pathNodeTooltip:"Drag node to move it. Double-click node to change segment type",pathCtrlPtTooltip:"Drag control point to adjust curve properties"},o={2:["x","y"],4:["x","y"],6:["x","y","x1","y1","x2","y2"],8:["x","y","x1","y1"],10:["x","y","r1","r2","angle","largeArcFlag","sweepFlag"],12:["x"],14:["y"],16:["x","y","x2","y2"],18:["x","y"]},f=[],c=true,l={};svgedit.path.setLinkControlPoints=function(d){c=d};var n=svgedit.path.path=null;svgedit.path.init=
function(d){n=d;f=[0,"ClosePath"];$.each(["Moveto","Lineto","CurvetoCubic","CurvetoQuadratic","Arc","LinetoHorizontal","LinetoVertical","CurvetoCubicSmooth","CurvetoQuadraticSmooth"],function(e,m){f.push(m+"Abs");f.push(m+"Rel")})};svgedit.path.insertItemBefore=function(d,e,m){d=d.pathSegList;if(svgedit.browser.supportsPathInsertItemBefore())d.insertItemBefore(e,m);else{for(var q=d.numberOfItems,v=[],p=0;p<q;p++){var I=d.getItem(p);v.push(I)}d.clear();for(p=0;p<q;p++){p==m&&d.appendItem(e);d.appendItem(v[p])}}};
svgedit.path.ptObjToArr=function(d,e){for(var m=o[d],q=m.length,v=Array(q),p=0;p<q;p++)v[p]=e[m[p]];return v};svgedit.path.getGripPt=function(d,e){var m={x:e?e.x:d.item.x,y:e?e.y:d.item.y},q=d.path;if(q.matrix)m=svgedit.math.transformPoint(m.x,m.y,q.matrix);m.x*=n.getCurrentZoom();m.y*=n.getCurrentZoom();return m};svgedit.path.getPointFromGrip=function(d,e){var m={x:d.x,y:d.y};if(e.matrix){d=svgedit.math.transformPoint(m.x,m.y,e.imatrix);m.x=d.x;m.y=d.y}m.x/=n.getCurrentZoom();m.y/=n.getCurrentZoom();
return m};svgedit.path.addPointGrip=function(d,e,m){var q=svgedit.path.getGripContainer(),v=svgedit.utilities.getElem("pathpointgrip_"+d);if(!v){v=document.createElementNS("http://www.w3.org/2000/svg","rect");svgedit.utilities.assignAttributes(v,{id:"pathpointgrip_"+d,display:"none",width:5,height:5,fill:"#fff",stroke:"#4F80FF","shape-rendering":"crispEdges","stroke-width":1,cursor:"move",style:"pointer-events:all","xlink:title":a.pathNodeTooltip});v=q.appendChild(v);$("#pathpointgrip_"+d).dblclick(function(){svgedit.path.path&&
svgedit.path.path.setSegType()})}e&&m&&svgedit.utilities.assignAttributes(v,{x:e-2.5,y:m-2.5,display:"inline"});return v};svgedit.path.getGripContainer=function(){var d=svgedit.utilities.getElem("pathpointgrip_container");if(!d){d=svgedit.utilities.getElem("selectorParentGroup").appendChild(document.createElementNS("http://www.w3.org/2000/svg","g"));d.id="pathpointgrip_container"}return d};svgedit.path.addCtrlGrip=function(d){var e=svgedit.utilities.getElem("ctrlpointgrip_"+d);if(e)return e;e=document.createElementNS("http://www.w3.org/2000/svg",
"circle");svgedit.utilities.assignAttributes(e,{id:"ctrlpointgrip_"+d,display:"none",r:3,fill:"#4F80FF",cursor:"move",style:"pointer-events:all","xlink:title":a.pathCtrlPtTooltip});svgedit.path.getGripContainer().appendChild(e);return e};svgedit.path.getCtrlLine=function(d){var e=svgedit.utilities.getElem("ctrlLine_"+d);if(e)return e;e=document.createElementNS("http://www.w3.org/2000/svg","line");svgedit.utilities.assignAttributes(e,{id:"ctrlLine_"+d,stroke:"#4F80FF","stroke-width":1,style:"pointer-events:none"});
svgedit.path.getGripContainer().appendChild(e);return e};svgedit.path.getPointGrip=function(d,e){var m=svgedit.path.addPointGrip(d.index);if(e){var q=svgedit.path.getGripPt(d);svgedit.utilities.assignAttributes(m,{x:q.x-2.5,y:q.y-2.5,display:"inline"})}return m};svgedit.path.getControlPoints=function(d){var e=d.item,m=d.index;if(!("x1"in e)||!("x2"in e))return null;var q={};svgedit.path.getGripContainer();for(var v=[svgedit.path.path.segs[m-1].item,e],p=1;p<3;p++){var I=m+"c"+p,V=q["c"+p+"_line"]=
svgedit.path.getCtrlLine(I),M=svgedit.path.getGripPt(d,{x:e["x"+p],y:e["y"+p]}),H=svgedit.path.getGripPt(d,{x:v[p-1].x,y:v[p-1].y});svgedit.utilities.assignAttributes(V,{x1:M.x,y1:M.y,x2:H.x,y2:H.y,display:"inline"});q["c"+p+"_line"]=V;pointGrip=q["c"+p]=svgedit.path.addCtrlGrip(I);svgedit.utilities.assignAttributes(pointGrip,{cx:M.x,cy:M.y,display:"inline"});q["c"+p]=pointGrip}return q};svgedit.path.replacePathSeg=function(d,e,m,q){q=q||svgedit.path.path.elem;d=q["createSVGPathSeg"+f[d]].apply(q,
m);if(svgedit.browser.supportsPathReplaceItem())q.pathSegList.replaceItem(d,e);else{m=q.pathSegList;q=m.numberOfItems;for(var v=[],p=0;p<q;p++){var I=m.getItem(p);v.push(I)}m.clear();for(p=0;p<q;p++)p==e?m.appendItem(d):m.appendItem(v[p])}};svgedit.path.getSegSelector=function(d,e){var m=d.index,q=svgedit.utilities.getElem("segline_"+m);if(!q){var v=svgedit.path.getGripContainer();q=document.createElementNS("http://www.w3.org/2000/svg","path");svgedit.utilities.assignAttributes(q,{id:"segline_"+m,
display:"none",fill:"none",stroke:"#0FF","stroke-width":2,style:"pointer-events:none",d:"M0,0 0,0"});v.appendChild(q)}if(e){m=d.prev;if(!m){q.setAttribute("display","none");return q}m=svgedit.path.getGripPt(m);svgedit.path.replacePathSeg(2,0,[m.x,m.y],q);v=svgedit.path.ptObjToArr(d.type,d.item,true);for(var p=0;p<v.length;p+=2){m=svgedit.path.getGripPt(d,{x:v[p],y:v[p+1]});v[p]=m.x;v[p+1]=m.y}svgedit.path.replacePathSeg(d.type,1,v,q)}return q};svgedit.path.smoothControlPoints=this.smoothControlPoints=
function(d,e,m){var q=d.x-m.x,v=d.y-m.y,p=e.x-m.x,I=e.y-m.y;if((q!=0||v!=0)&&(p!=0||I!=0)){d=Math.atan2(v,q);e=Math.atan2(I,p);q=Math.sqrt(q*q+v*v);p=Math.sqrt(p*p+I*I);v=n.getSVGRoot().createSVGPoint();I=n.getSVGRoot().createSVGPoint();if(d<0)d+=2*Math.PI;if(e<0)e+=2*Math.PI;var V=Math.abs(d-e),M=Math.abs(Math.PI-V)/2;if(d-e>0){d=V<Math.PI?d+M:d-M;e=V<Math.PI?e-M:e+M}else{d=V<Math.PI?d-M:d+M;e=V<Math.PI?e+M:e-M}v.x=q*Math.cos(d)+m.x;v.y=q*Math.sin(d)+m.y;I.x=p*Math.cos(e)+m.x;I.y=p*Math.sin(e)+m.y;
return[v,I]}};svgedit.path.Segment=function(d,e){this.selected=false;this.index=d;this.item=e;this.type=e.pathSegType;this.ctrlpts=[];this.segsel=this.ptgrip=null};svgedit.path.Segment.prototype.showCtrlPts=function(d){for(var e in this.ctrlpts)this.ctrlpts[e].setAttribute("display",d?"inline":"none")};svgedit.path.Segment.prototype.selectCtrls=function(){$("#ctrlpointgrip_"+this.index+"c1, #ctrlpointgrip_"+this.index+"c2").attr("fill","#4F80FF")};svgedit.path.Segment.prototype.show=function(d){if(this.ptgrip){this.ptgrip.setAttribute("display",
d?"inline":"none");this.segsel.setAttribute("display",d?"inline":"none");this.showCtrlPts(d)}};svgedit.path.Segment.prototype.select=function(d){if(this.ptgrip){this.ptgrip.setAttribute("stroke",d?"#0FF":"#00F");this.segsel.setAttribute("display",d?"inline":"none");this.ctrlpts&&this.selectCtrls(d);this.selected=d}};svgedit.path.Segment.prototype.addGrip=function(){this.ptgrip=svgedit.path.getPointGrip(this,true);this.ctrlpts=svgedit.path.getControlPoints(this,true);this.segsel=svgedit.path.getSegSelector(this,
true)};svgedit.path.Segment.prototype.update=function(d){if(this.ptgrip){var e=svgedit.path.getGripPt(this);svgedit.utilities.assignAttributes(this.ptgrip,this.ptgrip.nodeName=="rect"?{x:e.x-2.5,y:e.y-2.5}:{cx:e.x,cy:e.y});svgedit.path.getSegSelector(this,true);if(this.ctrlpts){if(d){this.item=svgedit.path.path.elem.pathSegList.getItem(this.index);this.type=this.item.pathSegType}svgedit.path.getControlPoints(this)}}};svgedit.path.Segment.prototype.move=function(d,e){var m=this.item;m=this.ctrlpts?
[m.x+=d,m.y+=e,m.x1,m.y1,m.x2+=d,m.y2+=e]:[m.x+=d,m.y+=e];svgedit.path.replacePathSeg(this.type,this.index,m);if(this.next&&this.next.ctrlpts){m=this.next.item;m=[m.x,m.y,m.x1+=d,m.y1+=e,m.x2,m.y2];svgedit.path.replacePathSeg(this.next.type,this.next.index,m)}if(this.mate){m=this.mate.item;m=[m.x+=d,m.y+=e];svgedit.path.replacePathSeg(this.mate.type,this.mate.index,m)}this.update(true);this.next&&this.next.update(true)};svgedit.path.Segment.prototype.setLinked=function(d){var e,m,q;if(d==2){m=1;e=
this.next;if(!e)return;q=this.item}else{m=2;e=this.prev;if(!e)return;q=e.item}var v=e.item;v["x"+m]=q.x+(q.x-this.item["x"+d]);v["y"+m]=q.y+(q.y-this.item["y"+d]);svgedit.path.replacePathSeg(e.type,e.index,[v.x,v.y,v.x1,v.y1,v.x2,v.y2]);e.update(true)};svgedit.path.Segment.prototype.moveCtrl=function(d,e,m){var q=this.item;q["x"+d]+=e;q["y"+d]+=m;svgedit.path.replacePathSeg(this.type,this.index,[q.x,q.y,q.x1,q.y1,q.x2,q.y2]);this.update(true)};svgedit.path.Segment.prototype.setType=function(d,e){svgedit.path.replacePathSeg(d,
this.index,e);this.type=d;this.item=svgedit.path.path.elem.pathSegList.getItem(this.index);this.showCtrlPts(d===6);this.ctrlpts=svgedit.path.getControlPoints(this);this.update(true)};svgedit.path.Path=function(d){if(!d||d.tagName!=="path")throw"svgedit.path.Path constructed without a <path> element";this.elem=d;this.segs=[];this.selected_pts=[];svgedit.path.path=this;this.init()};svgedit.path.Path.prototype.init=function(){$(svgedit.path.getGripContainer()).find("*").attr("display","none");var d=
this.elem.pathSegList,e=d.numberOfItems;this.segs=[];this.selected_pts=[];this.first_seg=null;for(var m=0;m<e;m++){var q=d.getItem(m);q=new svgedit.path.Segment(m,q);q.path=this;this.segs.push(q)}d=this.segs;q=null;for(m=0;m<e;m++){var v=d[m],p=m+1>=e?null:d[m+1],I=m-1<0?null:d[m-1];if(v.type===2){if(I&&I.type!==1){p=d[q];p.next=d[q+1];p.next.prev=p;p.addGrip()}q=m}else if(p&&p.type===1){v.next=d[q+1];v.next.prev=v;v.mate=d[q];v.addGrip();if(this.first_seg==null)this.first_seg=v}else if(p){if(v.type!==
1){v.addGrip();if(p&&p.type!==2){v.next=p;v.next.prev=v}}}else if(v.type!==1){p=d[q];p.next=d[q+1];p.next.prev=p;p.addGrip();v.addGrip();if(!this.first_seg)this.first_seg=d[q]}}return this};svgedit.path.Path.prototype.eachSeg=function(d){for(var e=this.segs.length,m=0;m<e;m++)if(d.call(this.segs[m],m)===false)break};svgedit.path.Path.prototype.addSeg=function(d){var e=this.segs[d];if(e.prev){var m=e.prev,q;switch(e.item.pathSegType){case 4:var v=(e.item.x+m.item.x)/2,p=(e.item.y+m.item.y)/2;q=this.elem.createSVGPathSegLinetoAbs(v,
p);break;case 6:q=(m.item.x+e.item.x1)/2;var I=(e.item.x1+e.item.x2)/2,V=(e.item.x2+e.item.x)/2,M=(q+I)/2;I=(I+V)/2;v=(M+I)/2;var H=(m.item.y+e.item.y1)/2,aa=(e.item.y1+e.item.y2)/2;m=(e.item.y2+e.item.y)/2;var T=(H+aa)/2;aa=(aa+m)/2;p=(T+aa)/2;q=this.elem.createSVGPathSegCurvetoCubicAbs(v,p,q,H,M,T);svgedit.path.replacePathSeg(e.type,d,[e.item.x,e.item.y,I,aa,V,m])}svgedit.path.insertItemBefore(this.elem,q,d)}};svgedit.path.Path.prototype.deleteSeg=function(d){var e=this.segs[d],m=this.elem.pathSegList;
e.show(false);var q=e.next;if(e.mate){var v=[q.item.x,q.item.y];svgedit.path.replacePathSeg(2,q.index,v);svgedit.path.replacePathSeg(4,e.index,v);m.removeItem(e.mate.index)}else{if(!e.prev){v=[q.item.x,q.item.y];svgedit.path.replacePathSeg(2,e.next.index,v)}m.removeItem(d)}};svgedit.path.Path.prototype.subpathIsClosed=function(d){var e=false;svgedit.path.path.eachSeg(function(m){if(m<=d)return true;if(this.type===2)return false;else if(this.type===1){e=true;return false}});return e};svgedit.path.Path.prototype.removePtFromSelection=
function(d){var e=this.selected_pts.indexOf(d);if(e!=-1){this.segs[d].select(false);this.selected_pts.splice(e,1)}};svgedit.path.Path.prototype.clearSelection=function(){this.eachSeg(function(){this.select(false)});this.selected_pts=[]};svgedit.path.Path.prototype.storeD=function(){this.last_d=this.elem.getAttribute("d")};svgedit.path.Path.prototype.show=function(d){this.eachSeg(function(){this.show(d)});d&&this.selectPt(this.first_seg.index);return this};svgedit.path.Path.prototype.movePts=function(d,
e){for(var m=this.selected_pts.length;m--;)this.segs[this.selected_pts[m]].move(d,e)};svgedit.path.Path.prototype.moveCtrl=function(d,e){var m=this.segs[this.selected_pts[0]];m.moveCtrl(this.dragctrl,d,e);c&&m.setLinked(this.dragctrl)};svgedit.path.Path.prototype.setSegType=function(d){this.storeD();for(var e=this.selected_pts.length,m;e--;){var q=this.segs[this.selected_pts[e]],v=q.prev;if(v){if(!d){m="Toggle Path Segment Type";d=q.type==6?4:6}d-=0;var p=q.item.x,I=q.item.y,V=v.item.x;v=v.item.y;
var M;switch(d){case 6:if(q.olditem){V=q.olditem;M=[p,I,V.x1,V.y1,V.x2,V.y2]}else{M=p-V;var H=I-v;M=[p,I,V+M/3,v+H/3,p-M/3,I-H/3]}break;case 4:M=[p,I];q.olditem=q.item}q.setType(d,M)}}svgedit.path.path.endChanges(m)};svgedit.path.Path.prototype.selectPt=function(d,e){this.clearSelection();d==null&&this.eachSeg(function(m){if(this.prev)d=m});this.addPtsToSelection(d);if(e){this.dragctrl=e;c&&this.segs[d].setLinked(e)}};svgedit.path.Path.prototype.update=function(){var d=this.elem;if(svgedit.utilities.getRotationAngle(d)){this.matrix=
svgedit.math.getMatrix(d);this.imatrix=this.matrix.inverse()}else this.imatrix=this.matrix=null;this.eachSeg(function(e){this.item=d.pathSegList.getItem(e);this.update()});return this};svgedit.path.getPath_=function(d){var e=l[d.id];e||(e=l[d.id]=new svgedit.path.Path(d));return e};svgedit.path.removePath_=function(d){d in l&&delete l[d]};var b=function(d,e){dx=d-oldcx;dy=e-oldcy;r=Math.sqrt(dx*dx+dy*dy);theta=Math.atan2(dy,dx)+angle;dx=r*Math.cos(theta)+oldcx;dy=r*Math.sin(theta)+oldcy;dx-=newcx;
dy-=newcy;r=Math.sqrt(dx*dx+dy*dy);theta=Math.atan2(dy,dx)-angle;return{x:(r*Math.cos(theta)+newcx)/1,y:(r*Math.sin(theta)+newcy)/1}};svgedit.path.recalcRotatedPath=function(){var d=svgedit.path.path.elem,e=svgedit.utilities.getRotationAngle(d,true);if(e){var m=svgedit.utilities.getBBox(d),q=svgedit.path.path.oldbbox,v=q.x+q.width/2,p=q.y+q.height/2;q=m.x+m.width/2;m=m.y+m.height/2;q=q-v;var I=m-p;m=Math.sqrt(q*q+I*I);I=Math.atan2(I,q)+e;q=m*Math.cos(I)+v;m=m*Math.sin(I)+p;v=d.pathSegList;for(p=v.numberOfItems;p;){p-=
1;I=v.getItem(p);var V=I.pathSegType;if(V!=1){var M=b(I.x,I.y);M=[M.x,M.y];if(I.x1!=null&&I.x2!=null){c_vals1=b(I.x1,I.y1);c_vals2=b(I.x2,I.y2);M.splice(M.length,0,c_vals1.x,c_vals1.y,c_vals2.x,c_vals2.y)}svgedit.path.replacePathSeg(V,p,M)}}svgedit.utilities.getBBox(d);v=svgroot.createSVGTransform();d=svgedit.transformlist.getTransformList(d);v.setRotate(e*180/Math.PI,q,m);d.replaceItem(v,0)}};svgedit.path.clearData=function(){l={}}})();if(!window.console){window.console={};window.console.log=function(){};window.console.dir=function(){}}if(window.opera){window.console.log=function(a){opera.postError(a)};window.console.dir=function(){}}
(function(){var a=jQuery.fn.attr;jQuery.fn.attr=function(o,f){var c=this.length;if(!c)return a.apply(this,arguments);for(var l=0;l<c;l++){var n=this[l];if(n.namespaceURI==="http://www.w3.org/2000/svg")if(f!==undefined)n.setAttribute(o,f);else if($.isArray(o)){c=o.length;for(l={};c--;){var b=o[c],d=n.getAttribute(b);if(d||d==="0")d=isNaN(d)?d:d-0;l[b]=d}return l}else if(typeof o==="object")for(b in o)n.setAttribute(b,o[b]);else{if((d=n.getAttribute(o))||d==="0")d=isNaN(d)?d:d-0;return d}else return a.apply(this,
arguments)}return this}})();
$.SvgCanvas=function(a,o){function f(g,h){for(var k=svgedit.utilities.getBBox(g),w=0;w<2;w++){var u=w===0?"fill":"stroke",G=g.getAttribute(u);if(G&&G.indexOf("url(")===0){G=ga(G);if(G.tagName==="linearGradient"){var z=G.getAttribute("x1")||0,A=G.getAttribute("y1")||0,C=G.getAttribute("x2")||1,F=G.getAttribute("y2")||0;z=k.width*z+k.x;A=k.height*A+k.y;C=k.width*C+k.x;F=k.height*F+k.y;z=P(z,A,h);F=P(C,F,h);C={};C.x1=(z.x-k.x)/k.width;C.y1=(z.y-k.y)/k.height;C.x2=(F.x-k.x)/k.width;C.y2=(F.y-k.y)/k.height;
G=G.cloneNode(true);$(G).attr(C);G.id=Q();Bb().appendChild(G);g.setAttribute(u,"url(#"+G.id+")")}}}}var c="http://www.w3.org/2000/svg",l={show_outside_canvas:true,selectNew:true,dimensions:[640,480]};o&&$.extend(l,o);var n=l.dimensions,b=this,d=a.ownerDocument,e=d.importNode(svgedit.utilities.text2xml('<svg id="svgroot" xmlns="'+c+'" xlinkns="http://www.w3.org/1999/xlink" width="'+n[0]+'" height="'+n[1]+'" x="'+n[0]+'" y="'+n[1]+'" overflow="visible"><defs><filter id="canvashadow" filterUnits="objectBoundingBox"><feGaussianBlur in="SourceAlpha" stdDeviation="4" result="blur"/><feOffset in="blur" dx="5" dy="5" result="offsetBlur"/><feMerge><feMergeNode in="offsetBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs></svg>').documentElement,
true);a.appendChild(e);var m=d.createElementNS(c,"svg");(b.clearSvgContentElement=function(){for(;m.firstChild;)m.removeChild(m.firstChild);$(m).attr({id:"svgcontent",width:n[0],height:n[1],x:n[0],y:n[1],overflow:l.show_outside_canvas?"visible":"hidden",xmlns:c,"xmlns:se":"http://svg-edit.googlecode.com","xmlns:xlink":"http://www.w3.org/1999/xlink"}).appendTo(e);var g=d.createComment(" Created with Method Draw - http://github.com/duopixel/Method-Draw/ ");m.appendChild(g)})();var q="svg_";b.setIdPrefix=
function(g){q=g};b.current_drawing_=new svgedit.draw.Drawing(m,q);var v=b.getCurrentDrawing=function(){return b.current_drawing_},p=1,I=null,V={shape:{fill:(l.initFill.color=="none"?"":"#")+l.initFill.color,fill_paint:null,fill_opacity:l.initFill.opacity,stroke:"#"+l.initStroke.color,stroke_paint:null,stroke_opacity:l.initStroke.opacity,stroke_width:l.initStroke.width,stroke_dasharray:"none",stroke_linejoin:"miter",stroke_linecap:"butt",opacity:l.initOpacity}};V.text=$.extend(true,{},V.shape);$.extend(V.text,
{fill:"#000000",stroke_width:0,font_size:24,font_family:"Junction"});var M=V.shape,H=Array(1),aa=this.addSvgElementFromJson=function(g){var h=svgedit.utilities.getElem(g.attr.id),k=v().getCurrentLayer();if(h&&g.element!=h.tagName){k.removeChild(h);h=null}if(!h){h=d.createElementNS(c,g.element);if(k)(I||k).appendChild(h)}g.curStyles&&svgedit.utilities.assignAttributes(h,{fill:M.fill,stroke:M.stroke,"stroke-width":M.stroke_width,"stroke-dasharray":M.stroke_dasharray,"stroke-linejoin":M.stroke_linejoin,
"stroke-linecap":M.stroke_linecap,"stroke-opacity":M.stroke_opacity,"fill-opacity":M.fill_opacity,opacity:M.opacity/2,style:"pointer-events:inherit"},100);svgedit.utilities.assignAttributes(h,g.attr,100);svgedit.utilities.cleanupElement(h);return h},T=b.getTransformList=svgedit.transformlist.getTransformList,P=svgedit.math.transformPoint,R=b.matrixMultiply=svgedit.math.matrixMultiply,ea=b.hasMatrixTransform=svgedit.math.hasMatrixTransform,S=b.transformListToTransform=svgedit.math.transformListToTransform,
X=svgedit.math.snapToAngle,ba=svgedit.math.getMatrix;svgedit.units.init({getBaseUnit:function(){return l.baseUnit},getElement:svgedit.utilities.getElem,getHeight:function(){return m.getAttribute("height")/p},getWidth:function(){return m.getAttribute("width")/p},getRoundDigits:function(){return bb.round_digits}});var la=b.convertToNum=svgedit.units.convertToNum;svgedit.utilities.init({getDOMDocument:function(){return d},getDOMContainer:function(){return a},getSVGRoot:function(){return e},getSelectedElements:function(){return H},
getSVGContent:function(){return m}});var ka=b.getUrlFromAttr=svgedit.utilities.getUrlFromAttr,da=b.getHref=svgedit.utilities.getHref,Z=b.setHref=svgedit.utilities.setHref,Y=svgedit.utilities.getPathBBox;b.getBBox=svgedit.utilities.getBBox;var ma=b.getRotationAngle=svgedit.utilities.getRotationAngle,ua=b.getElem=svgedit.utilities.getElem,ha=b.assignAttributes=svgedit.utilities.assignAttributes,qa=this.cleanupElement=svgedit.utilities.cleanupElement,Ga=svgedit.sanitize.getNSMap(),Ma=b.sanitizeSvg=svgedit.sanitize.sanitizeSvg,
Ra=svgedit.history.MoveElementCommand,Qa=svgedit.history.InsertElementCommand,Va=svgedit.history.RemoveElementCommand,Xa=svgedit.history.ChangeElementCommand,Na=svgedit.history.BatchCommand;b.undoMgr=new svgedit.history.UndoManager({handleHistoryEvent:function(g,h){var k=svgedit.history.HistoryEventTypes;if(g==k.BEFORE_UNAPPLY||g==k.BEFORE_APPLY)b.clearSelection();else if(g==k.AFTER_APPLY||g==k.AFTER_UNAPPLY){var w=h.elements();b.pathActions.clear();J("changed",w);w=h.type();k=g==k.AFTER_APPLY;if(w==
Ra.type()){k=k?h.newParent:h.oldParent;k==m&&b.identifyLayers()}else if(w==Qa.type()||w==Va.type()){h.parent==m&&b.identifyLayers();if(w==Qa.type())k&&$a(h.elem);else k||$a(h.elem);h.elem.tagName==="use"&&gc(h.elem)}else if(w==Xa.type()){h.elem.tagName=="title"&&h.elem.parentNode.parentNode==m&&b.identifyLayers();k=k?h.newValues:h.oldValues;k.stdDeviation&&b.setBlurOffsets(h.elem.parentNode,k.stdDeviation);if(h.elem.tagName==="use"&&svgedit.browser.isWebkit()){w=h.elem;if(!w.getAttribute("x")&&!w.getAttribute("y")){k=
w.parentNode;var u=w.nextSibling;k.removeChild(w);k.insertBefore(w,u)}}}}}});var Ha=function(g){b.undoMgr.addCommandToHistory(g)};svgedit.select.init(l,{createSVGElement:function(g){return b.addSvgElementFromJson(g)},svgRoot:function(){return e},svgContent:function(){return m},currentZoom:function(){return p},getStrokedBBox:function(g){return b.getStrokedBBox([g])}});var Pa=this.selectorManager=svgedit.select.getSelectorManager(),zb=this.hoverManager=svgedit.select.getSelectorManager();svgedit.path.init({getCurrentZoom:function(){return p},
getSVGRoot:function(){return e}});svgedit.utilities.snapToGrid=function(g){var h=l.snappingStep,k=l.baseUnit;if(k!=="px")h*=svgedit.units.getTypeMap()[k];return g=Math.round(g/h)*h};var Ja=svgedit.utilities.snapToGrid,Jb={exportNoBlur:"Blurred elements will appear as un-blurred",exportNoforeignObject:"foreignObject elements will not appear",exportNoDashArray:"Strokes will appear filled",exportNoText:"Text may not appear as expected"},tb=["clip-path","fill","filter","marker-end","marker-mid","marker-start",
"mask","stroke"],ab=$.data,$a=function(g){var h=$(g).attr(tb),k;for(k in h){var w=h[k];if(w&&w.indexOf("url(")===0){w=ka(w).substr(1);if(!ua(w)){Bb().appendChild(Fb[w]);delete Fb[w]}}}g=g.getElementsByTagName("*");if(g.length){h=0;for(k=g.length;h<k;h++)$a(g[h])}},Ka={},Da=l.imgPath+"logo.png",yb=[],bb={round_digits:5},Sa=false,gb=null,Ia="select",rb="none",sb={},mb=V.text,hb=M,La=null,Wa=null,jb=[],Eb={},Fb={};b.clipBoard=[];var nb=this.runExtensions=function(g,h,k){var w=false;if(k)w=[];$.each(Eb,
function(u,G){if(g in G)if(k)w.push(G[g](h));else w=G[g](h)});return w};this.addExtension=function(g,h){if(g in Eb)console.log('Cannot add extension "'+g+'", an extension by that name already exists"');else{var k=$.isFunction(h)?h($.extend(b.getPrivateMethods(),{svgroot:e,svgcontent:m,nonce:v().getNonce(),selectorManager:Pa,hoverManager:zb})):h;Eb[g]=k;J("extension_added",k)}};var Gb=this.round=function(g){return parseInt(g*p)/p},Ob=this.getIntersectionList=function(g){if(Wa==null)return null;var h=
I||v().getCurrentLayer();jb.length||(jb=Ub(h));var k=null;try{k=h.getIntersectionList(g,null)}catch(w){}if(k==null||typeof k.item!="function"){k=[];if(g)g=g;else{g=Wa.getBBox();h={};for(var u in g)h[u]=g[u]/p;g=h}for(u=jb.length;u--;)g.width&&g.width&&svgedit.math.rectsIntersect(g,jb[u].bbox)&&k.push(jb[u].elem)}return k};getStrokedBBox=this.getStrokedBBox=function(g){g||(g=Kb());if(!g.length)return false;var h=function(F){try{var E=svgedit.utilities.getBBox(F),D=svgedit.utilities.getRotationAngle(F);
if(D&&D%90||svgedit.math.hasMatrixTransform(svgedit.transformlist.getTransformList(F))){D=false;if(["ellipse","path","line","polyline","polygon"].indexOf(F.tagName)>=0)E=D=b.convertToPath(F,true);else if(F.tagName=="rect"){var N=F.getAttribute("rx"),K=F.getAttribute("ry");if(N||K)E=D=b.convertToPath(F,true)}if(!D){var O=F.cloneNode(true),ca=document.createElementNS(c,"g"),U=F.parentNode;U.appendChild(ca);ca.appendChild(O);E=svgedit.utilities.bboxToObj(ca.getBBox());U.removeChild(ca)}}return E}catch(ta){console.log(F,
ta);return null}},k;$.each(g,function(){if(!k)if(this.parentNode)k=h(this)});if(k==null)return null;var w=k.x+k.width,u=k.y+k.height,G=k.x,z=k.y,A=function(F){var E=F.getAttribute("stroke-width"),D=0;if(F.getAttribute("stroke")!="none"&&!isNaN(E))D+=E/2;return D},C=[];$.each(g,function(F,E){var D=h(E);if(D){var N=A(E);G=Math.min(G,D.x-N);z=Math.min(z,D.y-N);C.push(D)}});k.x=G;k.y=z;$.each(g,function(F,E){var D=C[F];if(D&&E.nodeType==1){var N=A(E);w=Math.max(w,D.x+D.width+N);u=Math.max(u,D.y+D.height+
N)}});k.width=w-G;k.height=u-z;return k};var Kb=this.getVisibleElements=function(g){g||(g=$(m).children());var h=[];$(g).children().each(function(k,w){try{w.getBBox()&&h.push(w)}catch(u){}});return h.reverse()},Ub=this.getVisibleElementsAndBBoxes=function(g){g||(g=$(m).children());var h=[];$(g).children().each(function(k,w){try{w.getBBox()&&h.push({elem:w,bbox:getStrokedBBox([w])})}catch(u){}});return h.reverse()},ra=this.groupSvgElem=function(g){var h=document.createElementNS(c,"g");g.parentNode.replaceChild(h,
g);$(h).append(g).data("gsvg",g)[0].id=Q()},ia=function(g){var h=document.createElementNS(g.namespaceURI,g.nodeName);h.removeAttribute("id");$.each(g.attributes,function(w,u){u.localName!="-moz-math-font-style"&&h.setAttributeNS(u.namespaceURI,u.nodeName,u.nodeValue)});if(svgedit.browser.isWebkit()&&g.nodeName=="path"){var k=Ua.convertPath(g);h.setAttribute("d",k)}$.each(g.childNodes,function(w,u){switch(u.nodeType){case 1:h.appendChild(ia(u));break;case 3:h.textContent=u.nodeValue}});if($(g).data("gsvg"))$(h).data("gsvg",
h.firstChild);else if($(g).data("symbol")){g=$(g).data("symbol");$(h).data("ref",g).data("symbol",g)}else h.tagName=="image"&&Lb(h);h.id=Q();return h},va,Q,J;(function(g){var h={};va=g.getId=function(){return v().getId()};Q=g.getNextId=function(){return v().getNextId()};J=g.call=function(k,w){if(h[k])return h[k](this,w)};g.bind=function(k,w){var u=h[k];h[k]=w;return u}})(b);this.prepareSvg=function(g){this.sanitizeSvg(g.documentElement);g=g.getElementsByTagNameNS(c,"path");for(var h=0,k=g.length;h<
k;++h){var w=g[h];w.setAttribute("d",Ua.convertPath(w));Ua.fixEnd(w)}};var ga=this.getRefElem=function(g){return ua(ka(g).substr(1))},Oa=function(g){if(!svgedit.browser.isGecko())return g;var h=g.cloneNode(true);g.parentNode.insertBefore(h,g);g.parentNode.removeChild(g);Pa.releaseSelector(g);H[0]=h;Pa.requestSelector(h).showGrips(true);return h};this.setRotationAngle=function(g,h){g=parseFloat(g);var k=H[0],w=k.getAttribute("transform"),u=svgedit.utilities.getBBox(k),G=u.x+u.width/2,z=u.y+u.height/
2;u=T(k);u.numberOfItems>0&&u.getItem(0).type==4&&u.removeItem(0);if(g!=0){G=P(G,z,S(u).matrix);z=e.createSVGTransform();z.setRotate(g,G.x,G.y);u.numberOfItems?u.insertItemBefore(z,0):u.appendItem(z)}else u.numberOfItems==0&&k.removeAttribute("transform");if(!h){u=k.getAttribute("transform");k.setAttribute("transform",w);ub("transform",u,H);J("changed",H)}ua("pathpointgrip_container");k=Pa.requestSelector(H[0]);k.resize();k.updateGripCursors(g)};var Za=this.recalculateAllSelectedDimensions=function(){for(var g=
new Na(rb=="none"?"position":"size"),h=H.length;h--;){var k=pb(H[h]);k&&g.addSubCommand(k)}if(!g.isEmpty()){Ha(g);J("changed",H)}},fb=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"],wb=function(g){console.log([g.a,g.b,g.c,g.d,g.e,g.f])},xb=this.remapElement=function(g,h,k){var w=l.gridSnapping&&g.parentNode.parentNode.localName==="svg",u=function(){if(w)for(var D in h)h[D]=Ja(h[D]);ha(g,h,1E3,true)};box=svgedit.utilities.getBBox(g);for(var G=0;G<2;G++){var z=G===0?
"fill":"stroke",A=g.getAttribute(z);if(A&&A.indexOf("url(")===0)if(k.a<0||k.d<0){A=ga(A).cloneNode(true);if(k.a<0){var C=A.getAttribute("x1"),F=A.getAttribute("x2");A.setAttribute("x1",-(C-1));A.setAttribute("x2",-(F-1))}if(k.d<0){C=A.getAttribute("y1");F=A.getAttribute("y2");A.setAttribute("y1",-(C-1));A.setAttribute("y2",-(F-1))}A.id=Q();Bb().appendChild(A);g.setAttribute(z,"url(#"+A.id+")")}}G=g.tagName;if(G==="g"||G==="text"||G==="use")if(k.a==1&&k.b==0&&k.c==0&&k.d==1&&(k.e!=0||k.f!=0)){z=S(g).matrix;
z=R(z.inverse(),k,z);h.x=parseFloat(h.x)+z.e;h.y=parseFloat(h.y)+z.f}else{z=T(g);A=e.createSVGTransform();A.setMatrix(R(S(z).matrix,k));z.clear();z.appendItem(A)}switch(G){case "foreignObject":case "rect":case "image":if(G==="image"&&(k.a<0||k.d<0)){z=T(g);A=e.createSVGTransform();A.setMatrix(R(S(z).matrix,k));z.clear();z.appendItem(A)}else{z=P(h.x,h.y,k);h.width=k.a*h.width;h.height=k.d*h.height;h.x=z.x+Math.min(0,h.width);h.y=z.y+Math.min(0,h.height);h.width=Math.abs(h.width);h.height=Math.abs(h.height)}u();
break;case "ellipse":G=P(h.cx,h.cy,k);h.cx=G.x;h.cy=G.y;h.rx=k.a*h.rx;h.ry=k.d*h.ry;h.rx=Math.abs(h.rx);h.ry=Math.abs(h.ry);u();break;case "circle":G=P(h.cx,h.cy,k);h.cx=G.x;h.cy=G.y;G=svgedit.math.transformBox(box.x,box.y,box.width,box.height,k);h.r=Math.min((G.tr.x-G.tl.x)/2,(G.bl.y-G.tl.y)/2);if(h.r)h.r=Math.abs(h.r);u();break;case "line":z=P(h.x1,h.y1,k);C=P(h.x2,h.y2,k);h.x1=z.x;h.y1=z.y;h.x2=C.x;h.y2=C.y;case "text":k=g.querySelectorAll("tspan");for(G=k.length;G--;){z=la("x",g.getAttribute("x"));
A=la("x",k[G].getAttribute("x"));C=la("y",g.getAttribute("y"));F=la("y",k[G].getAttribute("y"));var E={};if(!isNaN(z)&&!isNaN(A)&&z!=0&&A!=0&&h.x)E.x=h.x-(z-A);if(!isNaN(C)&&!isNaN(F)&&C!=0&&F!=0&&h.y)E.y=h.y-(C-F);if(E.x||E.y)ha(k[G],E,1E3,true)}u();break;case "use":u();break;case "g":(u=$(g).data("gsvg"))&&ha(u,h,1E3,true);break;case "polyline":case "polygon":u=h.points.length;for(G=0;G<u;++G){F=h.points[G];F=P(F.x,F.y,k);h.points[G].x=F.x;h.points[G].y=F.y}u=h.points.length;k="";for(G=0;G<u;++G){F=
h.points[G];k+=F.x+","+F.y+" "}g.setAttribute("points",k);break;case "path":z=g.pathSegList;u=z.numberOfItems;h.d=Array(u);for(G=0;G<u;++G){A=z.getItem(G);h.d[G]={type:A.pathSegType,x:A.x,y:A.y,x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,r1:A.r1,r2:A.r2,angle:A.angle,largeArcFlag:A.largeArcFlag,sweepFlag:A.sweepFlag}}u=h.d.length;G=h.d[0];E=P(G.x,G.y,k);h.d[0].x=E.x;h.d[0].y=E.y;for(G=1;G<u;++G){A=h.d[G];z=A.type;if(z%2==0){F=P(A.x!=undefined?A.x:E.x,A.y!=undefined?A.y:E.y,k);z=P(A.x1,A.y1,k);C=P(A.x2,A.y2,k);
A.x=F.x;A.y=F.y;A.x1=z.x;A.y1=z.y;A.x2=C.x;A.y2=C.y}else{A.x=k.a*A.x;A.y=k.d*A.y;A.x1=k.a*A.x1;A.y1=k.d*A.y1;A.x2=k.a*A.x2;A.y2=k.d*A.y2}A.r1=k.a*A.r1;A.r2=k.d*A.r2}k="";u=h.d.length;for(G=0;G<u;++G){A=h.d[G];z=A.type;k+=fb[z];switch(z){case 13:case 12:k+=A.x+" ";break;case 15:case 14:k+=A.y+" ";break;case 3:case 5:case 19:case 2:case 4:case 18:k+=A.x+","+A.y+" ";break;case 7:case 6:k+=A.x1+","+A.y1+" "+A.x2+","+A.y2+" "+A.x+","+A.y+" ";break;case 9:case 8:k+=A.x1+","+A.y1+" "+A.x+","+A.y+" ";break;
case 11:case 10:k+=A.r1+","+A.r2+" "+A.angle+" "+ +A.largeArcFlag+" "+ +A.sweepFlag+" "+A.x+","+A.y+" ";break;case 17:case 16:k+=A.x2+","+A.y2+" "+A.x+","+A.y+" "}}g.setAttribute("d",k)}},Db=function(g,h,k){g=ga(g).firstChild;var w=T(g),u=e.createSVGTransform();u.setTranslate(h,k);w.appendItem(u);pb(g)},pb=this.recalculateDimensions=function(g){if(g==null)return null;var h=T(g);if(h&&h.numberOfItems>0){for(var k=h.numberOfItems;k--;){var w=h.getItem(k);if(w.type===0)h.removeItem(k);else if(w.type===
1)svgedit.math.isIdentity(w.matrix)&&h.removeItem(k);else w.type===4&&w.angle===0&&h.removeItem(k)}if(h.numberOfItems===1&&ma(g))return null}if(!h||h.numberOfItems==0){g.removeAttribute("transform");return null}if(h){k=h.numberOfItems;for(var u=[];k--;){w=h.getItem(k);if(w.type===1)u.push([w.matrix,k]);else if(u.length)u=[]}if(u.length===2){k=e.createSVGTransformFromMatrix(R(u[1][0],u[0][0]));h.removeItem(u[0][1]);h.removeItem(u[1][1]);h.insertItemBefore(k,u[1][1])}k=h.numberOfItems;if(k>=2&&h.getItem(k-
2).type===1&&h.getItem(k-1).type===2){u=e.createSVGTransform();w=R(h.getItem(k-2).matrix,h.getItem(k-1).matrix);u.setMatrix(w);h.removeItem(k-2);h.removeItem(k-2);h.appendItem(u)}}switch(g.tagName){case "line":case "polyline":case "polygon":case "path":break;default:if(h.numberOfItems===1&&h.getItem(0).type===1||h.numberOfItems===2&&h.getItem(0).type===1&&h.getItem(0).type===4)return null}var G=$(g).data("gsvg");k=new Na("Transform");var z={},A=null;w=[];switch(g.tagName){case "line":w=["x1","y1",
"x2","y2"];break;case "circle":w=["cx","cy","r"];break;case "ellipse":w=["cx","cy","rx","ry"];break;case "foreignObject":case "rect":case "image":w=["width","height","x","y"];break;case "use":case "text":case "tspan":w=["x","y"];break;case "polygon":case "polyline":A={};A.points=g.getAttribute("points");u=g.points;var C=u.numberOfItems;z.points=Array(C);for(var F=0;F<C;++F){var E=u.getItem(F);z.points[F]={x:E.x,y:E.y}}break;case "path":A={};A.d=g.getAttribute("d");z.d=g.getAttribute("d")}if(w.length){z=
$(g).attr(w);$.each(z,function(Mb,Rb){z[Mb]=la(Mb,Rb)})}else if(G)z={x:$(G).attr("x")||0,y:$(G).attr("y")||0};if(A==null){A=$.extend(true,{},z);$.each(A,function(Mb,Rb){A[Mb]=la(Mb,Rb)})}A.transform=gb?gb:"";if(g.tagName=="g"&&!G||g.tagName=="a"){u=svgedit.utilities.getBBox(g);var D={x:u.x+u.width/2,y:u.y+u.height/2},N=P(u.x+u.width/2,u.y+u.height/2,S(h).matrix);w=e.createSVGMatrix();if(u=ma(g)){F=u*Math.PI/180;C=Math.abs(F)>1.0E-10?Math.sin(F)/(1-Math.cos(F)):2/F;for(F=0;F<h.numberOfItems;++F){w=
h.getItem(F);if(w.type==4){w=w.matrix;D.y=(C*w.e+w.f)/2;D.x=(w.e-C*w.f)/2;h.removeItem(F);break}}}F=w=G=0;var K=h.numberOfItems;if(K)var O=h.getItem(0).matrix;if(K>=3&&h.getItem(K-2).type==3&&h.getItem(K-3).type==2&&h.getItem(K-1).type==2){F=3;var ca=h.getItem(K-3).matrix,U=h.getItem(K-2).matrix,ta=h.getItem(K-1).matrix;C=g.childNodes;for(E=C.length;E--;){var xa=C.item(E);w=G=0;if(xa.nodeType==1){var ja=T(xa);if(ja){w=S(ja).matrix;G=ma(xa);var oa=gb,sa=[];gb=xa.getAttribute("transform");if(G||ea(ja)){var za=
e.createSVGTransform();za.setMatrix(R(ca,U,ta,w));ja.clear();ja.appendItem(za);sa.push(za)}else{G=R(w.inverse(),ta,w);za=e.createSVGMatrix();za.e=-G.e;za.f=-G.f;w=R(za.inverse(),w.inverse(),ca,U,ta,w,G.inverse());var kb=e.createSVGTransform(),ob=e.createSVGTransform(),Vb=e.createSVGTransform();kb.setTranslate(G.e,G.f);ob.setScale(w.a,w.d);Vb.setTranslate(za.e,za.f);ja.appendItem(Vb);ja.appendItem(ob);ja.appendItem(kb);sa.push(Vb);sa.push(ob);sa.push(kb)}k.addSubCommand(pb(xa));gb=oa}}}h.removeItem(K-
1);h.removeItem(K-2);h.removeItem(K-3)}else if(K>=3&&h.getItem(K-1).type==1){F=3;w=S(h).matrix;za=e.createSVGTransform();za.setMatrix(w);h.clear();h.appendItem(za)}else if((K==1||K>1&&h.getItem(1).type!=3)&&h.getItem(0).type==2){F=2;G=S(h).matrix;h.removeItem(0);w=S(h).matrix.inverse();w=R(w,G);G=w.e;w=w.f;if(G!=0||w!=0){C=g.childNodes;E=C.length;for(K=[];E--;){xa=C.item(E);if(xa.nodeType==1){if(xa.getAttribute("clip-path")){oa=xa.getAttribute("clip-path");if(K.indexOf(oa)===-1){Db(oa,G,w);K.push(oa)}}oa=
gb;gb=xa.getAttribute("transform");if(ja=T(xa)){ca=e.createSVGTransform();ca.setTranslate(G,w);ja.numberOfItems?ja.insertItemBefore(ca,0):ja.appendItem(ca);k.addSubCommand(pb(xa));ja=g.getElementsByTagNameNS(c,"use");xa="#"+xa.id;for(ca=ja.length;ca--;){U=ja.item(ca);if(xa==da(U)){ta=e.createSVGTransform();ta.setTranslate(-G,-w);T(U).insertItemBefore(ta,0);k.addSubCommand(pb(U))}}gb=oa}}}K=[];gb=oa}}else if(K==1&&h.getItem(0).type==1&&!u){F=1;w=h.getItem(0).matrix;C=g.childNodes;for(E=C.length;E--;){xa=
C.item(E);if(xa.nodeType==1){oa=gb;gb=xa.getAttribute("transform");if(ja=T(xa)){G=R(w,S(ja).matrix);K=e.createSVGTransform();K.setMatrix(G);ja.clear();ja.appendItem(K,0);k.addSubCommand(pb(xa));gb=oa;oa=xa.getAttribute("stroke-width");xa.getAttribute("stroke")!=="none"&&!isNaN(oa)&&xa.setAttribute("stroke-width",oa*((Math.abs(G.a)+Math.abs(G.d))/2))}}}h.clear()}else{if(u){D=e.createSVGTransform();D.setRotate(u,N.x,N.y);h.numberOfItems?h.insertItemBefore(D,0):h.appendItem(D)}h.numberOfItems==0&&g.removeAttribute("transform");
return null}if(F==2){if(u){N={x:D.x+O.e,y:D.y+O.f};D=e.createSVGTransform();D.setRotate(u,N.x,N.y);h.numberOfItems?h.insertItemBefore(D,0):h.appendItem(D)}}else if(F==3){w=S(h).matrix;O=e.createSVGTransform();O.setRotate(u,D.x,D.y);O=O.matrix;D=e.createSVGTransform();D.setRotate(u,N.x,N.y);N=D.matrix.inverse();oa=w.inverse();N=R(oa,N,O,w);G=N.e;w=N.f;if(G!=0||w!=0){C=g.childNodes;for(E=C.length;E--;){xa=C.item(E);if(xa.nodeType==1){oa=gb;gb=xa.getAttribute("transform");ja=T(xa);ca=e.createSVGTransform();
ca.setTranslate(G,w);ja.numberOfItems?ja.insertItemBefore(ca,0):ja.appendItem(ca);k.addSubCommand(pb(xa));gb=oa}}}if(u)h.numberOfItems?h.insertItemBefore(D,0):h.appendItem(D)}}else{u=svgedit.utilities.getBBox(g);if(!u&&g.tagName!="path")return null;w=e.createSVGMatrix();if(G=ma(g)){D={x:u.x+u.width/2,y:u.y+u.height/2};N=P(u.x+u.width/2,u.y+u.height/2,S(h).matrix);F=G*Math.PI/180;C=Math.abs(F)>1.0E-10?Math.sin(F)/(1-Math.cos(F)):2/F;for(F=0;F<h.numberOfItems;++F){w=h.getItem(F);if(w.type==4){w=w.matrix;
D.y=(C*w.e+w.f)/2;D.x=(w.e-C*w.f)/2;h.removeItem(F);break}}}F=0;K=h.numberOfItems;if(!svgedit.browser.isWebkit())if((O=g.getAttribute("fill"))&&O.indexOf("url(")===0){O=ga(O);oa="pattern";if(O.tagName!==oa)oa="gradient";if(O.getAttribute(oa+"Units")==="userSpaceOnUse"){w=S(h).matrix;u=T(O);u=S(u).matrix;w=R(w,u);u="matrix("+[w.a,w.b,w.c,w.d,w.e,w.f].join(",")+")";O.setAttribute(oa+"Transform",u)}}if(K>=3&&h.getItem(K-2).type==3&&h.getItem(K-3).type==2&&h.getItem(K-1).type==2){F=3;w=S(h,K-3,K-1).matrix;
h.removeItem(K-1);h.removeItem(K-2);h.removeItem(K-3)}else if(K==4&&h.getItem(K-1).type==1){F=3;w=S(h).matrix;za=e.createSVGTransform();za.setMatrix(w);h.clear();h.appendItem(za);w=e.createSVGMatrix()}else if((K==1||K>1&&h.getItem(1).type!=3)&&h.getItem(0).type==2){F=2;O=h.getItem(0).matrix;oa=S(h,1).matrix;u=oa.inverse();w=R(u,O,oa);h.removeItem(0)}else if(K==1&&h.getItem(0).type==1&&!G){w=S(h).matrix;switch(g.tagName){case "line":z=$(g).attr(["x1","y1","x2","y2"]);case "polyline":case "polygon":z.points=
g.getAttribute("points");if(z.points){u=g.points;C=u.numberOfItems;z.points=Array(C);for(F=0;F<C;++F){E=u.getItem(F);z.points[F]={x:E.x,y:E.y}}}case "path":z.d=g.getAttribute("d");F=1;h.clear()}}else{F=4;if(G){D=e.createSVGTransform();D.setRotate(G,N.x,N.y);h.numberOfItems?h.insertItemBefore(D,0):h.appendItem(D)}h.numberOfItems==0&&g.removeAttribute("transform");return null}if(F==1||F==2||F==3)xb(g,z,w);if(F==2){if(G){ea(h)||(N={x:D.x+w.e,y:D.y+w.f});D=e.createSVGTransform();D.setRotate(G,N.x,N.y);
h.numberOfItems?h.insertItemBefore(D,0):h.appendItem(D)}}else if(F==3&&G){w=S(h).matrix;O=e.createSVGTransform();O.setRotate(G,D.x,D.y);O=O.matrix;D=e.createSVGTransform();D.setRotate(G,N.x,N.y);N=D.matrix.inverse();oa=w.inverse();N=R(oa,N,O,w);xb(g,z,N);if(G)h.numberOfItems?h.insertItemBefore(D,0):h.appendItem(D)}}h.numberOfItems==0&&g.removeAttribute("transform");k.addSubCommand(new Xa(g,A));return k},Pb=null,cb=this.clearSelection=function(g){if(H[0]!=null)for(var h=H.length,k=0;k<h;++k){var w=
H[k];if(w==null)break;Pa.releaseSelector(w);H[k]=null}g||J("selected",H)},Nb=this.addToSelection=function(g,h){if(g.length!=0){for(var k=0;k<H.length;){if(H[k]==null)break;++k}for(var w=g.length;w--;){var u=g[w];if(u&&svgedit.utilities.getBBox(u)){if(u.tagName==="a"&&u.childNodes.length===1)u=u.firstChild;if(H.indexOf(u)==-1){H[k]=u;k++;u=Pa.requestSelector(u);H.length>1&&u.showGrips(false)}}}J("selected",H);h||H.length==1?Pa.requestSelector(H[0]).showGrips(true):Pa.requestSelector(H[0]).showGrips(false);
for(H.sort(function(G,z){if(G&&z&&G.compareDocumentPosition)return 3-(z.compareDocumentPosition(G)&6);else if(G==null)return 1});H[0]==null;)H.shift(0)}},Sb=this.selectOnly=function(g,h){cb(true);Nb(g,h)};this.removeFromSelection=function(g){if(H[0]!=null)if(g.length!=0){var h=Array(H.length);j=0;len=H.length;for(var k=0;k<len;++k){var w=H[k];if(w)if(g.indexOf(w)==-1){h[j]=w;j++}else Pa.releaseSelector(w)}H=h}};this.selectAllInCurrentLayer=function(){var g=v().getCurrentLayer();if(g){Ia="select";
Sb($(I||g).children())}};var ac=this.getMouseTarget=function(g){if(g==null)return null;g=g.target;if(g.correspondingUseElement)g=g.correspondingUseElement;if(["http://www.w3.org/1998/Math/MathML","http://www.w3.org/1999/xhtml"].indexOf(g.namespaceURI)>=0&&g.id!="svgcanvas")for(;g.nodeName!="foreignObject";){g=g.parentNode;if(!g)return e}var h=v().getCurrentLayer();if([e,a,m,h].indexOf(g)>=0)return e;if($(g).closest("#selectorParentGroup").length)return Pa.selectorParentGroup;for(;g.parentNode!==(I||
h);)g=g.parentNode;return g};(function(){var g=null,h=null,k=null,w=null,u=null,G={},z={minx:null,miny:null,maxx:null,maxy:null},A=mosueOver=function(C){if(!(b.spaceKey||C.button===1)){var F=C.button===2;C.altKey&&svgCanvas.cloneSelectedElements(0,0);Pb=m.getScreenCTM().inverse();var E=P(C.pageX,C.pageY,Pb),D=E.x*p;E=E.y*p;C.preventDefault();if(F)Ia="select";D=D/p;E=E/p;var N=ac(C);if(N.tagName==="a"&&N.childNodes.length===1)N=N.firstChild;var K=w=h=D,O=u=k=E;if(l.gridSnapping){D=Ja(D);E=Ja(E);h=
Ja(h);k=Ja(k)}if(N==Pa.selectorParentGroup&&H[0]!=null){N=C.target;var ca=ab(N,"type");if(ca=="rotate"){Ia="rotate";current_rotate_mode=ab(N,"dir")}else if(ca=="resize"){Ia="resize";rb=ab(N,"dir")}N=H[0]}gb=N.getAttribute("transform");ca=T(N);switch(Ia){case "select":Sa=true;rb="none";if(F)Sa=false;if(N!=e){if(H.indexOf(N)==-1){C.shiftKey||cb(true);Nb([N]);La=N;Ua.clear()}if(!F)for(F=0;F<H.length;++F)if(H[F]!=null){var U=T(H[F]);U.numberOfItems?U.insertItemBefore(e.createSVGTransform(),0):U.appendItem(e.createSVGTransform())}}else if(!F){cb();
Ia="multiselect";if(Wa==null)Wa=Pa.getRubberBandBox();w*=p;u*=p;ha(Wa,{x:w,y:u,width:0,height:0,display:"inline"},100)}break;case "zoom":Sa=true;if(Wa==null)Wa=Pa.getRubberBandBox();ha(Wa,{x:K*p,y:K*p,width:0,height:0,display:"inline"},100);break;case "resize":Sa=true;h=D;k=E;G=svgedit.utilities.getBBox($("#selectedBox0")[0]);var ta={};$.each(G,function(xa,ja){ta[xa]=ja/p});G=ta;F=ma(N)?1:0;if(ea(ca)){ca.insertItemBefore(e.createSVGTransform(),F);ca.insertItemBefore(e.createSVGTransform(),F);ca.insertItemBefore(e.createSVGTransform(),
F)}else{ca.appendItem(e.createSVGTransform());ca.appendItem(e.createSVGTransform());ca.appendItem(e.createSVGTransform());if(svgedit.browser.supportsNonScalingStroke()){if(D=svgedit.browser.isChrome())U=function(xa){var ja=xa.getAttributeNS(null,"stroke");xa.removeAttributeNS(null,"stroke");setTimeout(function(){xa.setAttributeNS(null,"stroke",ja)},1)};N.style.vectorEffect="non-scaling-stroke";D&&U(N);E=N.getElementsByTagName("*");K=E.length;for(F=0;F<K;F++){E[F].style.vectorEffect="non-scaling-stroke";
D&&U(E[F])}}}break;case "fhellipse":case "fhrect":case "fhpath":Sa=true;g=K+","+O+" ";U=M.stroke_width==0?1:M.stroke_width;aa({element:"polyline",curStyles:true,attr:{points:g,id:Q(),fill:"none",opacity:M.opacity/2,"stroke-linecap":"round",style:"pointer-events:none"}});z.minx=K;z.maxx=K;z.miny=O;z.maxy=O;break;case "image":Sa=true;U=aa({element:"image",attr:{x:D,y:E,width:0,height:0,id:Q(),opacity:M.opacity/2,style:"pointer-events:inherit"}});Z(U,Da);Lb(U);break;case "square":case "rect":Sa=true;
h=D;k=E;aa({element:"rect",curStyles:true,attr:{x:D,y:E,width:0,height:0,id:Q(),opacity:M.opacity/2}});break;case "line":Sa=true;U=M.stroke_width==0?1:M.stroke_width;aa({element:"line",curStyles:true,attr:{x1:D,y1:E,x2:D,y2:E,id:Q(),stroke:M.stroke,"stroke-width":U,"stroke-dasharray":M.stroke_dasharray,"stroke-linejoin":M.stroke_linejoin,"stroke-linecap":M.stroke_linecap,"stroke-opacity":M.stroke_opacity,fill:"none",opacity:M.opacity/2,style:"pointer-events:none"}});break;case "circle":Sa=true;aa({element:"circle",
curStyles:true,attr:{cx:D,cy:E,r:0,id:Q(),opacity:M.opacity/2}});break;case "ellipse":Sa=true;aa({element:"ellipse",curStyles:true,attr:{cx:D,cy:E,rx:0,ry:0,id:Q(),opacity:M.opacity/2}});break;case "text":Sa=true;aa({element:"text",curStyles:true,attr:{x:D,y:E,id:Q(),fill:mb.fill,"stroke-width":mb.stroke_width,"font-size":mb.font_size,"font-family":mb.font_family,"text-anchor":"left","xml:space":"preserve",opacity:M.opacity}});break;case "path":case "pathedit":h*=p;k*=p;Ua.mouseDown(C,N,h,k);Sa=true;
break;case "textedit":h*=p;k*=p;qb.mouseDown(C,N,h,k);Sa=true;break;case "rotate":Sa=true;b.undoMgr.beginUndoableChange("transform",H);document.getElementById("workarea").className="rotate"}U=nb("mouseDown",{event:C,start_x:h,start_y:k,selectedElements:H},true);$.each(U,function(xa,ja){if(ja&&ja.started)Sa=true});if(Ia)document.getElementById("workarea").className=Ia=="resize"?C.target.style.cursor:Ia}};$(a).mousedown(A).mousemove(function(C){if(Sa)if(!(C.button===1||b.spaceKey)){var F=H[0],E=P(C.pageX,
C.pageY,Pb),D=E.x*p;E=E.y*p;var N=ua(va()),K=x=D/p,O=y=E/p;if(l.gridSnapping){x=Ja(x);y=Ja(y)}C.preventDefault();switch(Ia){case "select":if(H[0]!==null){K=x-h;var ca=y-k;if(l.gridSnapping){K=Ja(K);ca=Ja(ca)}if(C.shiftKey){var U=X(h,k,x,y);x=U.x;y=U.y}if(K!=0||ca!=0){U=H.length;for(O=0;O<U;++O){F=H[O];if(F==null)break;var ta=e.createSVGTransform();N=T(F);ta.setTranslate(K,ca);N.numberOfItems?N.replaceItem(ta,0):N.appendItem(ta);Pa.requestSelector(F).resize()}J("transition",H)}}break;case "multiselect":K*=
p;O*=p;ha(Wa,{x:Math.min(w,K),y:Math.min(u,O),width:Math.abs(K-w),height:Math.abs(O-u)},100);N=[];K=[];ta=Ob();U=H.length;for(O=0;O<U;++O){ca=ta.indexOf(H[O]);if(ca==-1)N.push(H[O]);else ta[ca]=null}U=ta.length;for(O=0;O<U;++O)ta[O]&&K.push(ta[O]);N.length>0&&b.removeFromSelection(N);K.length>0&&Nb(K);break;case "resize":N=T(F);K=(U=ea(N))?G:svgedit.utilities.getBBox(F);O=K.x;ta=K.y;var xa=K.width,ja=K.height;K=x-h;ca=y-k;if(l.gridSnapping){K=Ja(K);ca=Ja(ca);ja=Ja(ja);xa=Ja(xa)}var oa=ma(F);if(oa){var sa=
Math.sqrt(K*K+ca*ca);ca=Math.atan2(ca,K)-oa*Math.PI/180;K=sa*Math.cos(ca);ca=sa*Math.sin(ca)}if(rb.indexOf("n")==-1&&rb.indexOf("s")==-1)ca=0;if(rb.indexOf("e")==-1&&rb.indexOf("w")==-1)K=0;var za=sa=0,kb=ja?(ja+ca)/ja:1,ob=xa?(xa+K)/xa:1;if(rb.indexOf("n")>=0){kb=ja?(ja-ca)/ja:1;za=ja}if(rb.indexOf("w")>=0){ob=xa?(xa-K)/xa:1;sa=xa}K=e.createSVGTransform();ca=e.createSVGTransform();xa=e.createSVGTransform();if(l.gridSnapping){O=Ja(O);sa=Ja(sa);ta=Ja(ta);za=Ja(za)}K.setTranslate(-(O+sa),-(ta+za));
if(C.shiftKey)if(ob==1)ob=kb;else kb=ob;ca.setScale(ob,kb);xa.setTranslate(O+sa,ta+za);if(U){U=oa?1:0;N.replaceItem(K,2+U);N.replaceItem(ca,1+U);N.replaceItem(xa,0+U)}else{U=N.numberOfItems;N.replaceItem(xa,U-3);N.replaceItem(ca,U-2);N.replaceItem(K,U-1)}Pa.requestSelector(F).resize();J("transition",H);break;case "zoom":K*=p;O*=p;ha(Wa,{x:Math.min(w*p,K),y:Math.min(u*p,O),width:Math.abs(K-w*p),height:Math.abs(O-u*p)},100);break;case "text":ha(N,{x:x,y:y},1E3);break;case "line":K=null;window.opera||
e.suspendRedraw(1E3);if(l.gridSnapping){x=Ja(x);y=Ja(y)}O=x;U=y;if(C.shiftKey){U=X(h,k,O,U);O=U.x;U=U.y}N.setAttributeNS(null,"x2",O);N.setAttributeNS(null,"y2",U);window.opera||e.unsuspendRedraw(K);break;case "foreignObject":case "square":case "rect":case "image":K=Math.abs(x-h);U=Math.abs(y-k);if(Ia=="square"||C.shiftKey){K=U=Math.max(K,U);O=h<x?h:h-K;ta=k<y?k:k-U}else{O=Math.min(h,x);ta=Math.min(k,y)}if(C.altKey){K*=2;U*=2;O=h-K/2;ta=k-U/2}if(l.gridSnapping){K=Ja(K);U=Ja(U);O=Ja(O);ta=Ja(ta)}ha(N,
{width:K,height:U,x:O,y:ta},1E3);break;case "circle":K=$(N).attr(["cx","cy"]);U=K.cx;O=K.cy;K=Math.sqrt((x-U)*(x-U)+(y-O)*(y-O));if(l.gridSnapping)K=Ja(K);N.setAttributeNS(null,"r",K);break;case "ellipse":$(N).attr(["cx","cy"]);U=Math.abs(h+(x-h)/2);O=Math.abs(k+(y-k)/2);K=null;window.opera||e.suspendRedraw(1E3);if(l.gridSnapping){x=Ja(x);U=Ja(U);y=Ja(y);O=Ja(O)}ta=Math.abs(h-U);ca=Math.abs(k-O);if(C.shiftKey){ca=ta;O=y>k?k+ta:k-ta}if(C.altKey){U=h;O=k;ta=Math.abs(x-U);ca=C.shiftKey?ta:Math.abs(y-
O)}N.setAttributeNS(null,"rx",ta);N.setAttributeNS(null,"ry",ca);N.setAttributeNS(null,"cx",U);N.setAttributeNS(null,"cy",O);window.opera||e.unsuspendRedraw(K);break;case "fhellipse":case "fhrect":z.minx=Math.min(K,z.minx);z.maxx=Math.max(K,z.maxx);z.miny=Math.min(O,z.miny);z.maxy=Math.max(O,z.maxy);case "fhpath":g+=+K+","+O+" ";N.setAttributeNS(null,"points",g);break;case "path":case "pathedit":x*=p;y*=p;if(l.gridSnapping){x=Ja(x);y=Ja(y);h=Ja(h);k=Ja(k)}if(C.shiftKey){if(U=svgedit.path.path){N=
U.dragging?U.dragging[0]:h;U=U.dragging?U.dragging[1]:k}else{N=h;U=k}U=X(N,U,x,y);x=U.x;y=U.y}if(Wa&&Wa.getAttribute("display")!=="none"){K*=p;O*=p;ha(Wa,{x:Math.min(w*p,K),y:Math.min(u*p,O),width:Math.abs(K-w*p),height:Math.abs(O-u*p)},100)}Ua.mouseMove(C,x,y);break;case "textedit":x*=p;y*=p;qb.mouseMove(D,E);break;case "rotate":K=svgedit.utilities.getBBox(F);U=K.x+K.width/2;O=K.y+K.height/2;N=ba(F);N=P(U,O,N);U=N.x;O=N.y;N=K.x;ta=K.y;if(current_rotate_mode=="nw")N=K.x+K.width;if(current_rotate_mode==
"se")ta=K.y+K.height;if(current_rotate_mode=="sw"){N=K.x+K.width;ta=K.y+K.height}compensation_angle=(Math.atan2(O-ta,U-N)*(180/Math.PI)-90)%360;oa=(Math.atan2(O-y,U-x)*(180/Math.PI)-90)%360;oa+=compensation_angle;if(l.gridSnapping)oa=Ja(oa);if(C.shiftKey)oa=Math.round(oa/45)*45;b.setRotationAngle(oa<-180?360+oa:oa,true);J("transition",H)}nb("mouseMove",{event:C,mouse_x:D,mouse_y:E,selected:F})}}).click(function(C){C.preventDefault();return false}).dblclick(function(C){var F=C.target.parentNode;if(F!==
I){var E=ac(C),D=E.tagName;if(D==="text"&&Ia!=="textedit"){C=P(C.pageX,C.pageY,Pb);qb.select(E,C.x,C.y)}if((D==="g"||D==="a")&&ma(E)){bc(E);E=H[0];cb(true)}I&&cc();F.tagName!=="g"&&F.tagName!=="a"||F===v().getCurrentLayer()||E===Pa.selectorParentGroup||oc(E)}}).mouseup(function(C){if(C.button!==2){var F=La;La=null;if(Sa){var E=P(C.pageX,C.pageY,Pb),D=E.x*p;E=E.y*p;var N=D/p,K=E/p,O=ua(va()),ca=false;Sa=false;switch(Ia){case "resize":case "multiselect":if(Wa!=null){Wa.setAttribute("display","none");
jb=[]}Ia="select";case "select":if(H[0]!=null){if(H[1]==null){D=H[0];switch(D.tagName){case "g":case "use":case "image":case "foreignObject":break;default:hb.fill=D.getAttribute("fill");hb.fill_opacity=D.getAttribute("fill-opacity");hb.stroke=D.getAttribute("stroke");hb.stroke_opacity=D.getAttribute("stroke-opacity");hb.stroke_width=D.getAttribute("stroke-width");hb.stroke_dasharray=D.getAttribute("stroke-dasharray");hb.stroke_linejoin=D.getAttribute("stroke-linejoin");hb.stroke_linecap=D.getAttribute("stroke-linecap")}if(D.tagName==
"text"){mb.font_size=D.getAttribute("font-size");mb.font_family=D.getAttribute("font-family")}Pa.requestSelector(D).showGrips(true)}Za();if(N!=w||K!=u){C=H.length;for(D=0;D<C;++D){if(H[D]==null)break;H[D].firstChild||Pa.requestSelector(H[D]).resize()}}else{D=C.target;if(H[0].nodeName==="path"&&H[1]==null)Ua.select(H[0]);else C.shiftKey&&F!=D&&b.removeFromSelection([D])}if(svgedit.browser.supportsNonScalingStroke())if(C=H[0]){C.removeAttribute("style");svgedit.utilities.walkTree(C,function(xa){xa.removeAttribute("style")})}}return;
case "zoom":Wa!=null&&Wa.setAttribute("display","none");J("zoomed",{x:Math.min(w,N),y:Math.min(u,K),width:Math.abs(N-w),height:Math.abs(K-u),factor:C.altKey?0.5:2});return;case "fhpath":F=O.getAttribute("points");N=F.indexOf(",");if(ca=N>=0?F.indexOf(",",N+1)>=0:F.indexOf(" ",F.indexOf(" ")+1)>=0)O=Ua.smoothPolylineIntoPath(O);break;case "line":F=$(O).attr(["x1","x2","y1","y2"]);ca=F.x1!=F.x2||F.y1!=F.y2;break;case "foreignObject":case "square":case "rect":case "image":F=$(O).attr(["width","height"]);
ca=F.width!=0||F.height!=0||Ia==="image";break;case "circle":ca=O.getAttribute("r")!=0;break;case "ellipse":F=$(O).attr(["rx","ry"]);ca=F.rx!=null||F.ry!=null;break;case "fhellipse":if(z.maxx-z.minx>0&&z.maxy-z.miny>0){O=aa({element:"ellipse",curStyles:true,attr:{cx:(z.minx+z.maxx)/2,cy:(z.miny+z.maxy)/2,rx:(z.maxx-z.minx)/2,ry:(z.maxy-z.miny)/2,id:va()}});J("changed",[O]);ca=true}break;case "fhrect":if(z.maxx-z.minx>0&&z.maxy-z.miny>0){O=aa({element:"rect",curStyles:true,attr:{x:z.minx,y:z.miny,
width:z.maxx-z.minx,height:z.maxy-z.miny,id:va()}});J("changed",[O]);ca=true}break;case "text":ca=true;Sb([O]);qb.start(O);break;case "path":O=null;Sa=true;F=Ua.mouseUp(C,O,D,E);O=F.element;ca=F.keep;break;case "pathedit":ca=true;O=null;Ua.mouseUp(C);break;case "textedit":ca=false;O=null;qb.mouseUp(C,D,E);break;case "rotate":ca=true;O=null;Ia="select";F=b.undoMgr.finishUndoableChange();F.isEmpty()||Ha(F);Za();J("changed",H)}D=nb("mouseUp",{event:C,mouse_x:D,mouse_y:E},true);$.each(D,function(xa,ja){if(ja){ca=
ja.keep||ca;O=ja.element;Sa=ja.started||Sa}});if(!ca&&O!=null){v().releaseId(va());O.parentNode.removeChild(O);O=null;for(D=C.target;D.parentNode.parentNode.tagName=="g";)D=D.parentNode;if((Ia!="path"||!drawn_path)&&D.parentNode.id!="selectorParentGroup"&&D.id!="svgcanvas"&&D.id!="svgroot"){b.setMode("select");Sb([D],true)}}else if(O!=null){b.addedNew=true;C=0.2;var U;if(false.beginElement&&O.getAttribute("opacity")!=M.opacity){U=$(false).clone().attr({to:M.opacity,dur:C}).appendTo(O);try{U[0].beginElement()}catch(ta){}}else C=
0;setTimeout(function(){U&&U.remove();O.setAttribute("opacity",M.opacity);O.setAttribute("style","pointer-events:inherit");qa(O);if(Ia==="path")Ua.toEditMode(O);else l.selectNew&&Sb([O],true);Ha(new Qa(O));J("changed",[O])},C*1E3)}gb=null}}});$(a).bind("mousewheel DOMMouseScroll",function(C){if(C.shiftKey){C.preventDefault();Pb=m.getScreenCTM().inverse();var F=P(C.pageX,C.pageY,Pb);F={x:F.x,y:F.y,width:0,height:0};if(C.wheelDelta)if(C.wheelDelta>=120)F.factor=2;else{if(C.wheelDelta<=-120)F.factor=
0.5}else if(C.detail)if(C.detail>0)F.factor=0.5;else if(C.detail<0)F.factor=2;F.factor&&J("zoomed",F)}})})();var Lb=function(g){$(g).click(function(h){h.preventDefault()})},qb=b.textActions=function(){function g(ja){var oa=F.value==="";$(F).focus();if(!arguments.length)if(oa)ja=0;else{if(F.selectionEnd!==F.selectionStart)return;ja=F.selectionEnd}var sa;sa=K[ja];oa||F.setSelectionRange(ja,ja);E=ua("text_cursor");if(!E){E=document.createElementNS(c,"line");ha(E,{id:"text_cursor",stroke:"#333","stroke-width":1});
E=ua("selectorParentGroup").appendChild(E)}N||(N=setInterval(function(){var za=E.getAttribute("display")==="none";E.setAttribute("display",za?"inline":"none")},600));oa=G(sa.x,O.y);sa=G(sa.x,O.y+O.height);ha(E,{x1:oa.x,y1:oa.y,x2:sa.x,y2:sa.y,visibility:"visible",display:"inline"});D&&D.setAttribute("d","")}function h(ja,oa,sa){if(ja===oa)g(oa);else{sa||F.setSelectionRange(ja,oa);D=ua("text_selectblock");if(!D){D=document.createElementNS(c,"path");ha(D,{id:"text_selectblock",fill:"green",opacity:0.5,
style:"pointer-events:none"});ua("selectorParentGroup").appendChild(D)}ja=K[ja];var za=K[oa];E.setAttribute("visibility","hidden");oa=G(ja.x,O.y);sa=G(ja.x+(za.x-ja.x),O.y);var kb=G(ja.x,O.y+O.height);ja=G(ja.x+(za.x-ja.x),O.y+O.height);ha(D,{d:"M"+oa.x+","+oa.y+" L"+sa.x+","+sa.y+" "+ja.x+","+ja.y+" "+kb.x+","+kb.y+"z",display:"inline"})}}function k(ja,oa){var sa=e.createSVGPoint();sa.x=ja;sa.y=oa;if(K.length==1)return 0;sa=C.getCharNumAtPosition(sa);if(sa<0){sa=K.length-2;if(ja<=K[0].x)sa=0}else if(sa>=
K.length-2)sa=K.length-2;var za=K[sa];ja>za.x+za.width/2&&sa++;return sa}function w(ja,oa,sa){var za=F.selectionStart;ja=k(ja,oa);h(Math.min(za,ja),Math.max(za,ja),!sa)}function u(ja,oa){var sa={x:ja,y:oa};sa.x/=p;sa.y/=p;if(ca){var za=P(sa.x,sa.y,ca.inverse());sa.x=za.x;sa.y=za.y}return sa}function G(ja,oa){var sa={x:ja,y:oa};if(ca){var za=P(sa.x,sa.y,ca);sa.x=za.x;sa.y=za.y}sa.x*=p;sa.y*=p;return sa}function z(ja){h(0,C.textContent.length);$(this).unbind(ja)}function A(ja){if(xa&&C){var oa=P(ja.pageX,
ja.pageY,Pb);oa=u(oa.x*p,oa.y*p);oa=k(oa.x,oa.y);var sa=C.textContent,za=sa.substr(0,oa).replace(/[a-z0-9]+$/i,"").length;sa=sa.substr(oa).match(/^[a-z0-9]+/i);h(za,(sa?sa[0].length:0)+oa);$(ja.target).click(z);setTimeout(function(){$(ja.target).unbind("click",z)},300)}}var C,F,E,D,N,K=[],O,ca,U,ta,xa;return{select:function(ja,oa,sa){C=ja;qb.toEditMode(oa,sa)},start:function(ja){C=ja;qb.toEditMode()},mouseDown:function(ja,oa,sa,za){ja=u(sa,za);F.focus();g(k(ja.x,ja.y));U=sa;ta=za},mouseMove:function(ja,
oa){var sa=u(ja,oa);w(sa.x,sa.y)},mouseUp:function(ja,oa,sa){var za=u(oa,sa);w(za.x,za.y,true);ja.target!==C&&oa<U+2&&oa>U-2&&sa<ta+2&&sa>ta-2&&qb.toSelectMode(true)},setCursor:g,toEditMode:function(ja,oa){xa=false;Ia="textedit";Pa.requestSelector(C).showGrips(false);Pa.requestSelector(C);qb.init();$(C).css("cursor","text");if(arguments.length){var sa=u(ja,oa);g(k(sa.x,sa.y))}else g();setTimeout(function(){xa=true},300)},toSelectMode:function(ja){Ia="select";clearInterval(N);N=null;D&&$(D).attr("display",
"none");E&&$(E).attr("visibility","hidden");$(C).css("cursor","move");if(ja){cb();$(C).css("cursor","move");J("selected",[C]);Nb([C],true)}C&&!C.textContent.length&&b.deleteSelectedElements();$(F).blur();C=false},setInputElem:function(ja){F=ja},clear:function(){Ia=="textedit"&&qb.toSelectMode()},init:function(){if(C){if(!C.parentNode){C=H[0];Pa.requestSelector(C).showGrips(false)}var ja=C.textContent.length,oa=C.getAttribute("transform");O=svgedit.utilities.getBBox(C);ca=oa?ba(C):null;K=Array(ja);
F.focus();$(C).unbind("dblclick",A).dblclick(A);if(!ja)var sa={x:O.x+O.width/2,width:0};for(oa=0;oa<ja;oa++){var za=C.getStartPositionOfChar(oa);sa=C.getEndPositionOfChar(oa);if(!svgedit.browser.supportsGoodTextCharPos()){var kb=b.contentW*p;za.x-=kb;sa.x-=kb;za.x/=p;sa.x/=p}K[oa]={x:za.x,y:O.y,width:sa.x-za.x,height:O.height}}K.push({x:sa.x,width:0});h(F.selectionStart,F.selectionEnd,true)}}}}(),Ua=b.pathActions=function(){var g=false,h,k,w;svgedit.path.Path.prototype.endChanges=function(z){if(svgedit.browser.isWebkit()){var A=
this.elem;A.setAttribute("d",Ua.convertPath(A))}z=new Xa(this.elem,{d:this.last_d},z);Ha(z);J("changed",[this.elem])};svgedit.path.Path.prototype.addPtsToSelection=function(z){$.isArray(z)||(z=[z]);for(var A=0;A<z.length;A++){var C=z[A],F=this.segs[C];F.ptgrip&&this.selected_pts.indexOf(C)==-1&&C>=0&&this.selected_pts.push(C)}this.selected_pts.sort();A=this.selected_pts.length;for(z=Array(A);A--;){F=this.segs[this.selected_pts[A]];F.select(true);z[A]=F.ptgrip}Ua.canDeleteNodes=true;Ua.closed_subpath=
this.subpathIsClosed(this.selected_pts[0]);J("selected",z)};var u=h=null,G=false;return{mouseDown:function(z,A,C,F){if(Ia==="path"){mouse_x=C;mouse_y=F;F=mouse_x/p;A=mouse_y/p;C=ua("path_stretch_line");k=[F,A];if(l.gridSnapping){F=Ja(F);A=Ja(A);mouse_x=Ja(mouse_x);mouse_y=Ja(mouse_y)}if(!C){C=document.createElementNS(c,"path");ha(C,{id:"path_stretch_line",stroke:"#22C","stroke-width":"0.5",fill:"none"});C=ua("selectorParentGroup").appendChild(C)}C.setAttribute("display","inline");var E=null;if(u){E=
u.pathSegList;for(var D=E.numberOfItems,N=6/p,K=false;D;){D--;var O=E.getItem(D),ca=O.x;O=O.y;if(F>=ca-N&&F<=ca+N&&A>=O-N&&A<=O+N){K=true;break}}N=va();svgedit.path.removePath_(N);N=ua(N);ca=E.numberOfItems;if(K){if(D<=1&&ca>=2){F=E.getItem(0).x;A=E.getItem(0).y;z=C.pathSegList.getItem(1);z=z.pathSegType===4?u.createSVGPathSegLinetoAbs(F,A):u.createSVGPathSegCurvetoCubicAbs(F,A,z.x1/p,z.y1/p,F,A);F=u.createSVGPathSegClosePath();E.appendItem(z);E.appendItem(F)}else if(ca<3)return E=false;$(C).remove();
element=N;u=null;Sa=false;if(g){svgedit.path.path.matrix&&xb(N,{},svgedit.path.path.matrix.inverse());C=N.getAttribute("d");z=$(svgedit.path.path.elem).attr("d");$(svgedit.path.path.elem).attr("d",z+C);$(N).remove();svgedit.path.path.matrix&&svgedit.path.recalcRotatedPath();svgedit.path.path.init();Ua.toEditMode(svgedit.path.path.elem);svgedit.path.path.selectPt();return false}}else{if(!$.contains(a,ac(z))){console.log("Clicked outside canvas");return false}E=u.pathSegList.numberOfItems;D=u.pathSegList.getItem(E-
1);N=D.x;D=D.y;if(z.shiftKey){z=X(N,D,F,A);F=z.x;A=z.y}z=C.pathSegList.getItem(1);z=z.pathSegType===4?u.createSVGPathSegLinetoAbs(Gb(F),Gb(A)):u.createSVGPathSegCurvetoCubicAbs(Gb(F),Gb(A),z.x1/p,z.y1/p,z.x2/p,z.y2/p);u.pathSegList.appendItem(z);F*=p;A*=p;C.setAttribute("d",["M",F,A,F,A].join(" "));C=E;if(g)C+=svgedit.path.path.segs.length;svgedit.path.addPointGrip(C,F,A)}}else{d_attr="M"+F+","+A+" ";u=aa({element:"path",curStyles:true,attr:{d:d_attr,id:Q(),opacity:M.opacity/2}});C.setAttribute("d",
["M",mouse_x,mouse_y,mouse_x,mouse_y].join(" "));C=g?svgedit.path.path.segs.length:0;svgedit.path.addPointGrip(C,mouse_x,mouse_y)}}else if(svgedit.path.path){svgedit.path.path.storeD();N=z.target.id;if(N.substr(0,14)=="pathpointgrip_"){A=svgedit.path.path.cur_pt=parseInt(N.substr(14));svgedit.path.path.dragging=[C,F];E=svgedit.path.path.segs[A];if(z.shiftKey)E.selected?svgedit.path.path.removePtFromSelection(A):svgedit.path.path.addPtsToSelection(A);else{if(svgedit.path.path.selected_pts.length<=
1||!E.selected)svgedit.path.path.clearSelection();svgedit.path.path.addPtsToSelection(A)}}else if(N.indexOf("ctrlpointgrip_")==0){svgedit.path.path.dragging=[C,F];z=N.split("_")[1].split("c");A=z[0]-0;svgedit.path.path.selectPt(A,z[1]-0)}if(!svgedit.path.path.dragging){if(Wa==null)Wa=Pa.getRubberBandBox();ha(Wa,{x:C*p,y:F*p,width:0,height:0,display:"inline"},100)}}},mouseMove:function(z,A,C){G=true;if(Ia==="path"){if(u){var F=u.pathSegList;z=F.numberOfItems-1;if(k){var E=svgedit.path.addCtrlGrip("1c1"),
D=svgedit.path.addCtrlGrip("0c2");D.getAttribute("cx");D.getAttribute("cy");E.setAttribute("cx",A);E.setAttribute("cy",C);E.setAttribute("display","inline");E=k[0];var N=k[1];F.getItem(z);var K=E+(E-A/p),O=N+(N-C/p);D.setAttribute("cx",K*p);D.setAttribute("cy",O*p);D.setAttribute("display","inline");D=svgedit.path.getCtrlLine(1);var ca=svgedit.path.getCtrlLine(2);ha(D,{x1:A,y1:C,x2:E*p,y2:N*p,display:"inline"});ha(ca,{x1:K*p,y1:O*p,x2:E*p,y2:N*p,display:"inline"});if(z===0)w=[A,C];else{F=F.getItem(z-
1);A=F.x;C=F.y;if(F.pathSegType===6){A+=A-F.x2;C+=C-F.y2}else if(w){A=w[0]/p;C=w[1]/p}svgedit.path.replacePathSeg(6,z,[E,N,A,C,K,O],u)}}else if(E=ua("path_stretch_line")){z=F.getItem(z);if(z.pathSegType===6)svgedit.path.replacePathSeg(6,1,[A,C,(z.x+(z.x-z.x2))*p,(z.y+(z.y-z.y2))*p,A,C],E);else w?svgedit.path.replacePathSeg(6,1,[A,C,w[0],w[1],A,C],E):svgedit.path.replacePathSeg(4,1,[A,C],E)}}}else if(svgedit.path.path.dragging){E=svgedit.path.getPointFromGrip({x:svgedit.path.path.dragging[0],y:svgedit.path.path.dragging[1]},
svgedit.path.path);N=svgedit.path.getPointFromGrip({x:A,y:C},svgedit.path.path);z=N.x-E.x;E=N.y-E.y;svgedit.path.path.dragging=[A,C];svgedit.path.path.dragctrl?svgedit.path.path.moveCtrl(z,E):svgedit.path.path.movePts(z,E)}else{svgedit.path.path.selected_pts=[];svgedit.path.path.eachSeg(function(){if(this.next||this.prev){var U=Wa.getBBox(),ta=svgedit.path.getGripPt(this);U=svgedit.math.rectsIntersect(U,{x:ta.x,y:ta.y,width:0,height:0});this.select(U);U&&svgedit.path.path.selected_pts.push(this.index)}})}},
mouseUp:function(z,A){if(Ia==="path"){k=null;if(!u){A=ua(va());Sa=false;w=null}return{keep:true,element:A}}if(svgedit.path.path.dragging){var C=svgedit.path.path.cur_pt;svgedit.path.path.dragging=false;svgedit.path.path.dragctrl=false;svgedit.path.path.update();G&&svgedit.path.path.endChanges("Move path point(s)");!z.shiftKey&&!G&&svgedit.path.path.selectPt(C)}else if(Wa&&Wa.getAttribute("display")!="none"){Wa.setAttribute("display","none");Wa.getAttribute("width")<=2&&Wa.getAttribute("height")<=
2&&Ua.toSelectMode(z.target)}else Ua.toSelectMode(z.target);G=false},toEditMode:function(z){svgedit.path.path=svgedit.path.getPath_(z);Ia="pathedit";cb();svgedit.path.path.show(true).update();svgedit.path.path.oldbbox=svgedit.utilities.getBBox(svgedit.path.path.elem);g=false},toSelectMode:function(z){var A=z==svgedit.path.path.elem;Ia="select";svgedit.path.path.show(false);h=false;cb();svgedit.path.path.matrix&&svgedit.path.recalcRotatedPath();if(A){J("selected",[z]);Nb([z],true)}},addSubPath:function(z){if(z){Ia=
"path";g=true}else{Ua.clear(true);Ua.toEditMode(svgedit.path.path.elem)}},select:function(z){if(h===z){Ua.toEditMode(z);Ia="pathedit"}else h=z},reorient:function(){var z=H[0];if(z)if(ma(z)!=0){var A=new Na("Reorient path"),C={d:z.getAttribute("d"),transform:z.getAttribute("transform")};A.addSubCommand(new Xa(z,C));cb();this.resetOrientation(z);Ha(A);svgedit.path.getPath_(z).show(false).matrix=null;this.clear();Nb([z],true);J("changed",H)}},clear:function(){h=null;if(u){var z=ua(va());$(ua("path_stretch_line")).remove();
$(z).remove();$(ua("pathpointgrip_container")).find("*").attr("display","none");u=w=null;Sa=false}else Ia=="pathedit"&&this.toSelectMode();svgedit.path.path&&svgedit.path.path.init().show(false)},resetOrientation:function(z){if(z==null||z.nodeName!="path")return false;var A=T(z),C=S(A).matrix;A.clear();z.removeAttribute("transform");A=z.pathSegList;for(var F=A.numberOfItems,E=0;E<F;++E){var D=A.getItem(E),N=D.pathSegType;if(N!=1){var K=[];$.each(["",1,2],function(O,ca){var U=D["x"+ca],ta=D["y"+ca];
if(U!==undefined&&ta!==undefined){U=P(U,ta,C);K.splice(K.length,0,U.x,U.y)}});svgedit.path.replacePathSeg(N,E,K,z)}}f(z,C)},zoomChange:function(){Ia=="pathedit"&&svgedit.path.path.update()},getNodePoint:function(){var z=svgedit.path.path.segs[svgedit.path.path.selected_pts.length?svgedit.path.path.selected_pts[0]:1];return{x:z.item.x,y:z.item.y,type:z.type}},linkControlPoints:function(z){svgedit.path.setLinkControlPoints(z)},clonePathNode:function(){svgedit.path.path.storeD();for(var z=svgedit.path.path.selected_pts,
A=z.length,C=[];A--;){var F=z[A];svgedit.path.path.addSeg(F);C.push(F+A);C.push(F+A+1)}svgedit.path.path.init().addPtsToSelection(C);svgedit.path.path.endChanges("Clone path node(s)")},opencloseSubPath:function(){var z=svgedit.path.path.selected_pts;if(z.length===1){var A=svgedit.path.path.elem,C=A.pathSegList,F=z[0],E=null,D=null;svgedit.path.path.eachSeg(function(ca){if(this.type===2&&ca<=F)D=this.item;if(ca<=F)return true;if(this.type===2){E=ca;return false}else if(this.type===1)return E=false});
if(E==null)E=svgedit.path.path.segs.length-1;if(E!==false){var N=A.createSVGPathSegLinetoAbs(D.x,D.y),K=A.createSVGPathSegClosePath();if(E==svgedit.path.path.segs.length-1){C.appendItem(N);C.appendItem(K)}else{svgedit.path.insertItemBefore(A,K,E);svgedit.path.insertItemBefore(A,N,E)}svgedit.path.path.init().selectPt(E+1)}else if(svgedit.path.path.segs[F].mate){C.removeItem(F);C.removeItem(F);svgedit.path.path.init().selectPt(F-1)}else{for(z=0;z<C.numberOfItems;z++){var O=C.getItem(z);if(O.pathSegType===
2)N=z;else if(z===F)C.removeItem(N);else if(O.pathSegType===1&&F<z){K=z-1;C.removeItem(z);break}}for(z=F-N-1;z--;)svgedit.path.insertItemBefore(A,C.getItem(N),K);A=C.getItem(N);svgedit.path.replacePathSeg(2,N,[A.x,A.y]);z=F;svgedit.path.path.init().selectPt(0)}}},deletePathNode:function(){if(Ua.canDeleteNodes){svgedit.path.path.storeD();for(var z=svgedit.path.path.selected_pts,A=z.length;A--;)svgedit.path.path.deleteSeg(z[A]);var C=function(){var F=svgedit.path.path.elem.pathSegList,E=F.numberOfItems,
D=function(O,ca){for(;ca--;)F.removeItem(O)};if(E<=1)return true;for(;E--;){var N=F.getItem(E);if(N.pathSegType===1){N=F.getItem(E-1);var K=F.getItem(E-2);if(N.pathSegType===2){D(E-1,2);C();break}else if(K.pathSegType===2){D(E-2,3);C();break}}else if(N.pathSegType===2)if(E>0){N=F.getItem(E-1).pathSegType;if(N===2){D(E-1,1);C();break}else if(N===1&&F.numberOfItems-1===E){D(E,1);C();break}}}return false};C();if(svgedit.path.path.elem.pathSegList.numberOfItems<=1){Ua.toSelectMode(svgedit.path.path.elem);
b.deleteSelectedElements()}else{svgedit.path.path.init();svgedit.path.path.clearSelection();if(window.opera){z=$(svgedit.path.path.elem);z.attr("d",z.attr("d"))}svgedit.path.path.endChanges("Delete path node(s)")}}},smoothPolylineIntoPath:function(z){var A=z.points,C=A.numberOfItems;if(C>=4){var F=A.getItem(0),E=null;z=[];z.push(["M",F.x,",",F.y," C"].join(""));for(var D=1;D<=C-4;D+=3){var N=A.getItem(D),K=A.getItem(D+1),O=A.getItem(D+2);if(E)if((F=svgedit.path.smoothControlPoints(E,N,F))&&F.length==
2){N=z[z.length-1].split(",");N[2]=F[0].x;N[3]=F[0].y;z[z.length-1]=N.join(",");N=F[1]}z.push([N.x,N.y,K.x,K.y,O.x,O.y].join(","));F=O;E=K}for(z.push("L");D<C;++D){K=A.getItem(D);z.push([K.x,K.y].join(","))}z=z.join(" ");z=aa({element:"path",curStyles:true,attr:{id:va(),d:z,fill:"none"}})}return z},setSegType:function(z){svgedit.path.path.setSegType(z)},moveNode:function(z,A){var C=svgedit.path.path.selected_pts;if(C.length){svgedit.path.path.storeD();C=svgedit.path.path.segs[C[0]];var F={x:0,y:0};
F[z]=A-C.item[z];C.move(F.x,F.y);svgedit.path.path.endChanges("Move path point")}},fixEnd:function(z){for(var A=z.pathSegList,C=A.numberOfItems,F,E=0;E<C;++E){var D=A.getItem(E);if(D.pathSegType===2)F=D;if(D.pathSegType===1){D=A.getItem(E-1);if(D.x!=F.x||D.y!=F.y){A=z.createSVGPathSegLinetoAbs(F.x,F.y);svgedit.path.insertItemBefore(z,A,E);Ua.fixEnd(z);break}}}svgedit.browser.isWebkit()&&z.setAttribute("d",Ua.convertPath(z))},convertPath:function(z,A){for(var C=z.pathSegList,F=C.numberOfItems,E=0,
D=0,N="",K=null,O=0;O<F;++O){var ca=C.getItem(O),U=ca.x||0,ta=ca.y||0,xa=ca.x1||0,ja=ca.y1||0,oa=ca.x2||0,sa=ca.y2||0,za=ca.pathSegType,kb=fb[za]["to"+(A?"Lower":"Upper")+"Case"](),ob=function(Vb,Mb,Rb){Mb=Mb?" "+Mb.join(" "):"";Rb=Rb?" "+svgedit.units.shortFloat(Rb):"";$.each(Vb,function(Xb,dc){Vb[Xb]=svgedit.units.shortFloat(dc)});N+=kb+Vb.join(" ")+Mb+Rb};switch(za){case 1:N+="z";break;case 12:U-=E;case 13:if(A){E+=U;kb="l"}else{U+=E;E=U;kb="L"}ob([[U,D]]);break;case 14:ta-=D;case 15:if(A){D+=
ta;kb="l"}else{ta+=D;D=ta;kb="L"}ob([[E,ta]]);break;case 2:case 4:case 18:U-=E;ta-=D;case 5:case 3:if(K&&C.getItem(O-1).pathSegType===1&&!A){E=K[0];D=K[1]}case 19:if(A){E+=U;D+=ta}else{U+=E;ta+=D;E=U;D=ta}if(za===3)K=[E,D];ob([[U,ta]]);break;case 6:U-=E;xa-=E;oa-=E;ta-=D;ja-=D;sa-=D;case 7:if(A){E+=U;D+=ta}else{U+=E;xa+=E;oa+=E;ta+=D;ja+=D;sa+=D;E=U;D=ta}ob([[xa,ja],[oa,sa],[U,ta]]);break;case 8:U-=E;xa-=E;ta-=D;ja-=D;case 9:if(A){E+=U;D+=ta}else{U+=E;xa+=E;ta+=D;ja+=D;E=U;D=ta}ob([[xa,ja],[U,ta]]);
break;case 10:U-=E;ta-=D;case 11:if(A){E+=U;D+=ta}else{U+=E;ta+=D;E=U;D=ta}ob([[ca.r1,ca.r2]],[ca.angle,ca.largeArcFlag?1:0,ca.sweepFlag?1:0],[U,ta]);break;case 16:U-=E;oa-=E;ta-=D;sa-=D;case 17:if(A){E+=U;D+=ta}else{U+=E;oa+=E;ta+=D;sa+=D;E=U;D=ta}ob([[oa,sa],[U,ta]])}}return N}}}(),kc=this.removeUnusedDefElems=function(){var g=m.getElementsByTagNameNS(c,"defs");if(!g||!g.length)return 0;for(var h=[],k=0,w=["fill","stroke","filter","marker-start","marker-mid","marker-end"],u=w.length,G=m.getElementsByTagNameNS(c,
"*"),z=G.length,A=0;A<z;A++){for(var C=G[A],F=0;F<u;F++){var E=ka(C.getAttribute(w[F]));E&&h.push(E.substr(1))}(C=da(C))&&C.indexOf("#")===0&&h.push(C.substr(1))}g=$(g).find("linearGradient, radialGradient, filter, marker, svg, symbol");defelem_ids=[];for(A=g.length;A--;){w=g[A];u=w.id;if(h.indexOf(u)<0){Fb[u]=w;w.parentNode.removeChild(w);k++}}return k};this.svgCanvasToString=function(){for(;kc()>0;);Ua.clear(true);$.each(m.childNodes,function(k,w){k&&w.nodeType===8&&w.data.indexOf("Created with")>=
0&&m.insertBefore(w,m.firstChild)});if(I){cc();Sb([I])}var g=[];$(m).find("g:data(gsvg)").each(function(){for(var k=this.attributes,w=k.length,u=0;u<w;u++)if(k[u].nodeName=="id"||k[u].nodeName=="style")w--;if(w<=0){k=this.firstChild;g.push(k);$(this).replaceWith(k)}});var h=this.svgToString(m,0);g.length&&$(g).each(function(){ra(this)});return h};this.svgToString=function(g,h){var k=[],w=svgedit.utilities.toXml,u=l.baseUnit,G=RegExp("^-?[\\d\\.]+"+u+"$");if(g){qa(g);var z=g.attributes,A,C,F=g.childNodes;
for(C=0;C<h;C++)k.push(" ");k.push("<");k.push(g.nodeName);if(g.id==="svgcontent"){C=Yb();if(u!=="px"){C.w=svgedit.units.convertUnit(C.w,u)+u;C.h=svgedit.units.convertUnit(C.h,u)+u}k.push(' width="'+C.w+'" height="'+C.h+'" xmlns="'+c+'"');var E={};$(g).find("*").andSelf().each(function(){$.each(this.attributes,function(O,ca){var U=ca.namespaceURI;if(U&&!E[U]&&Ga[U]!=="xmlns"&&Ga[U]!=="xml"){E[U]=true;k.push(" xmlns:"+Ga[U]+'="'+U+'"')}})});C=z.length;for(u=["width","height","xmlns","x","y","viewBox",
"id","overflow"];C--;){A=z.item(C);var D=w(A.nodeValue);if(A.nodeName.indexOf("xmlns:")!==0)if(D!=""&&u.indexOf(A.localName)==-1)if(!A.namespaceURI||Ga[A.namespaceURI]){k.push(" ");k.push(A.nodeName);k.push('="');k.push(D);k.push('"')}}}else{if(g.nodeName==="defs"&&!g.firstChild)return;var N=["-moz-math-font-style","_moz-math-font-style"];for(C=z.length-1;C>=0;C--){A=z.item(C);D=w(A.nodeValue);if(!(N.indexOf(A.localName)>=0))if(D!="")if(D.indexOf("pointer-events")!==0)if(!(A.localName==="class"&&
D.indexOf("se_")===0)){k.push(" ");if(A.localName==="d")D=Ua.convertPath(g,true);if(isNaN(D)){if(G.test(D))D=svgedit.units.shortFloat(D)+u}else D=svgedit.units.shortFloat(D);if(bb.apply&&g.nodeName==="image"&&A.localName==="href"&&bb.images&&bb.images==="embed"){var K=Ka[D];if(K)D=K}if(!A.namespaceURI||A.namespaceURI==c||Ga[A.namespaceURI]){k.push(A.nodeName);k.push('="');k.push(D);k.push('"')}}}}if(g.hasChildNodes()){k.push(">");h++;z=false;for(C=0;C<F.length;C++){u=F.item(C);switch(u.nodeType){case 1:k.push("\n");
k.push(this.svgToString(F.item(C),h));break;case 3:u=u.nodeValue.replace(/^\s+|\s+$/g,"");if(u!=""){z=true;k.push(w(u)+"")}break;case 4:k.push("\n");k.push(Array(h+1).join(" "));k.push("<![CDATA[");k.push(u.nodeValue);k.push("]]\>");break;case 8:k.push("\n");k.push(Array(h+1).join(" "));k.push("<!--");k.push(u.data);k.push("--\>")}}h--;if(!z){k.push("\n");for(C=0;C<h;C++)k.push(" ")}k.push("</");k.push(g.nodeName);k.push(">")}else k.push("/>")}return k.join("")};this.embedImage=function(g,h){$(new Image).load(function(){var k=
document.createElement("canvas");k.width=this.width;k.height=this.height;k.getContext("2d").drawImage(this,0,0);try{var w=";svgedit_url="+encodeURIComponent(g);w=k.toDataURL().replace(";base64",w+";base64");Ka[g]=w}catch(u){Ka[g]=false}Da=g;h&&h(Ka[g])}).attr("src",g)};this.setGoodImage=function(g){Da=g};this.open=function(){};this.save=function(g){cb();g&&$.extend(bb,g);bb.apply=true;g=this.svgCanvasToString();J("saved",g)};this.rasterExport=function(){cb();var g=[],h={feGaussianBlur:Jb.exportNoBlur,
foreignObject:Jb.exportNoforeignObject,"[stroke-dasharray]":Jb.exportNoDashArray},k=$(m);if(!("font"in $("<canvas>")[0].getContext("2d")))h.text=Jb.exportNoText;$.each(h,function(w,u){k.find(w).length&&g.push(u)});h=this.svgCanvasToString();J("exported",{svg:h,issues:g})};this.getSvgString=function(){bb.apply=false;return this.svgCanvasToString()};this.randomizeIds=function(){arguments.length>0&&arguments[0]==false?svgedit.draw.randomizeIds(false,v()):svgedit.draw.randomizeIds(true,v())};var hc=this.uniquifyElems=
function(g){var h={},k=["filter","linearGradient","pattern","radialGradient","symbol","textPath","use"];svgedit.utilities.walkTree(g,function(A){if(A.nodeType==1){if(A.id){A.id in h||(h[A.id]={elem:null,attrs:[],hrefs:[]});h[A.id].elem=A}$.each(tb,function(F,E){var D=A.getAttributeNode(E);if(D){var N=svgedit.utilities.getUrlFromAttr(D.value);if(N=N?N.substr(1):null){N in h||(h[N]={elem:null,attrs:[],hrefs:[]});h[N].attrs.push(D)}}});var C=svgedit.utilities.getHref(A);if(C&&k.indexOf(A.nodeName)>=
0)if(C=C.substr(1)){C in h||(h[C]={elem:null,attrs:[],hrefs:[]});h[C].hrefs.push(A)}}});for(var w in h)if(w){var u=h[w].elem;if(u){g=Q();u.id=g;u=h[w].attrs;for(var G=u.length;G--;){var z=u[G];z.ownerElement.setAttribute(z.name,"url(#"+g+")")}u=h[w].hrefs;for(G=u.length;G--;)svgedit.utilities.setHref(u[G],"#"+g)}}},gc=this.setUseData=function(g){var h=$(g);if(g.tagName!=="use")h=h.find("use");h.each(function(){var k=da(this).substr(1);if(k=ua(k)){$(this).data("ref",k);if(k.tagName=="symbol"||k.tagName==
"svg")$(this).data("symbol",k).data("ref",k)}})},ec=this.convertGradients=function(g){var h=$(g).find("linearGradient, radialGradient");if(!h.length&&svgedit.browser.isWebkit())h=$(g).find("*").filter(function(){return this.tagName.indexOf("Gradient")>=0});h.each(function(){if($(this).attr("gradientUnits")==="userSpaceOnUse"){var k=$(m).find('[fill="url(#'+this.id+')"],[stroke="url(#'+this.id+')"]');if(k.length)if(k=svgedit.utilities.getBBox(k[0]))if(this.tagName==="linearGradient"){var w=$(this).attr(["x1",
"y1","x2","y2"]),u=this.gradientTransform.baseVal;if(u&&u.numberOfItems>0){var G=S(u).matrix;u=P(w.x1,w.y1,G);G=P(w.x2,w.y2,G);w.x1=u.x;w.y1=u.y;w.x2=G.x;w.y2=G.y;this.removeAttribute("gradientTransform")}$(this).attr({x1:(w.x1-k.x)/k.width,y1:(w.y1-k.y)/k.height,x2:(w.x2-k.x)/k.width,y2:(w.y2-k.y)/k.height});this.removeAttribute("gradientUnits")}}})},ic=this.convertToGroup=function(g){g||(g=H[0]);var h=$(g),k=new Na,w;if(h.data("gsvg")){k=$(g.firstChild).attr(["x","y"]);$(g.firstChild.firstChild).unwrap();
$(g).removeData("gsvg");w=T(g);var u=e.createSVGTransform();u.setTranslate(k.x,k.y);w.appendItem(u);pb(g);J("selected",[g])}else if(h.data("symbol")){g=h.data("symbol");w=h.attr("transform");u=h.attr(["x","y"]);var G=g.getAttribute("viewBox");if(G){G=G.split(" ");u.x-=+G[0];u.y-=+G[1]}w+=" translate("+(u.x||0)+","+(u.y||0)+")";u=h.prev();k.addSubCommand(new Va(h[0],h[0].nextSibling,h[0].parentNode));h.remove();G=$(m).find("use:data(symbol)").length;h=d.createElementNS(c,"g");for(var z=g.childNodes,
A=0;A<z.length;A++)h.appendChild(z[A].cloneNode(true));if(svgedit.browser.isGecko()){z=$(Bb()).children("linearGradient,radialGradient,pattern").clone();$(h).append(z)}w&&h.setAttribute("transform",w);w=g.parentNode;hc(h);svgedit.browser.isGecko()&&$(Bb()).append($(h).find("linearGradient,radialGradient,pattern"));h.id=Q();u.after(h);if(w){if(!G){u=g.nextSibling;w.removeChild(g);k.addSubCommand(new Va(g,u,w))}k.addSubCommand(new Qa(h))}gc(h);svgedit.browser.isGecko()?ec(Bb()):ec(h);svgedit.utilities.walkTreePost(h,
function(C){try{pb(C)}catch(F){console.log(F)}});$(h).find("a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use").each(function(){if(!this.id)this.id=Q()});Sb([h]);(g=bc(h,true))&&k.addSubCommand(g);Ha(k)}else console.log("Unexpected element to ungroup:",g)};this.setSvgString=function(g){try{var h=svgedit.utilities.text2xml(g);this.prepareSvg(h);var k=new Na("Change Source"),w=m.nextSibling,u=e.removeChild(m);k.addSubCommand(new Va(u,w,e));m=d.adoptNode?d.adoptNode(h.documentElement):
d.importNode(h.documentElement,true);e.appendChild(m);var G=$(m);b.current_drawing_=new svgedit.draw.Drawing(m,q);var z=v().getNonce();z?J("setnonce",z):J("unsetnonce");G.find("image").each(function(){var K=this;Lb(K);var O=da(this);if(O.indexOf("data:")===0){var ca=O.match(/svgedit_url=(.*?);/);if(ca){var U=decodeURIComponent(ca[1]);$(new Image).load(function(){K.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",U)}).attr("src",U)}}b.embedImage(O)});G.find("svg").each(function(){if(!$(this).closest("defs").length){hc(this);
var K=this.parentNode;if(K.childNodes.length===1&&K.nodeName==="g"){$(K).data("gsvg",this);K.id=K.id||Q()}else ra(this)}});svgedit.browser.isGecko()&&G.find("linearGradient, radialGradient, pattern").appendTo(Bb());gc(G);ec(G[0]);svgedit.utilities.walkTreePost(m,function(K){try{pb(K)}catch(O){console.log(O)}});var A={id:"svgcontent",overflow:l.show_outside_canvas?"visible":"hidden"},C=false;if(G.attr("viewBox")){var F=G.attr("viewBox").split(" ");A.width=F[2];A.height=F[3]}else $.each(["width","height"],
function(K,O){var ca=G.attr(O);ca||(ca="100%");if((ca+"").substr(-1)==="%")C=true;else A[O]=la(O,ca)});Tb();G.children().find("a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use").each(function(){if(!this.id)this.id=Q()});if(C){var E=getStrokedBBox();A.width=E.width+E.x;A.height=E.height+E.y}if(A.width<=0)A.width=100;if(A.height<=0)A.height=100;G.attr(A);this.contentW=A.width;this.contentH=A.height;k.addSubCommand(new Qa(m));var D=G.attr(["width","height"]);
k.addSubCommand(new Xa(e,D));p=1;svgedit.transformlist.resetListMap();cb();svgedit.path.clearData();e.appendChild(Pa.selectorParentGroup);Ha(k);J("changed",[m])}catch(N){console.log(N);return false}return true};this.importSvgString=function(g){try{var h=svgedit.utilities.encode64(g.length+g).substr(0,32),k=false;if(sb[h])if($(sb[h].symbol).parents("#svgroot").length)k=true;var w=new Na("Import SVG");if(k)var u=sb[h].symbol,G=sb[h].xform;else{var z=svgedit.utilities.text2xml(g);this.prepareSvg(z);
var A;A=d.adoptNode?d.adoptNode(z.documentElement):d.importNode(z.documentElement,true);hc(A);var C=la("width",A.getAttribute("width")),F=la("height",A.getAttribute("height")),E=A.getAttribute("viewBox"),D=E?E.split(" "):[0,0,C,F];for(g=0;g<4;++g)D[g]=+D[g];m.getAttribute("width");var N=+m.getAttribute("height");G=F>C?"scale("+N/3/D[3]+")":"scale("+N/3/D[2]+")";G="translate(0) "+G+" translate(0)";u=d.createElementNS(c,"symbol");var K=Bb();for(svgedit.browser.isGecko()&&$(A).find("linearGradient, radialGradient, pattern").appendTo(K);A.firstChild;)u.appendChild(A.firstChild);
var O=A.attributes;for(A=0;A<O.length;A++){var ca=O[A];u.setAttribute(ca.nodeName,ca.nodeValue)}u.id=Q();sb[h]={symbol:u,xform:G};Bb().appendChild(u);w.addSubCommand(new Qa(u))}var U=d.createElementNS(c,"use");U.id=Q();Z(U,"#"+u.id);(I||v().getCurrentLayer()).appendChild(U);w.addSubCommand(new Qa(U));cb();U.setAttribute("transform",G);pb(U);$(U).data("symbol",u).data("ref",u);Nb([U]);Ha(w);J("changed",[m])}catch(ta){console.log(ta);return false}return true};var Tb=b.identifyLayers=function(){cc();
v().identifyLayers()};this.createLayer=function(g){var h=new Na("Create Layer");g=v().createLayer(g);h.addSubCommand(new Qa(g));Ha(h);cb();J("changed",[g])};this.cloneLayer=function(g){var h=new Na("Duplicate Layer"),k=d.createElementNS(c,"g"),w=d.createElementNS(c,"title");w.textContent=g;k.appendChild(w);w=v().getCurrentLayer();$(w).after(k);w=w.childNodes;for(var u=0;u<w.length;u++){var G=w[u];G.localName!="title"&&k.appendChild(ia(G))}cb();Tb();h.addSubCommand(new Qa(k));Ha(h);b.setCurrentLayer(g);
J("changed",[k])};this.deleteCurrentLayer=function(){var g=v().getCurrentLayer(),h=g.nextSibling,k=g.parentNode;if(g=v().deleteCurrentLayer()){var w=new Na("Delete Layer");w.addSubCommand(new Va(g,h,k));Ha(w);cb();J("changed",[k]);return true}return false};this.setCurrentLayer=function(g){(g=v().setCurrentLayer(svgedit.utilities.toXml(g)))&&cb();return g};this.renameCurrentLayer=function(g){var h=v();if(h.current_layer){var k=h.current_layer;if(!b.setCurrentLayer(g)){for(var w=new Na("Rename Layer"),
u=0;u<h.getNumLayers();++u)if(h.all_layers[u][1]==k)break;var G=h.getLayerName(u);h.all_layers[u][0]=svgedit.utilities.toXml(g);var z=k.childNodes.length;for(u=0;u<z;++u){var A=k.childNodes.item(u);if(A&&A.tagName=="title"){for(;A.firstChild;)A.removeChild(A.firstChild);A.textContent=g;w.addSubCommand(new Xa(A,{"#text":G}));Ha(w);J("changed",[k]);return true}}}h.current_layer=k}return false};this.setCurrentLayerPosition=function(g){var h=v();if(h.current_layer&&g>=0&&g<h.getNumLayers()){for(var k=
0;k<h.getNumLayers();++k)if(h.all_layers[k][1]==h.current_layer)break;if(k==h.getNumLayers())return false;if(k!=g){var w=null,u=h.current_layer.nextSibling;if(g>k){if(g<h.getNumLayers()-1)w=h.all_layers[g+1][1]}else w=h.all_layers[g][1];m.insertBefore(h.current_layer,w);Ha(new Ra(h.current_layer,u,m));Tb();b.setCurrentLayer(h.getLayerName(g));return true}}return false};this.setLayerVisibility=function(g,h){var k=v(),w=k.getLayerVisibility(g),u=k.setLayerVisibility(g,h);if(u)Ha(new Xa(u,{display:w?
"inline":"none"},"Layer Visibility"));else return false;if(u==k.getCurrentLayer()){cb();Ua.clear()}return true};this.moveSelectedToLayer=function(g){for(var h=null,k=v(),w=0;w<k.getNumLayers();++w)if(k.getLayerName(w)==g){h=k.all_layers[w][1];break}if(!h)return false;g=new Na("Move Elements to Layer");k=H;for(w=k.length;w--;){var u=k[w];if(u){var G=u.nextSibling,z=u.parentNode;h.appendChild(u);g.addSubCommand(new Ra(u,G,z))}}Ha(g);return true};this.mergeLayer=function(g){var h=new Na("Merge Layer"),
k=v(),w=$(k.current_layer).prev()[0];if(w){for(h.addSubCommand(new Va(k.current_layer,k.current_layer.nextSibling,m));k.current_layer.firstChild;){var u=k.current_layer.firstChild;if(u.localName=="title"){h.addSubCommand(new Va(u,u.nextSibling,k.current_layer));k.current_layer.removeChild(u)}else{var G=u.nextSibling;w.appendChild(u);h.addSubCommand(new Ra(u,G,k.current_layer))}}m.removeChild(k.current_layer);if(!g){cb();Tb();J("changed",[m]);Ha(h)}k.current_layer=w;return h}};this.mergeAllLayers=
function(){var g=new Na("Merge all Layers"),h=v();for(h.current_layer=h.all_layers[h.getNumLayers()-1][1];$(m).children("g").length>1;)g.addSubCommand(b.mergeLayer(true));cb();Tb();J("changed",[m]);Ha(g)};var cc=this.leaveContext=function(){var g=yb.length;if(g){for(var h=0;h<g;h++){var k=yb[h],w=ab(k,"orig_opac");w!==1?k.setAttribute("opacity",w):k.removeAttribute("opacity");k.setAttribute("style","pointer-events: inherit")}yb=[];cb(true);J("contextset",null)}I=null},oc=this.setContext=function(g){cc();
if(typeof g==="string")g=ua(g);I=g;$(g).parentsUntil("#svgcontent").andSelf().siblings().each(function(){var h=this.getAttribute("opacity")||1;ab(this,"orig_opac",h);this.setAttribute("opacity",h*0.33);this.setAttribute("style","pointer-events: none");yb.push(this)});cb();J("contextset",I)};this.clear=function(){Ua.clear();cb();b.clearSvgContentElement();b.current_drawing_=new svgedit.draw.Drawing(m);b.createLayer("Layer 1");b.undoMgr.resetUndoStack();Pa.initGroup();Wa=Pa.getRubberBandBox();J("cleared")};
this.linkControlPoints=Ua.linkControlPoints;this.getContentElem=function(){return m};this.getRootElem=function(){return e};this.getSelectedElems=function(){return H};var Yb=this.getResolution=function(){var g=m.getAttribute("width")/p,h=m.getAttribute("height")/p;return{w:g,h:h,zoom:p}};this.getZoom=function(){return p};this.getVersion=function(){return"svgcanvas.js ($Rev: 2082 $)"};this.setUiStrings=function(g){$.extend(Jb,g.notification)};this.setConfig=function(g){$.extend(l,g)};this.getTitle=
function(g){if(g=g||H[0]){g=$(g).data("gsvg")||$(g).data("symbol")||g;g=g.childNodes;for(var h=0;h<g.length;h++)if(g[h].nodeName=="title")return g[h].textContent;return""}};this.setGroupTitle=function(g){var h=H[0];h=$(h).data("gsvg")||h;var k=$(h).children("title"),w=new Na("Set Label");if(g.length)if(k.length){k=k[0];w.addSubCommand(new Xa(k,{"#text":k.textContent}));k.textContent=g}else{k=d.createElementNS(c,"title");k.textContent=g;$(h).prepend(k);w.addSubCommand(new Qa(k))}else{w.addSubCommand(new Va(k[0],
k.nextSibling,h));k.remove()}Ha(w)};this.getDocumentTitle=function(){return b.getTitle(m)};this.setDocumentTitle=function(g){for(var h=m.childNodes,k=false,w="",u=new Na("Change Image Title"),G=0;G<h.length;G++)if(h[G].nodeName=="title"){k=h[G];w=k.textContent;break}if(!k){k=d.createElementNS(c,"title");m.insertBefore(k,m.firstChild)}if(g.length)k.textContent=g;else k.parentNode.removeChild(k);u.addSubCommand(new Xa(k,{"#text":w}));Ha(u)};this.getEditorNS=function(g){g&&m.setAttribute("xmlns:se",
"http://svg-edit.googlecode.com");return"http://svg-edit.googlecode.com"};this.setResolution=function(g,h){var k=Yb(),w=k.w;k=k.h;var u;if(g=="fit"){var G=getStrokedBBox();if(G){u=new Na("Fit Canvas to Content");var z=Kb();Nb(z);var A=[],C=[];$.each(z,function(){A.push(G.x*-1);C.push(G.y*-1)});z=b.moveSelectedElements(A,C,true);u.addSubCommand(z);cb();g=Math.round(G.width);h=Math.round(G.height)}else return false}if(g!=w||h!=k){z=e.suspendRedraw(1E3);u||(u=new Na("Change Image Dimensions"));g=la("width",
g);h=la("height",h);m.setAttribute("width",g);m.setAttribute("height",h);this.contentW=g;this.contentH=h;u.addSubCommand(new Xa(m,{width:w,height:k}));m.setAttribute("viewBox",[0,0,g/p,h/p].join(" "));u.addSubCommand(new Xa(m,{viewBox:["0 0",w,k].join(" ")}));Ha(u);e.unsuspendRedraw(z);if(background=document.getElementById("canvas_background")){background.setAttribute("x",-1);background.setAttribute("y",-1);background.setAttribute("width",g+2);background.setAttribute("height",h+2)}J("changed",[m])}return true};
this.getOffset=function(){return $(m).attr(["x","y"])};this.setBBoxZoom=function(g,h,k){var w=0.85,u=function(G){if(!G)return false;var z=Math.min(Math.round(h/G.width*100*w)/100,Math.round(k/G.height*100*w)/100);b.setZoom(z);return{zoom:z,bbox:G}};if(typeof g=="object"){g=g;if(g.width==0||g.height==0){b.setZoom(g.zoom?g.zoom:p*g.factor);return{zoom:p,bbox:g}}return u(g)}switch(g){case "selection":if(!H[0])return;g=$.map(H,function(G){if(G)return G});g=getStrokedBBox(g);break;case "canvas":g=Yb();
w=0.95;g={width:g.w,height:g.h,x:0,y:0};break;case "content":g=getStrokedBBox();break;case "layer":g=getStrokedBBox(Kb(v().getCurrentLayer()));break;default:return}return u(g)};this.setZoom=function(g){var h=Yb();m.setAttribute("viewBox","0 0 "+h.w/g+" "+h.h/g);p=g;$.each(H,function(k,w){w&&Pa.requestSelector(w).resize()});Ua.zoomChange();nb("zoomChanged",g)};this.getMode=function(){return Ia};this.setMode=function(g){Ua.clear(true);qb.clear();$("#workarea").attr("class",g);hb=H[0]&&H[0].nodeName==
"text"?mb:M;Ia=g};this.getColor=function(g){return hb[g]};this.setColor=function(g,h,k){M[g]=h;hb[g+"_paint"]={type:"solidColor"};for(var w=[],u=H.length;u--;){var G=H[u];if(G)if(G.tagName=="g")svgedit.utilities.walkTree(G,function(z){z.nodeName!="g"&&w.push(z)});else if(g=="fill")G.tagName!="polyline"&&G.tagName!="line"&&w.push(G);else w.push(G)}if(w.length>0)if(k)vb(g,h,w);else{ub(g,h,w);J("changed",w)}};var Bb=function(){var g=m.getElementsByTagNameNS(c,"defs");if(g.length>0)g=g[0];else{g=d.createElementNS(c,
"defs");m.firstChild?m.insertBefore(g,m.firstChild.nextSibling):m.appendChild(g)}return g},mc=this.setGradient=function(g){if(!(!hb[g+"_paint"]||hb[g+"_paint"].type=="solidColor")){var h=b[g+"Grad"],k=lc(h),w=Bb();if(k)h=k;else{h=w.appendChild(d.importNode(h,true));h.id=Q()}b.setColor(g,"url(#"+h.id+")");if(g=="canvas")(g=document.getElementById("canvas_background"))&&g.setAttribute("fill","url(#"+h.id+")")}},lc=function(g){var h=Bb();h=$(h).find("linearGradient, radialGradient");for(var k=h.length,
w=["r","cx","cy","fx","fy"];k--;){var u=h[k];if(g.tagName=="linearGradient"){if(g.getAttribute("x1")!=u.getAttribute("x1")||g.getAttribute("y1")!=u.getAttribute("y1")||g.getAttribute("x2")!=u.getAttribute("x2")||g.getAttribute("y2")!=u.getAttribute("y2"))continue}else{var G=$(g).attr(w),z=$(u).attr(w),A=false;$.each(w,function(K,O){if(G[O]!=z[O])A=true});if(A)continue}var C=g.getElementsByTagNameNS(c,"stop"),F=u.getElementsByTagNameNS(c,"stop");if(C.length==F.length){for(var E=C.length;E--;){var D=
C[E],N=F[E];if(D.getAttribute("offset")!=N.getAttribute("offset")||D.getAttribute("stop-opacity")!=N.getAttribute("stop-opacity")||D.getAttribute("stop-color")!=N.getAttribute("stop-color"))break}if(E==-1)return u}}return null};this.setPaint=function(g,h){var k=new $.jGraduate.Paint(h);this.setPaintOpacity(g,k.alpha/100,true);hb[g+"_paint"]=k;switch(k.type){case "solidColor":if(k.solidColor!="none"&&k.solidColor!="#none")this.setColor(g,"#"+k.solidColor);else{this.setColor(g,"none");document.querySelector(g==
"fill"?"#fill_color rect":"#stroke_color rect").setAttribute("fill","none")}break;case "linearGradient":case "radialGradient":b[g+"Grad"]=k[k.type];mc(g)}};this.getStrokeWidth=function(){return hb.stroke_width};this.setStrokeWidth=function(g){if(g==0&&["line","path"].indexOf(Ia)>=0)b.setStrokeWidth(1);else{hb.stroke_width=g;for(var h=[],k=H.length;k--;){var w=H[k];if(w)w.tagName=="g"?svgedit.utilities.walkTree(w,function(u){u.nodeName!="g"&&h.push(u)}):h.push(w)}if(h.length>0){ub("stroke-width",g,
h);J("changed",H)}}};this.setStrokeAttr=function(g,h){M[g.replace("-","_")]=h;for(var k=[],w=H.length;w--;){var u=H[w];if(u)u.tagName=="g"?svgedit.utilities.walkTree(u,function(G){G.nodeName!="g"&&k.push(G)}):k.push(u)}if(k.length>0){ub(g,h,k);J("changed",H)}};this.getStyle=function(){return M};this.getOpacity=function(){return M.opacity};this.setOpacity=function(g){M.opacity=g;ub("opacity",g)};this.getFillOpacity=function(){return M.fill_opacity};this.getStrokeOpacity=function(){return M.stroke_opacity};
this.setPaintOpacity=function(g,h,k){M[g+"_opacity"]=h;k?vb(g+"-opacity",h):ub(g+"-opacity",h)};this.getBlur=function(g){var h=0;if(g)if(g.getAttribute("filter"))if(g=ua(g.id+"_blur"))h=g.firstChild.getAttribute("stdDeviation");return h};(function(){function g(){var u=b.undoMgr.finishUndoableChange();h.addSubCommand(u);Ha(h);k=h=null}var h=null,k=null,w=false;b.setBlurNoUndo=function(u){if(k)if(u===0){vb("filter","");w=true}else{var G=H[0];w&&vb("filter","url(#"+G.id+"_blur)");if(svgedit.browser.isWebkit()){G.removeAttribute("filter");
G.setAttribute("filter","url(#"+G.id+"_blur)")}vb("stdDeviation",u,[k.firstChild]);b.setBlurOffsets(k,u)}else b.setBlur(u)};b.setBlurOffsets=function(u,G){if(G>3)ha(u,{x:"-50%",y:"-50%",width:"200%",height:"200%"},100);else if(!svgedit.browser.isWebkit()){u.removeAttribute("x");u.removeAttribute("y");u.removeAttribute("width");u.removeAttribute("height")}};b.setBlur=function(u,G){if(h)g();else{var z=H[0],A=z.id;k=ua(A+"_blur");u-=0;var C=new Na;if(k){if(u===0)k=null}else{var F=aa({element:"feGaussianBlur",
attr:{"in":"SourceGraphic",stdDeviation:u}});k=aa({element:"filter",attr:{id:A+"_blur"}});k.appendChild(F);Bb().appendChild(k);C.addSubCommand(new Qa(k))}F={filter:z.getAttribute("filter")};if(u===0){z.removeAttribute("filter");C.addSubCommand(new Xa(z,F))}else{ub("filter","url(#"+A+"_blur)");C.addSubCommand(new Xa(z,F));b.setBlurOffsets(k,u);h=C;b.undoMgr.beginUndoableChange("stdDeviation",[k?k.firstChild:null]);if(G){b.setBlurNoUndo(u);g()}}}}})();this.getBold=function(){var g=H[0];if(g!=null&&
g.tagName=="text"&&H[1]==null)return g.getAttribute("font-weight")=="bold";return false};this.setBold=function(g){var h=H[0];if(h!=null&&h.tagName=="text"&&H[1]==null)ub("font-weight",g?"bold":"normal");H[0].textContent||qb.setCursor()};this.getItalic=function(){var g=H[0];if(g!=null&&g.tagName=="text"&&H[1]==null)return g.getAttribute("font-style")=="italic";return false};this.setItalic=function(g){var h=H[0];if(h!=null&&h.tagName=="text"&&H[1]==null)ub("font-style",g?"italic":"normal");H[0].textContent||
qb.setCursor()};this.getFontFamily=function(){return mb.font_family};this.setFontFamily=function(g){mb.font_family=g;ub("font-family",g);H[0]&&!H[0].textContent&&qb.setCursor()};this.setFontColor=function(g){mb.fill=g;ub("fill",g)};this.getFontSize=function(){return mb.fill};this.getFontSize=function(){return mb.font_size};this.setFontSize=function(g){mb.font_size=g;ub("font-size",g);H[0].textContent||qb.setCursor()};this.getText=function(){var g=H[0];if(g==null)return"";return g.textContent};this.setTextContent=
function(g){ub("#text",g);qb.init(g);qb.setCursor()};this.setImageURL=function(g){var h=H[0];if(h){var k=$(h).attr(["width","height"]);k=!k.width||!k.height;var w=da(h);if(w!==g)k=true;else if(!k)return;var u=new Na("Change Image URL");Z(h,g);u.addSubCommand(new Xa(h,{"#href":w}));k?$(new Image).load(function(){var G=$(h).attr(["width","height"]);$(h).attr({width:this.width,height:this.height});Pa.requestSelector(h).resize();u.addSubCommand(new Xa(h,G));Ha(u);J("changed",[h])}).attr("src",g):Ha(u)}};
this.setLinkURL=function(g){var h=H[0];if(h){if(h.tagName!=="a"){h=$(h).parents("a");if(h.length)h=h[0];else return}var k=da(h);if(k!==g){var w=new Na("Change Link URL");Z(h,g);w.addSubCommand(new Xa(h,{"#href":k}));Ha(w)}}};this.setRectRadius=function(g){var h=H[0];if(h!=null&&h.tagName=="rect"){var k=h.getAttribute("rx");if(k!=g){h.setAttribute("rx",g);h.setAttribute("ry",g);Ha(new Xa(h,{rx:k,ry:k},"Radius"));J("changed",[h])}}};this.makeHyperlink=function(g){b.groupSelectedElements("a",g)};this.removeHyperlink=
function(){b.ungroupSelectedElement()};this.setSegType=function(g){Ua.setSegType(g)};this.convertToPath=function(g,h){if(g==null)$.each(H,function(xa,ja){ja&&b.convertToPath(ja)});else{if(!h)var k=new Na("Convert element to Path");var w=h?{}:{fill:M.fill,"fill-opacity":M.fill_opacity,stroke:M.stroke,"stroke-width":M.stroke_width,"stroke-dasharray":M.stroke_dasharray,"stroke-linejoin":M.stroke_linejoin,"stroke-linecap":M.stroke_linecap,"stroke-opacity":M.stroke_opacity,opacity:M.opacity,visibility:"hidden"};
$.each(["marker-start","marker-end","marker-mid","filter","clip-path"],function(){if(g.getAttribute(this))w[this]=g.getAttribute(this)});var u=aa({element:"path",attr:w}),G=g.getAttribute("transform");G&&u.setAttribute("transform",G);var z=g.id,A=g.parentNode;g.nextSibling?A.insertBefore(u,g):A.appendChild(u);var C="",F=function(xa){$.each(xa,function(ja,oa){var sa=oa[1];C+=oa[0];for(var za=0;za<sa.length;za+=2)C+=sa[za]+","+sa[za+1]+" "})},E=1.81;switch(g.tagName){case "ellipse":case "circle":var D=
$(g).attr(["rx","ry","cx","cy"]),N=D.cx,K=D.cy,O=D.rx;D=D.ry;if(g.tagName=="circle")O=D=$(g).attr("r");F([["M",[N-O,K]],["C",[N-O,K-D/E,N-O/E,K-D,N,K-D]],["C",[N+O/E,K-D,N+O,K-D/E,N+O,K]],["C",[N+O,K+D/E,N+O/E,K+D,N,K+D]],["C",[N-O/E,K+D,N-O,K+D/E,N-O,K]],["Z",[]]]);break;case "path":C=g.getAttribute("d");break;case "line":D=$(g).attr(["x1","y1","x2","y2"]);C="M"+D.x1+","+D.y1+"L"+D.x2+","+D.y2;break;case "polyline":case "polygon":C="M"+g.getAttribute("points");break;case "rect":D=$(g).attr(["rx",
"ry"]);O=D.rx;D=D.ry;var ca=g.getBBox();N=ca.x;K=ca.y;var U=ca.width;ca=ca.height;E=4-E;!O&&!D?F([["M",[N,K]],["L",[N+U,K]],["L",[N+U,K+ca]],["L",[N,K+ca]],["L",[N,K]],["Z",[]]]):F([["M",[N,K+D]],["C",[N,K+D/E,N+O/E,K,N+O,K]],["L",[N+U-O,K]],["C",[N+U-O/E,K,N+U,K+D/E,N+U,K+D]],["L",[N+U,K+ca-D]],["C",[N+U,K+ca-D/E,N+U-O/E,K+ca,N+U-O,K+ca]],["L",[N+O,K+ca]],["C",[N+O/E,K+ca,N,K+ca-D/E,N,K+ca-D]],["L",[N,K+D]],["Z",[]]]);break;default:u.parentNode.removeChild(u)}C&&u.setAttribute("d",C);if(h){Ua.resetOrientation(u);
k=false;try{k=u.getBBox()}catch(ta){}u.parentNode.removeChild(u);return k}else{if(G){G=T(u);ea(G)&&Ua.resetOrientation(u)}k.addSubCommand(new Va(g,g.nextSibling,A));k.addSubCommand(new Qa(u));cb();g.parentNode.removeChild(g);u.setAttribute("id",z);u.removeAttribute("visibility");Nb([u],true);Ha(k)}}};var vb=function(g,h,k){var w=e.suspendRedraw(1E3);Ia=="pathedit"&&Ua.moveNode(g,h);k=k||H;for(var u=k.length,G=["g","polyline","path"];u--;){var z=k[u];if(z!=null){Ia==="textedit"&&g!=="#text"&&z.textContent.length&&
qb.toSelectMode(z);if((g==="x"||g==="y")&&G.indexOf(z.tagName)>=0){var A=getStrokedBBox([z]);b.moveSelectedElements((g==="x"?h-A.x:0)*p,(g==="y"?h-A.y:0)*p,true)}else{A=g==="#text"?z.textContent:z.getAttribute(g);if(A==null)A="";if(A!==String(h)){if(g=="#text"){svgedit.utilities.getBBox(z);z.textContent=h;if(/rotate/.test(z.getAttribute("transform")))z=Oa(z)}else g=="#href"?Z(z,h):z.setAttribute(g,h);if(svgedit.browser.isGecko()&&z.nodeName==="text"&&/rotate/.test(z.getAttribute("transform")))if((h+
"").indexOf("url")===0||["font-size","font-family","x","y"].indexOf(g)>=0&&z.textContent)z=Oa(z);H.indexOf(z)>=0&&setTimeout(function(){z.parentNode&&Pa.requestSelector(z).resize()},0);A=ma(z);if(A!=0&&g!="transform")for(var C=T(z),F=C.numberOfItems;F--;)if(C.getItem(F).type==4){C.removeItem(F);var E=svgedit.utilities.getBBox(z),D=P(E.x+E.width/2,E.y+E.height/2,S(C).matrix);E=D.x;D=D.y;var N=e.createSVGTransform();N.setRotate(A,E,D);C.insertItemBefore(N,F);break}}}}}e.unsuspendRedraw(w)},ub=this.changeSelectedAttribute=
function(g,h,k){k=k||H;b.undoMgr.beginUndoableChange(g,k);vb(g,h,k);g=b.undoMgr.finishUndoableChange();g.isEmpty()||Ha(g)};this.deleteSelectedElements=function(){for(var g=new Na("Delete Elements"),h=H.length,k=[],w=0;w<h;++w){var u=H[w];if(u==null)break;var G=u.parentNode,z=u;Pa.releaseSelector(z);svgedit.path.removePath_(z.id);if(G.tagName==="a"&&G.childNodes.length===1){z=G;G=G.parentNode}var A=z.nextSibling;z=G.removeChild(z);k.push(u);H[w]=null;g.addSubCommand(new Va(z,A,G))}g.isEmpty()||Ha(g);
J("changed",k);cb()};this.cutSelectedElements=function(){for(var g=new Na("Cut Elements"),h=H.length,k=[],w=0;w<h;++w){var u=H[w];if(u==null)break;var G=u.parentNode,z=u;Pa.releaseSelector(z);svgedit.path.removePath_(z.id);var A=z.nextSibling;z=G.removeChild(z);k.push(u);H[w]=null;g.addSubCommand(new Va(z,A,G))}g.isEmpty()||Ha(g);J("changed",k);cb();b.clipBoard=k};this.copySelectedElements=function(){b.clipBoard=$.merge([],H)};this.pasteElements=function(){var g=b.clipBoard,h=g.length;if(h){for(var k=
[],w=new Na("Paste elements");h--;){var u=g[h];if(u){var G=ia(u);if(!ua(u.id))G.id=u.id;k.push(G);(I||v().getCurrentLayer()).appendChild(G);w.addSubCommand(new Qa(G))}}svgCanvas.clearSelection();setTimeout(function(){Sb(k)},100);Ha(w);J("changed",k)}};this.groupSelectedElements=function(g){g||(g="g");var h="";switch(g){case "a":h="Make hyperlink";var k="";if(arguments.length>1)k=arguments[1];break;default:g="g";h="Group Elements"}h=new Na(h);var w=aa({element:g,attr:{id:Q()}});g==="a"&&Z(w,k);h.addSubCommand(new Qa(w));
for(k=H.length;k--;){var u=H[k];if(u!=null){if(u.parentNode.tagName==="a"&&u.parentNode.childNodes.length===1)u=u.parentNode;var G=u.nextSibling,z=u.parentNode;w.appendChild(u);h.addSubCommand(new Ra(u,G,z))}}h.isEmpty()||Ha(h);Sb([w],true)};var bc=this.pushGroupProperties=function(g,h){var k=g.childNodes,w=k.length,u=g.getAttribute("transform"),G=T(g),z=S(G).matrix,A=new Na("Push group properties"),C=0,F=ma(g),E=$(g).attr(["filter","opacity"]),D,N;for(C=0;C<w;C++){var K=k[C];if(K.nodeType===1){if(E.opacity!==
null&&E.opacity!==1){K.getAttribute("opacity");var O=Math.round((K.getAttribute("opacity")||1)*E.opacity*100)/100;ub("opacity",O,[K])}if(E.filter){var ca=O=this.getBlur(K);N||(N=this.getBlur(g));if(O)O=N-0+(O-0);else if(O===0)O=N;if(ca)D=ga(K.getAttribute("filter"));else if(D){D=ia(D);Bb().appendChild(D)}else D=ga(E.filter);D.id=K.id+"_"+(D.firstChild.tagName==="feGaussianBlur"?"blur":"filter");ub("filter","url(#"+D.id+")",[K]);if(O){ub("stdDeviation",O,[D.firstChild]);b.setBlurOffsets(D,O)}}O=T(K);
if(~K.tagName.indexOf("Gradient"))O=null;if(O)if(K.tagName!=="defs")if(G.numberOfItems){if(F&&G.numberOfItems==1){var U=G.getItem(0).matrix,ta=e.createSVGMatrix();if(ca=ma(K))ta=O.getItem(0).matrix;var xa=svgedit.utilities.getBBox(K),ja=S(O).matrix,oa=P(xa.x+xa.width/2,xa.y+xa.height/2,ja);xa=F+ca;ja=e.createSVGTransform();ja.setRotate(xa,oa.x,oa.y);U=R(U,ta,ja.matrix.inverse());ca&&O.removeItem(0);if(xa)O.numberOfItems?O.insertItemBefore(ja,0):O.appendItem(ja);if(U.e||U.f){ca=e.createSVGTransform();
ca.setTranslate(U.e,U.f);O.numberOfItems?O.insertItemBefore(ca,0):O.appendItem(ca)}}else{ca=K.getAttribute("transform");U={};U.transform=ca?ca:"";ca=e.createSVGTransform();U=S(O).matrix;ta=U.inverse();U=R(ta,z,U);ca.setMatrix(U);O.appendItem(ca)}(K=pb(K))&&A.addSubCommand(K)}}}if(u){U={};U.transform=u;g.setAttribute("transform","");g.removeAttribute("transform");A.addSubCommand(new Xa(g,U))}if(h&&!A.isEmpty())return A};this.ungroupSelectedElement=function(){var g=H[0];if($(g).data("gsvg")||$(g).data("symbol"))ic(g);
else if(g.tagName==="use"){var h=ua(da(g).substr(1));$(g).data("symbol",h).data("ref",h);ic(g)}else{h=$(g).parents("a");if(h.length)g=h[0];if(g.tagName==="g"||g.tagName==="a"){h=new Na("Ungroup Elements");var k=bc(g,true);k&&h.addSubCommand(k);k=g.parentNode;for(var w=g.nextSibling,u=Array(g.childNodes.length),G=0;g.firstChild;){var z=g.firstChild,A=z.nextSibling,C=z.parentNode;if(z.tagName==="title"){h.addSubCommand(new Va(z,z.nextSibling,C));C.removeChild(z)}else{u[G++]=z=k.insertBefore(z,w);h.addSubCommand(new Ra(z,
A,C))}}cb();w=g.nextSibling;g=k.removeChild(g);h.addSubCommand(new Va(g,w,k));h.isEmpty()||Ha(h);Nb(u)}}};this.moveToTopSelectedElement=function(){var g=H[0];if(g!=null){g=g;var h=g.parentNode,k=g.nextSibling;g=g.parentNode.appendChild(g);if(k!=g.nextSibling){Ha(new Ra(g,k,h,"top"));J("changed",[g])}}};this.moveToBottomSelectedElement=function(){var g=H[0];if(g!=null){g=g;var h=g.parentNode,k=g.nextSibling,w=g.parentNode.firstChild;if(w.tagName=="title")w=w.nextSibling;if(w.tagName=="defs")w=w.nextSibling;
g=g.parentNode.insertBefore(g,w);if(k!=g.nextSibling){Ha(new Ra(g,k,h,"bottom"));J("changed",[g])}}};this.moveUpDownSelected=function(g){var h=H[0];if(h){jb=[];var k,w,u=$(Ob(getStrokedBBox([h]))).toArray();g=="Down"&&u.reverse();$.each(u,function(){if(w){k=this;return false}else if(this==h)w=true});if(k){u=h.parentNode;var G=h.nextSibling;$(k)[g=="Down"?"before":"after"](h);if(G!=h.nextSibling){Ha(new Ra(h,G,u,"Move "+g));J("changed",[h])}}}};this.moveSelectedElements=function(g,h,k){if(g.constructor!=
Array){g/=p;h/=p}k=k||true;for(var w=new Na("position"),u=H.length;u--;){var G=H[u];if(G!=null){var z=e.createSVGTransform(),A=T(G);g.constructor==Array?z.setTranslate(g[u],h[u]):z.setTranslate(g,h);A.numberOfItems?A.insertItemBefore(z,0):A.appendItem(z);(z=pb(G))&&w.addSubCommand(z);Pa.requestSelector(G).resize()}}if(!w.isEmpty()){k&&Ha(w);J("changed",H);return w}};this.cloneSelectedElements=function(g,h){for(var k=new Na("Clone Elements"),w=H.length,u=0;u<w;++u){var G=H[u];if(G==null)break}w=H.slice(0,
u);this.clearSelection(true);for(u=w.length;u--;){G=w[u]=ia(w[u]);(I||v().getCurrentLayer()).appendChild(G);k.addSubCommand(new Qa(G))}if(!k.isEmpty()){Nb(w.reverse());this.moveSelectedElements(g,h,false);Ha(k)}};this.alignSelectedElements=function(g,h){var k=[],w=Number.MAX_VALUE,u=Number.MIN_VALUE,G=Number.MAX_VALUE,z=Number.MIN_VALUE,A=Number.MIN_VALUE,C=Number.MIN_VALUE,F=H.length;if(F){for(var E=0;E<F;++E){if(H[E]==null)break;k[E]=getStrokedBBox([H[E]]);switch(h){case "smallest":if((g=="l"||
g=="c"||g=="r")&&(A==Number.MIN_VALUE||A>k[E].width)||(g=="t"||g=="m"||g=="b")&&(C==Number.MIN_VALUE||C>k[E].height)){w=k[E].x;G=k[E].y;u=k[E].x+k[E].width;z=k[E].y+k[E].height;A=k[E].width;C=k[E].height}break;case "largest":if((g=="l"||g=="c"||g=="r")&&(A==Number.MIN_VALUE||A<k[E].width)||(g=="t"||g=="m"||g=="b")&&(C==Number.MIN_VALUE||C<k[E].height)){w=k[E].x;G=k[E].y;u=k[E].x+k[E].width;z=k[E].y+k[E].height;A=k[E].width;C=k[E].height}break;default:if(k[E].x<w)w=k[E].x;if(k[E].y<G)G=k[E].y;if(k[E].x+
k[E].width>u)u=k[E].x+k[E].width;if(k[E].y+k[E].height>z)z=k[E].y+k[E].height}}if(h=="page"){G=w=0;u=b.contentW;z=b.contentH}A=Array(F);C=Array(F);for(E=0;E<F;++E){if(H[E]==null)break;var D=k[E];A[E]=0;C[E]=0;switch(g){case "l":A[E]=w-D.x;break;case "c":A[E]=(w+u)/2-(D.x+D.width/2);break;case "r":A[E]=u-(D.x+D.width);break;case "t":C[E]=G-D.y;break;case "m":C[E]=(G+z)/2-(D.y+D.height/2);break;case "b":C[E]=z-(D.y+D.height)}}this.moveSelectedElements(A,C)}};this.contentW=Yb().w;this.contentH=Yb().h;
this.updateCanvas=function(g,h){e.setAttribute("width",g);e.setAttribute("height",h);var k=$("#canvasBackground")[0],w=m.getAttribute("x"),u=m.getAttribute("y"),G=g/2-this.contentW*p/2,z=h/2-this.contentH*p/2;ha(m,{width:this.contentW*p,height:this.contentH*p,x:G,y:z,viewBox:"0 0 "+this.contentW+" "+this.contentH});ha(k,{width:m.getAttribute("width"),height:m.getAttribute("height"),x:G,y:z});(k=ua("background_image"))&&ha(k,{width:"100%",height:"100%"});Pa.selectorParentGroup.setAttribute("transform",
"translate("+G+","+z+")");return{x:G,y:z,old_x:w,old_y:u,d_x:G-w,d_y:z-u}};this.setBackground=function(g,h){var k=ua("canvasBackground"),w=$(k).find("rect")[0],u=ua("background_image");w.setAttribute("fill",g);if(h){if(!u){u=d.createElementNS(c,"image");ha(u,{id:"background_image",width:"100%",height:"100%",preserveAspectRatio:"xMinYMin",style:"pointer-events:none"})}Z(u,h);k.appendChild(u)}else u&&u.parentNode.removeChild(u)};this.cycleElement=function(g){var h=H[0],k=false,w=Kb(I||v().getCurrentLayer());
if(w.length){if(h==null){g=g?w.length-1:0;k=w[g]}else for(var u=w.length;u--;)if(w[u]==h){g=g?u-1:u+1;if(g>=w.length)g=0;else if(g<0)g=w.length-1;k=w[g];break}Sb([k],true);J("selected",H)}};this.clear();this.getPrivateMethods=function(){return{addCommandToHistory:Ha,setGradient:mc,addSvgElementFromJson:aa,assignAttributes:ha,BatchCommand:Na,call:J,ChangeElementCommand:Xa,copyElem:ia,ffClone:Oa,findDefs:Bb,findDuplicateGradient:lc,getElem:ua,getId:va,getIntersectionList:Ob,getMouseTarget:ac,getNextId:Q,
getPathBBox:Y,getUrlFromAttr:ka,hasMatrixTransform:ea,identifyLayers:Tb,InsertElementCommand:Qa,isIdentity:svgedit.math.isIdentity,logMatrix:wb,matrixMultiply:R,MoveElementCommand:Ra,preventClickDefault:Lb,recalculateAllSelectedDimensions:Za,recalculateDimensions:pb,remapElement:xb,RemoveElementCommand:Va,removeUnusedDefElems:kc,round:Gb,runExtensions:nb,sanitizeSvg:Ma,SVGEditTransformList:svgedit.transformlist.SVGTransformList,toString:toString,transformBox:svgedit.math.transformBox,transformListToTransform:S,
transformPoint:P,walkTree:svgedit.utilities.walkTree}}};(function(){document.addEventListener("touchstart",touchHandler,true);document.addEventListener("touchmove",touchHandler,true);document.addEventListener("touchend",touchHandler,true);document.addEventListener("touchcancel",touchHandler,true);if(!window.svgEditor)window.svgEditor=function(a){function o(v,p){var I=f.setSvgString(v)!==false;p=p||a.noop;I?p(true):a.alert(e.notification.errorLoadingSVG,function(){p(false)})}var f,c={},l=false,n={lang:"en",iconsize:"m",bkgd_color:"FFF",bkgd_url:"",img_save:"embed"},
b={},d={canvas_expansion:1,dimensions:[640,480],initFill:{color:"fff",opacity:1},initStroke:{width:1.5,color:"000",opacity:1},initOpacity:1,imgPath:"images/",extPath:"extensions/",jGraduatePath:"jgraduate/images/",extensions:[],initTool:"select",wireframe:false,colorPickerCSS:false,gridSnapping:false,gridColor:"#000",baseUnit:"px",snappingStep:10,showRulers:true,show_outside_canvas:false,no_save_warning:true,initFont:"Sans-serif"},e=c.uiStrings={common:{ok:"OK",cancel:"Cancel",key_up:"Up",key_down:"Down",
key_backspace:"Backspace",key_del:"Del"},layers:{layer:"Layer"},notification:{invalidAttrValGiven:"Invalid value given",noContentToFitTo:"No content to fit to",dupeLayerName:"There is already a layer named that!",enterUniqueLayerName:"Please enter a unique layer name",enterNewLayerName:"Please enter the new layer name",layerHasThatName:"Layer already has that name",QmoveElemsToLayer:'Move selected elements to layer "%s"?',QwantToClear:"Do you want to clear the drawing?\nThis will also erase your undo history!",
QwantToOpen:"Do you want to open a new file?\nThis will also erase your undo history!",QerrorsRevertToSource:"There were parsing errors in your SVG source.\nRevert back to original SVG source?",QignoreSourceChanges:"Ignore changes made to SVG source?",featNotSupported:"Feature not supported",enterNewImgURL:"Enter the new image URL",defsFailOnSave:"NOTE: Due to a bug in your browser, this image may appear wrong (missing gradients or elements). It will however appear correct once actually saved.",loadingImage:"Loading image, please wait...",
saveFromBrowser:'Select "Save As..." in your browser to save this image as a %s file.',noteTheseIssues:"Also note the following issues: ",unsavedChanges:"There are unsaved changes.",enterNewLinkURL:"Enter the new hyperlink URL",errorLoadingSVG:"Error: Unable to load SVG data",URLloadFail:"Unable to load from URL",retrieving:'Retrieving "%s" ...'}};b={};var m={};c.curConfig=d;c.tool_scale=1;a.pref=function(v,p){if(p)b[v]=p;v="svg-edit-"+v;var I=location.hostname,V=I&&I.indexOf(".")>=0,M=p!=undefined,
H=false;try{if(window.localStorage)H=localStorage}catch(aa){}try{if(window.globalStorage&&V)H=globalStorage[I]}catch(T){}if(H)if(M)H.setItem(v,p);else{if(H.getItem(v))return H.getItem(v)+""}else if(window.widget)if(M)widget.setPreferenceForKey(p,v);else return widget.preferenceForKey(v);else if(M){I=new Date;I.setTime(I.getTime()+31536E6);p=encodeURIComponent(p);document.cookie=v+"="+p+"; expires="+I.toUTCString()}else return(I=document.cookie.match(RegExp(v+"=([^;]+)")))?decodeURIComponent(I[1]):
""};c.setConfig=function(v){a.each(v,function(p,I){p in n&&a.pref(p,I)});a.extend(true,d,v);if(v.extensions)d.extensions=v.extensions};c.setCustomHandlers=function(v){c.ready(function(){if(v.open){a('#tool_open > input[type="file"]').remove();a("#tool_open").show();f.open=v.open}if(v.save){c.show_save_warning=false;f.bind("saved",v.save)}v.pngsave&&f.bind("exported",v.pngsave);m=v})};c.randomizeIds=function(){f.randomizeIds(arguments)};c.init=function(){function v(s,B){var L=s.id,W=L.split("_"),fa=
W[0];W=W[1];B&&f.setStrokeAttr("stroke-"+fa,W);mb();ja("#cur_"+fa,L,20);a(s).addClass("current").siblings().removeClass("current")}function p(s,B){a.pref("bkgd_color",s);a.pref("bkgd_url",B);f.setBackground(s,B)}function I(){var s=f.getHref(ha);s=s.indexOf("data:")===0?"":s;a.prompt(e.notification.enterNewImgURL,s,function(B){B&&Da(B)})}function V(){if(f.deleteCurrentLayer()){bb();Hb();a("#layerlist tr.layer").removeClass("layersel");a("#layerlist tr.layer:first").addClass("layersel")}}function M(){var s=
f.getCurrentDrawing().getCurrentLayerName()+" copy";a.prompt(e.notification.enterUniqueLayerName,s,function(B){if(B)if(f.getCurrentDrawing().hasLayer(B))a.alert(e.notification.dupeLayerName);else{f.cloneLayer(B);bb();Hb()}})}function H(s){var B=a("#layerlist tr.layersel").index(),L=f.getCurrentDrawing().getNumLayers();if(B>0||B<L-1){B+=s;f.setCurrentLayerPosition(L-B-1);Hb()}}function aa(s,B){var L=document.getElementById("ruler_x_cursor"),W=document.getElementById("ruler_y_cursor"),fa=document.getElementById("workarea");
document.getElementById("title_show");svgedit.browser.isTouch()||a("#workarea").unbind("mousemove.rulers").bind("mousemove.rulers",function(pc){pc.stopPropagation();L.style.left=pc.pageX-66+fa.scrollLeft+"px";W.style.top=pc.pageY-48+fa.scrollTop+"px"});B||(B=f.getZoom());s||(s=a("#svgcanvas"));for(var pa=f.getContentElem(),wa=svgedit.units.getTypeMap()[d.baseUnit],ya=0;ya<2;ya++){var Ca=ya===0,Ba=Ca?"x":"y",Aa=Ca?"width":"height",Ab=pa.getAttribute(Ba)-0;Ba=a("#ruler_"+Ba+" canvas:first");$hcanv=
Ba.clone();Ba.replaceWith($hcanv);var Ta=$hcanv[0];var na=Ba=s[Aa]()*2;Ta.parentNode.style[Aa]=na+"px";var Cb=0,db,Ea=Ta.getContext("2d");Ea.fillStyle="rgb(200,0,0)";Ea.fillRect(0,0,Ta.width,Ta.height);$hcanv.siblings().remove();if(Ba>=3E4){var Ya=parseInt(Ba/3E4)+1;db=Array(Ya);db[0]=Ea;for(var Fa=1;Fa<Ya;Fa++){Ta[Aa]=3E4;var ib=Ta.cloneNode(true);Ta.parentNode.appendChild(ib);db[Fa]=ib.getContext("2d")}ib[Aa]=Ba%3E4;Ba=3E4}Ta[Aa]=Ba;Aa=wa*B;var eb=50/Aa;Ta=1;for(Fa=0;Fa<jc.length;Fa++){Ta=Ya=jc[Fa];
if(eb<=Ya)break}eb=Ta*Aa;Ea.font="normal 9px 'Lucida Grande', sans-serif";Ea.fillStyle="#777";for(var lb=Ab/Aa%Ta*Aa,$b=lb-eb;lb<na;lb+=eb){$b+=eb;Fa=Math.round(lb)+0.5;if(Ca){Ea.moveTo(Fa,15);Ea.lineTo(Fa,0)}else{Ea.moveTo(15,Fa);Ea.lineTo(0,Fa)}Ya=($b-Ab)/Aa;if(Ta>=1)Fa=Math.round(Ya);else{Fa=(Ta+"").split(".")[1].length;Fa=Ya.toFixed(Fa)-0}if(Fa!==0&&Fa!==1E3&&Fa%1E3===0)Fa=Fa/1E3+"K";if(Ca){Ea.fillText(Fa,lb+2,8);Ea.fillStyle="#777"}else{Ya=(Fa+"").split("");for(Fa=0;Fa<Ya.length;Fa++){Ea.fillText(Ya[Fa],
1,lb+9+Fa*9);Ea.fillStyle="#777"}}Ya=eb/10;for(Fa=1;Fa<10;Fa++){var Qb=Math.round(lb+Ya*Fa)+0.5;if(db&&Qb>Ba){Cb++;Ea.stroke();if(Cb>=db.length){Fa=10;lb=na;continue}Ea=db[Cb];lb-=3E4;Qb=Math.round(lb+Ya*Fa)+0.5}var Zb=Fa%2?12:10;if(Ca){Ea.moveTo(Qb,15);Ea.lineTo(Qb,Zb)}else{Ea.moveTo(15,Qb);Ea.lineTo(Zb,Qb)}}}Ea.strokeStyle="#666";Ea.stroke()}}(function(){var s=window.opener;if(s)try{var B=s.document.createEvent("Event");B.initEvent("svgEditorReady",true,true);s.document.documentElement.dispatchEvent(B)}catch(L){}})();
(function(){var s=a.deparam.querystring(true);if(!a.isEmptyObject(s)){if(s.dimensions)s.dimensions=s.dimensions.split(",");if(s.extensions)s.extensions=s.extensions.split(",");if(s.bkgd_color)s.bkgd_color="#"+s.bkgd_color;svgEditor.setConfig(s);var B=s.source,L=a.param.querystring();if(!B)if(L.indexOf("source=data:")>=0)B=L.match(/source=(data:[^&]*)/)[1];if(B)if(B.indexOf("data:")===0){B=B.replace(/ /g,"+");c.loadFromDataURI(B)}else c.loadFromString(B);else if(L.indexOf("paramurl=")!==-1)svgEditor.loadFromURL(L.substr(9));
else s.url&&svgEditor.loadFromURL(s.url)}})();var T=function(){a.each(d.extensions,function(){var s=this;a.getScript(d.extPath+s,function(B){if(!B){B=document.createElement("script");B.src=d.extPath+s;document.querySelector("head").appendChild(B)}})})};document.location.protocol==="file:"?setTimeout(T,100):T();a.svgIcons(d.imgPath+"svg_edit_icons.svg",{w:27,h:27,id_match:false,no_img:!svgedit.browser.isWebkit(),fallback_path:d.imgPath,fallback:{new_image:"clear.png",save:"save.png",open:"open.png",
source:"source.png",docprops:"document-properties.png",wireframe:"wireframe.png",undo:"undo.png",redo:"redo.png",select:"select.png",select_node:"select_node.png",pencil:"fhpath.png",pen:"line.png",square:"square.png",rect:"rect.png",fh_rect:"freehand-square.png",circle:"circle.png",ellipse:"ellipse.png",fh_ellipse:"freehand-circle.png",path:"path.png",text:"text.png",image:"image.png",zoom:"zoom.png",clone:"clone.png",node_clone:"node_clone.png","delete":"delete.png",node_delete:"node_delete.png",
move_top:"move_top.png",move_bottom:"move_bottom.png",to_path:"to_path.png",link_controls:"link_controls.png",reorient:"reorient.png",align_left:"align-left.png",align_center:"align-center",align_right:"align-right",align_top:"align-top",align_middle:"align-middle",align_bottom:"align-bottom",go_up:"go-up.png",go_down:"go-down.png",ok:"save.png",cancel:"cancel.png",arrow_right:"flyouth.png",arrow_down:"dropdown.gif"},placement:{"#tool_docprops > div":"docprops","#tool_select":"select","#tool_fhpath":"pencil",
"#tool_line":"pen","#tool_rect,#tools_rect_show":"rect","#tool_square":"square","#tool_fhrect":"fh_rect","#tool_ellipse,#tools_ellipse_show":"ellipse","#tool_circle":"circle","#tool_fhellipse":"fh_ellipse","#tool_path":"path","#tool_text,#layer_rename":"text","#tool_image":"image","#tool_zoom":"zoom","#tool_node_clone":"node_clone","#tool_node_delete":"node_delete","#tool_add_subpath":"add_subpath","#tool_openclose_path":"open_path","#tool_alignleft, #tool_posleft":"align_left","#tool_aligncenter, #tool_poscenter":"align_center",
"#tool_alignright, #tool_posright":"align_right","#tool_aligntop, #tool_postop":"align_top","#tool_alignmiddle, #tool_posmiddle":"align_middle","#tool_alignbottom, #tool_posbottom":"align_bottom","#cur_position":"align","#linecap_butt,#cur_linecap":"linecap_butt","#linecap_round":"linecap_round","#linecap_square":"linecap_square","#linejoin_miter,#cur_linejoin":"linejoin_miter","#linejoin_round":"linejoin_round","#linejoin_bevel":"linejoin_bevel","#url_notice":"warning","#layer_up":"go_up","#layer_down":"go_down",
"#layer_moreopts":"context_menu","#layerlist td.layervis":"eye","#tool_source_save,#tool_docprops_save,#tool_prefs_save":"ok","#tool_source_cancel,#tool_docprops_cancel,#tool_prefs_cancel":"cancel","#rwidthLabel, #iwidthLabel":"width","#rheightLabel, #iheightLabel":"height","#angleLabel":"angle","#linkLabel,#tool_make_link,#tool_make_link_multi":"globe_link","#zoomLabel":"zoom","#blurLabel":"blur",".flyout_arrow_horiz":"arrow_right","#palette .palette_item:first, #fill_bg, #stroke_bg":"no_color"},
resize:{"#logo .svg_icon":32,".flyout_arrow_horiz .svg_icon":5,".layer_button .svg_icon, #layerlist td.layervis .svg_icon":14,"#main_button .dropdown .svg_icon":9,"#fill_bg .svg_icon, #stroke_bg .svg_icon":24,".palette_item:first .svg_icon":16,".toolbar_button button .svg_icon":16,".stroke_tool div div .svg_icon":20,"#tools_bottom label .svg_icon":18,"#zoom_dropdown .svg_icon":7},callback:function(){a(".toolbar_button button > svg, .toolbar_button button > img").each(function(){a(this).parent().prepend(this)});
a(".tool_button, .tool_button_current").addClass("loaded");var s=a("#tools_left");if(s.length!=0){s.offset();s.outerHeight()}a(".tools_flyout").each(function(){var B=a("#"+this.id+"_show"),L=B.attr("data-curopt");if(!B.children("svg, img").length){L=a(L).children().clone();if(L.length){L[0].removeAttribute("style");B.append(L)}}});svgEditor.runCallbacks();setTimeout(function(){a(".flyout_arrow_horiz:empty").each(function(){a(this).append(a.getSvgIcon("arrow_right").width(5).height(5))})},1)}});a("#rulers").on("dblclick",
function(s){a("#base_unit_container").css({top:s.pageY-10,left:s.pageX-50,display:"block"})});a("#base_unit_container").on("mouseleave mouseenter",function(){t=setTimeout(function(){a("#base_unit_container").fadeOut(500)},200);event.type=="mouseover"&&clearTimeout(t)});a("#base_unit").on("change",function(){xa()});c.canvas=f=new a.SvgCanvas(document.getElementById("svgcanvas"),d);c.show_save_warning=false;c.paintBox={fill:null,stroke:null,canvas:null};T=navigator.platform.indexOf("Mac")>=0;var P=
navigator.userAgent.indexOf("AppleWebKit")>=0,R=T?"meta+":"ctrl+",ea=f.pathActions,S=f.undoMgr,X=svgedit.utilities,ba=d.imgPath+"placeholder.svg",la=a("#workarea"),ka=a("#cmenu_canvas");a("#cmenu_layers");var da=null,Z=1,Y="toolbars",ma="";T||a(".shortcut").each(function(){var s=a(this).text();a(this).text(s.split("\u2318").join("Ctrl+"))});(function(){a("#dialog_container").draggable({cancel:"#dialog_content, #dialog_buttons *",containment:"window"});var s=a("#dialog_box"),B=a("#dialog_buttons"),
L=function(W,fa,pa,wa){a("#dialog_content").html("<p>"+fa.replace(/\n/g,"</p><p>")+"</p>").toggleClass("prompt",W=="prompt");B.empty();var ya=a('<input type="button" value="'+e.common.ok+'">').appendTo(B);W!="alert"&&a('<input type="button" value="'+e.common.cancel+'">').appendTo(B).click(function(){s.hide();pa(false)});if(W=="prompt"){var Ca=a('<input type="text">').prependTo(B);Ca.val(wa||"");Ca.bind("keydown","return",function(){ya.click()})}W=="process"&&ya.hide();s.show();ya.click(function(){s.hide();
var Ba=W=="prompt"?Ca.val():true;pa&&pa(Ba)}).focus();W=="prompt"&&Ca.focus()};a.alert=function(W,fa){L("alert",W,fa)};a.confirm=function(W,fa){L("confirm",W,fa)};a.process_cancel=function(W,fa){L("process",W,fa)};a.prompt=function(W,fa,pa){L("prompt",W,pa,fa)}})();var ua=function(){var s=a(".tool_button_current");if(s.length&&s[0].id!=="tool_select"){s.removeClass("tool_button_current").addClass("tool_button");a("#tool_select").addClass("tool_button_current").removeClass("tool_button")}f.setMode("select")},
ha=null,qa=false,Ga=false,Ma=false,Ra=false,Qa="",Va=a("title:first").text(),Xa=function(s,B,L){f.getResolution();a("#svgcanvas").position();if(B=f.setBBoxZoom(B,la.width()-15,la.height()-15)){s=B.zoom;B=B.bbox;if(s<0.0010)Ia({value:0.1});else{a("#zoom").val(s*100);L?Wb():Wb(false,{x:B.x*s+B.width*s/2,y:B.y*s+B.height*s/2});f.getMode()=="zoom"&&B.width&&ua();E()}}};a("#cur_context_panel").delegate("a","click",function(){var s=a(this);s.attr("data-root")?f.leaveContext():f.setContext(s.text());return false});
var Na=function(){c.paintBox.fill.prep();c.paintBox.stroke.prep()},Ha={},Pa=function(s){a.each(s,function(B,L){var W=a(B).children(),fa=B+"_show",pa=a(fa),wa=false;W.addClass("tool_button").unbind("click mousedown mouseup").each(function(Ba){var Aa=L[Ba];Ha[Aa.sel]=Aa.fn;if(Aa.isDefault)wa=Ba;Ba=function(Ab){var Ta=Aa;if(Ab.type==="keydown"){var na=a(Ta.parent+"_show").hasClass("tool_button_current"),Cb=a(Ta.parent+"_show").attr("data-curopt");a.each(s[Aa.parent],function(Ea,Ya){if(Ya.sel==Cb)Ta=
!Ab.shiftKey||!na?Ya:s[Aa.parent][Ea+1]||s[Aa.parent][0]})}if(a(this).hasClass("disabled"))return false;La(fa)&&Ta.fn();var db=Ta.icon?a.getSvgIcon(Ta.icon,true):a(Ta.sel).children().eq(0).clone();db[0].setAttribute("width",pa.width());db[0].setAttribute("height",pa.height());pa.children(":not(.flyout_arrow_horiz)").remove();pa.append(db).attr("data-curopt",Ta.sel)};a(this).mouseup(Ba);Aa.key&&a(document).bind("keydown",Aa.key[0]+" shift+"+Aa.key[0],Ba)});if(wa)pa.attr("data-curopt",L[wa].sel);else pa.attr("data-curopt")||
pa.attr("data-curopt",L[0].sel);var ya,Ca=a(fa).position();a(B).css({left:Ca.left+34,top:Ca.top+77});pa.mousedown(function(Ba){a("#tools_shapelib").is(":visible")&&La(fa,false);if(pa.hasClass("disabled"))return false;var Aa=a(B),Ab=Ca.left+34,Ta=Aa.width()*-1,na=Aa.data("shown_popop")?200:0;ya=setTimeout(function(){pa.data("isLibrary")?Aa.css("left",Ab).show():Aa.css("left",Ta).show().animate({left:Ab},150);Aa.data("shown_popop",true)},na);Ba.preventDefault()}).mouseup(function(){clearTimeout(ya);
var Ba=a(this).attr("data-curopt");if(pa.data("isLibrary")&&a(fa.replace("_show","")).is(":visible"))La(fa,true);else La(fa)&&Ba in Ha&&Ha[Ba]()})});Jb()},zb=function(s,B){return a("<div>",{"class":"tools_flyout",id:s}).appendTo("#svg_editor").append(B)},Ja=function(){a(".tools_flyout").each(function(){var s=a("#"+this.id+"_show"),B=s.offset();s=s.outerWidth();a(this).css({left:(B.left+s)*Z,top:B.top})})},Jb=function(){a(".tools_flyout").each(function(){var s=a("#"+this.id+"_show");if(!s.data("isLibrary")){var B=
[];a(this).children().each(function(){B.push(this.title)});s[0].title=B.join(" / ")}})},tb,ab=function(s,B,L){var W=null;if(s.indexOf("url(#")===0){s=(s=f.getRefElem(s))?s.cloneNode(true):a("#"+L+"_color defs *")[0];W={alpha:B};W[s.tagName]=s}else W=s.indexOf("#")===0?{alpha:B,solidColor:s.substr(1)}:{alpha:B,solidColor:"none"};return new a.jGraduate.Paint(W)},$a=f.getResolution();if(d.baseUnit!=="px"){$a.w=svgedit.units.convertUnit($a.w)+d.baseUnit;$a.h=svgedit.units.convertUnit($a.h)+d.baseUnit}a(".canvas_width").val($a.w);
a(".canvas_height").val($a.h);a("#docprops_button").on("click",function(){N()});var Ka=function(s){f.createLayer("background");cur_shape=f.addSvgElementFromJson({element:"rect",attr:{x:-1,y:-1,width:$a.w+2,height:$a.h+2,stroke:"none",id:"canvas_background",opacity:1,fill:s||"#fff",style:"pointer-events:none"}});f.setCurrentLayer("Layer 1");f.setCurrentLayerPosition("1")};document.getElementById("canvas_background")||Ka();document.getElementById("canvas_background").getAttribute("fill");var Da=c.setImageURL=
function(s){s||(s=ba);f.setImageURL(s);a("#image_url").val(s);if(s.indexOf("data:")===0){a("#image_url").hide();a("#change_image_url").show()}else{f.embedImage(s,function(B){B?a("#url_notice").hide():a("#url_notice").show();ba=s});a("#image_url").show();a("#change_image_url").hide()}},yb=function(s){var B=Math.min(Math.max(12+s.value.length*6,50),300);a(s).width(B)},bb=function(){var s=ha;if(s!=null&&!s.parentNode)s=null;var B=f.getCurrentDrawing().getCurrentLayerName(),L=f.getMode(),W=d.baseUnit!==
"px"?d.baseUnit:null,fa=L=="pathedit",pa=a("#cmenu_canvas li");a("#selected_panel, #multiselected_panel, #g_panel, #path_panel, #rect_panel, #canvas_panel, #circle_panel,\t\t\t\t\t#ellipse_panel, #line_panel, #text_panel, #image_panel, #container_panel, #use_panel, #a_panel").hide();a(".menu_item","#edit_menu").addClass("disabled");a(".menu_item","#object_menu").addClass("disabled");!s&&!qa&&a("#canvas_panel").show();if(s!=null){var wa=s.nodeName,ya=f.getRotationAngle(s);a("#angle").val(Math.round(ya));
ya=f.getBlur(s);a("#blur").val(ya);a("#blur_slider").slider("option","value",ya);f.addedNew&&wa==="image"&&f.getHref(s).indexOf("data:")!==0&&I();if(!fa&&L!="pathedit"){a("#selected_panel").show();a(".action_selected").removeClass("disabled");if(["line","circle","ellipse"].indexOf(wa)>=0)a("#xy_panel").hide();else{var Ca,Ba;if(["g","polyline","path"].indexOf(wa)>=0){if(L=f.getStrokedBBox([s])){Ca=L.x;Ba=L.y}}else{Ca=s.getAttribute("x");Ba=s.getAttribute("y")}if(W){Ca=svgedit.units.convertUnit(Ca);
Ba=svgedit.units.convertUnit(Ba)}a("#selected_x").val(Math.round(Ba)||0);a("#selected_y").val(Math.round(Ca)||0);a("#xy_panel").show()}["image","text","path","g","use"].indexOf(wa)==-1&&a(".action_path_convert_selected").removeClass("disabled");wa==="path"&&a(".action_path_selected").removeClass("disabled")}else{B=ea.getNodePoint();a("#tool_add_subpath").removeClass("push_button_pressed").addClass("tool_button");a("#tool_node_delete").toggleClass("disabled",!ea.canDeleteNodes);ja("#tool_openclose_path",
ea.closed_subpath?"open_path":"close_path");if(B){fa=a("#seg_type");if(W){B.x=svgedit.units.convertUnit(B.x);B.y=svgedit.units.convertUnit(B.y)}a("#path_node_x").val(Math.round(B.x));a("#path_node_y").val(Math.round(B.y));B.type?fa.val(B.type).removeAttr("disabled"):fa.val(4).attr("disabled","disabled")}return}W={g:[],a:[],rect:["rx","width","height"],image:["width","height"],circle:["cx","cy","r"],ellipse:["cx","cy","rx","ry"],line:["x1","y1","x2","y2"],text:[],use:[]};var Aa=s.tagName;a(s).data("gsvg")&&
a("#g_panel").show();Aa=="path"&&a("#path_panel").show();if(W[Aa]){W=W[Aa];a("#"+Aa+"_panel").show();a.each(W,function(Ab,Ta){var na=s.getAttribute(Ta);if(d.baseUnit!=="px"&&s[Ta])na=svgedit.units.convertUnit(s[Ta].baseVal.value);a("#"+Aa+"_"+Ta).val(Math.round(na)||0)});if(Aa=="text"){a("#text_panel").css("display","inline");f.getItalic()?a("#tool_italic").addClass("push_button_pressed").removeClass("tool_button"):a("#tool_italic").removeClass("push_button_pressed").addClass("tool_button");f.getBold()?
a("#tool_bold").addClass("push_button_pressed").removeClass("tool_button"):a("#tool_bold").removeClass("push_button_pressed").addClass("tool_button");a("#font_family").val(s.getAttribute("font-family"));a("#font_size").val(s.getAttribute("font-size"));a("#text").val(s.textContent);f.addedNew&&setTimeout(function(){a("#text").focus().select()},100)}else if(Aa=="image")Da(f.getHref(s));else if(Aa==="g"||Aa==="use"){a("#container_panel").show();a(".action_group_selected").removeClass("disabled");W=f.getTitle();
wa=a("#g_title")[0];wa.value=W;yb(wa);Aa=="use"?wa.setAttribute("disabled","disabled"):wa.removeAttribute("disabled")}}pa[(Aa==="g"?"en":"dis")+"ableContextMenuItems"]("#ungroup");pa[(Aa==="g"||!qa?"dis":"en")+"ableContextMenuItems"]("#group")}else if(qa){a("#multiselected_panel").show();a(".action_multi_selected").removeClass("disabled");pa.enableContextMenuItems("#group").disableContextMenuItems("#ungroup")}else pa.disableContextMenuItems("#delete,#cut,#copy,#group,#ungroup,#move_front,#move_up,#move_down,#move_back");
S.getUndoStackSize()>0?a("#tool_undo").removeClass("disabled"):a("#tool_undo").addClass("disabled");S.getRedoStackSize()>0?a("#tool_redo").removeClass("disabled"):a("#tool_redo").addClass("disabled");f.addedNew=false;if(s&&!fa||qa){a("#selLayerNames").removeAttr("disabled").val(B);ka.enableContextMenuItems("#delete,#cut,#copy,#move_front,#move_up,#move_down,#move_back")}else a("#selLayerNames").attr("disabled","disabled")};a("#text").focus(function(){});a("#text").blur(function(){});f.bind("selected",
function(s,B){var L=f.getMode();L==="select"&&ua();L=L=="pathedit";ha=B.length==1||B[1]==null?B[0]:null;qa=B.length>=2&&B[1]!=null;if(ha!=null)if(!L){if(ha!=null)switch(ha.tagName){case "use":case "image":case "foreignObject":break;case "g":case "a":for(var W=null,fa=ha.getElementsByTagName("*"),pa=0,wa=fa.length;pa<wa;pa++){var ya=fa[pa].getAttribute("stroke-width");if(pa===0)W=ya;else if(W!==ya)W=null}a("#stroke_width").val(W===null?"":W);c.paintBox.fill.update(true);c.paintBox.stroke.update(true);
break;default:c.paintBox.fill.update(true);c.paintBox.stroke.update(true);a("#stroke_width").val(ha.getAttribute("stroke-width")||1);a("#stroke_style").val(ha.getAttribute("stroke-dasharray")||"none");W=ha.getAttribute("stroke-linejoin")||"miter";a("#linejoin_"+W).length!=0&&v(a("#linejoin_"+W)[0]);W=ha.getAttribute("stroke-linecap")||"butt";a("#linecap_"+W).length!=0&&v(a("#linecap_"+W)[0])}if(ha!=null){W=(ha.getAttribute("opacity")||1)*100;a("#group_opacity").val(W);a("#opac_slider").slider("option",
"value",W);a("#elem_id").val(ha.id)}}a("#path_node_panel").toggle(L);a("#tools_bottom_2,#tools_bottom_3").toggle(!L);if(L){a(".tool_button_current").removeClass("tool_button_current").addClass("tool_button");a("#tool_select").addClass("tool_button_current").removeClass("tool_button");ja("#tool_select","select_node");qa=false;if(B.length)ha=B[0]}else{if(B[0]){L=f.selectorManager.requestSelector(B[0]);L.reset(B[0]);L.selectorRect.setAttribute("display","inline")}ja("#tool_select","select")}bb();f.runExtensions("selectedChanged",
{elems:B,selectedElement:ha,multiselected:qa})});f.bind("transition",function(s,B){var L=f.getMode(),W=B[0];if(W){qa=B.length>=2&&B[1]!=null;if(!qa)switch(L){case "rotate":L=f.getRotationAngle(W);a("#angle").val(Math.round(L));a("#tool_reorient").toggleClass("disabled",L==0)}f.runExtensions("elementTransition",{elems:B})}});f.bind("changed",function(s,B){var L=f.getMode();L==="select"&&ua();for(var W=0;W<B.length;++W){var fa=B[W];if(fa&&fa.tagName==="svg"){Hb();Wb()}else if(fa&&ha&&ha.parentNode==
null)ha=fa}c.show_save_warning=true;bb();if(ha&&L==="select"){c.paintBox.fill.update();c.paintBox.stroke.update()}f.runExtensions("elementChanged",{elems:B})});f.bind("saved",function(s,B){c.show_save_warning=false;B='<?xml version="1.0"?>\n'+B;var L=navigator.userAgent;if(~L.indexOf("Chrome")&&a.browser.version>=533||~L.indexOf("MSIE"))D(0,true);else{var W=s.open("data:image/svg+xml;base64,"+X.encode64(B)),fa=a.pref("save_notice_done");if(fa!=="all"){var pa=e.notification.saveFromBrowser.replace("%s",
"SVG");if(L.indexOf("Gecko/")!==-1)if(B.indexOf("<defs")!==-1){pa+="\n\n"+e.notification.defsFailOnSave;a.pref("save_notice_done","all");fa="all"}else a.pref("save_notice_done","part");else a.pref("save_notice_done","all");fa!=="part"&&W.alert(pa)}}});f.bind("exported",function(s,B){var L=B.issues;a("#export_canvas").length||a("<canvas>",{id:"export_canvas"}).hide().appendTo("body");var W=a("#export_canvas")[0];W.width=f.contentW;W.height=f.contentH;canvg(W,B.svg,{renderCallback:function(){var fa=
W.toDataURL("image/png");da.location.href=fa;if(a.pref("export_notice_done")!=="all"){fa=e.notification.saveFromBrowser.replace("%s","PNG");if(L.length)fa+="\n\n"+e.notification.noteTheseIssues+"\n \u2022 "+L.join("\n \u2022 ");a.pref("export_notice_done","all");da.alert(fa)}}})});f.bind("zoomed",Xa);f.bind("contextset",function(s,B){var L="";if(B){var W="";L='<a href="#" data-root="y">'+f.getCurrentDrawing().getCurrentLayerName()+"</a>";a(B).parentsUntil("#svgcontent > g").andSelf().each(function(){if(this.id){W+=
" > "+this.id;L+=this!==B?' > <a href="#">'+this.id+"</a>":" > "+this.id}});Qa=W}else Qa=null;a("#cur_context_panel").toggle(!!B).html(L);U()});f.bind("extension_added",function(s,B){function L(){if(tb){clearTimeout(tb);tb=null}fa||(tb=setTimeout(function(){fa=true;za(b.iconsize)},50))}var W=false,fa=false,pa=true,wa=function(){if(B.callback&&!W&&pa){W=true;B.callback()}},ya=[];B.context_tools&&a.each(B.context_tools,function(Ta,na){var Cb=na.container_id?' id="'+na.container_id+'"':"",db=a("#"+na.panel);
db.length||(db=a("<div>",{id:na.panel}).appendTo("#tools_top").hide());switch(na.type){case "tool_button":var Ea='<div class="tool_button">'+na.id+"</div>",Ya=a(Ea).appendTo(db);na.events&&a.each(na.events,function(eb,lb){a(Ya).bind(eb,lb)});break;case "select":Ea="<label"+Cb+'><select id="'+na.id+'">';a.each(na.options,function(eb,lb){Ea+='<option value="'+eb+'"'+(eb==na.defval?" selected":"")+">"+lb+"</option>"});Ea+="</select></label>";var Fa=a(Ea).appendTo(db).find("select");a.each(na.events,
function(eb,lb){a(Fa).bind(eb,lb)});break;case "button-select":Ea='<div id="'+na.id+'" class="dropdown toolset" title="'+na.title+'"><div id="cur_'+na.id+'" class="icon_label"></div><button></button></div>';Cb=a('<ul id="'+na.id+'_opts"></ul>').appendTo("#option_lists");na.colnum&&Cb.addClass("optcols"+na.colnum);a(Ea).appendTo(db).children();ya.push({elem:"#"+na.id,list:"#"+na.id+"_opts",title:na.title,callback:na.events.change,cur:"#cur_"+na.id});break;case "input":Ea="<label"+Cb+'><span id="'+
na.id+'_label">'+na.label+':</span><input id="'+na.id+'" title="'+na.title+'" size="'+(na.size||"4")+'" value="'+(na.defval||"")+'" type="text"/></label>';var ib=a(Ea).appendTo(db).find("input");na.spindata&&ib.SpinButton(na.spindata);na.events&&a.each(na.events,function(eb,lb){ib.bind(eb,lb)})}});if(B.buttons){var Ca={},Ba={},Aa=B.svgicons,Ab={};a.each(B.buttons,function(Ta,na){for(var Cb,db=na.id,Ea=Ta;a("#"+db).length;)db=na.id+"_"+ ++Ea;if(Aa){Ca[db]=na.icon;Ea=na.svgicon?na.svgicon:na.id;if(na.type==
"app_menu")Ba["#"+db+" > div"]=Ea;else Ba["#"+db]=Ea}else Cb=na.type=="menu"?"":a('<img src="'+na.icon+'">');var Ya,Fa;switch(na.type){case "mode_flyout":case "mode":Ya="tool_button";if(na.cls)Ya+=" "+na.cls;Fa="#tools_left";break;case "context":Ya="tool_button";Fa="#"+na.panel;a(Fa).length||a("<div>",{id:na.panel}).appendTo("#tools_top");break;case "menu":Ya="menu_item tool_button";Fa="#"+(na.after||na.panel);break;case "app_menu":Ya="";Fa=na.parent||"#main_menu ul";a(Fa).length||a("<div>",{id:na.panel}).appendTo("#tools_top")}var ib=
a(na.list||na.type=="app_menu"?"<li/>":"<div/>").attr("id",db).attr("title",na.title).addClass(Ya);if(!na.includeWith&&!na.list){if("position"in na)a(Fa).children().eq(na.position).before(ib);else na.type!="menu"||!na.after?ib.appendTo(Fa):a(Fa).after(ib);if(na.type=="mode_flyout"){Ea=a(ib);Ya=Ea.parent();if(!Ea.parent().hasClass("tools_flyout")){var eb=Ea[0].id.replace("tool_","tools_"),lb=Ea.clone().attr("id",eb+"_show").append(a("<div>",{"class":"flyout_arrow_horiz"}));Ea.before(lb);Ya=zb(eb,Ea);
Ya.data("isLibrary",true);lb.data("isLibrary",true)}Ba["#"+eb+"_show"]=na.id;db=Ab["#"+Ya[0].id]=[{sel:"#"+db,fn:na.events.click,icon:na.id,isDefault:true},$b]}else if(na.type=="app_menu"||na.type=="menu")ib.append(na.title)}else if(na.list){ib.addClass("push_button");a("#"+na.list+"_opts").append(ib);if(na.isDefault){a("#cur_"+na.list).append(ib.children().clone());Ea=na.svgicon?na.svgicon:na.id;Ba["#cur_"+na.list]=Ea}}else if(na.includeWith){Fa=na.includeWith;Ea=a(Fa.button);Ya=Ea.parent();if(!Ea.parent().hasClass("tools_flyout")){eb=
Ea[0].id.replace("tool_","tools_");lb=Ea.clone().attr("id",eb+"_show").append(a("<div>",{"class":"flyout_arrow_horiz"}));Ea.before(lb);Ya=zb(eb,Ea)}var $b=qc.getButtonData(Fa.button);if(Fa.isDefault)Ba["#"+eb+"_show"]=na.id;db=Ab["#"+Ya[0].id]=[{sel:"#"+db,fn:na.events.click,icon:na.id,key:na.key,isDefault:na.includeWith?na.includeWith.isDefault:0},$b];eb="position"in Fa?Fa.position:"last";$b=Ya.children().length;if(!isNaN(eb)&&eb>=0&&eb<$b)Ya.children().eq(eb).before(ib);else{Ya.append(ib);db.reverse()}}Aa||
ib.append(Cb);na.list||a.each(na.events,function(Qb,Zb){if(Qb=="click")if(na.type=="mode"){na.includeWith?ib.bind(Qb,Zb):ib.bind(Qb,function(){La(ib)&&Zb()});if(na.key){a(document).bind("keydown",na.key,Zb);na.title&&ib.attr("title",na.title+" ["+na.key+"]")}}else ib.bind(Qb,Zb);else ib.bind(Qb,Zb)});Pa(Ab)});a.each(ya,function(){Fb(this.elem,this.list,this.callback,{seticon:true})});if(Aa)pa=false;a.svgIcons(Aa,{w:27,h:27,id_match:false,no_img:!P,fallback:Ca,placement:Ba,callback:function(){b.iconsize&&
b.iconsize!="m"&&L();pa=true;wa()}})}wa()});f.textActions.setInputElem(a("#text")[0]);var Sa='<div class="palette_item" data-rgb="none"></div>';a.each(["#000000","#3f3f3f","#7f7f7f","#bfbfbf","#ffffff","#ff0000","#ff7f00","#ffff00","#7fff00","#00ff00","#00ff7f","#00ffff","#007fff","#0000ff","#7f00ff","#ff00ff","#ff007f","#7f0000","#7f3f00","#7f7f00","#3f7f00","#007f00","#007f3f","#007f7f","#003f7f","#00007f","#3f007f","#7f007f","#7f003f","#ffaaaa","#ffd4aa","#ffffaa","#d4ffaa","#aaffaa","#aaffd4",
"#aaffff","#aad4ff"],function(s,B){Sa+='<div class="palette_item" style="background-color: '+B+';" data-rgb="'+B+'"></div>'});a("#palette").append(Sa);Sa="";a.each(["#FFF","#888","#000"],function(){Sa+='<div class="color_block" style="background-color:'+this+';"></div>'});a("#bg_blocks").append(Sa);var gb=a("#bg_blocks div");gb.each(function(){a(this).click(function(){gb.removeClass("cur_background");a(this).addClass("cur_background")})});if(a.pref("bkgd_color"))p(a.pref("bkgd_color"),a.pref("bkgd_url"));
else a.pref("bkgd_url")&&p(n.bkgd_color,a.pref("bkgd_url"));if(a.pref("img_save")){b.img_save=a.pref("img_save");a("#image_save_opts input").val([b.img_save])}var Ia=function(s){var B=s.value/100;if(B<0.0010)s.value=0.1;else{s=f.getZoom();Xa(window,{width:0,height:0,x:(la[0].scrollLeft+la.width()/2)/s,y:(la[0].scrollTop+la.height()/2)/s,zoom:B},true)}},rb=function(s,B){if(B==null)B=s.value;a("#group_opacity").val(B);if(!s||!s.handle)a("#opac_slider").slider("option","value",B);f.setOpacity(B/100)},
sb=function(s,B,L){if(B==null)B=s.value;a("#blur").val(B);var W=false;if(!s||!s.handle){a("#blur_slider").slider("option","value",B);W=true}L?f.setBlurNoUndo(B):f.setBlur(B,W)},mb=function(){window.opera&&a("<p/>").hide().appendTo("body").remove()};a("#stroke_style").change(function(){f.setStrokeAttr("stroke-dasharray",a(this).val());mb()});a("#stroke_linejoin").change(function(){f.setStrokeAttr("stroke-linejoin",a(this).val());mb()});a("select").change(function(){a(this).blur()});var hb=false;a("#selLayerNames").change(function(){var s=
this.options[this.selectedIndex].value,B=e.notification.QmoveElemsToLayer.replace("%s",s),L=function(W){if(W){hb=true;f.moveSelectedToLayer(s);f.clearSelection();Hb()}};if(s)hb?L(true):a.confirm(B,L)});a("#font_family").change(function(){f.setFontFamily(this.value)});a("#seg_type").change(function(){f.setSegType(a(this).val())});a("#text").keyup(function(){f.setTextContent(this.value)});a("#image_url").change(function(){Da(this.value)});a("#link_url").change(function(){this.value.length?f.setLinkURL(this.value):
f.removeHyperlink()});a("#g_title").change(function(){f.setGroupTitle(this.value)});a(".attr_changer").change(function(){var s=this.getAttribute("data-attr"),B=this.value;if(svgedit.units.isValidUnit(s,B,ha))this.blur();else{a.alert(e.notification.invalidAttrValGiven);this.value=ha.getAttribute(s);return false}if(s!=="id")if(isNaN(B))B=f.convertToNum(s,B);else if(d.baseUnit!=="px"){var L=svgedit.units.getTypeMap();if(ha[s]||f.getMode()==="pathedit"||s==="x"||s==="y")B*=L[d.baseUnit]}if(s==="id"){s=
ha;f.clearSelection();s.id=B;f.addToSelection([s],true)}else f.changeSelectedAttribute(s,B);this.blur()});a("#palette").mouseover(function(){var s=a('<input type="hidden">');a(this).append(s);s.focus().remove()});a(".palette_item").mousedown(function(){var s=a("#tool_stroke").hasClass("active"),B=s?"stroke":"fill",L=a(this).attr("data-rgb"),W=null;if(L==="transparent"||L==="initial"||L==="#none"){L="none";W=new a.jGraduate.Paint}else W=new a.jGraduate.Paint({alpha:100,solidColor:L.substr(1)});c.paintBox[B].setPaint(W);
if(s){f.setColor("stroke",L);L!="none"&&f.getStrokeOpacity()!=1&&f.setPaintOpacity("stroke",1)}else{f.setColor("fill",L);L!="none"&&f.getFillOpacity()!=1&&f.setPaintOpacity("fill",1)}}).bind("contextmenu",function(s){s.preventDefault()});a("#toggle_stroke_tools").toggle(function(){a(".stroke_tool").css("display","table-cell");a(this).addClass("expanded");Xb()},function(){a(".stroke_tool").css("display","none");a(this).removeClass("expanded");Xb()});var La=function(s,B){if(a(s).hasClass("disabled"))return false;
if(a(s).parent().hasClass("tools_flyout"))return true;var L=L||"normal";B||a(".tools_flyout").fadeOut(L);a("#styleoverrides").text("");a(".tool_button_current").removeClass("tool_button_current").addClass("tool_button");a(s).addClass("tool_button_current").removeClass("tool_button");return true};(function(){var s=null,B=null,L=la[0],W=false,fa=false;a("#svgcanvas").bind("mousemove mouseup",function(pa){if(W!==false){L.scrollLeft-=pa.clientX-s;L.scrollTop-=pa.clientY-B;s=pa.clientX;B=pa.clientY;if(pa.type===
"mouseup")W=false;return false}}).mousedown(function(pa){if(pa.button===1||fa===true){W=true;s=pa.clientX;B=pa.clientY;return false}});a(window).mouseup(function(){W=false});a(document).bind("keydown","space",function(pa){f.spaceKey=fa=true;pa.preventDefault()}).bind("keyup","space",function(pa){pa.preventDefault();f.spaceKey=fa=false}).bind("keydown","alt",function(){f.getMode()==="zoom"&&la.addClass("out")}).bind("keyup","alt",function(){f.getMode()==="zoom"&&la.removeClass("out")})})();var Wa=
a(".menu"),jb=function(s){s.target.style.background="#fff";setTimeout(function(){s.target.style.background="#ddd"},50);setTimeout(function(){s.target.style.background="#fff"},150);setTimeout(function(){s.target.style.background="#ddd"},200);setTimeout(function(){s.target.style.background=""},200);setTimeout(function(){a("#menu_bar").removeClass("active")},220);return false};a(".menu_item").live("click",function(s){jb(s)});a("svg, body").on("mousedown",function(s){top!=self&&!s.isTrigger&&typeof top.exports.setEditorFocus==
"function"&&top.exports.setEditorFocus();if(!a(s.target).hasClass("menu_title"))if(!a(s.target).hasClass("disabled")&&a(s.target).hasClass("menu_item"))jb(s);else{a("#menu_bar").removeClass("active");a("#tools_shapelib").is(":visible")&&!a(s.target).parents("#tools_shapelib_show, #tools_shapelib").length&&a("#tools_shapelib").hide();s.target.nodeName.toLowerCase()!="input"&&a("input").blur()}});var Eb=[6,12,16,33,50,66,100,150,200,300,400,600,800,1200];a("#workarea").on("mousewheel",function(s,B,
L,W){if(s.altKey){s.preventDefault();s=f.getZoom()*100;B=Eb.length;for(Ib=0;Ib<B;Ib++){L=Math.min(B,Ib+1);if(W>0)zoom=Eb[Ib]<=s?Eb[L]:zoom;if(W<0)zoom=Eb[Ib]<s?Eb[Ib]:zoom}zoom&&Ia({value:zoom})}});a(".menu_title").on("click",function(){a("#menu_bar").toggleClass("active")});a(".menu_title").on("mouseover",function(){Wa.removeClass("open");a(this).parent().addClass("open")});c.addDropDown=function(s,B,L){if(a(s).length!=0){var W=a(s).find("button"),fa=a(s).find("ul").attr("id",a(s)[0].id+"-list");
L||a("#option_lists").append(fa);var pa=false;L&&a(s).addClass("dropup");fa.find("li").bind("mouseup",B);a(window).mouseup(function(){if(!pa){W.removeClass("down");fa.hide()}pa=false});W.bind("mousedown",function(){if(W.hasClass("down")){W.removeClass("down");fa.hide()}else{W.addClass("down");if(!L){var wa=a(s).offset();fa.css({top:wa.top,left:wa.left-110})}fa.show();pa=true}}).hover(function(){pa=true}).mouseout(function(){pa=false})}};var Fb=function(s,B,L,W){var fa=a(s);B=a(B);var pa=false,wa=
W.dropUp;wa&&a(s).addClass("dropup");B.find("li").bind("mouseup",function(){if(W.seticon){ja("#cur_"+fa[0].id,a(this).children());a(this).addClass("current").siblings().removeClass("current")}L.apply(this,arguments)});a(window).mouseup(function(){if(!pa){fa.removeClass("down");B.hide();B.css({top:0,left:0})}pa=false});B.height();a(s).bind("mousedown",function(){var ya=a(s).offset();if(wa){ya.top-=B.height();ya.left+=8}else ya.top+=a(s).height();a(B).offset(ya);if(fa.hasClass("down")){fa.removeClass("down");
B.hide();B.css({top:0,left:0})}else{fa.addClass("down");B.show();pa=true;return false}}).hover(function(){pa=true}).mouseout(function(){pa=false});W.multiclick&&B.mousedown(function(){pa=true})};c.addDropDown("#font_family_dropdown",function(){a(this).text();a("#font_family").val(a(this).text()).change()});c.addDropDown("#opacity_dropdown",function(){if(!a(this).find("div").length){var s=parseInt(a(this).text().split("%")[0]);rb(false,s)}},false);a("#opac_slider").slider({start:function(){a("#opacity_dropdown li:not(.special)").hide()},
stop:function(){a("#opacity_dropdown li").show();a(window).mouseup()},slide:function(s,B){rb(B)}});c.addDropDown("#blur_dropdown",a.noop);var nb=false;a("#blur_slider").slider({max:10,step:0.1,stop:function(s,B){nb=false;sb(B);a("#blur_dropdown li").show();a(window).mouseup()},start:function(){nb=true},slide:function(s,B){sb(B,null,nb)}});c.addDropDown("#zoom_dropdown",function(){var s=a(this),B=s.attr("data-val");B?Xa(window,B):Ia({value:parseInt(s.text())})},true);Fb("#stroke_linecap","#linecap_opts",
function(){v(this,true)},{dropUp:true});Fb("#stroke_linejoin","#linejoin_opts",function(){v(this,true)},{dropUp:true});a("div","#position_opts").each(function(){this.addEventListener("mouseup",function(){var s=this.id.replace("tool_pos","").charAt(0);f.alignSelectedElements(s,"page")})});(function(){var s,B=function(){a(s).blur()};a("#svg_editor").find("button, select, input:not(#text)").focus(function(){s=this;Y="toolbars";la.mousedown(B)}).blur(function(){Y="canvas";la.unbind("mousedown",B);f.getMode()==
"textedit"&&a("#text").focus()})})();var Gb=function(){if(La("#tool_select")){f.setMode("select");a("#styleoverrides").text("#svgcanvas svg *{cursor:move;pointer-events:all}, #svgcanvas svg{cursor:default}")}},Ob=function(){La("#tool_fhpath")&&f.setMode("fhpath")},Kb=function(){La("#tool_line")&&f.setMode("line")},Ub=function(){La("#tool_rect")&&f.setMode("rect")},ra=function(){La("#tool_ellipse")&&f.setMode("ellipse")},ia=function(){La("#tool_image")&&f.setMode("image")},va=function(){La("#tool_zoom")&&
f.setMode("zoom")},Q=function(){if(La("#tool_zoom")){u();ua()}},J=function(){La("#tool_text")&&f.setMode("text")},ga=function(){La("#tool_path")&&f.setMode("path")},Oa=function(){if(ha!=null||qa)f.deleteSelectedElements()},Za=function(){if(ha!=null||qa){window.event.type==="keydown"&&vb(a("#edit_menu"));f.cutSelectedElements()}},fb=function(){if(ha!=null||qa){window.event.type==="keydown"&&vb(a("#edit_menu"));f.copySelectedElements()}},wb=function(){window.event.type==="keydown"&&vb(a("#edit_menu"));
var s=f.getZoom(),B=(la[0].scrollLeft+la.width()/2)/s-f.contentW;s=(la[0].scrollTop+la.height()/2)/s-f.contentH;f.pasteElements("point",B,s)},xb=function(){if(ha!=null){window.event.type==="keydown"&&vb(a("#object_menu"));f.moveToTopSelectedElement()}},Db=function(){if(ha!=null){window.event.type==="keydown"&&vb(a("#object_menu"));f.moveToBottomSelectedElement()}},pb=function(){if(ha!=null){window.event.type==="keydown"&&vb(a("#object_menu"));f.moveUpDownSelected("Up")}},Pb=function(){if(ha!=null){window.event.type===
"keydown"&&vb(a("#object_menu"));f.moveUpDownSelected("Down")}},cb=function(s){if(ha!=null){window.event.type==="keydown"&&vb(a("#object_menu"));f.moveUpDownSelected(s)}},Nb=function(){if(ha!=null){f.convertToPath();elems=f.getSelectedElems();f.selectorManager.requestSelector(elems[0]).selectorRect.setAttribute("display","none");f.setMode("pathedit");ea.toEditMode(elems[0]);f.clearSelection()}},Sb=function(){ha!=null&&ea.reorient()},ac=function(){if(ha!=null||qa)a.prompt(e.notification.enterNewLinkURL,
"http://",function(s){s&&f.makeHyperlink(s)})},Lb=function(s,B){if(ha!=null||qa){if(d.gridSnapping){var L=f.getZoom()*d.snappingStep;s*=L;B*=L}a("input").blur();f.moveSelectedElements(s,B)}},qb=function(){var s=!a("#tool_node_link").hasClass("push_button_pressed");s?a("#tool_node_link").addClass("push_button_pressed").removeClass("tool_button").find("input").attr("checked",true):a("#tool_node_link").removeClass("push_button_pressed").addClass("tool_button").find("input").attr("checked",false);ea.linkControlPoints(s)},
Ua=function(){ea.getNodePoint()&&ea.clonePathNode()},kc=function(){ea.getNodePoint()&&ea.deletePathNode()},hc=function(){var s=a("#tool_add_subpath"),B=!s.hasClass("push_button_pressed");B?s.addClass("push_button_pressed").removeClass("tool_button"):s.removeClass("push_button_pressed").addClass("tool_button");ea.addSubPath(B)},gc=function(){ea.opencloseSubPath()},ec=function(){f.cycleElement(1)},ic=function(){f.cycleElement(0)},Tb=function(s,B){if(!(ha==null||qa)){s||(B*=-1);var L=a("#angle").val()*
1+B;f.setRotationAngle(L);bb()}},cc=function(){var s=d.dimensions;a.confirm(e.notification.QwantToClear,function(B){if(B){ua();f.clear();f.setResolution(s[0],s[1]);Wb(true);u();Hb();bb();Na();f.runExtensions("onNewDocument")}})},oc=function(){f.setBold(!f.getBold());bb();return false},Yb=function(){f.setItalic(!f.getItalic());bb();return false},Bb=function(){if(!m.pngsave){var s=e.notification.loadingImage;da=window.open("data:text/html;charset=utf-8,<title>"+s+"</title><h1>"+s+"</h1>")}window.canvg?
f.rasterExport():a.getScript("canvg/rgbcolor.js",function(){a.getScript("canvg/canvg.js",function(){f.rasterExport()})})},mc=function(){f.open()},lc=function(){},vb=function(s){var B=s.prev();B.css("background","#09f");setTimeout(function(){B.css("background","")},200)},ub=function(){if(S.getUndoStackSize()>0){window.event.type==="keydown"&&vb(a("#edit_menu"));S.undo();Hb()}},bc=function(){if(S.getRedoStackSize()>0){window.event.type==="keydown"&&vb(a("#edit_menu"));S.redo();Hb()}},g=function(){if(qa)f.groupSelectedElements();
else ha&&f.ungroupSelectedElement()},h=function(){window.event.type==="keydown"&&vb(a("#edit_menu"));f.cloneSelectedElements(20,20)},k=function(){var s=this.id.replace("tool_align","").charAt(0);f.alignSelectedElements(s,a("#align_relative_to").val())},w=function(){var s=document.querySelector("#tool_stroke rect"),B=document.querySelector("#tool_fill rect"),L=B.getAttribute("fill"),W=s.getAttribute("fill");s=parseFloat(s.getAttribute("stroke-opacity"));if(isNaN(s))s=100;B=parseFloat(B.getAttribute("fill-opacity"));
if(isNaN(B))B=100;W=ab(W,s,"stroke");L=ab(L,B,"fill");c.paintBox.fill.setPaint(W,true);c.paintBox.stroke.setPaint(L,true)},u=function(s){var B=f.getResolution();s=s?B.zoom*s:1;a("#zoom").val(s*100);f.setZoom(s);E();Wb(true)},G=function(){!a("#tool_wireframe").hasClass("push_button_pressed")?a("#tool_wireframe").addClass("push_button_pressed"):a("#tool_wireframe").removeClass("push_button_pressed");la.toggleClass("wireframe");if(!vc){var s=a("#wireframe_rules");s.length?s.empty():a('<style id="wireframe_rules"></style>').appendTo("head");
E()}},z=function(){var s=!a("#tool_snap").hasClass("push_button_pressed");s?a("#tool_snap").addClass("push_button_pressed"):a("#tool_snap").removeClass("push_button_pressed");d.gridSnapping=s;xa()},A=function(){f.clearSelection();a("#tool_canvas").trigger("click")},C=function(){window.self!=window.top&&top.exports.setEditorFocus(false)},F=function(){if(a("#tool_rulers").hasClass("push_button_pressed")){a("#tool_rulers").removeClass("push_button_pressed");a("#show_rulers").attr("checked",false);d.showRulers=
false}else{a("#tool_rulers").addClass("push_button_pressed");a("#show_rulers").attr("checked",true);d.showRulers=true}a("#rulers").toggle(!!d.showRulers)},E=function(){if(!vc){var s="#workarea.wireframe #svgcontent * { stroke-width: "+1/f.getZoom()+"px; }";a("#wireframe_rules").text(la.hasClass("wireframe")?s:"")}},D=function(s,B){if(!Ga){Ga=true;a("#save_output_btns").toggle(!!B);a("#tool_source_back").toggle(!B);var L=ma=f.getSvgString();a("#svg_source_textarea").val(L);a("#svg_source_editor").fadeIn();
O();a("#svg_source_textarea").focus()}},N=function(){if(!Ma){Ma=true;a("#image_save_opts input").val([b.img_save]);var s=f.getResolution();if(d.baseUnit!=="px"){s.w=svgedit.units.convertUnit(s.w)+d.baseUnit;s.h=svgedit.units.convertUnit(s.h)+d.baseUnit}a(".canvas_width").val(s.w);a(".canvas_height").val(s.h);a("#canvas_title").val(f.getDocumentTitle());a("#svg_docprops").show()}},K=function(){if(!Ra){Ra=true;var s=a("#bg_blocks div"),B=a.pref("bkgd_color"),L=a.pref("bkgd_url");s.each(function(){var W=
a(this),fa=W.css("background-color")==B;W.toggleClass("cur_background",fa);fa&&a("#canvas_bg_url").removeClass("cur_background")});B||s.eq(0).addClass("cur_background");L&&a("#canvas_bg_url").val(L);a("grid_snapping_step").attr("value",d.snappingStep);d.gridSnapping==true?a("#grid_snapping_on").attr("checked","checked"):a("#grid_snapping_on").removeAttr("checked");a("#svg_prefs").show()}},O=function(){var s=a("#svg_source_container").height()-50;a("#svg_source_textarea").css("height",s)},ca=function(){if(Ga){var s=
function(){f.clearSelection();ob();u();Hb();U();Na()};f.setSvgString(a("#svg_source_textarea").val())?s():a.confirm(e.notification.QerrorsRevertToSource,function(B){if(!B)return false;s()});ua()}},U=function(s){s=s||f.getDocumentTitle();s=Va+(s?": "+s:"");a("title:first").text(s)},ta=function(){var s=a("#canvas_width"),B=s.val(),L=a("#canvas_height"),W=L.val();if(B!="fit"&&!svgedit.units.isValidUnit("width",B)){a.alert(e.notification.invalidAttrValGiven);s.parent().addClass("error");return false}s.parent().removeClass("error");
if(W!="fit"&&!svgedit.units.isValidUnit("height",W)){a.alert(e.notification.invalidAttrValGiven);L.parent().addClass("error");return false}L.parent().removeClass("error");if(!f.setResolution(B,W)){a.alert(e.notification.noContentToFitTo);return false}b.img_save=a("#image_save_opts :checked").val();a.pref("img_save",b.img_save);Wb();Vb()},xa=function(){var s=a("#bg_blocks div.cur_background").css("background-color")||"#FFF";p(s,a("#canvas_bg_url").val());za(a("#iconsize").val());d.gridSnapping=a("#tool_snap").hasClass("push_button_pressed");
d.snappingStep=a("#grid_snapping_step").val();d.showRulers=a("#show_rulers")[0].checked;a("#rulers").toggle(d.showRulers);d.showRulers&&aa();d.baseUnit=a("#base_unit").val();f.setConfig(d);Wb();Mb()},ja=c.setIcon=function(s,B){var L=typeof B==="string"?a.getSvgIcon(B,true):B.clone();L?a(s).find("img").replaceWith(L):console.log("NOTE: Icon image missing: "+B)},oa;oa=function(){var s=/^(Moz|Webkit|Khtml|O|ms|Icab)(?=[A-Z])/,B=document.getElementsByTagName("script")[0],L;for(L in B.style)if(s.test(L))return L.match(s)[0];
if("WebkitOpacity"in B.style)return"Webkit";if("KhtmlOpacity"in B.style)return"Khtml";return""}();var sa=function(s,B){oa.toLowerCase();var L=["top","left","bottom","right"];s.each(function(){for(var W=a(this),fa=W.outerWidth()*(B-1),pa=W.outerHeight()*(B-1),wa=0;wa<4;wa++){var ya=L[wa],Ca=W.data("orig_margin-"+ya);if(Ca==null){Ca=parseInt(W.css("margin-"+ya));W.data("orig_margin-"+ya,Ca)}Ca=Ca*B;if(ya==="right")Ca+=fa;else if(ya==="bottom")Ca+=pa;W.css("margin-"+ya,Ca)}})},za=c.setIconSize=function(s,
B){if(!(s==b.size&&!B)){var L=a("#tools_top .toolset, #editor_panel > *, #history_panel > *,\t\t\t\t#main_button, #tools_left > *, #path_node_panel > *, #multiselected_panel > *,\t\t\t\t#g_panel > *, #tool_font_size > *, .tools_flyout"),W=1;W=typeof s=="number"?s:{s:0.75,m:1,l:1.25,xl:1.5}[s];c.tool_scale=Z=W;Ja();var fa=L.parents(":hidden");fa.css("visibility","hidden").show();sa(L,W);fa.css("visibility","visible").hide();a.pref("iconsize",s);a("#iconsize").val(s);fa={"#tools_top":{left:50,height:72},
"#tools_left":{width:31,top:74},"div#workarea":{left:38,top:74}};L=a("#tool_size_rules");if(L.length)L.empty();else L=a('<style id="tool_size_rules"></style>').appendTo("head");if(s!="m"){var pa="";a.each(fa,function(wa,ya){wa="#svg_editor "+wa.replace(/,/g,", #svg_editor");pa+=wa+"{";a.each(ya,function(Ca,Ba){if(typeof Ba==="number")var Aa=Ba*W+"px";else if(Ba[s]||Ba.all)Aa=Ba[s]||Ba.all;pa+=Ca+":"+Aa+";"});pa+="}"});fa="-"+oa.toLowerCase()+"-";pa+="#tools_top .toolset, #editor_panel > *, #history_panel > *,\t\t\t\t#main_button, #tools_left > *, #path_node_panel > *, #multiselected_panel > *,\t\t\t\t#g_panel > *, #tool_font_size > *, .tools_flyout{"+
fa+"transform: scale("+W+");} #svg_editor div.toolset .toolset {"+fa+"transform: scale(1); margin: 1px !important;} #svg_editor .ui-slider {"+fa+"transform: scale("+1/W+");}";L.text(pa)}Ja()}},kb=function(){a("#dialog_box").hide();if(!Ga&&!Ma&&!Ra)Qa&&f.leaveContext();else{if(Ga)ma!==a("#svg_source_textarea").val()?a.confirm(e.notification.QignoreSourceChanges,function(s){s&&ob()}):ob();else if(Ma)Vb();else Ra&&Mb();Xb()}},ob=function(){a("#svg_source_editor").hide();Ga=false;a("#svg_source_textarea").blur()},
Vb=function(){a("#svg_docprops").hide();a("#canvas_width,#canvas_height").removeAttr("disabled");a("#resolution")[0].selectedIndex=0;a("#image_save_opts input").val([b.img_save]);Ma=false},Mb=function(){a("#svg_prefs").hide();Ra=false},Rb={width:a(window).width(),height:a(window).height()},Xb=a.noop,dc;svgedit.browser.isIE()&&function(){Xb=function(){if(la[0].scrollLeft===0&&la[0].scrollTop===0){la[0].scrollLeft=dc.left;la[0].scrollTop=dc.top}};dc={left:la[0].scrollLeft,top:la[0].scrollTop};a(window).resize(Xb);
svgEditor.ready(function(){setTimeout(function(){Xb()},500)});la.scroll(function(){dc={left:la[0].scrollLeft,top:la[0].scrollTop}})}();a(window).resize(function(){Ga&&O();a.each(Rb,function(s,B){var L=a(window)[s]();la[0]["scroll"+(s==="width"?"Left":"Top")]-=(L-B)/2;Rb[s]=L})});(function(){la.scroll(function(){if(a("#ruler_x").length!=0)a("#ruler_x")[0].scrollLeft=la[0].scrollLeft;if(a("#ruler_y").length!=0)a("#ruler_y")[0].scrollTop=la[0].scrollTop})})();a("#url_notice").click(function(){a.alert(this.title)});
a("#change_image_url").click(I);(function(){var s=["clear","open","save","source","delete","delete_multi","paste","clone","clone_multi","move_top","move_bottom"],B="";a.each(s,function(L,W){B+="#tool_"+W+(L==s.length-1?",":"")});a(B).mousedown(function(){a(this).addClass("tool_button_current")}).bind("mousedown mouseout",function(){a(this).removeClass("tool_button_current")});a("#tool_undo, #tool_redo").mousedown(function(){a(this).hasClass("disabled")||a(this).addClass("tool_button_current")}).bind("mousedown mouseout",
function(){a(this).removeClass("tool_button_current")})})();if(T&&!window.opera){T=["tool_clear","tool_save","tool_source","tool_undo","tool_redo","tool_clone"];for(var Ib=T.length;Ib--;){var rc=document.getElementById(T[Ib]);if(rc!=null){var sc=rc.title,wc=sc.indexOf("Ctrl+");rc.title=[sc.substr(0,wc),"Cmd+",sc.substr(wc+5)].join("")}}}var tc=function(s){var B=s[0].id=="stroke_color"?"stroke":"fill",L=s[0].id=="canvas_color";if(L)B="canvas";var W=c.paintBox[B].paint;s=B=="stroke"?"Pick a Stroke Paint and Opacity":
"Pick a Fill Paint and Opacity";L=L?{right:200,top:50}:{left:45,bottom:50};a("#color_picker").draggable({cancel:".jGraduate_tabs, .jGraduate_colPick, .jGraduate_gradPick, .jPicker",containment:"window"}).css(L).jGraduate({paint:W,window:{pickerTitle:s},images:{clientPath:d.jGraduatePath},newstop:"inverse"},function(fa){W=new a.jGraduate.Paint(fa);c.paintBox[B].setPaint(W);f.setPaint(B,W);a("#color_picker").hide()},function(){a("#color_picker").hide()})};T=function(s,B){var L=document.getElementById("canvas_background"),
W={color:"fff",opacity:1};if(B=="stroke")W=d.initStroke;if(B=="fill")W=d.initFill;if(B=="canvas"&&L)if(L=L.getAttribute("fill").match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/))W={color:("0"+parseInt(L[1],10).toString(16)).slice(-2)+("0"+parseInt(L[2],10).toString(16)).slice(-2)+("0"+parseInt(L[3],10).toString(16)).slice(-2),opacity:1};L=(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg"><rect width="100%" height="100%"\t\t\t\t\tfill="#'+W.color+'" opacity="'+W.opacity+'"/>\t\t\t\t\t<defs><linearGradient id="gradbox_"/></defs></svg>',
"text/xml").documentElement;L=a(s)[0].appendChild(document.importNode(L,true));L.setAttribute("width",24.5);this.rect=L.firstChild;this.defs=L.getElementsByTagName("defs")[0];this.grad=this.defs.firstChild;this.paint=new a.jGraduate.Paint({solidColor:W.color});this.type=B;this.setPaint=function(fa,pa){this.paint=fa;var wa="none",ya=fa.type,Ca=fa.alpha/100;switch(ya){case "solidColor":wa=fa[ya]=="none"||fa[ya]=="one"?"none":"#"+fa[ya];break;case "linearGradient":case "radialGradient":this.defs.removeChild(this.grad);
this.grad=this.defs.appendChild(fa[ya]);wa="url(#"+(this.grad.id="gradbox_"+this.type)+")"}this.rect.setAttribute("fill",wa);this.rect.setAttribute("opacity",Ca);if(pa){f.setColor(this.type,wa,true);f.setPaintOpacity(this.type,Ca,true)}if(this.type=="canvas"){(ya=document.getElementById("canvas_background"))?ya.setAttribute("fill",wa):Ka(wa);console.log(ya.getAttribute("fill"))}};this.update=function(fa){if(ha){var pa=this.type;switch(ha.tagName){case "use":case "image":case "foreignObject":return;
case "g":case "a":for(var wa=null,ya=ha.getElementsByTagName("*"),Ca=0,Ba=ya.length;Ca<Ba;Ca++){var Aa=ya[Ca].getAttribute(pa);if(Ca===0)wa=Aa;else if(wa!==Aa){wa=null;break}}if(wa===null){ya=null;return}ya=wa;wa=1;break;default:wa=parseFloat(ha.getAttribute(pa+"-opacity"));if(isNaN(wa))wa=1;ya=pa==="fill"?"black":"none";ya=ha.getAttribute(pa)||ya}if(fa){f.setColor(pa,ya,true);f.setPaintOpacity(pa,wa,true)}wa*=100;this.setPaint(ab(ya,wa,pa))}};this.prep=function(){switch(this.paint.type){case "linearGradient":case "radialGradient":var fa=
new a.jGraduate.Paint({copy:this.paint});f.setPaint(B,fa)}}};c.paintBox.fill=new T("#fill_color","fill");c.paintBox.stroke=new T("#stroke_color","stroke");c.paintBox.canvas=new T("#canvas_color","canvas");a("#stroke_width").val(d.initStroke.width);a("#group_opacity").val(d.initOpacity*100);T=c.paintBox.fill.rect.cloneNode(false);T.setAttribute("style","vector-effect:non-scaling-stroke");var vc=T.style.vectorEffect==="non-scaling-stroke";T.removeAttribute("style");T=c.paintBox.fill.rect.ownerDocument.createElementNS("http://www.w3.org/2000/svg",
"feGaussianBlur");typeof T.stdDeviationX==="undefined"&&a("#tool_blur").hide();a(T).remove();setTimeout(function(){f.embedImage("images/placeholder.svg",function(s){if(!s){a("#image_save_opts [value=embed]").attr("disabled","disabled");a("#image_save_opts input").val(["ref"]);b.img_save="ref";a("#image_opt_embed").css("color","#666").attr("title",e.notification.featNotSupported)}})},1E3);a("#tool_fill").click(function(){if(a("#tool_fill").hasClass("active"))tc(a("#fill_color"));else{a("#tool_fill").addClass("active");
a("#tool_stroke").removeClass("active")}});a("#tool_canvas").click(function(){tc(a("#canvas_color"))});a("#tool_stroke").click(function(){if(a("#tool_stroke").hasClass("active"))tc(a("#stroke_color"));else{a("#tool_stroke").addClass("active");a("#tool_fill").removeClass("active")}});a("#group_opacityLabel").click(function(){a("#opacity_dropdown button").mousedown();a(window).mouseup()});a("#zoomLabel").click(function(){a("#zoom_dropdown button").mousedown();a(window).mouseup()});a("#tool_move_top").mousedown(function(s){a("#tools_stacking").show();
s.preventDefault()});a(".layer_button").mousedown(function(){a(this).addClass("layer_buttonpressed")}).mouseout(function(){a(this).removeClass("layer_buttonpressed")}).mouseup(function(){a(this).removeClass("layer_buttonpressed")});a(".push_button").mousedown(function(){a(this).hasClass("disabled")||a(this).addClass("push_button_pressed").removeClass("push_button")}).mouseout(function(){a(this).removeClass("push_button_pressed").addClass("push_button")}).mouseup(function(){a(this).removeClass("push_button_pressed").addClass("push_button")});
a("#layer_new").click(function(){var s=f.getCurrentDrawing().getNumLayers();do var B=e.layers.layer+" "+ ++s;while(f.getCurrentDrawing().hasLayer(B));a.prompt(e.notification.enterUniqueLayerName,B,function(L){if(L)if(f.getCurrentDrawing().hasLayer(L))a.alert(e.notification.dupeLayerName);else{f.createLayer(L);bb();Hb()}})});a("#layer_delete").click(V);a("#layer_up").click(function(){H(-1)});a("#layer_down").click(function(){H(1)});a("#layer_rename").click(function(){a("#layerlist tr.layersel").prevAll();
var s=a("#layerlist tr.layersel td.layername").text();a.prompt(e.notification.enterNewLayerName,"",function(B){if(B)if(s==B||f.getCurrentDrawing().hasLayer(B))a.alert(e.notification.layerHasThatName);else{f.renameCurrentLayer(B);Hb()}})});var fc=-1,nc=false,uc=false,xc=function(s){if(uc)if(fc!=-1){nc=true;s=fc-s.pageX;var B=a("#sidepanels"),L=parseInt(B.css("width"));if(L+s>300)s=300-L;else if(L+s<2)s=2-L;if(s!=0){fc-=s;L=a("#layerpanel");la.css("right",parseInt(la.css("right"))+s);B.css("width",
parseInt(B.css("width"))+s);L.css("width",parseInt(L.css("width"))+s);B=a("#ruler_x");B.css("right",parseInt(B.css("right"))+s)}}};a("#sidepanel_handle").mousedown(function(s){fc=s.pageX;a(window).mousemove(xc);uc=false;setTimeout(function(){uc=true},20)}).mouseup(function(){nc||yc();fc=-1;nc=false});a(window).mouseup(function(){fc=-1;nc=false;a("#svg_editor").unbind("mousemove",xc)});var yc=function(s){var B=parseInt(a("#sidepanels").css("width"));s=(B>2||s?2:150)-B;B=a("#sidepanels");var L=a("#layerpanel"),
W=a("#ruler_x");la.css("right",parseInt(la.css("right"))+s);B.css("width",parseInt(B.css("width"))+s);L.css("width",parseInt(L.css("width"))+s);W.css("right",parseInt(W.css("right"))+s)},zc=function(s){for(var B=Array(f.getCurrentDrawing().getNumLayers()),L=0;L<B.length;++L)B[L]=f.getCurrentDrawing().getLayerName(L);if(s)for(L=0;L<B.length;++L)B[L]!=s&&f.getCurrentDrawing().setLayerOpacity(B[L],0.5);else for(L=0;L<B.length;++L)f.getCurrentDrawing().setLayerOpacity(B[L],1)},Hb=function(){var s=a("#layerlist tbody"),
B=a("#selLayerNames");s.empty();B.empty();for(var L=f.getCurrentDrawing().getCurrentLayerName(),W=f.getCurrentDrawing().getNumLayers(),fa=a.getSvgIcon("eye");W--;){var pa=f.getCurrentDrawing().getLayerName(W),wa='<tr class="layer';if(pa==L)wa+=" layersel";wa+='">';wa+=f.getCurrentDrawing().getLayerVisibility(pa)?'<td class="layervis"/><td class="layername" >'+pa+"</td></tr>":'<td class="layervis layerinvis"/><td class="layername" >'+pa+"</td></tr>";s.append(wa);B.append('<option value="'+pa+'">'+
pa+"</option>")}if(fa!==undefined){fa.clone();a("td.layervis",s).append(fa.clone());a.resizeSvgIcons({"td.layervis .svg_icon":14})}a("#layerlist td.layername").mouseup(function(ya){a("#layerlist tr.layer").removeClass("layersel");a(this.parentNode).addClass("layersel");f.setCurrentLayer(this.textContent);ya.preventDefault()}).mouseover(function(){a(this).css({"font-style":"italic",color:"blue"});zc(this.textContent)}).mouseout(function(){a(this).css({"font-style":"normal",color:"black"});zc()});a("#layerlist td.layervis").click(function(){var ya=
a(this.parentNode).prevAll().length;ya=a("#layerlist tr.layer:eq("+ya+") td.layername").text();var Ca=a(this).hasClass("layerinvis");f.setLayerVisibility(ya,Ca);Ca?a(this).removeClass("layerinvis"):a(this).addClass("layerinvis")});for(B=5-a("#layerlist tr.layer").size();B-- >0;)s.append('<tr><td style="color:white">_</td><td/></tr>')};Hb();a(window).bind("load resize",function(){la.css("line-height",la.height()+"px")});a("#resolution").change(function(){var s=a("#canvas_width,#canvas_height");if(this.selectedIndex)if(this.value==
"content")s.val("fit").attr("disabled","disabled");else{var B=this.value.split("x");a("#canvas_width").val(B[0]);a("#canvas_height").val(B[1]);s.removeAttr("disabled")}else a("#canvas_width").val()=="fit"&&s.removeAttr("disabled").val(100)});a("input,select").attr("autocomplete","off");var qc=function(){var s=[{sel:"#tool_select",fn:Gb,evt:"click",key:["V",true]},{sel:"#tool_fhpath",fn:Ob,evt:"click",key:["Q",true]},{sel:"#tool_line",fn:Kb,evt:"click",key:["L",true]},{sel:"#tool_rect",fn:Ub,evt:"click",
key:["R",true],icon:"rect"},{sel:"#tool_ellipse",fn:ra,evt:"mouseup",key:["C",true],icon:"ellipse"},{sel:"#tool_path",fn:ga,evt:"click",key:["P",true]},{sel:"#tool_text",fn:J,evt:"click",key:["T",true]},{sel:"#tool_image",fn:ia,evt:"mouseup"},{sel:"#tool_zoom",fn:va,evt:"mouseup",key:["Z",true]},{sel:"#tool_clear",fn:cc,evt:"mouseup",key:[R+"N",true]},{sel:"#tool_save",fn:function(){Ga?ca():f.save({images:b.img_save,round_digits:6})},evt:"mouseup",key:[R+"S",true]},{sel:"#tool_export",fn:Bb,evt:"mouseup"},
{sel:"#tool_open",fn:mc,evt:"mouseup"},{sel:"#tool_import",fn:lc,evt:"mouseup"},{sel:"#tool_source",fn:D,evt:"click",key:[R+"U",true]},{sel:"#tool_wireframe",fn:G,evt:"click"},{sel:"#tool_snap",fn:z,evt:"click"},{sel:"#tool_rulers",fn:F,evt:"click"},{sel:"#tool_source_cancel,#svg_source_overlay,#tool_docprops_cancel,#tool_prefs_cancel",fn:kb,evt:"click",key:["esc",false,false],hidekey:true},{sel:"#tool_source_save",fn:ca,evt:"click"},{sel:"#tool_docprops_save",fn:ta,evt:"click"},{sel:"#tool_docprops",
fn:N,evt:"mouseup"},{sel:"#tool_prefs_save",fn:xa,evt:"click"},{sel:"#tool_prefs_option",fn:function(){K();return false},evt:"mouseup"},{sel:"#tool_delete,#tool_delete_multi",fn:Oa,evt:"click",key:["del/backspace",true]},{sel:"#tool_reorient",fn:Sb,evt:"click"},{sel:"#tool_node_link",fn:qb,evt:"click"},{sel:"#tool_node_clone",fn:Ua,evt:"click"},{sel:"#tool_node_delete",fn:kc,evt:"click"},{sel:"#tool_openclose_path",fn:gc,evt:"click"},{sel:"#tool_add_subpath",fn:hc,evt:"click"},{sel:"#tool_move_top",
fn:xb,evt:"click",key:R+"shift+up"},{sel:"#tool_move_bottom",fn:Db,evt:"click",key:R+"shift+down"},{sel:"#tool_move_up",fn:pb,evt:"click",key:[R+"up",true]},{sel:"#tool_move_down",fn:Pb,evt:"click",key:[R+"down",true]},{sel:"#tool_topath",fn:Nb,evt:"click"},{sel:"#tool_make_link,#tool_make_link_multi",fn:ac,evt:"click"},{sel:"#tool_clone,#tool_clone_multi",fn:h,evt:"click",key:[R+"D",true]},{sel:"#tool_group",fn:g,evt:"click",key:[R+"G",true]},{sel:"#tool_ungroup",fn:g,evt:"click",key:R+"shift+G"},
{sel:"#tool_unlink_use",fn:g,evt:"click"},{sel:"[id^=tool_align]",fn:k,evt:"click"},{sel:"#tool_undo",fn:ub,evt:"click",key:R+"z"},{sel:"#tool_redo",fn:bc,evt:"click",key:["y",true]},{sel:"#tool_canvas_color_menu",fn:A,evt:"click"},{sel:"#tool_cut",fn:Za,evt:"click",key:[R+"x",true]},{sel:"#tool_copy",fn:fb,evt:"click",key:R+"c"},{sel:"#tool_paste",fn:wb,evt:"click",key:R+"v"},{sel:"#tool_switch",fn:w,evt:"click",key:["x",true]},{sel:"#tool_bold",fn:oc,evt:"mousedown",key:[R+"B",true]},{sel:"#tool_italic",
fn:Yb,evt:"mousedown",key:[R+"I",true]},{sel:"#copy_save_done",fn:kb,evt:"click"},{key:"ctrl+left",fn:function(){Tb(0,1)}},{key:"ctrl+right",fn:function(){Tb(1,1)}},{key:"ctrl+shift+left",fn:function(){Tb(0,5)}},{key:"ctrl+shift+right",fn:function(){Tb(1,5)}},{key:"shift+O",fn:ic},{key:"shift+P",fn:ec},{key:[R+"+",true],fn:function(){u(2)}},{key:[R+"-",true],fn:function(){u(0.5)}},{key:["up",true],fn:function(){Lb(0,-1)}},{key:["down",true],fn:function(){Lb(0,1)}},{key:["left",true],fn:function(){Lb(-1,
0)}},{key:["right",true],fn:function(){Lb(1,0)}},{key:"shift+up",fn:function(){Lb(0,-10)}},{key:"shift+down",fn:function(){Lb(0,10)}},{key:"shift+left",fn:function(){Lb(-10,0)}},{key:"shift+right",fn:function(){Lb(10,0)}},{key:["alt+up",true],fn:function(){f.cloneSelectedElements(0,-1)}},{key:["alt+down",true],fn:function(){f.cloneSelectedElements(0,1)}},{key:["alt+left",true],fn:function(){f.cloneSelectedElements(-1,0)}},{key:["alt+right",true],fn:function(){f.cloneSelectedElements(1,0)}},{key:["alt+shift+up",
true],fn:function(){f.cloneSelectedElements(0,-10)}},{key:["alt+shift+down",true],fn:function(){f.cloneSelectedElements(0,10)}},{key:["alt+shift+left",true],fn:function(){f.cloneSelectedElements(-10,0)}},{key:["alt+shift+right",true],fn:function(){f.cloneSelectedElements(10,0)}},{key:R+"A",fn:function(){f.selectAllInCurrentLayer()}},{key:R+"shift+z",fn:bc},{key:"esc",fn:C}],B={"4/Shift+4":"#tools_rect_show","5/Shift+5":"#tools_ellipse_show"};return{setAll:function(){var L={};a.each(s,function(W,fa){if(fa.sel){var pa=
a(fa.sel);if(pa.length==0)return true;if(fa.evt){if(svgedit.browser.isTouch()&&fa.evt==="click")fa.evt="mousedown";pa[fa.evt](fa.fn)}if(fa.parent&&a(fa.parent+"_show").length!=0){var wa=a(fa.parent);wa.length||(wa=zb(fa.parent.substr(1)));wa.append(pa);a.isArray(L[fa.parent])||(L[fa.parent]=[]);L[fa.parent].push(fa)}}if(fa.key){var ya=fa.fn,Ca=false;if(a.isArray(fa.key)){wa=fa.key[0];if(fa.key.length>1)Ca=fa.key[1]}else wa=fa.key;wa+="";svgedit.browser.isMac&&wa.indexOf("+")!=-1&&wa.split("+")[0]==
"ctrl"&&wa.replace("ctrl","cmd");a.each(wa.split("/"),function(Aa,Ab){a(document).bind("keydown",Ab,function(Ta){ya();Ca&&Ta.preventDefault();return false})});if(fa.sel&&!fa.hidekey&&pa.attr("title")){var Ba=pa.attr("title").split("[")[0]+" ("+wa+")";B[wa]=fa.sel;pa.parents("#main_menu").length||pa.attr("title",Ba)}}});Pa(L);a(".attr_changer, #image_url").bind("keydown","return",function(W){a(this).change();W.preventDefault()});a(window).bind("keydown","tab",function(W){if(Y==="canvas"){W.preventDefault();
ec()}}).bind("keydown","shift+tab",function(W){if(Y==="canvas"){W.preventDefault();ic()}});a("#tool_zoom").dblclick(Q)},setTitles:function(){a.each(B,function(L,W){var fa=a(W).parents("#main_menu").length;a(W).each(function(){var pa=fa?a(this).text().split(" [")[0]:this.title.split(" [")[0],wa="";a.each(L.split("/"),function(ya,Ca){var Ba=Ca.split("+"),Aa="";if(Ba.length>1){Aa=Ba[0]+"+";Ca=Ba[1]}wa+=(ya?"/":"")+Aa+(e["key_"+Ca]||Ca)});if(fa)this.lastChild.textContent=pa+" ["+wa+"]";else this.title=
pa+" ["+wa+"]"})})},getButtonData:function(L){var W;a.each(s,function(fa,pa){if(pa.sel===L)W=pa});return W}}}();qc.setAll();c.ready(function(){var s=d.initTool,B=a("#tools_left, #svg_editor .tools_flyout"),L=B.find("#tool_"+s);s=B.find("#"+s);(L.length?L:s.length?s:a("#tool_select")).click().mouseup();d.wireframe&&a("#tool_wireframe").click();d.showlayers&&yc();a("#rulers").toggle(!!d.showRulers);if(d.showRulers)a("#show_rulers")[0].checked=true;if(d.gridSnapping)a("#grid_snapping_on")[0].checked=
true;d.baseUnit&&a("#base_unit").val(d.baseUnit);d.snappingStep&&a("#grid_snapping_step").val(d.snappingStep)});a("#rect_rx").SpinButton({min:0,max:1E3,step:1,callback:function(s){f.setRectRadius(s.value)}});a("#stroke_width").SpinButton({min:0,max:99,step:1,smallStep:0.1,callback:function(s){var B=s.value;if(B==0&&ha&&["line","polyline"].indexOf(ha.nodeName)>=0)B=s.value=1;f.setStrokeWidth(B)}});a("#angle").SpinButton({min:-180,max:180,step:5,callback:function(s){f.setRotationAngle(s.value);a("#tool_reorient").toggleClass("disabled",
s.value==0)}});a("#font_size").SpinButton({step:1,min:0.0010,stepfunc:function(s,B){var L=s.value-0,W=L+B,fa=W>=L;if(B===0)return L;return L>=24?fa?Math.round(L*1.1):Math.round(L/1.1):L<=1?fa?L*2:L/2:W},callback:function(s){f.setFontSize(s.value)}});a("#group_opacity").SpinButton({step:5,min:0,max:100,callback:rb});a("#blur").SpinButton({step:0.1,min:0,max:10,callback:sb});a("#zoom").SpinButton({min:0.0010,max:1E4,step:50,stepfunc:function(s,B){var L=s.value-0;if(L===0)return 100;var W=L+B;if(B===
0)return L;return L>=100?W:W>=L?L*2:L/2},callback:Ia}).val(f.getZoom()*100);a("#workarea").contextMenu({menu:"cmenu_canvas",inSpeed:0},function(s){switch(s){case "delete":Oa();break;case "cut":Za();break;case "copy":fb();break;case "paste":f.pasteElements();break;case "paste_in_place":f.pasteElements("in_place");break;case "group":f.groupSelectedElements();break;case "ungroup":f.ungroupSelectedElement();break;case "move_front":xb();break;case "move_up":cb("Up");break;case "move_down":cb("Down");break;
case "move_back":Db();break;default:svgedit.contextmenu&&svgedit.contextmenu.hasCustomHandler(s)&&svgedit.contextmenu.getCustomHandler(s).call()}f.clipBoard.length&&ka.enableContextMenuItems("#paste,#paste_in_place")});T=function(s){switch(s){case "dupe":M();break;case "delete":V();break;case "merge_down":if(a("#layerlist tr.layersel").index()!=f.getCurrentDrawing().getNumLayers()-1){f.mergeLayer();bb();Hb()}break;case "merge_all":f.mergeAllLayers();bb();Hb()}};a("#layerlist").contextMenu({menu:"cmenu_layers",
inSpeed:0},T);a("#layer_moreopts").contextMenu({menu:"cmenu_layers",inSpeed:0,allowLeft:true},T);a(".contextMenu li").mousedown(function(s){s.preventDefault()});a("#cmenu_canvas li").disableContextMenu();ka.enableContextMenuItems("#delete,#cut,#copy");window.onbeforeunload=function(){if(S.getUndoStackSize()===0)c.show_save_warning=false;if(!d.no_save_warning&&c.show_save_warning)return e.notification.unsavedChanges};c.openPrep=function(s){a("#main_menu").hide();S.getUndoStackSize()===0?s(true):a.confirm(e.notification.QwantToOpen,
s)};if(window.FileReader){T=a('<input type="file">').change(function(){var s=this;c.openPrep(function(B){if(B){f.clear();if(s.files.length==1){B=new FileReader;B.onloadend=function(L){o(L.target.result);Wb()};B.readAsText(s.files[0])}}})});a("#tool_open").show().prepend(T);T=a('<input type="file">').change(function(){a("#main_menu").hide();if(this.files.length==1){var s=new FileReader;s.onloadend=function(B){f.importSvgString(B.target.result,true);Wb()};s.readAsText(this.files[0])}});a("#tool_import").show().prepend(T)}var Wb=
c.updateCanvas=function(s,B){var L=la.width(),W=la.height(),fa=L,pa=W,wa=f.getZoom(),ya=a("#svgcanvas"),Ca={x:la[0].scrollLeft+fa/2,y:la[0].scrollTop+pa/2},Ba=d.canvas_expansion;L=Math.max(fa,f.contentW*wa*Ba);W=Math.max(pa,f.contentH*wa*Ba);L==fa&&W==pa?la.css("overflow","hidden"):la.css("overflow","scroll");Ba=ya.height()/2;var Aa=ya.width()/2;ya.width(L).height(W);var Ab=W/2,Ta=L/2,na=f.updateCanvas(L,W),Cb=Ta/Aa;L=L/2-fa/2;W=W/2-pa/2;if(B){B.x+=na.x;B.y+=na.y}else B={x:Ta+(Ca.x-Aa)*Cb,y:Ab+(Ca.y-
Ba)*Cb};if(s)if(f.contentW>la.width()){la[0].scrollLeft=na.x-10;la[0].scrollTop=na.y-10}else{la[0].scrollLeft=L;la[0].scrollTop=W}else{la[0].scrollLeft=B.x-fa/2;la[0].scrollTop=B.y-pa/2}if(d.showRulers){aa(ya,wa);la.scroll()}},jc=[];for(Ib=0.1;Ib<1E5;Ib*=10){jc.push(1*Ib);jc.push(2*Ib);jc.push(5*Ib)}Wb(true);try{var Ac=function(s){if(window.JSON&&JSON.stringify)return JSON.stringify(s);var B=arguments.callee;if(typeof s=="boolean"||typeof s=="number")return s+"";else if(typeof s=="string")return'"'+
s.replace(/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,function(fa){return"\\u"+("0000"+fa.charCodeAt(0).toString(16)).slice(-4)})+'"';else if(s.length){for(var L=0;L<s.length;L++)s[L]=B(s[L]);return"["+s.join(",")+"]"}else{L=[];for(var W in s)L.push(B(W)+":"+B(s[W]));return"{"+L.join(",")+"}"}};window.addEventListener("message",function(s){var B=parseInt(s.data.substr(0,s.data.indexOf(";")));try{s.source.postMessage("SVGe"+
B+";"+Ac(eval(s.data)),"*")}catch(L){s.source.postMessage("SVGe"+B+";error:"+L.message,"*")}},false)}catch(Bc){window.embed_error=Bc}a(function(){window.svgCanvas=f;f.ready=svgEditor.ready});c.setLang=function(s,B){a.pref("lang",s);a("#lang_select").val(s);if(B){var L=a("#layerlist tr.layersel td.layername").text()==e.common.layer+" 1";a.extend(e,B);f.setUiStrings(B);qc.setTitles();if(L){f.renameCurrentLayer(e.common.layer+" 1");Hb()}f.runExtensions("langChanged",s);Jb();a.each({"#stroke_color":"#tool_stroke .icon_label, #tool_stroke .color_block",
"#fill_color":"#tool_fill label, #tool_fill .color_block","#linejoin_miter":"#cur_linejoin","#linecap_butt":"#cur_linecap"},function(W,fa){a(fa).attr("title",a(W)[0].title)});a("#multiselected_panel div[id^=tool_align]").each(function(){a("#tool_pos"+this.id.substr(10))[0].title=this.title})}}};var q=[];c.ready=function(v){l?v():q.push(v)};c.runCallbacks=function(){a.each(q,function(){this()});l=true};c.loadFromString=function(v){c.ready(function(){o(v)})};c.disableUI=function(){};c.loadFromURL=function(v,
p){p||(p={});var I=p.cache,V=p.callback;c.ready(function(){a.ajax({url:v,dataType:"text",cache:!!I,success:function(M){o(M,V)},error:function(M,H,aa){M.status!=404&&M.responseText?o(M.responseText,V):a.alert(e.notification.URLloadFail+": \n"+aa+"",V)}})})};c.loadFromDataURI=function(v){c.ready(function(){var p=v.substring(26);o(svgedit.utilities.decode64(p))})};c.addExtension=function(){var v=arguments;a(function(){f&&f.addExtension.apply(this,v)})};return c}(jQuery);$(svgEditor.init)})();svgedit=svgedit||{};
(function(){var a=this;if(!svgedit.contextmenu)svgedit.contextmenu={};a.contextMenuExtensions={};svgEditor.ready(function(){for(menuItem in contextMenuExtensions){var o=contextMenuExtensions[menuItem];Object.keys(a.contextMenuExtensions).length==0&&$("#cmenu_canvas").append("<li class='separator'>");var f=o.shortcut||"";$("#cmenu_canvas").append("<li class='disabled'><a href='#"+o.id+"'>"+o.label+"<span class='shortcut'>"+f+"</span></a></li>")}});svgedit.contextmenu.resetCustomMenus=function(){a.contextMenuExtensions=
{}};svgedit.contextmenu.add=function(o){if(o&&o.id&&o.label&&o.action&&typeof o.action=="function")if(o.id in a.contextMenuExtensions)console.error('Cannot add extension "'+o.id+'", an extension by that name already exists"');else{console.log("Registed contextmenu item: {id:"+o.id+", label:"+o.label+"}");a.contextMenuExtensions[o.id]=o}else console.error("Menu items must be defined and have at least properties: id, label, action, where action must be a function")};svgedit.contextmenu.hasCustomHandler=
function(o){return a.contextMenuExtensions[o]&&true};svgedit.contextmenu.getCustomHandler=function(o){return a.contextMenuExtensions[o].action}})();var svgEditor=function(a,o){function f(l,n,b){var d=a("#svg_editor").parent(),e;for(e in n){var m=n[e];m||console.log(e);if(b)e="#"+e;if(d.find(e).length){var q=d.find(e)[0];switch(l){case "content":for(var v=0;v<q.childNodes.length;v++){var p=q.childNodes[v];if(p.nodeType===3&&p.textContent.replace(/\s/g,"")){p.textContent=m;break}}break;case "title":q.title=m}}else console.log("Missing: "+e)}}var c;o.readLang=function(l){var n=o.canvas.runExtensions("addlangData",c,true);a.each(n,function(V,M){if(M.data)l=
a.merge(l,M.data)});if(l.tools){var b=l.tools;n=l.properties;var d=l.config,e=l.layers,m=l.common,q=l.ui;f("content",{copyrightLabel:l.misc.powered_by,curve_segments:n.curve_segments,fitToContent:b.fitToContent,fit_to_all:b.fit_to_all,fit_to_canvas:b.fit_to_canvas,fit_to_layer_content:b.fit_to_layer_content,fit_to_sel:b.fit_to_sel,icon_large:d.icon_large,icon_medium:d.icon_medium,icon_small:d.icon_small,icon_xlarge:d.icon_xlarge,image_opt_embed:d.image_opt_embed,image_opt_ref:d.image_opt_ref,includedImages:d.included_images,
largest_object:b.largest_object,layersLabel:e.layers,page:b.page,relativeToLabel:b.relativeTo,selLayerLabel:e.move_elems_to,selectedPredefined:d.select_predefined,selected_objects:b.selected_objects,smallest_object:b.smallest_object,straight_segments:n.straight_segments,svginfo_bg_url:d.editor_img_url+":",svginfo_bg_note:d.editor_bg_note,svginfo_change_background:d.background,svginfo_dim:d.doc_dims,svginfo_editor_prefs:d.editor_prefs,svginfo_height:m.height,svginfo_icons:d.icon_size,svginfo_image_props:d.image_props,
svginfo_lang:d.language,svginfo_title:d.doc_title,svginfo_width:m.width,tool_docprops_cancel:m.cancel,tool_docprops_save:m.ok,tool_source_cancel:m.cancel,tool_source_save:m.ok,tool_prefs_cancel:m.cancel,tool_prefs_save:m.ok,sidepanel_handle:e.layers.split("").join(" "),tool_clear:b.new_doc,tool_docprops:b.docprops,tool_export:b.export_png,tool_import:b.import_doc,tool_imagelib:b.imagelib,tool_open:b.open_doc,tool_save:b.save_doc,svginfo_units_rulers:d.units_and_rulers,svginfo_rulers_onoff:d.show_rulers,
svginfo_unit:d.base_unit,svginfo_grid_settings:d.grid,svginfo_snap_onoff:d.snapping_onoff,svginfo_snap_step:d.snapping_stepsize},true);var v={},p;for(p in l.shape_cats)v['#shape_cats [data-cat="'+p+'"]']=l.shape_cats[p];setTimeout(function(){f("content",v)},2E3);var I={};a.each(["cut","copy","paste","paste_in_place","delete","group","ungroup","move_front","move_up","move_down","move_back"],function(){I['#cmenu_canvas a[href="#'+this+'"]']=b[this]});a.each(["dupe","merge_down","merge_all"],function(){I['#cmenu_layers a[href="#'+
this+'"]']=e[this]});I['#cmenu_layers a[href="#delete"]']=e.del;f("content",I);f("title",{align_relative_to:b.align_relative_to,circle_cx:n.circle_cx,circle_cy:n.circle_cy,circle_r:n.circle_r,cornerRadiusLabel:n.corner_radius,ellipse_cx:n.ellipse_cx,ellipse_cy:n.ellipse_cy,ellipse_rx:n.ellipse_rx,ellipse_ry:n.ellipse_ry,fill_color:n.fill_color,font_family:n.font_family,idLabel:n.id,image_height:n.image_height,image_url:n.image_url,image_width:n.image_width,layer_delete:e.del,layer_down:e.move_down,
layer_new:e["new"],layer_rename:e.rename,layer_moreopts:m.more_opts,layer_up:e.move_up,line_x1:n.line_x1,line_x2:n.line_x2,line_y1:n.line_y1,line_y2:n.line_y2,linecap_butt:n.linecap_butt,linecap_round:n.linecap_round,linecap_square:n.linecap_square,linejoin_bevel:n.linejoin_bevel,linejoin_miter:n.linejoin_miter,linejoin_round:n.linejoin_round,main_icon:b.main_menu,mode_connect:b.mode_connect,tools_shapelib_show:b.mode_shapelib,palette:q.palette_info,zoom_panel:q.zoom_level,path_node_x:n.node_x,path_node_y:n.node_y,
rect_height_tool:n.rect_height,rect_width_tool:n.rect_width,seg_type:n.seg_type,selLayerNames:e.move_selected,selected_x:n.pos_x,selected_y:n.pos_y,stroke_color:n.stroke_color,stroke_style:n.stroke_style,stroke_width:n.stroke_width,svginfo_title:d.doc_title,text:n.text_contents,toggle_stroke_tools:q.toggle_stroke_tools,tool_add_subpath:b.add_subpath,tool_alignbottom:b.align_bottom,tool_aligncenter:b.align_center,tool_alignleft:b.align_left,tool_alignmiddle:b.align_middle,tool_alignright:b.align_right,
tool_aligntop:b.align_top,tool_angle:n.angle,tool_blur:n.blur,tool_bold:n.bold,tool_circle:b.mode_circle,tool_clone:b.clone,tool_clone_multi:b.clone,tool_delete:b.del,tool_delete_multi:b.del,tool_ellipse:b.mode_ellipse,tool_eyedropper:b.mode_eyedropper,tool_fhellipse:b.mode_fhellipse,tool_fhpath:b.mode_fhpath,tool_fhrect:b.mode_fhrect,tool_font_size:n.font_size,tool_group:b.group,tool_make_link:b.make_link,tool_link_url:b.set_link_url,tool_image:b.mode_image,tool_italic:n.italic,tool_line:b.mode_line,
tool_move_bottom:b.move_bottom,tool_move_top:b.move_top,tool_node_clone:b.node_clone,tool_node_delete:b.node_delete,tool_node_link:b.node_link,tool_opacity:n.opacity,tool_openclose_path:b.openclose_path,tool_path:b.mode_path,tool_position:b.align_to_page,tool_rect:b.mode_rect,tool_redo:b.redo,tool_reorient:b.reorient_path,tool_select:b.mode_select,tool_source:b.source_save,tool_square:b.mode_square,tool_text:b.mode_text,tool_topath:b.to_path,tool_undo:b.undo,tool_ungroup:b.ungroup,tool_wireframe:b.wireframe_mode,
view_grid:b.toggle_grid,tool_zoom:b.mode_zoom,url_notice:b.no_embed},true);o.setLang(c,l)}};o.putLocale=function(l,n){if(l)c=l;else{c=a.pref("lang");if(!c){if(navigator.userLanguage)c=navigator.userLanguage;else if(navigator.language)c=navigator.language;if(c=="")return}console.log("Lang: "+c);if(a.inArray(c,n)==-1&&c!=="test")c="en";if(c.indexOf("en")==0)return}var b=o.curConfig.langPath+"lang."+c+".js";a.getScript(b,function(d){if(!d){d=document.createElement("script");d.src=b;document.querySelector("head").appendChild(d)}})};
return o}(jQuery,svgEditor);(function(a,o){function f(l){return!a(l).parents().andSelf().filter(function(){return a.curCSS(this,"visibility")==="hidden"||a.expr.filters.hidden(this)}).length}function c(l,n){var b=l.nodeName.toLowerCase();if("area"===b){b=l.parentNode;var d=b.name;if(!l.href||!d||b.nodeName.toLowerCase()!=="map")return false;b=a("img[usemap=#"+d+"]")[0];return!!b&&f(b)}return(/input|select|textarea|button|object/.test(b)?!l.disabled:"a"==b?l.href||n:n)&&f(l)}a.ui=a.ui||{};a.ui.version||(a.extend(a.ui,{version:"1.8.17",
keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),a.fn.extend({propAttr:a.fn.prop||a.fn.attr,_focus:a.fn.focus,focus:function(l,n){return typeof l=="number"?this.each(function(){var b=
this;setTimeout(function(){a(b).focus();n&&n.call(b)},l)}):this._focus.apply(this,arguments)},scrollParent:function(){var l;a.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?l=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.curCSS(this,"position",1))&&/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0):l=this.parents().filter(function(){return/(auto|scroll)/.test(a.curCSS(this,
"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0);return/fixed/.test(this.css("position"))||!l.length?a(document):l},zIndex:function(l){if(l!==o)return this.css("zIndex",l);if(this.length){l=a(this[0]);for(var n;l.length&&l[0]!==document;){n=l.css("position");if(n==="absolute"||n==="relative"||n==="fixed"){n=parseInt(l.css("zIndex"),10);if(!isNaN(n)&&n!==0)return n}l=l.parent()}}return 0},disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":
"mousedown")+".ui-disableSelection",function(l){l.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.each(["Width","Height"],function(l,n){function b(q,v,p,I){a.each(d,function(){v-=parseFloat(a.curCSS(q,"padding"+this,true))||0;p&&(v-=parseFloat(a.curCSS(q,"border"+this+"Width",true))||0);I&&(v-=parseFloat(a.curCSS(q,"margin"+this,true))||0)});return v}var d=n==="Width"?["Left","Right"]:["Top","Bottom"],e=n.toLowerCase(),m={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,
outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+n]=function(q){if(q===o)return m["inner"+n].call(this);return this.each(function(){a(this).css(e,b(this,q)+"px")})};a.fn["outer"+n]=function(q,v){if(typeof q!="number")return m["outer"+n].call(this,q);return this.each(function(){a(this).css(e,b(this,q,true,v)+"px")})}}),a.extend(a.expr[":"],{data:function(l,n,b){return!!a.data(l,b[3])},focusable:function(l){return c(l,!isNaN(a.attr(l,"tabindex")))},tabbable:function(l){var n=a.attr(l,
"tabindex"),b=isNaN(n);return(b||n>=0)&&c(l,!b)}}),a(function(){var l=document.body,n=l.appendChild(n=document.createElement("div"));a.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});a.support.minHeight=n.offsetHeight===100;a.support.selectstart="onselectstart"in n;l.removeChild(n).style.display="none"}),a.extend(a.ui,{plugin:{add:function(l,n,b){l=a.ui[l].prototype;for(var d in b){l.plugins[d]=l.plugins[d]||[];l.plugins[d].push([n,b[d]])}},call:function(l,n,b){if((n=l.plugins[n])&&
l.element[0].parentNode)for(var d=0;d<n.length;d++)l.options[n[d][0]]&&n[d][1].apply(l.element,b)}},contains:function(l,n){return document.compareDocumentPosition?l.compareDocumentPosition(n)&16:l!==n&&l.contains(n)},hasScroll:function(l,n){if(a(l).css("overflow")==="hidden")return false;var b=n&&n==="left"?"scrollLeft":"scrollTop",d=false;if(l[b]>0)return true;l[b]=1;d=l[b]>0;l[b]=0;return d},isOverAxis:function(l,n,b){return l>n&&l<n+b},isOver:function(l,n,b,d,e,m){return a.ui.isOverAxis(l,b,e)&&
a.ui.isOverAxis(n,d,m)}}))})(jQuery);
(function(a,o){if(a.cleanData){var f=a.cleanData;a.cleanData=function(l){for(var n=0,b;(b=l[n])!=null;n++)try{a(b).triggerHandler("remove")}catch(d){}f(l)}}else{var c=a.fn.remove;a.fn.remove=function(l,n){return this.each(function(){n||(!l||a.filter(l,[this]).length)&&a("*",this).add([this]).each(function(){try{a(this).triggerHandler("remove")}catch(b){}});return c.call(a(this),l,n)})}}a.widget=function(l,n,b){var d=l.split(".")[0],e;l=l.split(".")[1];e=d+"-"+l;b||(b=n,n=a.Widget);a.expr[":"][e]=
function(m){return!!a.data(m,l)};a[d]=a[d]||{};a[d][l]=function(m,q){arguments.length&&this._createWidget(m,q)};n=new n;n.options=a.extend(true,{},n.options);a[d][l].prototype=a.extend(true,n,{namespace:d,widgetName:l,widgetEventPrefix:a[d][l].prototype.widgetEventPrefix||l,widgetBaseClass:e},b);a.widget.bridge(l,a[d][l])};a.widget.bridge=function(l,n){a.fn[l]=function(b){var d=typeof b=="string",e=Array.prototype.slice.call(arguments,1),m=this;b=!d&&e.length?a.extend.apply(null,[true,b].concat(e)):
b;if(d&&b.charAt(0)==="_")return m;d?this.each(function(){var q=a.data(this,l),v=q&&a.isFunction(q[b])?q[b].apply(q,e):q;if(v!==q&&v!==o){m=v;return false}}):this.each(function(){var q=a.data(this,l);q?q.option(b||{})._init():a.data(this,l,new n(b,this))});return m}};a.Widget=function(l,n){arguments.length&&this._createWidget(l,n)};a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:false},_createWidget:function(l,n){a.data(n,this.widgetName,this);this.element=a(n);this.options=
a.extend(true,{},this.options,this._getCreateOptions(),l);var b=this;this.element.bind("remove."+this.widgetName,function(){b.destroy()});this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return a.metadata&&a.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+
"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(l,n){var b=l;if(arguments.length===0)return a.extend({},this.options);if(typeof l=="string"){if(n===o)return this.options[l];b={};b[l]=n}this._setOptions(b);return this},_setOptions:function(l){var n=this;a.each(l,function(b,d){n._setOption(b,d)});return this},_setOption:function(l,n){this.options[l]=n;l==="disabled"&&this.widget()[n?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",
n);return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_trigger:function(l,n,b){var d,e=this.options[l];b=b||{};n=a.Event(n);n.type=(l===this.widgetEventPrefix?l:this.widgetEventPrefix+l).toLowerCase();n.target=this.element[0];if(l=n.originalEvent)for(d in l)d in n||(n[d]=l[d]);this.element.trigger(n,b);return!(a.isFunction(e)&&e.call(this.element[0],n,b)===false||n.isDefaultPrevented())}}})(jQuery);
(function(a){var o=false;a(document).mouseup(function(){o=false});a.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var f=this;this.element.bind("mousedown."+this.widgetName,function(c){return f._mouseDown(c)}).bind("click."+this.widgetName,function(c){if(true===a.data(c.target,f.widgetName+".preventClickEvent")){a.removeData(c.target,f.widgetName+".preventClickEvent");c.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function(){this.element.unbind("."+
this.widgetName)},_mouseDown:function(f){if(!o){this._mouseStarted&&this._mouseUp(f);this._mouseDownEvent=f;var c=this,l=f.which==1,n=typeof this.options.cancel=="string"&&f.target.nodeName?a(f.target).closest(this.options.cancel).length:false;if(!l||n||!this._mouseCapture(f))return true;(this.mouseDelayMet=!this.options.delay)||(this._mouseDelayTimer=setTimeout(function(){c.mouseDelayMet=true},this.options.delay));if(this._mouseDistanceMet(f)&&this._mouseDelayMet(f)){this._mouseStarted=this._mouseStart(f)!==
false;if(!this._mouseStarted){f.preventDefault();return true}}true===a.data(f.target,this.widgetName+".preventClickEvent")&&a.removeData(f.target,this.widgetName+".preventClickEvent");this._mouseMoveDelegate=function(b){return c._mouseMove(b)};this._mouseUpDelegate=function(b){return c._mouseUp(b)};a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);f.preventDefault();return o=true}},_mouseMove:function(f){if(a.browser.msie&&
!(document.documentMode>=9)&&!f.button)return this._mouseUp(f);if(this._mouseStarted){this._mouseDrag(f);return f.preventDefault()}this._mouseDistanceMet(f)&&this._mouseDelayMet(f)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,f)!==false,this._mouseStarted?this._mouseDrag(f):this._mouseUp(f));return!this._mouseStarted},_mouseUp:function(f){a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);this._mouseStarted&&
(this._mouseStarted=false,f.target==this._mouseDownEvent.target&&a.data(f.target,this.widgetName+".preventClickEvent",true),this._mouseStop(f));return false},_mouseDistanceMet:function(f){return Math.max(Math.abs(this._mouseDownEvent.pageX-f.pageX),Math.abs(this._mouseDownEvent.pageY-f.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true}})})(jQuery);
(function(a){a.widget("ui.draggable",a.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false},_create:function(){this.options.helper=="original"&&
!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative");this.options.addClasses&&this.element.addClass("ui-draggable");this.options.disabled&&this.element.addClass("ui-draggable-disabled");this._mouseInit()},destroy:function(){if(this.element.data("draggable")){this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy();return this}},_mouseCapture:function(o){var f=this.options;
if(this.helper||f.disabled||a(o.target).is(".ui-resizable-handle"))return false;this.handle=this._getHandle(o);if(!this.handle)return false;f.iframeFix&&a(f.iframeFix===true?"iframe":f.iframeFix).each(function(){a('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1E3}).css(a(this).offset()).appendTo("body")});return true},_mouseStart:function(o){var f=this.options;this.helper=
this._createHelper(o);this._cacheHelperProportions();a.ui.ddmanager&&(a.ui.ddmanager.current=this);this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};a.extend(this.offset,{click:{left:o.pageX-this.offset.left,top:o.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});
this.originalPosition=this.position=this._generatePosition(o);this.originalPageX=o.pageX;this.originalPageY=o.pageY;f.cursorAt&&this._adjustOffsetFromHelper(f.cursorAt);f.containment&&this._setContainment();if(this._trigger("start",o)===false){this._clear();return false}this._cacheHelperProportions();a.ui.ddmanager&&!f.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,o);this.helper.addClass("ui-draggable-dragging");this._mouseDrag(o,true);a.ui.ddmanager&&a.ui.ddmanager.dragStart(this,o);return true},
_mouseDrag:function(o,f){this.position=this._generatePosition(o);this.positionAbs=this._convertPositionTo("absolute");if(!f){var c=this._uiHash();if(this._trigger("drag",o,c)===false){this._mouseUp({});return false}this.position=c.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";a.ui.ddmanager&&a.ui.ddmanager.drag(this,o);return false},_mouseStop:function(o){var f=
false;a.ui.ddmanager&&!this.options.dropBehaviour&&(f=a.ui.ddmanager.drop(this,o));this.dropped&&(f=this.dropped,this.dropped=false);if((!this.element[0]||!this.element[0].parentNode)&&this.options.helper=="original")return false;if(this.options.revert=="invalid"&&!f||this.options.revert=="valid"&&f||this.options.revert===true||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,f)){var c=this;a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),
function(){c._trigger("stop",o)!==false&&c._clear()})}else this._trigger("stop",o)!==false&&this._clear();return false},_mouseUp:function(o){this.options.iframeFix===true&&a("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)});a.ui.ddmanager&&a.ui.ddmanager.dragStop(this,o);return a.ui.mouse.prototype._mouseUp.call(this,o)},cancel:function(){this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear();return this},_getHandle:function(o){var f=!this.options.handle||
!a(this.options.handle,this.element).length?true:false;a(this.options.handle,this.element).find("*").andSelf().each(function(){this==o.target&&(f=true)});return f},_createHelper:function(o){var f=this.options;o=a.isFunction(f.helper)?a(f.helper.apply(this.element[0],[o])):f.helper=="clone"?this.element.clone().removeAttr("id"):this.element;o.parents("body").length||o.appendTo(f.appendTo=="parent"?this.element[0].parentNode:f.appendTo);o[0]!=this.element[0]&&!/(fixed|absolute)/.test(o.css("position"))&&
o.css("position","absolute");return o},_adjustOffsetFromHelper:function(o){typeof o=="string"&&(o=o.split(" "));a.isArray(o)&&(o={left:+o[0],top:+o[1]||0});"left"in o&&(this.offset.click.left=o.left+this.margins.left);"right"in o&&(this.offset.click.left=this.helperProportions.width-o.right+this.margins.left);"top"in o&&(this.offset.click.top=o.top+this.margins.top);"bottom"in o&&(this.offset.click.top=this.helperProportions.height-o.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=
this.helper.offsetParent();var o=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(o.left+=this.scrollParent.scrollLeft(),o.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)o={top:0,left:0};return{top:o.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:o.left+(parseInt(this.offsetParent.css("borderLeftWidth"),
10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var o=this.element.position();return{top:o.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:o.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),
10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var o=this.options;o.containment=="parent"&&(o.containment=this.helper[0].parentNode);if(o.containment=="document"||o.containment=="window")this.containment=[o.containment=="document"?0:a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,o.containment=="document"?0:a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,
(o.containment=="document"?0:a(window).scrollLeft())+a(o.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(o.containment=="document"?0:a(window).scrollTop())+(a(o.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(o.containment)&&o.containment.constructor!=Array){o=a(o.containment);var f=o[0];if(f){o.offset();var c=a(f).css("overflow")!=
"hidden";this.containment=[(parseInt(a(f).css("borderLeftWidth"),10)||0)+(parseInt(a(f).css("paddingLeft"),10)||0),(parseInt(a(f).css("borderTopWidth"),10)||0)+(parseInt(a(f).css("paddingTop"),10)||0),(c?Math.max(f.scrollWidth,f.offsetWidth):f.offsetWidth)-(parseInt(a(f).css("borderLeftWidth"),10)||0)-(parseInt(a(f).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(c?Math.max(f.scrollHeight,f.offsetHeight):f.offsetHeight)-(parseInt(a(f).css("borderTopWidth"),
10)||0)-(parseInt(a(f).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relative_container=o}}else o.containment.constructor==Array&&(this.containment=o.containment)},_convertPositionTo:function(o,f){f||(f=this.position);var c=o=="absolute"?1:-1,l=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,n=/(html|body)/i.test(l[0].tagName);return{top:f.top+
this.offset.relative.top*c+this.offset.parent.top*c-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():n?0:l.scrollTop())*c),left:f.left+this.offset.relative.left*c+this.offset.parent.left*c-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():n?0:l.scrollLeft())*c)}},_generatePosition:function(o){var f=this.options,c=this.cssPosition=="absolute"&&
(this.scrollParent[0]==document||!a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,l=/(html|body)/i.test(c[0].tagName),n=o.pageX,b=o.pageY;if(this.originalPosition){var d;if(this.containment){if(this.relative_container){d=this.relative_container.offset();d=[this.containment[0]+d.left,this.containment[1]+d.top,this.containment[2]+d.left,this.containment[3]+d.top]}else d=this.containment;o.pageX-this.offset.click.left<d[0]&&(n=d[0]+this.offset.click.left);
o.pageY-this.offset.click.top<d[1]&&(b=d[1]+this.offset.click.top);o.pageX-this.offset.click.left>d[2]&&(n=d[2]+this.offset.click.left);o.pageY-this.offset.click.top>d[3]&&(b=d[3]+this.offset.click.top)}if(f.grid){b=f.grid[1]?this.originalPageY+Math.round((b-this.originalPageY)/f.grid[1])*f.grid[1]:this.originalPageY;b=d?b-this.offset.click.top<d[1]||b-this.offset.click.top>d[3]?b-this.offset.click.top<d[1]?b+f.grid[1]:b-f.grid[1]:b:b;n=f.grid[0]?this.originalPageX+Math.round((n-this.originalPageX)/
f.grid[0])*f.grid[0]:this.originalPageX;n=d?n-this.offset.click.left<d[0]||n-this.offset.click.left>d[2]?n-this.offset.click.left<d[0]?n+f.grid[0]:n-f.grid[0]:n:n}}return{top:b-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():l?0:c.scrollTop()),left:n-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&a.browser.version<
526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():l?0:c.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove();this.helper=null;this.cancelHelperRemoval=false},_trigger:function(o,f,c){c=c||this._uiHash();a.ui.plugin.call(this,o,[f,c]);o=="drag"&&(this.positionAbs=this._convertPositionTo("absolute"));return a.Widget.prototype._trigger.call(this,o,f,
c)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});a.extend(a.ui.draggable,{version:"1.8.17"});a.ui.plugin.add("draggable","connectToSortable",{start:function(o,f){var c=a(this).data("draggable"),l=c.options,n=a.extend({},f,{item:c.element});c.sortables=[];a(l.connectToSortable).each(function(){var b=a.data(this,"sortable");b&&!b.options.disabled&&(c.sortables.push({instance:b,shouldRevert:b.options.revert}),
b.refreshPositions(),b._trigger("activate",o,n))})},stop:function(o,f){var c=a(this).data("draggable"),l=a.extend({},f,{item:c.element});a.each(c.sortables,function(){this.instance.isOver?(this.instance.isOver=0,c.cancelHelperRemoval=true,this.instance.cancelHelperRemoval=false,this.shouldRevert&&(this.instance.options.revert=true),this.instance._mouseStop(o),this.instance.options.helper=this.instance.options._helper,c.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):
(this.instance.cancelHelperRemoval=false,this.instance._trigger("deactivate",o,l))})},drag:function(o,f){var c=a(this).data("draggable"),l=this;a.each(c.sortables,function(){this.instance.positionAbs=c.positionAbs;this.instance.helperProportions=c.helperProportions;this.instance.offset.click=c.offset.click;this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=a(l).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",
true),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return f.helper[0]},o.target=this.instance.currentItem[0],this.instance._mouseCapture(o,true),this.instance._mouseStart(o,true,true),this.instance.offset.click.top=c.offset.click.top,this.instance.offset.click.left=c.offset.click.left,this.instance.offset.parent.left-=c.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=c.offset.parent.top-this.instance.offset.parent.top,
c._trigger("toSortable",o),c.dropped=this.instance.element,c.currentItem=c.element,this.instance.fromOutside=c),this.instance.currentItem&&this.instance._mouseDrag(o)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=true,this.instance.options.revert=false,this.instance._trigger("out",o,this.instance._uiHash(this.instance)),this.instance._mouseStop(o,true),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&
this.instance.placeholder.remove(),c._trigger("fromSortable",o),c.dropped=false)})}});a.ui.plugin.add("draggable","cursor",{start:function(){var o=a("body"),f=a(this).data("draggable").options;o.css("cursor")&&(f._cursor=o.css("cursor"));o.css("cursor",f.cursor)},stop:function(){var o=a(this).data("draggable").options;o._cursor&&a("body").css("cursor",o._cursor)}});a.ui.plugin.add("draggable","opacity",{start:function(o,f){var c=a(f.helper),l=a(this).data("draggable").options;c.css("opacity")&&(l._opacity=
c.css("opacity"));c.css("opacity",l.opacity)},stop:function(o,f){var c=a(this).data("draggable").options;c._opacity&&a(f.helper).css("opacity",c._opacity)}});a.ui.plugin.add("draggable","scroll",{start:function(){var o=a(this).data("draggable");o.scrollParent[0]!=document&&o.scrollParent[0].tagName!="HTML"&&(o.overflowOffset=o.scrollParent.offset())},drag:function(o){var f=a(this).data("draggable"),c=f.options,l=false;if(f.scrollParent[0]!=document&&f.scrollParent[0].tagName!="HTML"){if(!c.axis||
c.axis!="x")f.overflowOffset.top+f.scrollParent[0].offsetHeight-o.pageY<c.scrollSensitivity?f.scrollParent[0].scrollTop=l=f.scrollParent[0].scrollTop+c.scrollSpeed:o.pageY-f.overflowOffset.top<c.scrollSensitivity&&(f.scrollParent[0].scrollTop=l=f.scrollParent[0].scrollTop-c.scrollSpeed);if(!c.axis||c.axis!="y")f.overflowOffset.left+f.scrollParent[0].offsetWidth-o.pageX<c.scrollSensitivity?f.scrollParent[0].scrollLeft=l=f.scrollParent[0].scrollLeft+c.scrollSpeed:o.pageX-f.overflowOffset.left<c.scrollSensitivity&&
(f.scrollParent[0].scrollLeft=l=f.scrollParent[0].scrollLeft-c.scrollSpeed)}else{if(!c.axis||c.axis!="x")o.pageY-a(document).scrollTop()<c.scrollSensitivity?l=a(document).scrollTop(a(document).scrollTop()-c.scrollSpeed):a(window).height()-(o.pageY-a(document).scrollTop())<c.scrollSensitivity&&(l=a(document).scrollTop(a(document).scrollTop()+c.scrollSpeed));if(!c.axis||c.axis!="y")o.pageX-a(document).scrollLeft()<c.scrollSensitivity?l=a(document).scrollLeft(a(document).scrollLeft()-c.scrollSpeed):
a(window).width()-(o.pageX-a(document).scrollLeft())<c.scrollSensitivity&&(l=a(document).scrollLeft(a(document).scrollLeft()+c.scrollSpeed))}l!==false&&a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(f,o)}});a.ui.plugin.add("draggable","snap",{start:function(){var o=a(this).data("draggable"),f=o.options;o.snapElements=[];a(f.snap.constructor!=String?f.snap.items||":data(draggable)":f.snap).each(function(){var c=a(this),l=c.offset();this!=o.element[0]&&o.snapElements.push({item:this,
width:c.outerWidth(),height:c.outerHeight(),top:l.top,left:l.left})})},drag:function(o,f){for(var c=a(this).data("draggable"),l=c.options,n=l.snapTolerance,b=f.offset.left,d=b+c.helperProportions.width,e=f.offset.top,m=e+c.helperProportions.height,q=c.snapElements.length-1;q>=0;q--){var v=c.snapElements[q].left,p=v+c.snapElements[q].width,I=c.snapElements[q].top,V=I+c.snapElements[q].height;if(v-n<b&&b<p+n&&I-n<e&&e<V+n||v-n<b&&b<p+n&&I-n<m&&m<V+n||v-n<d&&d<p+n&&I-n<e&&e<V+n||v-n<d&&d<p+n&&I-n<m&&
m<V+n){if(l.snapMode!="inner"){var M=Math.abs(I-m)<=n,H=Math.abs(V-e)<=n,aa=Math.abs(v-d)<=n,T=Math.abs(p-b)<=n;M&&(f.position.top=c._convertPositionTo("relative",{top:I-c.helperProportions.height,left:0}).top-c.margins.top);H&&(f.position.top=c._convertPositionTo("relative",{top:V,left:0}).top-c.margins.top);aa&&(f.position.left=c._convertPositionTo("relative",{top:0,left:v-c.helperProportions.width}).left-c.margins.left);T&&(f.position.left=c._convertPositionTo("relative",{top:0,left:p}).left-c.margins.left)}var P=
M||H||aa||T;if(l.snapMode!="outer"){M=Math.abs(I-e)<=n;H=Math.abs(V-m)<=n;aa=Math.abs(v-b)<=n;T=Math.abs(p-d)<=n;M&&(f.position.top=c._convertPositionTo("relative",{top:I,left:0}).top-c.margins.top);H&&(f.position.top=c._convertPositionTo("relative",{top:V-c.helperProportions.height,left:0}).top-c.margins.top);aa&&(f.position.left=c._convertPositionTo("relative",{top:0,left:v}).left-c.margins.left);T&&(f.position.left=c._convertPositionTo("relative",{top:0,left:p-c.helperProportions.width}).left-
c.margins.left)}!c.snapElements[q].snapping&&(M||H||aa||T||P)&&c.options.snap.snap&&c.options.snap.snap.call(c.element,o,a.extend(c._uiHash(),{snapItem:c.snapElements[q].item}));c.snapElements[q].snapping=M||H||aa||T||P}else{c.snapElements[q].snapping&&c.options.snap.release&&c.options.snap.release.call(c.element,o,a.extend(c._uiHash(),{snapItem:c.snapElements[q].item}));c.snapElements[q].snapping=false}}}});a.ui.plugin.add("draggable","stack",{start:function(){var o=a(this).data("draggable").options;
o=a.makeArray(a(o.stack)).sort(function(c,l){return(parseInt(a(c).css("zIndex"),10)||0)-(parseInt(a(l).css("zIndex"),10)||0)});if(o.length){var f=parseInt(o[0].style.zIndex)||0;a(o).each(function(c){this.style.zIndex=f+c});this[0].style.zIndex=f+o.length}}});a.ui.plugin.add("draggable","zIndex",{start:function(o,f){var c=a(f.helper),l=a(this).data("draggable").options;c.css("zIndex")&&(l._zIndex=c.css("zIndex"));c.css("zIndex",l.zIndex)},stop:function(o,f){var c=a(this).data("draggable").options;
c._zIndex&&a(f.helper).css("zIndex",c._zIndex)}})})(jQuery);
(function(a){a.widget("ui.slider",a.ui.mouse,{widgetEventPrefix:"slide",options:{animate:false,distance:0,max:100,min:0,orientation:"horizontal",range:false,step:1,value:0,values:null},_create:function(){var o=this,f=this.options,c=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),l=f.values&&f.values.length||1,n=[];this._mouseSliding=this._keySliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider ui-slider-"+
this.orientation+" ui-widget ui-widget-content ui-corner-all"+(f.disabled?" ui-slider-disabled ui-disabled":""));this.range=a([]);f.range&&(f.range===true&&(f.values||(f.values=[this._valueMin(),this._valueMin()]),f.values.length&&f.values.length!==2&&(f.values=[f.values[0],f.values[0]])),this.range=a("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(f.range==="min"||f.range==="max"?" ui-slider-range-"+f.range:"")));for(var b=c.length;b<l;b+=1)n.push("<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>");
this.handles=c.add(a(n.join("")).appendTo(o.element));this.handle=this.handles.eq(0);this.handles.add(this.range).filter("a").click(function(d){d.preventDefault()}).hover(function(){f.disabled||a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")}).focus(function(){f.disabled?a(this).blur():(a(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),a(this).addClass("ui-state-focus"))}).blur(function(){a(this).removeClass("ui-state-focus")});this.handles.each(function(d){a(this).data("index.ui-slider-handle",
d)});this.handles.keydown(function(d){var e=true,m=a(this).data("index.ui-slider-handle"),q,v,p;if(!o.options.disabled){switch(d.keyCode){case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:e=false;if(!o._keySliding){o._keySliding=true;a(this).addClass("ui-state-active");q=o._start(d,m);if(q===false)return}}q=o.options.step;o.options.values&&o.options.values.length?
v=p=o.values(m):v=p=o.value();switch(d.keyCode){case a.ui.keyCode.HOME:p=o._valueMin();break;case a.ui.keyCode.END:p=o._valueMax();break;case a.ui.keyCode.PAGE_UP:p=o._trimAlignValue(v+(o._valueMax()-o._valueMin())/5);break;case a.ui.keyCode.PAGE_DOWN:p=o._trimAlignValue(v-(o._valueMax()-o._valueMin())/5);break;case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:if(v===o._valueMax())return;p=o._trimAlignValue(v+q);break;case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(v===o._valueMin())return;p=o._trimAlignValue(v-
q)}o._slide(d,m,p);return e}}).keyup(function(d){var e=a(this).data("index.ui-slider-handle");o._keySliding&&(o._keySliding=false,o._stop(d,e),o._change(d,e),a(this).removeClass("ui-state-active"))});this._refreshValue();this._animateOff=false},destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider");this._mouseDestroy();
return this},_mouseCapture:function(o){var f=this.options,c,l,n,b,d;if(f.disabled)return false;this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();c=this._normValueFromMouse({x:o.pageX,y:o.pageY});l=this._valueMax()-this._valueMin()+1;b=this;this.handles.each(function(e){var m=Math.abs(c-b.values(e));l>m&&(l=m,n=a(this),d=e)});f.range===true&&this.values(1)===f.min&&(d+=1,n=a(this.handles[d]));if(this._start(o,d)===false)return false;
this._mouseSliding=true;b._handleIndex=d;n.addClass("ui-state-active").focus();f=n.offset();this._clickOffset=!a(o.target).parents().andSelf().is(".ui-slider-handle")?{left:0,top:0}:{left:o.pageX-f.left-n.width()/2,top:o.pageY-f.top-n.height()/2-(parseInt(n.css("borderTopWidth"),10)||0)-(parseInt(n.css("borderBottomWidth"),10)||0)+(parseInt(n.css("marginTop"),10)||0)};this.handles.hasClass("ui-state-hover")||this._slide(o,d,c);return this._animateOff=true},_mouseStart:function(){return true},_mouseDrag:function(o){var f=
this._normValueFromMouse({x:o.pageX,y:o.pageY});this._slide(o,this._handleIndex,f);return false},_mouseStop:function(o){this.handles.removeClass("ui-state-active");this._mouseSliding=false;this._stop(o,this._handleIndex);this._change(o,this._handleIndex);this._clickOffset=this._handleIndex=null;return this._animateOff=false},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(o){var f,c;this.orientation==="horizontal"?
(f=this.elementSize.width,c=o.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(f=this.elementSize.height,c=o.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0));o=c/f;o>1&&(o=1);o<0&&(o=0);this.orientation==="vertical"&&(o=1-o);f=this._valueMax()-this._valueMin();return this._trimAlignValue(this._valueMin()+o*f)},_start:function(o,f){var c={handle:this.handles[f],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(f),
c.values=this.values());return this._trigger("start",o,c)},_slide:function(o,f,c){var l,n,b;this.options.values&&this.options.values.length?(l=this.values(f?0:1),this.options.values.length===2&&this.options.range===true&&(f===0&&c>l||f===1&&c<l)&&(c=l),c!==this.values(f)&&(n=this.values(),n[f]=c,b=this._trigger("slide",o,{handle:this.handles[f],value:c,values:n}),this.values(f?0:1),b!==false&&this.values(f,c,true))):c!==this.value()&&(b=this._trigger("slide",o,{handle:this.handles[f],value:c}),b!==
false&&this.value(c))},_stop:function(o,f){var c={handle:this.handles[f],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(f),c.values=this.values());this._trigger("stop",o,c)},_change:function(o,f){if(!this._keySliding&&!this._mouseSliding){var c={handle:this.handles[f],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(f),c.values=this.values());this._trigger("change",o,c)}},value:function(o){if(arguments.length){this.options.value=
this._trimAlignValue(o);this._refreshValue();this._change(null,0)}else return this._value()},values:function(o,f){var c,l,n;if(arguments.length>1){this.options.values[o]=this._trimAlignValue(f);this._refreshValue();this._change(null,o)}else{if(!arguments.length)return this._values();if(!a.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(o):this.value();c=this.options.values;l=arguments[0];for(n=0;n<c.length;n+=1){c[n]=this._trimAlignValue(l[n]);this._change(null,
n)}this._refreshValue()}},_setOption:function(o,f){var c,l=0;a.isArray(this.options.values)&&(l=this.options.values.length);a.Widget.prototype._setOption.apply(this,arguments);switch(o){case "disabled":f?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.propAttr("disabled",true),this.element.addClass("ui-disabled")):(this.handles.propAttr("disabled",false),this.element.removeClass("ui-disabled"));break;case "orientation":this._detectOrientation();
this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;case "value":this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case "values":this._animateOff=true;this._refreshValue();for(c=0;c<l;c+=1)this._change(null,c);this._animateOff=false}},_value:function(){var o=this.options.value;return o=this._trimAlignValue(o)},_values:function(o){var f,c;if(arguments.length){f=this.options.values[o];
return f=this._trimAlignValue(f)}f=this.options.values.slice();for(c=0;c<f.length;c+=1)f[c]=this._trimAlignValue(f[c]);return f},_trimAlignValue:function(o){if(o<=this._valueMin())return this._valueMin();if(o>=this._valueMax())return this._valueMax();var f=this.options.step>0?this.options.step:1,c=(o-this._valueMin())%f;o=o-c;Math.abs(c)*2>=f&&(o+=c>0?f:-f);return parseFloat(o.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var o=
this.options.range,f=this.options,c=this,l=this._animateOff?false:f.animate,n,b={},d,e,m,q;this.options.values&&this.options.values.length?this.handles.each(function(v){n=(c.values(v)-c._valueMin())/(c._valueMax()-c._valueMin())*100;b[c.orientation==="horizontal"?"left":"bottom"]=n+"%";a(this).stop(1,1)[l?"animate":"css"](b,f.animate);c.options.range===true&&(c.orientation==="horizontal"?(v===0&&c.range.stop(1,1)[l?"animate":"css"]({left:n+"%"},f.animate),v===1&&c.range[l?"animate":"css"]({width:n-
d+"%"},{queue:false,duration:f.animate})):(v===0&&c.range.stop(1,1)[l?"animate":"css"]({bottom:n+"%"},f.animate),v===1&&c.range[l?"animate":"css"]({height:n-d+"%"},{queue:false,duration:f.animate})));d=n}):(e=this.value(),m=this._valueMin(),q=this._valueMax(),n=q!==m?(e-m)/(q-m)*100:0,b[c.orientation==="horizontal"?"left":"bottom"]=n+"%",this.handle.stop(1,1)[l?"animate":"css"](b,f.animate),o==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[l?"animate":"css"]({width:n+"%"},f.animate),
o==="max"&&this.orientation==="horizontal"&&this.range[l?"animate":"css"]({width:100-n+"%"},{queue:false,duration:f.animate}),o==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[l?"animate":"css"]({height:n+"%"},f.animate),o==="max"&&this.orientation==="vertical"&&this.range[l?"animate":"css"]({height:100-n+"%"},{queue:false,duration:f.animate}))}});a.extend(a.ui.slider,{version:"1.8.17"})})(jQuery);(function(a){Math.precision=function(b,d){if(d===undefined)d=0;return Math.round(b*Math.pow(10,d))/Math.pow(10,d)};var o=function(b,d){var e=this,m=b.find("img:first"),q=0,v=100,p=100,I=0,V=100,M=100,H=0,aa=0,T,P,R=[],ea=function(Z){for(var Y=0;Y<R.length;Y++)R[Y].call(e,e,Z)},S=function(Z){var Y=b.offset();T={l:Y.left|0,t:Y.top|0};clearTimeout(P);P=setTimeout(function(){la.call(e,Z)},0);a(document).bind("mousemove",X).bind("mouseup",ba);Z.preventDefault()},X=function(Z){clearTimeout(P);P=setTimeout(function(){la.call(e,
Z)},0);Z.stopPropagation();Z.preventDefault();return false},ba=function(Z){a(document).unbind("mouseup",ba).unbind("mousemove",X);Z.stopPropagation();Z.preventDefault();return false},la=function(Z){var Y=Z.pageX-T.l;Z=Z.pageY-T.t;var ma=b.w,ua=b.h;if(Y<0)Y=0;else if(Y>ma)Y=ma;if(Z<0)Z=0;else if(Z>ua)Z=ua;ka.call(e,"xy",{x:Y/ma*p+q,y:Z/ua*M+I})},ka=function(Z,Y,ma){if(Y===undefined){if(Z===undefined||Z==null)Z="xy";switch(Z.toLowerCase()){case "x":return H;case "y":return aa;default:return{x:H,y:aa}}}if(!(ma!=
null&&ma==e)){var ua=false,ha,qa;if(Z==null)Z="xy";switch(Z.toLowerCase()){case "x":ha=Y&&(Y.x&&Y.x|0||Y|0)||0;break;case "y":qa=Y&&(Y.y&&Y.y|0||Y|0)||0;break;default:ha=Y&&Y.x&&Y.x|0||0;qa=Y&&Y.y&&Y.y|0||0}if(ha!=null){if(ha<q)ha=q;else if(ha>v)ha=v;if(H!=ha){H=ha;ua=true}}if(qa!=null){if(qa<I)qa=I;else if(qa>V)qa=V;if(aa!=qa){aa=qa;ua=true}}ua&&ea.call(e,ma||e)}},da=function(Z){a.isFunction(Z)&&R.push(Z)};a.extend(true,e,{val:ka,range:function(Z,Y){if(Y===undefined){if(Z===undefined||Z==null)Z=
"all";switch(Z.toLowerCase()){case "minx":return q;case "maxx":return v;case "rangex":return{minX:q,maxX:v,rangeX:p};case "miny":return I;case "maxy":return V;case "rangey":return{minY:I,maxY:V,rangeY:M};default:return{minX:q,maxX:v,rangeX:p,minY:I,maxY:V,rangeY:M}}}var ma,ua,ha,qa;if(Z==null)Z="all";switch(Z.toLowerCase()){case "minx":ma=Y&&(Y.minX&&Y.minX|0||Y|0)||0;break;case "maxx":ua=Y&&(Y.maxX&&Y.maxX|0||Y|0)||0;break;case "rangex":ma=Y&&Y.minX&&Y.minX|0||0;ua=Y&&Y.maxX&&Y.maxX|0||0;break;case "miny":ha=
Y&&(Y.minY&&Y.minY|0||Y|0)||0;break;case "maxy":qa=Y&&(Y.maxY&&Y.maxY|0||Y|0)||0;break;case "rangey":ha=Y&&Y.minY&&Y.minY|0||0;qa=Y&&Y.maxY&&Y.maxY|0||0;break;default:ma=Y&&Y.minX&&Y.minX|0||0;ua=Y&&Y.maxX&&Y.maxX|0||0;ha=Y&&Y.minY&&Y.minY|0||0;qa=Y&&Y.maxY&&Y.maxY|0||0}if(ma!=null&&q!=ma){q=ma;p=v-q}if(ua!=null&&v!=ua){v=ua;p=v-q}if(ha!=null&&I!=ha){I=ha;M=V-I}if(qa!=null&&V!=qa){V=qa;M=V-I}},bind:da,unbind:function(Z){if(a.isFunction(Z))for(var Y;(Y=a.inArray(Z,R))!=-1;)R.splice(Y,1)},destroy:function(){a(document).unbind("mouseup",
ba).unbind("mousemove",X);b.unbind("mousedown",S);R=m=b=null}});m.src=d.arrow&&d.arrow.image;m.w=d.arrow&&d.arrow.width||m.width();m.h=d.arrow&&d.arrow.height||m.height();b.w=d.map&&d.map.width||b.width();b.h=d.map&&d.map.height||b.height();b.bind("mousedown",S);da.call(e,function(){var Z=0,Y=0,ma=b.w,ua=b.h,ha=m.w,qa=m.h;setTimeout(function(){if(p>0)Z=H==v?ma:H/p*ma|0;if(M>0)Y=aa==V?ua:aa/M*ua|0;if(ha>=ma)Z=(ma>>1)-(ha>>1);else Z-=ha>>1;if(qa>=ua)Y=(ua>>1)-(qa>>1);else Y-=qa>>1;m.css({left:Z+"px",
top:Y+"px"})},0)})},f=function(b,d,e,m){var q=this;b=b.find("td.Text input");var v=b.eq(3),p=b.eq(4),I=b.eq(5),V=b.length>7?b.eq(6):null,M=b.eq(0),H=b.eq(1),aa=b.eq(2),T=b.eq(b.length>7?7:6),P=b.length>7?b.eq(8):null,R=function(ka){if(!(ka.target.value==""&&ka.target!=T.get(0)&&(e!=null&&ka.target!=e.get(0)||e==null))){if(!X(ka))return ka;switch(ka.target){case v.get(0):switch(ka.keyCode){case 38:v.val(ba.call(q,(v.val()<<0)+1,0,255));d.val("r",v.val(),ka.target);return false;case 40:v.val(ba.call(q,
(v.val()<<0)-1,0,255));d.val("r",v.val(),ka.target);return false}break;case p.get(0):switch(ka.keyCode){case 38:p.val(ba.call(q,(p.val()<<0)+1,0,255));d.val("g",p.val(),ka.target);return false;case 40:p.val(ba.call(q,(p.val()<<0)-1,0,255));d.val("g",p.val(),ka.target);return false}break;case I.get(0):switch(ka.keyCode){case 38:I.val(ba.call(q,(I.val()<<0)+1,0,255));d.val("b",I.val(),ka.target);return false;case 40:I.val(ba.call(q,(I.val()<<0)-1,0,255));d.val("b",I.val(),ka.target);return false}break;
case V&&V.get(0):switch(ka.keyCode){case 38:V.val(ba.call(q,parseFloat(V.val())+1,0,100));d.val("a",Math.precision(V.val()*255/100,m),ka.target);return false;case 40:V.val(ba.call(q,parseFloat(V.val())-1,0,100));d.val("a",Math.precision(V.val()*255/100,m),ka.target);return false}break;case M.get(0):switch(ka.keyCode){case 38:M.val(ba.call(q,(M.val()<<0)+1,0,360));d.val("h",M.val(),ka.target);return false;case 40:M.val(ba.call(q,(M.val()<<0)-1,0,360));d.val("h",M.val(),ka.target);return false}break;
case H.get(0):switch(ka.keyCode){case 38:H.val(ba.call(q,(H.val()<<0)+1,0,100));d.val("s",H.val(),ka.target);return false;case 40:H.val(ba.call(q,(H.val()<<0)-1,0,100));d.val("s",H.val(),ka.target);return false}break;case aa.get(0):switch(ka.keyCode){case 38:aa.val(ba.call(q,(aa.val()<<0)+1,0,100));d.val("v",aa.val(),ka.target);return false;case 40:aa.val(ba.call(q,(aa.val()<<0)-1,0,100));d.val("v",aa.val(),ka.target);return false}}}},ea=function(ka){if(!(ka.target.value==""&&ka.target!=T.get(0)&&
(e!=null&&ka.target!=e.get(0)||e==null))){if(!X(ka))return ka;switch(ka.target){case v.get(0):v.val(ba.call(q,v.val(),0,255));d.val("r",v.val(),ka.target);break;case p.get(0):p.val(ba.call(q,p.val(),0,255));d.val("g",p.val(),ka.target);break;case I.get(0):I.val(ba.call(q,I.val(),0,255));d.val("b",I.val(),ka.target);break;case V&&V.get(0):V.val(ba.call(q,V.val(),0,100));d.val("a",Math.precision(V.val()*255/100,m),ka.target);break;case M.get(0):M.val(ba.call(q,M.val(),0,360));d.val("h",M.val(),ka.target);
break;case H.get(0):H.val(ba.call(q,H.val(),0,100));d.val("s",H.val(),ka.target);break;case aa.get(0):aa.val(ba.call(q,aa.val(),0,100));d.val("v",aa.val(),ka.target);break;case T.get(0):T.val(T.val().replace(/[^a-fA-F0-9]/g,"").toLowerCase().substring(0,6));e&&e.val(T.val());d.val("hex",T.val()!=""?T.val():null,ka.target);break;case e&&e.get(0):e.val(e.val().replace(/[^a-fA-F0-9]/g,"").toLowerCase().substring(0,6));T.val(e.val());d.val("hex",e.val()!=""?e.val():null,ka.target);break;case P&&P.get(0):P.val(P.val().replace(/[^a-fA-F0-9]/g,
"").toLowerCase().substring(0,2));d.val("a",P.val()!=null?parseInt(P.val(),16):null,ka.target)}}},S=function(ka){if(d.val()!=null)switch(ka.target){case v.get(0):v.val(d.val("r"));break;case p.get(0):p.val(d.val("g"));break;case I.get(0):I.val(d.val("b"));break;case V&&V.get(0):V.val(Math.precision(d.val("a")*100/255,m));break;case M.get(0):M.val(d.val("h"));break;case H.get(0):H.val(d.val("s"));break;case aa.get(0):aa.val(d.val("v"));break;case T.get(0):case e&&e.get(0):T.val(d.val("hex"));e&&e.val(d.val("hex"));
break;case P&&P.get(0):P.val(d.val("ahex").substring(6))}},X=function(ka){switch(ka.keyCode){case 9:case 16:case 29:case 37:case 39:return false;case "c".charCodeAt():case "v".charCodeAt():if(ka.ctrlKey)return false}return true},ba=function(ka,da,Z){if(ka==""||isNaN(ka))return da;if(ka>Z)return Z;if(ka<da)return da;return ka},la=function(ka,da){var Z=ka.val("all");if(da!=v.get(0))v.val(Z!=null?Z.r:"");if(da!=p.get(0))p.val(Z!=null?Z.g:"");if(da!=I.get(0))I.val(Z!=null?Z.b:"");if(V&&da!=V.get(0))V.val(Z!=
null?Math.precision(Z.a*100/255,m):"");if(da!=M.get(0))M.val(Z!=null?Z.h:"");if(da!=H.get(0))H.val(Z!=null?Z.s:"");if(da!=aa.get(0))aa.val(Z!=null?Z.v:"");if(da!=T.get(0)&&(e&&da!=e.get(0)||!e))T.val(Z!=null?Z.hex:"");if(e&&da!=e.get(0)&&da!=T.get(0))e.val(Z!=null?Z.hex:"");if(P&&da!=P.get(0))P.val(Z!=null?Z.ahex.substring(6):"")};a.extend(true,q,{destroy:function(){v.add(p).add(I).add(V).add(M).add(H).add(aa).add(T).add(e).add(P).unbind("keyup",ea).unbind("blur",S);v.add(p).add(I).add(V).add(M).add(H).add(aa).unbind("keydown",
R);d.unbind(la);P=T=aa=H=M=V=I=p=v=null}});v.add(p).add(I).add(V).add(M).add(H).add(aa).add(T).add(e).add(P).bind("keyup",ea).bind("blur",S);v.add(p).add(I).add(V).add(M).add(H).add(aa).bind("keydown",R);d.bind(la)};a.jPicker={List:[],Color:function(b){var d=this,e,m,q,v,p,I,V,M=[],H=function(T){for(var P=0;P<M.length;P++)M[P].call(d,d,T)},aa=function(T,P,R){if(P===undefined){if(T===undefined||T==null||T=="")T="all";if(e==null)return null;switch(T.toLowerCase()){case "ahex":return n.rgbaToHex({r:e,
g:m,b:q,a:v});case "hex":return aa("ahex").substring(0,6);case "all":return{r:e,g:m,b:q,a:v,h:p,s:I,v:V,hex:aa.call(d,"hex"),ahex:aa.call(d,"ahex")};default:P={};for(var ea=0;ea<T.length;ea++)switch(T.charAt(ea)){case "r":if(T.length==1)P=e;else P.r=e;break;case "g":if(T.length==1)P=m;else P.g=m;break;case "b":if(T.length==1)P=q;else P.b=q;break;case "a":if(T.length==1)P=v;else P.a=v;break;case "h":if(T.length==1)P=p;else P.h=p;break;case "s":if(T.length==1)P=I;else P.s=I;break;case "v":if(T.length==
1)P=V;else P.v=V}return P=={}?aa.call(d,"all"):P}}if(!(R!=null&&R==d)){var S=false;if(T==null)T="";if(P==null){if(e!=null){e=null;S=true}if(m!=null){m=null;S=true}if(q!=null){q=null;S=true}if(v!=null){v=null;S=true}if(p!=null){p=null;S=true}if(I!=null){I=null;S=true}if(V!=null){V=null;S=true}S&&H.call(d,R||d)}else switch(T.toLowerCase()){case "ahex":case "hex":P=n.hexToRgba(P&&(P.ahex||P.hex)||P||"00000000");aa.call(d,"rgba",{r:P.r,g:P.g,b:P.b,a:T=="ahex"?P.a:v!=null?v:255},R);break;default:if(P&&
(P.ahex!=null||P.hex!=null)){aa.call(d,"ahex",P.ahex||P.hex||"00000000",R);break}var X={},ba=false,la=false;if(P.r!==undefined&&!T.indexOf("r")==-1)T+="r";if(P.g!==undefined&&!T.indexOf("g")==-1)T+="g";if(P.b!==undefined&&!T.indexOf("b")==-1)T+="b";if(P.a!==undefined&&!T.indexOf("a")==-1)T+="a";if(P.h!==undefined&&!T.indexOf("h")==-1)T+="h";if(P.s!==undefined&&!T.indexOf("s")==-1)T+="s";if(P.v!==undefined&&!T.indexOf("v")==-1)T+="v";for(ea=0;ea<T.length;ea++)switch(T.charAt(ea)){case "r":if(la)continue;
ba=true;X.r=P&&P.r&&P.r|0||P&&P|0||0;if(X.r<0)X.r=0;else if(X.r>255)X.r=255;if(e!=X.r){e=X.r;S=true}break;case "g":if(la)continue;ba=true;X.g=P&&P.g&&P.g|0||P&&P|0||0;if(X.g<0)X.g=0;else if(X.g>255)X.g=255;if(m!=X.g){m=X.g;S=true}break;case "b":if(la)continue;ba=true;X.b=P&&P.b&&P.b|0||P&&P|0||0;if(X.b<0)X.b=0;else if(X.b>255)X.b=255;if(q!=X.b){q=X.b;S=true}break;case "a":X.a=P&&P.a!=null?P.a|0:P!=null?P|0:255;if(X.a<0)X.a=0;else if(X.a>255)X.a=255;if(v!=X.a){v=X.a;S=true}break;case "h":if(ba)continue;
la=true;X.h=P&&P.h&&P.h|0||P&&P|0||0;if(X.h<0)X.h=0;else if(X.h>360)X.h=360;if(p!=X.h){p=X.h;S=true}break;case "s":if(ba)continue;la=true;X.s=P&&P.s!=null?P.s|0:P!=null?P|0:100;if(X.s<0)X.s=0;else if(X.s>100)X.s=100;if(I!=X.s){I=X.s;S=true}break;case "v":if(ba)continue;la=true;X.v=P&&P.v!=null?P.v|0:P!=null?P|0:100;if(X.v<0)X.v=0;else if(X.v>100)X.v=100;if(V!=X.v){V=X.v;S=true}}if(S){if(ba){e=e||0;m=m||0;q=q||0;P=n.rgbToHsv({r:e,g:m,b:q});p=P.h;I=P.s;V=P.v}else if(la){p=p||0;I=I!=null?I:100;V=V!=
null?V:100;P=n.hsvToRgb({h:p,s:I,v:V});e=P.r;m=P.g;q=P.b}v=v!=null?v:255;H.call(d,R||d)}}}};a.extend(true,d,{val:aa,bind:function(T){a.isFunction(T)&&M.push(T)},unbind:function(T){if(a.isFunction(T))for(var P;(P=a.inArray(T,M))!=-1;)M.splice(P,1)},destroy:function(){M=null}});if(b)if(b.ahex!=null)aa("ahex",b);else if(b.hex!=null)aa((b.a!=null?"a":"")+"hex",b.a!=null?{ahex:b.hex+n.intToHex(b.a)}:b);else if(b.r!=null&&b.g!=null&&b.b!=null)aa("rgb"+(b.a!=null?"a":""),b);else if(b.h!=null&&b.s!=null&&
b.v!=null)aa("hsv"+(b.a!=null?"a":""),b)},ColorMethods:{hexToRgba:function(b){b=this.validateHex(b);if(b=="")return{r:null,g:null,b:null,a:null};var d="00",e="00",m="00",q="255";if(b.length==6)b+="ff";if(b.length>6){d=b.substring(0,2);e=b.substring(2,4);m=b.substring(4,6);q=b.substring(6,b.length)}else{if(b.length>4){d=b.substring(4,b.length);b=b.substring(0,4)}if(b.length>2){e=b.substring(2,b.length);b=b.substring(0,2)}if(b.length>0)m=b.substring(0,b.length)}return{r:this.hexToInt(d),g:this.hexToInt(e),
b:this.hexToInt(m),a:this.hexToInt(q)}},validateHex:function(b){if(typeof b=="object")return"";b=b.toLowerCase().replace(/[^a-f0-9]/g,"");if(b.length>8)b=b.substring(0,8);return b},rgbaToHex:function(b){return this.intToHex(b.r)+this.intToHex(b.g)+this.intToHex(b.b)+this.intToHex(b.a)},intToHex:function(b){b=(b|0).toString(16);if(b.length==1)b="0"+b;return b.toLowerCase()},hexToInt:function(b){return parseInt(b,16)},rgbToHsv:function(b){var d=b.r/255,e=b.g/255;b=b.b/255;var m={h:0,s:0,v:0},q=0,v=
0;if(d>=e&&d>=b){v=d;q=e>b?b:e}else if(e>=b&&e>=d){v=e;q=d>b?b:d}else{v=b;q=e>d?d:e}m.v=v;m.s=v?(v-q)/v:0;if(m.s){q=v-q;m.h=d==v?(e-b)/q:e==v?2+(b-d)/q:4+(d-e)/q;m.h=parseInt(m.h*60);if(m.h<0)m.h+=360}else m.h=0;m.s=m.s*100|0;m.v=m.v*100|0;return m},hsvToRgb:function(b){var d={r:0,g:0,b:0,a:100},e=b.h,m=b.s;b=b.v;if(m==0)d.r=b==0?d.g=d.b=0:d.g=d.b=b*255/100|0;else{if(e==360)e=0;e/=60;m/=100;b/=100;var q=e|0,v=e-q;e=b*(1-m);var p=b*(1-m*v);m=b*(1-m*(1-v));switch(q){case 0:d.r=b;d.g=m;d.b=e;break;case 1:d.r=
p;d.g=b;d.b=e;break;case 2:d.r=e;d.g=b;d.b=m;break;case 3:d.r=e;d.g=p;d.b=b;break;case 4:d.r=m;d.g=e;d.b=b;break;case 5:d.r=b;d.g=e;d.b=p}d.r=d.r*255|0;d.g=d.g*255|0;d.b=d.b*255|0}return d}}};var c=a.jPicker.Color,l=a.jPicker.List,n=a.jPicker.ColorMethods;a.fn.jPicker=function(b){var d=arguments;return this.each(function(){var e=this,m=a.extend(true,{},a.fn.jPicker.defaults,b);if(a(e).get(0).nodeName.toLowerCase()=="input"){a.extend(true,m,{window:{bindToInput:true,expandable:true,input:a(e)}});if(a(e).val()==
""){m.color.active=new c({hex:null});m.color.current=new c({hex:null})}else if(n.validateHex(a(e).val())){m.color.active=new c({hex:a(e).val(),a:m.color.active.val("a")});m.color.current=new c({hex:a(e).val(),a:m.color.active.val("a")})}}if(m.window.expandable)a(e).after('<span class="jPicker"><span class="Icon"><span class="Color">&nbsp;</span><span class="Alpha">&nbsp;</span><span class="Image" title="Click To Open Color Picker">&nbsp;</span><span class="Container">&nbsp;</span></span></span>');
else m.window.liveUpdate=false;var q=parseFloat(navigator.appVersion.split("MSIE")[1])<7&&document.body.filters,v=null,p=null,I=null,V=null,M=null,H=null,aa=null,T=null,P=null,R=null,ea=null,S=null,X=null,ba=null,la=null,ka=null,da=null,Z=null,Y=null,ma=null,ua=null,ha=null,qa=null,Ga=null,Ma=null,Ra=null,Qa=null,Va=null,Xa=function(Q){var J=va.active,ga=J.val("hex"),Oa,Za;m.color.mode=Q;switch(Q){case "h":setTimeout(function(){ab.call(e,p,"transparent");Ka.call(e,V,0);Da.call(e,V,100);Ka.call(e,
M,260);Da.call(e,M,100);ab.call(e,I,"transparent");Ka.call(e,aa,0);Da.call(e,aa,100);Ka.call(e,T,260);Da.call(e,T,100);Ka.call(e,P,260);Da.call(e,P,100);Ka.call(e,R,260);Da.call(e,R,100);Ka.call(e,S,260);Da.call(e,S,100)},0);X.range("all",{minX:0,maxX:100,minY:0,maxY:100});ba.range("rangeY",{minY:0,maxY:360});if(J.val("ahex")==null)break;X.val("xy",{x:J.val("s"),y:100-J.val("v")},X);ba.val("y",360-J.val("h"),ba);break;case "s":setTimeout(function(){ab.call(e,p,"transparent");Ka.call(e,V,-260);Ka.call(e,
M,-520);Ka.call(e,aa,-260);Ka.call(e,T,-520);Ka.call(e,S,260);Da.call(e,S,100)},0);X.range("all",{minX:0,maxX:360,minY:0,maxY:100});ba.range("rangeY",{minY:0,maxY:100});if(J.val("ahex")==null)break;X.val("xy",{x:J.val("h"),y:100-J.val("v")},X);ba.val("y",100-J.val("s"),ba);break;case "v":setTimeout(function(){ab.call(e,p,"000000");Ka.call(e,V,-780);Ka.call(e,M,260);ab.call(e,I,ga);Ka.call(e,aa,-520);Ka.call(e,T,260);Da.call(e,T,100);Ka.call(e,S,260);Da.call(e,S,100)},0);X.range("all",{minX:0,maxX:360,
minY:0,maxY:100});ba.range("rangeY",{minY:0,maxY:100});if(J.val("ahex")==null)break;X.val("xy",{x:J.val("h"),y:100-J.val("s")},X);ba.val("y",100-J.val("v"),ba);break;case "r":Oa=-1040;Za=-780;X.range("all",{minX:0,maxX:255,minY:0,maxY:255});ba.range("rangeY",{minY:0,maxY:255});if(J.val("ahex")==null)break;X.val("xy",{x:J.val("b"),y:255-J.val("g")},X);ba.val("y",255-J.val("r"),ba);break;case "g":Oa=-1560;Za=-1820;X.range("all",{minX:0,maxX:255,minY:0,maxY:255});ba.range("rangeY",{minY:0,maxY:255});
if(J.val("ahex")==null)break;X.val("xy",{x:J.val("b"),y:255-J.val("r")},X);ba.val("y",255-J.val("g"),ba);break;case "b":Oa=-2080;Za=-2860;X.range("all",{minX:0,maxX:255,minY:0,maxY:255});ba.range("rangeY",{minY:0,maxY:255});if(J.val("ahex")==null)break;X.val("xy",{x:J.val("r"),y:255-J.val("g")},X);ba.val("y",255-J.val("b"),ba);break;case "a":setTimeout(function(){ab.call(e,p,"transparent");Ka.call(e,V,-260);Ka.call(e,M,-520);Ka.call(e,aa,260);Ka.call(e,T,260);Da.call(e,T,100);Ka.call(e,S,0);Da.call(e,
S,100)},0);X.range("all",{minX:0,maxX:360,minY:0,maxY:100});ba.range("rangeY",{minY:0,maxY:255});if(J.val("ahex")==null)break;X.val("xy",{x:J.val("h"),y:100-J.val("v")},X);ba.val("y",255-J.val("a"),ba);break;default:throw"Invalid Mode";}switch(Q){case "s":case "v":case "a":setTimeout(function(){Da.call(e,V,100);Da.call(e,aa,100);Ka.call(e,P,260);Da.call(e,P,100);Ka.call(e,R,260);Da.call(e,R,100)},0);break;case "r":case "g":case "b":setTimeout(function(){ab.call(e,p,"transparent");ab.call(e,I,"transparent");
Da.call(e,aa,100);Da.call(e,V,100);Ka.call(e,V,Oa);Ka.call(e,M,Oa-260);Ka.call(e,aa,Za-780);Ka.call(e,T,Za-520);Ka.call(e,P,Za);Ka.call(e,R,Za-260);Ka.call(e,S,260);Da.call(e,S,100)},0)}J.val("ahex")!=null&&Na.call(e,J)},Na=function(Q,J){if(J==null||J!=ba&&J!=X)zb.call(e,Q,J);setTimeout(function(){Ja.call(e,Q);Jb.call(e,Q);tb.call(e,Q)},0)},Ha=function(Q,J){var ga=va.active;if(!(J!=X&&ga.val()==null)){var Oa=Q.val("all");switch(m.color.mode){case "h":ga.val("sv",{s:Oa.x,v:100-Oa.y},J);break;case "s":case "a":ga.val("hv",
{h:Oa.x,v:100-Oa.y},J);break;case "v":ga.val("hs",{h:Oa.x,s:100-Oa.y},J);break;case "r":ga.val("gb",{g:255-Oa.y,b:Oa.x},J);break;case "g":ga.val("rb",{r:255-Oa.y,b:Oa.x},J);break;case "b":ga.val("rg",{r:Oa.x,g:255-Oa.y},J)}}},Pa=function(Q,J){var ga=va.active;if(!(J!=ba&&ga.val()==null))switch(m.color.mode){case "h":ga.val("h",{h:360-Q.val("y")},J);break;case "s":ga.val("s",{s:100-Q.val("y")},J);break;case "v":ga.val("v",{v:100-Q.val("y")},J);break;case "r":ga.val("r",{r:255-Q.val("y")},J);break;
case "g":ga.val("g",{g:255-Q.val("y")},J);break;case "b":ga.val("b",{b:255-Q.val("y")},J);break;case "a":ga.val("a",255-Q.val("y"),J)}},zb=function(Q,J){if(J!=X)switch(m.color.mode){case "h":var ga=Q.val("sv");X.val("xy",{x:ga!=null?ga.s:100,y:100-(ga!=null?ga.v:100)},J);break;case "s":case "a":ga=Q.val("hv");X.val("xy",{x:ga&&ga.h||0,y:100-(ga!=null?ga.v:100)},J);break;case "v":ga=Q.val("hs");X.val("xy",{x:ga&&ga.h||0,y:100-(ga!=null?ga.s:100)},J);break;case "r":ga=Q.val("bg");X.val("xy",{x:ga&&
ga.b||0,y:255-(ga&&ga.g||0)},J);break;case "g":ga=Q.val("br");X.val("xy",{x:ga&&ga.b||0,y:255-(ga&&ga.r||0)},J);break;case "b":ga=Q.val("rg");X.val("xy",{x:ga&&ga.r||0,y:255-(ga&&ga.g||0)},J)}if(J!=ba)switch(m.color.mode){case "h":ba.val("y",360-(Q.val("h")||0),J);break;case "s":ga=Q.val("s");ba.val("y",100-(ga!=null?ga:100),J);break;case "v":ga=Q.val("v");ba.val("y",100-(ga!=null?ga:100),J);break;case "r":ba.val("y",255-(Q.val("r")||0),J);break;case "g":ba.val("y",255-(Q.val("g")||0),J);break;case "b":ba.val("y",
255-(Q.val("b")||0),J);break;case "a":ga=Q.val("a");ba.val("y",255-(ga!=null?ga:255),J)}},Ja=function(Q){try{var J=Q.val("all");ma.css({backgroundColor:J&&"#"+J.hex||"transparent"});Da.call(e,ma,J&&Math.precision(J.a*100/255,4)||0)}catch(ga){}},Jb=function(Q){switch(m.color.mode){case "h":ab.call(e,p,(new c({h:Q.val("h")||0,s:100,v:100})).val("hex"));break;case "s":case "a":var J=Q.val("s");Da.call(e,M,100-(J!=null?J:100));break;case "v":J=Q.val("v");Da.call(e,V,J!=null?J:100);break;case "r":Da.call(e,
M,Math.precision((Q.val("r")||0)/255*100,4));break;case "g":Da.call(e,M,Math.precision((Q.val("g")||0)/255*100,4));break;case "b":Da.call(e,M,Math.precision((Q.val("b")||0)/255*100))}Q=Q.val("a");Da.call(e,H,Math.precision((255-(Q||0))*100/255,4))},tb=function(Q){switch(m.color.mode){case "h":var J=Q.val("a");Da.call(e,ea,Math.precision((255-(J||0))*100/255,4));break;case "s":J=Q.val("hva");var ga=new c({h:J&&J.h||0,s:100,v:J!=null?J.v:100});ab.call(e,I,ga.val("hex"));Da.call(e,T,100-(J!=null?J.v:
100));Da.call(e,ea,Math.precision((255-(J&&J.a||0))*100/255,4));break;case "v":J=Q.val("hsa");ga=new c({h:J&&J.h||0,s:J!=null?J.s:100,v:100});ab.call(e,I,ga.val("hex"));Da.call(e,ea,Math.precision((255-(J&&J.a||0))*100/255,4));break;case "r":case "g":case "b":ga=J=0;Q=Q.val("rgba");if(m.color.mode=="r"){J=Q&&Q.b||0;ga=Q&&Q.g||0}else if(m.color.mode=="g"){J=Q&&Q.b||0;ga=Q&&Q.r||0}else if(m.color.mode=="b"){J=Q&&Q.r||0;ga=Q&&Q.g||0}var Oa=ga>J?J:ga;Da.call(e,T,J>ga?Math.precision((J-ga)/(255-ga)*100,
4):0);Da.call(e,P,ga>J?Math.precision((ga-J)/(255-J)*100,4):0);Da.call(e,R,Math.precision(Oa/255*100,4));Da.call(e,ea,Math.precision((255-(Q&&Q.a||0))*100/255,4));break;case "a":J=Q.val("a");ab.call(e,I,Q.val("hex")||"000000");Da.call(e,ea,J!=null?0:100);Da.call(e,S,J!=null?100:0)}},ab=function(Q,J){Q.css({backgroundColor:J&&J.length==6&&"#"+J||"transparent"})},$a=function(Q,J){if(q&&(J.indexOf("AlphaBar.png")!=-1||J.indexOf("Bars.png")!=-1||J.indexOf("Maps.png")!=-1)){Q.attr("pngSrc",J);Q.css({backgroundImage:"none",
filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+J+"', sizingMethod='scale')"})}else Q.css({backgroundImage:"url('"+J+"')"})},Ka=function(Q,J){Q.css({top:J+"px"})},Da=function(Q,J){Q.css({visibility:J>0?"visible":"hidden"});if(J>0&&J<100)if(q){var ga=Q.attr("pngSrc");ga!=null&&(ga.indexOf("AlphaBar.png")!=-1||ga.indexOf("Bars.png")!=-1||ga.indexOf("Maps.png")!=-1)?Q.css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+ga+"', sizingMethod='scale') progid:DXImageTransform.Microsoft.Alpha(opacity="+
J+")"}):Q.css({opacity:Math.precision(J/100,4)})}else Q.css({opacity:Math.precision(J/100,4)});else if(J==0||J==100)if(q){ga=Q.attr("pngSrc");ga!=null&&(ga.indexOf("AlphaBar.png")!=-1||ga.indexOf("Bars.png")!=-1||ga.indexOf("Maps.png")!=-1)?Q.css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+ga+"', sizingMethod='scale')"}):Q.css({opacity:""})}else Q.css({opacity:""})},yb=function(){va.active.val("ahex",va.current.val("ahex"))},bb=function(){va.current.val("ahex",va.active.val("ahex"))},
Sa=function(Q){a(this).parents("tbody:first").find('input:radio[value!="'+Q.target.value+'"]').removeAttr("checked");Xa.call(e,Q.target.value)},gb=function(){yb.call(e)},Ia=function(){yb.call(e);m.window.expandable&&Kb.call(e);a.isFunction(Gb)&&Gb.call(e,va.active,qa)},rb=function(){bb.call(e);m.window.expandable&&Kb.call(e);a.isFunction(Fb)&&Fb.call(e,va.active,ha)},sb=function(){Ob.call(e)},mb=function(Q){var J=Q.val("hex");ua.css({backgroundColor:J&&"#"+J||"transparent"});Da.call(e,ua,Math.precision((Q.val("a")||
0)*100/255,4))},hb=function(Q){var J=Q.val("hex");Q=Q.val("va");Ma.css({backgroundColor:J&&"#"+J||"transparent"});Da.call(e,Ra,Math.precision((255-(Q&&Q.a||0))*100/255,4));if(m.window.bindToInput&&m.window.updateInputColor)m.window.input.css({backgroundColor:J&&"#"+J||"transparent",color:Q==null||Q.v>75?"#000000":"#ffffff"})},La=function(Q){ka=parseInt(v.css("left"));da=parseInt(v.css("top"));Z=Q.pageX;Y=Q.pageY;a(document).bind("mousemove",Wa).bind("mouseup",jb);Q.preventDefault()},Wa=function(Q){v.css({left:ka-
(Z-Q.pageX)+"px",top:da-(Y-Q.pageY)+"px"});m.window.expandable&&!a.support.boxModel&&v.prev().css({left:v.css("left"),top:v.css("top")});Q.stopPropagation();Q.preventDefault();return false},jb=function(Q){a(document).unbind("mousemove",Wa).unbind("mouseup",jb);Q.stopPropagation();Q.preventDefault();return false},Eb=function(Q){Q.preventDefault();Q.stopPropagation();va.active.val("ahex",a(this).attr("title")||null,Q.target);return false},Fb=a.isFunction(d[1])&&d[1]||null,nb=a.isFunction(d[2])&&d[2]||
null,Gb=a.isFunction(d[3])&&d[3]||null,Ob=function(){va.current.val("ahex",va.active.val("ahex"));var Q=function(){if(!(!m.window.expandable||a.support.boxModel)){var J=v.find("table:first");v.before("<iframe/>");v.prev().css({width:J.width(),height:v.height(),opacity:0,position:"absolute",left:v.css("left"),top:v.css("top")})}};if(m.window.expandable){a(document.body).children("div.jPicker.Container").css({zIndex:10});v.css({zIndex:20})}switch(m.window.effects.type){case "fade":v.fadeIn(m.window.effects.speed.show,
Q);break;case "slide":v.slideDown(m.window.effects.speed.show,Q);break;default:v.show(m.window.effects.speed.show,Q)}},Kb=function(){var Q=function(){m.window.expandable&&v.css({zIndex:10});!m.window.expandable||a.support.boxModel||v.prev().remove()};switch(m.window.effects.type){case "fade":v.fadeOut(m.window.effects.speed.hide,Q);break;case "slide":v.slideUp(m.window.effects.speed.hide,Q);break;default:v.hide(m.window.effects.speed.hide,Q)}},Ub=function(){var Q=m.window,J=Q.expandable?a(e).next().find(".Container:first"):
null;v=Q.expandable?a("<div/>"):a(e);v.addClass("jPicker Container");Q.expandable&&v.hide();v.get(0).onselectstart=function(Pb){if(Pb.target.nodeName.toLowerCase()!=="input")return false};var ga=va.active.val("all");if(Q.alphaPrecision<0)Q.alphaPrecision=0;else if(Q.alphaPrecision>2)Q.alphaPrecision=2;var Oa='<table class="jPicker" cellpadding="0" cellspacing="0"><tbody>'+(Q.expandable?'<tr><td class="Move" colspan="5">&nbsp;</td></tr>':"")+'<tr><td rowspan="9"><h2 class="Title">'+(Q.title||ia.text.title)+
'</h2><div class="Map"><span class="Map1">&nbsp;</span><span class="Map2">&nbsp;</span><span class="Map3">&nbsp;</span><img src="'+ra.clientPath+ra.colorMap.arrow.file+'" class="Arrow"/></div></td><td rowspan="9"><div class="Bar"><span class="Map1">&nbsp;</span><span class="Map2">&nbsp;</span><span class="Map3">&nbsp;</span><span class="Map4">&nbsp;</span><span class="Map5">&nbsp;</span><span class="Map6">&nbsp;</span><img src="'+ra.clientPath+ra.colorBar.arrow.file+'" class="Arrow"/></div></td><td colspan="2" class="Preview"><div class="prev_div">'+
ia.text.newColor+'<div class="color_preview"><span class="Active" title="'+ia.tooltips.colors.newColor+'">&nbsp;</span><span class="Current" title="'+ia.tooltips.colors.currentColor+'">&nbsp;</span></div></div>'+ia.text.currentColor+'</td><td rowspan="9" class="Button"><input type="button" class="Ok" value="'+ia.text.ok+'" title="'+ia.tooltips.buttons.ok+'"/><input type="button" class="Cancel" value="'+ia.text.cancel+'" title="'+ia.tooltips.buttons.cancel+'"/><div class="Grid">&nbsp;</div></td></tr><tr class="Hue"><td class="Radio"><label title="'+
ia.tooltips.hue.radio+'"><input type="radio" value="h"'+(m.color.mode=="h"?' checked="checked"':"")+'/>H:</label></td><td class="Text"><input type="text" maxlength="3" value="'+(ga!=null?ga.h:"")+'" title="'+ia.tooltips.hue.textbox+'"/>&nbsp;\u00ba</td></tr><tr class="Saturation"><td class="Radio"><label title="'+ia.tooltips.saturation.radio+'"><input type="radio" value="s"'+(m.color.mode=="s"?' checked="checked"':"")+'/>S:</label></td><td class="Text"><input type="text" maxlength="3" value="'+(ga!=
null?ga.s:"")+'" title="'+ia.tooltips.saturation.textbox+'"/>&nbsp;%</td></tr><tr class="Value"><td class="Radio"><label title="'+ia.tooltips.value.radio+'"><input type="radio" value="v"'+(m.color.mode=="v"?' checked="checked"':"")+'/>V:</label></td><td class="Text"><input type="text" maxlength="3" value="'+(ga!=null?ga.v:"")+'" title="'+ia.tooltips.value.textbox+'"/>&nbsp;%<br/><br/></td></tr><tr class="Red"><td class="Radio"><label title="'+ia.tooltips.red.radio+'"><input type="radio" value="r"'+
(m.color.mode=="r"?' checked="checked"':"")+'/>R:</label></td><td class="Text"><input type="text" maxlength="3" value="'+(ga!=null?ga.r:"")+'" title="'+ia.tooltips.red.textbox+'"/></td></tr><tr class="Green"><td class="Radio"><label title="'+ia.tooltips.green.radio+'"><input type="radio" value="g"'+(m.color.mode=="g"?' checked="checked"':"")+'/>G:</label></td><td class="Text"><input type="text" maxlength="3" value="'+(ga!=null?ga.g:"")+'" title="'+ia.tooltips.green.textbox+'"/></td></tr><tr class="Blue"><td class="Radio"><label title="'+
ia.tooltips.blue.radio+'"><input type="radio" value="b"'+(m.color.mode=="b"?' checked="checked"':"")+'/>B:</label></td><td class="Text"><input type="text" maxlength="3" value="'+(ga!=null?ga.b:"")+'" title="'+ia.tooltips.blue.textbox+'"/></td></tr><tr class="Alpha"><td class="Radio">'+(Q.alphaSupport?'<label title="'+ia.tooltips.alpha.radio+'"><input type="radio" value="a"'+(m.color.mode=="a"?' checked="checked"':"")+"/>A:</label>":"&nbsp;")+'</td><td class="Text">'+(Q.alphaSupport?'<input type="text" maxlength="'+
(3+Q.alphaPrecision)+'" value="'+(ga!=null?Math.precision(ga.a*100/255,Q.alphaPrecision):"")+'" title="'+ia.tooltips.alpha.textbox+'"/>&nbsp;%':"&nbsp;")+'</td></tr><tr class="Hex"><td colspan="2" class="Text"><label title="'+ia.tooltips.hex.textbox+'">#:<input type="text" maxlength="6" class="Hex" value="'+(ga!=null?ga.hex:"")+'"/></label>'+(Q.alphaSupport?'<input type="text" maxlength="2" class="AHex" value="'+(ga!=null?ga.ahex.substring(6):"")+'" title="'+ia.tooltips.hex.alpha+'"/></td>':"&nbsp;")+
"</tr></tbody></table>";if(Q.expandable){v.html(Oa);a(document.body).children("div.jPicker.Container").length==0?a(document.body).prepend(v):a(document.body).children("div.jPicker.Container:last").after(v);v.mousedown(function(){a(document.body).children("div.jPicker.Container").css({zIndex:10});v.css({zIndex:20})});v.css({left:Q.position.x=="left"?J.offset().left-530-(Q.position.y=="center"?25:0)+"px":Q.position.x=="center"?J.offset().left-260+"px":Q.position.x=="right"?J.offset().left-10+(Q.position.y==
"center"?25:0)+"px":Q.position.x=="screenCenter"?(a(document).width()>>1)-260+"px":J.offset().left+parseInt(Q.position.x)+"px",position:"absolute",top:Q.position.y=="top"?J.offset().top-312+"px":Q.position.y=="center"?J.offset().top-156+"px":Q.position.y=="bottom"?J.offset().top+25+"px":J.offset().top+parseInt(Q.position.y)+"px"})}else{v=a(e);v.html(Oa)}Oa=v.find("tbody:first");p=Oa.find("div.Map:first");I=Oa.find("div.Bar:first");var Za=p.find("span"),fb=I.find("span");V=Za.filter(".Map1:first");
M=Za.filter(".Map2:first");H=Za.filter(".Map3:first");aa=fb.filter(".Map1:first");T=fb.filter(".Map2:first");P=fb.filter(".Map3:first");R=fb.filter(".Map4:first");ea=fb.filter(".Map5:first");S=fb.filter(".Map6:first");X=new o(p,{map:{width:ra.colorMap.width,height:ra.colorMap.height},arrow:{image:ra.clientPath+ra.colorMap.arrow.file,width:ra.colorMap.arrow.width,height:ra.colorMap.arrow.height}});X.bind(Ha);ba=new o(I,{map:{width:ra.colorBar.width,height:ra.colorBar.height},arrow:{image:ra.clientPath+
ra.colorBar.arrow.file,width:ra.colorBar.arrow.width,height:ra.colorBar.arrow.height}});ba.bind(Pa);la=new f(Oa,va.active,Q.expandable&&Q.bindToInput?Q.input:null,Q.alphaPrecision);Za=ga!=null?ga.hex:null;var wb=Oa.find(".Preview");fb=Oa.find(".Button");ma=wb.find(".Active:first").css({backgroundColor:Za&&"#"+Za||"transparent"});ua=wb.find(".Current:first").css({backgroundColor:Za&&"#"+Za||"transparent"}).bind("click",gb);Da.call(e,ua,Math.precision(va.current.val("a")*100)/255,4);ha=fb.find(".Ok:first").bind("click",
rb);qa=fb.find(".Cancel:first").bind("click",Ia);Ga=fb.find(".Grid:first");setTimeout(function(){$a.call(e,V,ra.clientPath+"Maps.png");$a.call(e,M,ra.clientPath+"Maps.png");$a.call(e,H,ra.clientPath+"map-opacity.png");$a.call(e,aa,ra.clientPath+"Bars.png");$a.call(e,T,ra.clientPath+"Bars.png");$a.call(e,P,ra.clientPath+"Bars.png");$a.call(e,R,ra.clientPath+"Bars.png");$a.call(e,ea,ra.clientPath+"bar-opacity.png");$a.call(e,S,ra.clientPath+"AlphaBar.png");$a.call(e,wb.find("div:last"),ra.clientPath+
"preview-opacity.png")},0);Oa.find("td.Radio input").bind("click",Sa);if(va.quickList&&va.quickList.length>0){fb="";for(i=0;i<va.quickList.length;i++){if((typeof va.quickList[i]).toString().toLowerCase()=="string")va.quickList[i]=new c({hex:va.quickList[i]});var xb=va.quickList[i].val("a"),Db=va.quickList[i].val("ahex");if(!Q.alphaSupport&&Db)Db=Db.substring(0,6)+"ff";var pb=va.quickList[i].val("hex");fb+='<span class="QuickColor"'+(Db&&' title="#'+Db+'"'||"")+' style="background-color:'+(pb&&"#"+
pb||"")+";"+(pb?"":"background-image:url("+ra.clientPath+"NoColor.png)")+(Q.alphaSupport&&xb&&xb<255?";opacity:"+Math.precision(xb/255,4)+";filter:Alpha(opacity="+Math.precision(xb/2.55,4)+")":"")+'">&nbsp;</span>'}$a.call(e,Ga,ra.clientPath+"bar-opacity.png");Ga.html(fb);Ga.find(".QuickColor").click(Eb)}Xa.call(e,m.color.mode);va.active.bind(Na);a.isFunction(nb)&&va.active.bind(nb);va.current.bind(mb);if(Q.expandable){e.icon=J.parents(".Icon:first");Ma=e.icon.find(".Color:first").css({backgroundColor:Za&&
"#"+Za||"transparent"});Ra=e.icon.find(".Alpha:first");$a.call(e,Ra,ra.clientPath+"bar-opacity.png");Da.call(e,Ra,Math.precision((255-(ga!=null?ga.a:0))*100/255,4));Qa=e.icon.find(".Image:first").css({backgroundImage:"url('"+ra.clientPath+ra.picker.file+"')"}).bind("click",sb);if(Q.bindToInput&&Q.updateInputColor)Q.input.css({backgroundColor:Za&&"#"+Za||"transparent",color:ga==null||ga.v>75?"#000000":"#ffffff"});Va=Oa.find(".Move:first").bind("mousedown",La);va.active.bind(hb)}else Ob.call(e)},ra=
m.images,ia=m.localization,va={active:(typeof m.color.active).toString().toLowerCase()=="string"?new c({ahex:!m.window.alphaSupport&&m.color.active?m.color.active.substring(0,6)+"ff":m.color.active}):new c({ahex:!m.window.alphaSupport&&m.color.active.val("ahex")?m.color.active.val("ahex").substring(0,6)+"ff":m.color.active.val("ahex")}),current:(typeof m.color.active).toString().toLowerCase()=="string"?new c({ahex:!m.window.alphaSupport&&m.color.active?m.color.active.substring(0,6)+"ff":m.color.active}):
new c({ahex:!m.window.alphaSupport&&m.color.active.val("ahex")?m.color.active.val("ahex").substring(0,6)+"ff":m.color.active.val("ahex")}),quickList:m.color.quickList};a.extend(true,e,{commitCallback:Fb,liveCallback:nb,cancelCallback:Gb,color:va,show:Ob,hide:Kb,destroy:function(){v.find("td.Radio input").unbind("click",Sa);ua.unbind("click",gb);qa.unbind("click",Ia);ha.unbind("click",rb);if(m.window.expandable){Qa.unbind("click",sb);Va.unbind("mousedown",La);e.icon=null}v.find(".QuickColor").unbind("click",
Eb);S=ea=R=P=T=aa=H=M=V=I=p=null;X.destroy();X=null;ba.destroy();ba=null;la.destroy();nb=Gb=Fb=Ga=qa=ha=ua=ma=la=null;v.html("");for(i=0;i<l.length;i++)l[i]==e&&l.splice(i,1)}});l.push(e);setTimeout(function(){Ub.call(e)},0)})};a.fn.jPicker.defaults={window:{title:null,effects:{type:"slide",speed:{show:"slow",hide:"fast"}},position:{x:"screenCenter",y:"top"},expandable:false,liveUpdate:true,alphaSupport:false,alphaPrecision:0,updateInputColor:true},color:{mode:"h",active:new c({ahex:"#ffcc00ff"}),
quickList:[new c({h:360,s:33,v:100}),new c({h:360,s:66,v:100}),new c({h:360,s:100,v:100}),new c({h:360,s:100,v:75}),new c({h:360,s:100,v:50}),new c({h:180,s:0,v:100}),new c({h:30,s:33,v:100}),new c({h:30,s:66,v:100}),new c({h:30,s:100,v:100}),new c({h:30,s:100,v:75}),new c({h:30,s:100,v:50}),new c({h:180,s:0,v:90}),new c({h:60,s:33,v:100}),new c({h:60,s:66,v:100}),new c({h:60,s:100,v:100}),new c({h:60,s:100,v:75}),new c({h:60,s:100,v:50}),new c({h:180,s:0,v:80}),new c({h:90,s:33,v:100}),new c({h:90,
s:66,v:100}),new c({h:90,s:100,v:100}),new c({h:90,s:100,v:75}),new c({h:90,s:100,v:50}),new c({h:180,s:0,v:70}),new c({h:120,s:33,v:100}),new c({h:120,s:66,v:100}),new c({h:120,s:100,v:100}),new c({h:120,s:100,v:75}),new c({h:120,s:100,v:50}),new c({h:180,s:0,v:60}),new c({h:150,s:33,v:100}),new c({h:150,s:66,v:100}),new c({h:150,s:100,v:100}),new c({h:150,s:100,v:75}),new c({h:150,s:100,v:50}),new c({h:180,s:0,v:50}),new c({h:180,s:33,v:100}),new c({h:180,s:66,v:100}),new c({h:180,s:100,v:100}),
new c({h:180,s:100,v:75}),new c({h:180,s:100,v:50}),new c({h:180,s:0,v:40}),new c({h:210,s:33,v:100}),new c({h:210,s:66,v:100}),new c({h:210,s:100,v:100}),new c({h:210,s:100,v:75}),new c({h:210,s:100,v:50}),new c({h:180,s:0,v:30}),new c({h:240,s:33,v:100}),new c({h:240,s:66,v:100}),new c({h:240,s:100,v:100}),new c({h:240,s:100,v:75}),new c({h:240,s:100,v:50}),new c({h:180,s:0,v:20}),new c({h:270,s:33,v:100}),new c({h:270,s:66,v:100}),new c({h:270,s:100,v:100}),new c({h:270,s:100,v:75}),new c({h:270,
s:100,v:50}),new c({h:180,s:0,v:10}),new c({h:300,s:33,v:100}),new c({h:300,s:66,v:100}),new c({h:300,s:100,v:100}),new c({h:300,s:100,v:75}),new c({h:300,s:100,v:50}),new c({h:180,s:0,v:0}),new c({h:330,s:33,v:100}),new c({h:330,s:66,v:100}),new c({h:330,s:100,v:100}),new c({h:330,s:100,v:75}),new c({h:330,s:100,v:50}),new c]},images:{clientPath:"/jPicker/images/",colorMap:{width:256,height:256,arrow:{file:"mappoint.gif",width:15,height:15}},colorBar:{width:20,height:256,arrow:{file:"rangearrows.gif",
width:20,height:7}},picker:{file:"picker.gif",width:25,height:24}},localization:{text:{title:"Drag Markers To Pick A Color",newColor:"new",currentColor:"current",ok:"OK",cancel:"Cancel"},tooltips:{colors:{newColor:"New Color - Press &ldquo;OK&rdquo; To Commit",currentColor:"Click To Revert To Original Color"},buttons:{ok:"Commit To This Color Selection",cancel:"Cancel And Revert To Original Color"},hue:{radio:"Set To &ldquo;Hue&rdquo; Color Mode",textbox:"Enter A &ldquo;Hue&rdquo; Value (0-360&deg;)"},
saturation:{radio:"Set To &ldquo;Saturation&rdquo; Color Mode",textbox:"Enter A &ldquo;Saturation&rdquo; Value (0-100%)"},value:{radio:"Set To &ldquo;Value&rdquo; Color Mode",textbox:"Enter A &ldquo;Value&rdquo; Value (0-100%)"},red:{radio:"Set To &ldquo;Red&rdquo; Color Mode",textbox:"Enter A &ldquo;Red&rdquo; Value (0-255)"},green:{radio:"Set To &ldquo;Green&rdquo; Color Mode",textbox:"Enter A &ldquo;Green&rdquo; Value (0-255)"},blue:{radio:"Set To &ldquo;Blue&rdquo; Color Mode",textbox:"Enter A &ldquo;Blue&rdquo; Value (0-255)"},
alpha:{radio:"Set To &ldquo;Alpha&rdquo; Color Mode",textbox:"Enter A &ldquo;Alpha&rdquo; Value (0-100)"},hex:{textbox:"Enter A &ldquo;Hex&rdquo; Color Value (#000000-#ffffff)",alpha:"Enter A &ldquo;Alpha&rdquo; Value (#00-#ff)"}}}}})(jQuery,"1.1.6");(function(a){function o(l){var n=l||window.event,b=[].slice.call(arguments,1),d=0,e=0,m=0;l=a.event.fix(n);l.type="mousewheel";if(n.wheelDelta)d=n.wheelDelta/120;if(n.detail)d=-n.detail/3;m=d;if(n.axis!==undefined&&n.axis===n.HORIZONTAL_AXIS){m=0;e=-1*d}if(n.wheelDeltaY!==undefined)m=n.wheelDeltaY/120;if(n.wheelDeltaX!==undefined)e=-1*n.wheelDeltaX/120;b.unshift(l,d,e,m);return(a.event.dispatch||a.event.handle).apply(this,b)}var f=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var c=f.length;c;)a.event.fixHooks[f[--c]]=
a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var l=f.length;l;)this.addEventListener(f[--l],o,false);else this.onmousewheel=o},teardown:function(){if(this.removeEventListener)for(var l=f.length;l;)this.removeEventListener(f[--l],o,false);else this.onmousewheel=null}};a.fn.extend({mousewheel:function(l){return l?this.bind("mousewheel",l):this.trigger("mousewheel")},unmousewheel:function(l){return this.unbind("mousewheel",l)}})})(jQuery);svgEditor.addExtension("eyedropper",function(a){function o(b){if(f.getMode()!="eyedropper"){var d=$("#tool_eyedropper");b.elems[0]&&$.inArray(b.elems[0].nodeName,["svg","g","use"])==-1?d.removeClass("disabled"):d.addClass("disabled")}}var f=svgEditor.canvas,c=svgedit.history.ChangeElementCommand,l={fillPaint:"red",fillOpacity:1,strokePaint:"black",strokeOpacity:1,strokeWidth:5,strokeDashArray:null,opacity:1,strokeLinecap:"butt",strokeLinejoin:"miter"},n=function(b,d,e){var m=null;console.log(b);if(b.indexOf("url(#")===
0){b=(b=f.getRefElem(b))?b.cloneNode(true):$("#"+e+"_color defs *")[0];m={alpha:d};m[b.tagName]=b}else m=b.indexOf("#")===0?{alpha:d,solidColor:b.substr(1)}:{alpha:d,solidColor:"none"};return new $.jGraduate.Paint(m)};return{name:"eyedropper",svgicons:"extensions/eyedropper-icon.xml",buttons:[{id:"tool_eyedropper",type:"mode",title:"Eye Dropper Tool",key:"I","class":"disabled",events:{click:function(){f.setMode("eyedropper")}}}],selectedChanged:o,elementChanged:o,mouseDown:function(b){var d=f.getMode(),
e=b.event;e=e.target.id==="svgroot"?document.getElementById("canvas_background"):e.target;if(d=="eyedropper"&&e){l.fillPaint=e.getAttribute("fill")||"white";l.fillOpacity=e.getAttribute("fill-opacity")||1;l.strokePaint=e.getAttribute("stroke")||"none";l.strokeOpacity=e.getAttribute("stroke-opacity")||1;l.strokeWidth=e.getAttribute("stroke-width");l.strokeDashArray=e.getAttribute("stroke-dasharray");l.strokeLinecap=e.getAttribute("stroke-linecap");l.strokeLinejoin=e.getAttribute("stroke-linejoin");
l.opacity=e.getAttribute("opacity")||1;if($.inArray(b.selectedElements.nodeName,["g","use"])==-1){var m={},q=function(p,I,V){m[I]=p.getAttribute(I);p.setAttribute(I,V)},v=new a.BatchCommand;b.selectedElements.forEach(function(p){l.fillPaint&&q(p,"fill",l.fillPaint);l.fillOpacity&&q(p,"fill-opacity",l.fillOpacity);l.strokePaint&&q(p,"stroke",l.strokePaint);l.strokeOpacity&&q(p,"stroke-opacity",l.strokeOpacity);l.strokeWidth&&q(p,"stroke-width",l.strokeWidth);l.strokeDashArray&&q(p,"stroke-dasharray",
l.strokeDashArray);l.opacity&&q(p,"opacity",l.opacity);l.strokeLinecap&&q(p,"stroke-linecap",l.strokeLinecap);l.strokeLinejoin&&q(p,"stroke-linejoin",l.strokeLinejoin);v.addSubCommand(new c(p,m));console.log(m);m={}});n(l.fillPaint,l.fillOpacity*100,"fill");n(l.strokePaint,l.strokeOpacity*100,"stroke");svgEditor.paintBox.fill.update(true);svgEditor.paintBox.stroke.update(true);f.undoMgr.addCommandToHistory(v)}}}}});svgEditor.addExtension("Markers",function(a){function o(R,ea){var S=R.getAttribute(ea);if(!S)return null;S=S.match(/\(\#(.*)\)/);if(!S||S.length!==2)return null;return a.getElem(S[1])}function f(R){$("#marker_panel").toggle(R);$("#marker_panel_title").length<1&&$("#marker_panel").prepend("<h4 id='marker_panel_title'>Arrows</h4>");if(R){var ea=V[0],S,X;$.each(M,function(ba,la){var ka=o(ea,"marker-"+la),da=$("#"+la+"_marker");if(ka){if(!ka.attributes.se_type)return;X=S="\\"+ka.attributes.se_type.textContent;
if(S=="\\textmarker")S=ka.lastChild.textContent;else da.hide()}else{X=S="\\nomarker";da.hide()}da.val(S);m(la,X)})}}function c(R,ea){var S=a.getElem(R);if(!S)if(!(ea==""||ea=="\\nomarker")){var X=V[0].getAttribute("stroke"),ba=50,la=50,ka="0 0 100 100",da=5,Z=5;se_type=ea.substr(0,1)=="\\"?ea.substr(1):"textmarker";if(T[se_type]){S=I({element:"marker",attr:{id:R,markerUnits:"strokeWidth",orient:"auto",style:"pointer-events:none",se_type:se_type}});if(se_type!="textmarker"){var Y=I(T[se_type]),ma=
X;if(se_type.substr(-2)=="_o")ma="none";Y.setAttribute("fill",ma);Y.setAttribute("stroke",X);Y.setAttribute("stroke-width",10);S.appendChild(Y)}else{Y=I(T[se_type]);Y.textContent=ea;ma=Y.getBBox();ma.x=0;ma.y=0;ma.width+=2;ma.height+=2;Y.setAttribute("x",1);Y.setAttribute("y",ma.height-1-ma.height/4);Y.setAttribute("fill",X);ba=ma.width/2+1;la=ma.height/2+1;ka=ma.x+" "+ma.y+" "+ma.width+" "+ma.height;da=ma.width/10;Z=ma.height/10;X=I({element:"rect",attr:{x:ma.x,y:ma.y,width:ma.width,height:ma.height,
fill:"#ffffff",stroke:"none","stroke-width":0}});S.setAttribute("orient",0);S.appendChild(X);S.appendChild(Y)}S.setAttribute("viewBox",ka);S.setAttribute("markerWidth",da);S.setAttribute("markerHeight",Z);S.setAttribute("refX",ba);S.setAttribute("refY",la);a.findDefs().appendChild(S);return S}}}function l(){var R={start_marker:"start",mid_marker:"mid",end_marker:"end"}[this.id],ea="marker-"+R,S=this.value,X=V[0],ba=o(X,ea);ba&&$(ba).remove();X.removeAttribute(ea);if(S=="")S="\\nomarker";if(S=="\\nomarker"){m(R,
S);a.call("changed",V)}else{ba=H+R+"_"+X.id;c(ba,S);svgCanvas.changeSelectedAttribute(ea,"url(#"+ba+")");X.tagName=="line"&&R=="mid"&&n(X);a.call("changed",V);m(R,S)}}function n(R){if(R.tagName!="line")return R;var ea=R.getAttribute("x1")-0,S=R.getAttribute("x2")-0,X=R.getAttribute("y1")-0,ba=R.getAttribute("y2")-0,la=R.id,ka=I({element:"polyline",attr:{points:ea+","+X+(" "+(ea+S)/2+","+(X+ba)/2+" ")+S+","+ba,stroke:R.getAttribute("stroke"),"stroke-width":R.getAttribute("stroke-width"),fill:"none",
opacity:R.getAttribute("opacity")||1}});$.each(M,function(da,Z){var Y="marker-"+Z;R.getAttribute(Y)&&ka.setAttribute(Y,R.getAttribute(Y))});ea=new a.BatchCommand;ea.addSubCommand(new a.RemoveElementCommand(R,R.parentNode));ea.addSubCommand(new a.InsertElementCommand(ka));$(R).after(ka).remove();svgCanvas.clearSelection();ka.id=la;svgCanvas.addToSelection([ka]);a.addCommandToHistory(ea);return ka}function b(R){var ea=R.getAttribute("stroke");$.each(M,function(S,X){var ba=o(R,"marker-"+X);if(ba)if(ba.attributes.se_type)if(ba=
ba.lastElementChild){var la=ba.getAttribute("fill"),ka=ba.getAttribute("stroke");la&&la!="none"&&ba.setAttribute("fill",ea);ka&&ka!="none"&&ba.setAttribute("stroke",ea)}})}function d(R){$.each(M,function(ea,S){var X=H+S+"_"+R.id,ba="marker-"+S,la=o(R,ba);if(la&&la.attributes.se_type)if(la=R.getAttribute(ba)){var ka=R.id.length;la=la.substr(-ka-1,ka);if(R.id!=la){la=$("#"+S+"_marker").attr("value");c(X,la);svgCanvas.changeSelectedAttribute(ba,"url(#"+X+")");if(R.tagName=="line"&&S=="mid")R=n(R);a.call("changed",
V)}}})}function e(R,ea){$("#"+R+"_marker").val(ea);$("#"+R+"_marker").change();$("#"+R+"_marker")}function m(R,ea){if(ea.substr(0,1)!="\\")ea="\\textmarker";var S="#"+aa+R+"_"+ea.substr(1);svgEditor.setIcon("#cur_"+R+"_marker_list",$(S).children());$(S).addClass("current").siblings().removeClass("current")}function q(R){var ea=$("#"+R+"_marker").val();if(ea.substr(0,1)=="\\")ea="";$.prompt("Enter text for "+R+" marker",ea,function(S){S&&e(R,S)})}function v(){var R=this.id.split("_"),ea=R[1],S=R[2];
if(R[3])S+="_"+R[3];S!="textmarker"?e(ea,"\\"+S):q(ea)}function p(R,ea){var S=P[R],X;for(X in S)if(S[X].id==ea)return S[X].title;return ea}var I=a.addSvgElementFromJson,V,M=["start","mid","end"],H="se_marker_",aa="mkr_",T={nomarker:{},leftarrow:{element:"path",attr:{d:"M0,50 L100,90 L70,50 L100,10 Z"}},rightarrow:{element:"path",attr:{d:"M100,50 L0,90 L30,50 L0,10 Z"}},textmarker:{element:"text",attr:{x:0,y:0,"stroke-width":0,stroke:"none","font-size":75,"font-family":"serif","text-anchor":"left",
"xml:space":"preserve"}},forwardslash:{element:"path",attr:{d:"M30,100 L70,0"}},reverseslash:{element:"path",attr:{d:"M30,0 L70,100"}},verticalslash:{element:"path",attr:{d:"M50,0 L50,100"}},box:{element:"path",attr:{d:"M20,20 L20,80 L80,80 L80,20 Z"}},star:{element:"path",attr:{d:"M10,30 L90,30 L20,90 L50,10 L80,90 Z"}},xmark:{element:"path",attr:{d:"M20,80 L80,20 M80,80 L20,20"}},triangle:{element:"path",attr:{d:"M10,80 L50,20 L80,80 Z"}},mcircle:{element:"circle",attr:{r:30,cx:50,cy:50}}},P={en:[{id:"start_marker_list",
title:"Select start marker type"},{id:"mid_marker_list",title:"Select mid marker type"},{id:"end_marker_list",title:"Select end marker type"},{id:"nomarker",title:"No Marker"},{id:"leftarrow",title:"Left Arrow"},{id:"rightarrow",title:"Right Arrow"},{id:"textmarker",title:"Text Marker"},{id:"forwardslash",title:"Forward Slash"},{id:"reverseslash",title:"Reverse Slash"},{id:"verticalslash",title:"Vertical Slash"},{id:"box",title:"Box"},{id:"star",title:"Star"},{id:"xmark",title:"X"},{id:"triangle",
title:"Triangle"},{id:"mcircle",title:"Circle"},{id:"leftarrow_o",title:"Open Left Arrow"},{id:"rightarrow_o",title:"Open Right Arrow"},{id:"box_o",title:"Open Box"},{id:"star_o",title:"Open Star"},{id:"triangle_o",title:"Open Triangle"},{id:"mcircle_o",title:"Open Circle"}]};$.each(["leftarrow","rightarrow","box","star","mcircle","triangle"],function(R,ea){T[ea+"_o"]=T[ea]});return{name:"Markers",svgicons:"extensions/markers-icons.xml",buttons:function(){var R=[];$.each(M,function(ea,S){var X=S+
"_marker_list",ba=true;$.each(T,function(la){var ka=p("en",la);R.push({id:aa+S+"_"+la,svgicon:la,title:ka,type:"context",events:{click:v},panel:"marker_panel",list:X,isDefault:ba});ba=false})});return R}(),context_tools:[{type:"input",panel:"marker_panel",title:"Start marker",id:"start_marker",label:"Start",size:3,events:{change:l}},{type:"button-select",panel:"marker_panel",title:p("en","start_marker_list"),id:"start_marker_list",colnum:3,events:{change:v}},{type:"input",panel:"marker_panel",title:"Middle marker",
id:"mid_marker",label:"Middle",defval:"",size:3,events:{change:l}},{type:"button-select",panel:"marker_panel",title:p("en","mid_marker_list"),id:"mid_marker_list",colnum:3,events:{change:v}},{type:"input",panel:"marker_panel",title:"End marker",id:"end_marker",label:"End",size:3,events:{change:l}},{type:"button-select",panel:"marker_panel",title:p("en","end_marker_list"),id:"end_marker_list",colnum:3,events:{change:v}}],callback:function(){$("#marker_panel").addClass("toolset").hide()},addLangData:function(R){return{data:P[R]}},
selectedChanged:function(R){V=R.elems;for(var ea=V.length,S=["line","path","polyline","polygon"];ea--;){var X=V[ea];if(X&&$.inArray(X.tagName,S)!=-1)R.selectedElement&&!R.multiselected?f(true):f(false);else f(false)}},elementChanged:function(R){if((R=R.elems[0])&&(R.getAttribute("marker-start")||R.getAttribute("marker-mid")||R.getAttribute("marker-end"))){b(R);d(R)}changing_flag=false}}});svgEditor.addExtension("view_grid",function(a){function o(e){b.attr("width");b.attr("height");var m=svgedit.units.getTypeMap()[svgEditor.curConfig.baseUnit],q=[0.01,0.1,1,10,100,1E3];svgCanvas.getContentElem().getAttribute("x");var v=l;m=m*e;var p=100/m,I=1;for(e=0;e<q.length;e++){var V=q[e];I=V;if(p<=V)break}q=I*m;v.width=q;v.height=q;m=v.getContext("2d");p=q/10;m.globalAlpha=0.2;m.strokeStyle="#000";for(e=1;e<10;e++){I=Math.round(p*e)+0.5;m.moveTo(I,q);m.lineTo(I,0);m.moveTo(q,I);m.lineTo(0,I)}m.stroke();
m.beginPath();m.globalAlpha=0.5;m.moveTo(0.5,q);m.lineTo(0.5,0);m.moveTo(q,0.5);m.lineTo(0,0.5);m.stroke();v=v.toDataURL("image/png");d.setAttribute("width",q);d.setAttribute("height",q);d.parentNode.setAttribute("width",q);d.parentNode.setAttribute("height",q);svgCanvas.setHref(d,v)}if(!document.getElementById("canvasGrid")){var f=document.getElementById("svgcanvas").ownerDocument,c=false;a=a.assignAttributes;var l=document.createElement("canvas");$(l).hide().appendTo("body");var n=f.createElementNS("http://www.w3.org/2000/svg",
"g");a(n,{id:"canvasGrid",width:"100%",height:"100%",x:0,y:0,overflow:"visible",display:"none"});var b=$("#canvas_background");b.after(n);n=f.createElementNS("http://www.w3.org/2000/svg","pattern");a(n,{id:"gridpattern",patternUnits:"userSpaceOnUse",x:0,y:0,width:100,height:100});var d=f.createElementNS("http://www.w3.org/2000/svg","image");a(d,{x:0,y:0,width:100,height:100});n.appendChild(d);$("#svgroot defs").append(n);f=f.createElementNS("http://www.w3.org/2000/svg","rect");a(f,{width:"100%",height:"100%",
x:0,y:0,"stroke-width":0,stroke:"none",fill:"url(#gridpattern)",style:"pointer-events: none; display:visible;"});$("#canvasGrid").append(f)}return{name:"view_grid",zoomChanged:function(e){c&&o(e)},buttons:[{id:"view_grid",type:"menu",after:"tool_wireframe",panel:"view_menu",title:"View Grid",events:{click:function(){if($("#view_grid").hasClass("push_button_pressed")){svgEditor.curConfig.showGrid=c=false;$("#view_grid").removeClass("push_button_pressed");$("#canvasGrid").attr("display","none")}else{svgEditor.curConfig.showGrid=
c=true;$("#view_grid").addClass("push_button_pressed");$("#canvasGrid").attr("display","normal");o(svgCanvas.getZoom())}}}}]}});svgEditor.addExtension("shapes",function(){function a(){$("#shape_buttons").empty();$("#shape_buttons").append(I.buttons)}function o(M){var H=p[M];if(H){I=H;H.buttons.length||f(M,H);a()}else{$("#shape_buttons").html("Loading...");$.getJSON("extensions/shapelib/"+M+".json",function(aa){I=p[M]={data:aa.data,size:aa.size,fill:aa.fill};f(M,aa);a()})}}function f(M,H){var aa=I.size||300,T=I.fill||false,P=aa*0.05;P=[-P,-P,aa+P*2,aa+P*2].join(" ");aa=T?0:aa/30;aa=(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg"><svg viewBox="'+
P+'"><path fill="#333" stroke="transparent" stroke-width="'+aa+'" /></svg></svg>',"text/xml");aa.documentElement.setAttribute("width",40);aa.documentElement.setAttribute("height",40);T=$(document.importNode(aa.documentElement,true));var R=H.data;I.buttons=[];for(var ea in R){var S=R[ea],X=T.clone();if(S.charAt(S.length-1)=="x"){aa=32;P=aa*0.05;P=[-P,-P,aa+P*2,aa+P*2].join(" ");X.find("svg").attr("viewBox",P);S.replace("x","")}X.find("path").attr("d",S);aa=X.wrap('<div class="tool_button">').parent().attr({id:V+
"_"+ea,title:ea});I.buttons.push(aa[0])}}var c,l,n=svgEditor.canvas,b,d,e,m=n.getRootElem(),q={},v={basic:"Basic",object:"Objects",symbol:"Symbols",arrow:"Arrows",flowchart:"Flowchart",nature:"Nature",game:"Cards & Chess",dialog_balloon:"Dialog balloons",music:"Music",weather:"Weather &amp; Time",ui:"User Interface",social:"Social Web"},p={basic:{data:{star_points_5:"m1,116.58409l113.82668,0l35.17332,-108.13487l35.17334,108.13487l113.82666,0l-92.08755,66.83026l35.17514,108.13487l-92.08759,-66.83208l-92.08757,66.83208l35.17515,-108.13487l-92.08758,-66.83026z",
donut:"m1,150l0,0c0,-82.29042 66.70958,-149 149,-149l0,0c39.51724,0 77.41599,15.69816 105.35889,43.64108c27.94293,27.94293 43.64111,65.84165 43.64111,105.35892l0,0c0,82.29041 -66.70958,149 -149,149l0,0c-82.29041,0 -149,-66.70959 -149,-149zm74.5,0l0,0c0,41.1452 33.35481,74.5 74.5,74.5c41.14522,0 74.5,-33.3548 74.5,-74.5c0,-41.1452 -33.3548,-74.5 -74.5,-74.5l0,0c-41.14519,0 -74.5,33.35481 -74.5,74.5z",triangle:"m1,280.375l149,-260.75l149,260.75z",right_triangle:"m1,299l0,-298l298,298z",diamond:"m1,150l149,-149l149,149l-149,149l-149,-149z",
pentagon:"m1.00035,116.97758l148.99963,-108.4053l148.99998,108.4053l-56.91267,175.4042l-184.1741,0l-56.91284,-175.4042z",hexagon:"m1,149.99944l63.85715,-127.71428l170.28572,0l63.85713,127.71428l-63.85713,127.71428l-170.28572,0l-63.85715,-127.71428z",septagon1:"m0.99917,191.06511l29.51249,-127.7108l119.48833,-56.83673l119.48836,56.83673l29.51303,127.7108l-82.69087,102.41679l-132.62103,0l-82.69031,-102.41679z",heptagon:"m1,88.28171l87.28172,-87.28171l123.43653,0l87.28172,87.28171l0,123.43654l-87.28172,87.28172l-123.43653,0l-87.28172,-87.28172l0,-123.43654z",
decagon:"m1,150.00093l28.45646,-88.40318l74.49956,-54.63682l92.08794,0l74.50002,54.63682l28.45599,88.40318l-28.45599,88.40318l-74.50002,54.63681l-92.08794,0l-74.49956,-54.63681l-28.45646,-88.40318z",dodecagon:"m1,110.07421l39.92579,-69.14842l69.14842,-39.92579l79.85159,0l69.14842,39.92579l39.92578,69.14842l0,79.85159l-39.92578,69.14842l-69.14842,39.92578l-79.85159,0l-69.14842,-39.92578l-39.92579,-69.14842l0,-79.85159z",trapezoid:"m1,299l55.875,-298l186.25001,0l55.87498,298z",dialog_balloon_1:"m0.99786,35.96579l0,0c0,-19.31077 15.28761,-34.96524 34.14583,-34.96524l15.52084,0l0,0l74.50001,0l139.68748,0c9.05606,0 17.74118,3.68382 24.14478,10.24108c6.40356,6.55726 10.00107,15.45081 10.00107,24.72416l0,87.41311l0,0l0,52.44785l0,0c0,19.31078 -15.2876,34.96524 -34.14584,34.96524l-139.68748,0l-97.32507,88.90848l22.82506,-88.90848l-15.52084,0c-18.85822,0 -34.14583,-15.65446 -34.14583,-34.96524l0,0l0,-52.44785l0,0z",
heart:"m150,73c61,-175 300,0 0,225c-300,-225 -61,-400 0,-225z",cylinder:"m299.0007,83.77844c0,18.28676 -66.70958,33.11111 -149.00002,33.11111m149.00002,-33.11111l0,0c0,18.28676 -66.70958,33.11111 -149.00002,33.11111c-82.29041,0 -148.99997,-14.82432 -148.99997,-33.11111m0,0l0,0c0,-18.28674 66.70956,-33.1111 148.99997,-33.1111c82.29044,0 149.00002,14.82436 149.00002,33.1111l0,132.44449c0,18.28674 -66.70958,33.11105 -149.00002,33.11105c-82.29041,0 -148.99997,-14.82431 -148.99997,-33.11105z",arrow_up:"m1.49805,149.64304l148.50121,-148.00241l148.50121,148.00241l-74.25061,0l0,148.71457l-148.5012,0l0,-148.71457z",
arrow_u_turn:"m1.00059,299.00055l0,-167.62497l0,0c0,-72.00411 58.37087,-130.37499 130.375,-130.37499l0,0l0,0c34.57759,0 67.73898,13.7359 92.18906,38.18595c24.45006,24.45005 38.18593,57.61144 38.18593,92.18904l0,18.625l37.24997,0l-74.49995,74.50002l-74.50002,-74.50002l37.25,0l0,-18.625c0,-30.8589 -25.0161,-55.87498 -55.87498,-55.87498l0,0l0,0c-30.85892,0 -55.875,25.01608 -55.875,55.87498l0,167.62497z",arrow_left_up:"m0.99865,224.5l74.50004,-74.5l0,37.25l111.74991,0l0,-111.75l-37.25,0l74.5,-74.5l74.5,74.5l-37.25,0l0,186.25l-186.24989,0l0,37.25l-74.50005,-74.5z",
plaque:"m-0.00197,49.94376l0,0c27.5829,0 49.94327,-22.36036 49.94327,-49.94327l199.76709,0l0,0c0,27.5829 22.36037,49.94327 49.94325,49.94327l0,199.7671l0,0c-27.58289,0 -49.94325,22.36034 -49.94325,49.94325l-199.76709,0c0,-27.58292 -22.36037,-49.94325 -49.94327,-49.94325z",page:"m249.3298,298.99744l9.9335,-39.73413l39.73413,-9.93355l-49.66763,49.66768l-248.33237,0l0,-298.00001l298.00001,0l0,248.33234",cross:"m0.99844,99.71339l98.71494,0l0,-98.71495l101.26279,0l0,98.71495l98.71495,0l0,101.2628l-98.71495,0l0,98.71494l-101.26279,0l0,-98.71494l-98.71494,0z",
divide:"m150,0.99785l0,0c25.17819,0 45.58916,20.41097 45.58916,45.58916c0,25.17821 -20.41096,45.58916 -45.58916,45.58916c-25.17822,0 -45.58916,-20.41093 -45.58916,-45.58916c0,-25.1782 20.41093,-45.58916 45.58916,-45.58916zm0,296.25203c-25.17822,0 -45.58916,-20.41095 -45.58916,-45.58917c0,-25.17819 20.41093,-45.58916 45.58916,-45.58916c25.17819,0 45.58916,20.41096 45.58916,45.58916c0,25.17822 -20.41096,45.58917 -45.58916,45.58917zm-134.06754,-193.71518l268.13507,0l0,91.17833l-268.13507,0z",minus:"m0.99887,102.39503l297.49445,0l0,95.2112l-297.49445,0z",
times:"m1.00089,73.36786l72.36697,-72.36697l76.87431,76.87368l76.87431,-76.87368l72.36765,72.36697l-76.87433,76.87431l76.87433,76.87431l-72.36765,72.36765l-76.87431,-76.87433l-76.87431,76.87433l-72.36697,-72.36765l76.87368,-76.87431l-76.87368,-76.87431z"},buttons:[]}},I=p.basic,V="shapelib";return{svgicons:"extensions/ext-shapes.xml",buttons:[{id:"tool_shapelib",type:"mode_flyout",position:6,title:"Shape library",events:{click:function(){n.setMode(V)}}}],callback:function(){var M=$('<div id="shape_buttons">');
$("#tools_shapelib > *").wrapAll(M);var H=$("#tools_shapelib_show");o("basic");$("#shape_buttons").mouseup(function(T){T=$(T.target).closest("div.tool_button");if(T.length){var P=T.children().clone().attr({width:24,height:24});H.children(":not(.flyout_arrow_horiz)").remove();H.append(P).attr("data-curopt","#"+T[0].id).mouseup();n.setMode(V);l=T[0].id.substr((V+"_").length);c=I.data[l];$(".tools_flyout").fadeOut()}});M=$('<div id="shape_cats">');var aa="";$.each(v,function(T,P){aa+="<div data-cat="+
T+">"+P+"</div>"});M.html(aa).children().bind("mouseup",function(){var T=$(this);T.siblings().removeClass("current");T.addClass("current");o(T.attr("data-cat"));return false});M.children().eq(0).addClass("current");$("#tools_shapelib").prepend(M);H.mouseup(function(){n.setMode(c?V:"select")});$("#tool_shapelib").remove();M=$("#tools_shapelib").height();$("#tools_shapelib").css({"margin-top":-(M/2),"margin-left":3})},mouseDown:function(M){if(n.getMode()===V){var H=d=M.start_x;M=e=M.start_y;var aa=
n.getStyle();b=n.addSvgElementFromJson({element:"path",curStyles:true,attr:{d:c,id:n.getNextId(),opacity:aa.opacity/2,style:"pointer-events:none"}});b.setAttribute("d",c);if(/[a-z]/.test(c)){c=I.data[l]=n.pathActions.convertPath(b);b.setAttribute("d",c);n.pathActions.fixEnd(b)}b.setAttribute("transform","translate("+H+","+M+") scale(0.005) translate("+-H+","+-M+")");n.recalculateDimensions(b);n.getTransformList(b);q=b.getBBox();totalScale={sx:1,sy:1};return{started:true}}},mouseMove:function(M){if(n.getMode()===
V){var H=n.getZoom(),aa=M.event,T=M.mouse_x/H,P=M.mouse_y/H;M=n.getTransformList(b);var R=b.getBBox();H=R.x;var ea=R.y,S=R.width,X=R.height,ba=T-d,la=P-e,ka={x:Math.min(d,T),y:Math.min(e,P),width:Math.abs(T-d),height:Math.abs(P-e)},da=R=0;X=X?(X+la)/X:1;S=S?(S+ba)/S:1;S=ka.width/q.width;X=ka.height/q.height;S=S||1;X=X||1;if(T<d)R=q.width;if(P<e)da=q.height;T=m.createSVGTransform();P=m.createSVGTransform();ka=m.createSVGTransform();T.setTranslate(-(H+R),-(ea+da));if(aa.shiftKey){replaced=true;aa=Math.min(Math.abs(S),
Math.abs(X));S=aa*(S<0?-1:1);X=aa*(X<0?-1:1);if(totalScale.sx!=totalScale.sy){aa=totalScale.sx>totalScale.sy?1:totalScale.sx/totalScale.sy;ba=totalScale.sy>totalScale.sx?1:totalScale.sy/totalScale.sx;S*=ba;X*=aa;console.log(aa,ba)}}totalScale.sx*=S;totalScale.sy*=X;P.setScale(S,X);ka.setTranslate(H+R,ea+da);M.appendItem(ka);M.appendItem(P);M.appendItem(T);n.recalculateDimensions(b);q=b.getBBox()}},mouseUp:function(M){if(n.getMode()===V){if(M.mouse_x==d&&M.mouse_y==e)return{keep:false,element:b,started:false};
n.setMode("select");return{keep:true,element:b,started:false}}}}});
