(function(a){function H(h){if(typeof h.data==="string"){var i=h.handler,u=h.data.toLowerCase().split(" ");h.handler=function(E){if(!(this!==E.target&&(/textarea|select/i.test(E.target.nodeName)||E.target.type==="text"))){var e=E.type!=="keypress"&&a.hotkeys.specialKeys[E.which],f=String.fromCharCode(E.which).toLowerCase(),g="",p={};if(E.altKey&&e!=="alt")g+="alt+";if(E.ctrlKey&&e!=="ctrl")g+="ctrl+";if(E.metaKey&&!E.ctrlKey&&e!=="meta")g+="meta+";if(E.shiftKey&&e!=="shift")g+="shift+";if(e)p[g+e]=
true;else{p[g+f]=true;p[g+a.hotkeys.shiftNums[f]]=true;if(g==="shift+")p[a.hotkeys.shiftNums[f]]=true}e=0;for(f=u.length;e<f;e++)if(p[u[e]])return i.apply(this,arguments)}}}}a.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",
106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta",219:"[",221:"]"},shiftNums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}};a.each(["keydown","keyup","keypress"],function(){a.event.special[this]={add:H}})})(jQuery);(function(a,H){function h(U){return typeof U==="string"}function i(U){var Z=g.call(arguments,1);return function(){return U.apply(this,Z.concat(g.call(arguments)))}}function u(U,Z,ea,ra,ja){var la;if(ra!==f){Z=ea.match(U?/^([^#]*)\#?(.*)$/:/^([^#?]*)\??([^#]*)(#?.*)/);ea=Z[3]||"";if(ja===2&&h(ra))ra=ra.replace(U?va:Na,"");else{la=q(Z[2]);ra=h(ra)?q[U?X:ka](ra):ra;ra=ja===2?ra:ja===1?a.extend({},ra,la):a.extend({},la,ra);ra=z(ra);if(U)ra=ra.replace(ha,p)}U=Z[1]+(U?"#":ra||!Z[1]?"?":"")+ra+ea}else U=
Z(ea!==f?ea:H[qa][ga]);return U}function E(U,Z,ea){if(Z===f||typeof Z==="boolean"){ea=Z;Z=z[U?X:ka]()}else Z=h(Z)?Z.replace(U?va:Na,""):Z;return q(Z,ea)}function e(U,Z,ea,ra){if(!h(ea)&&typeof ea!=="object"){ra=ea;ea=Z;Z=f}return this.each(function(){var ja=a(this),la=Z||ma()[(this.nodeName||"").toLowerCase()]||"",T=la&&ja.attr(la)||"";ja.attr(la,z[U](T,ea,ra))})}var f,g=Array.prototype.slice,p=decodeURIComponent,z=a.param,D,q,M,ba=a.bbq=a.bbq||{},N,I,ma,ia=a.event.special,ka="querystring",X="fragment",
qa="location",ga="href",Na=/^.*\?|#.*$/g,va=/^.*\#/,ha,Ra={};z[ka]=i(u,0,function(U){return U.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,"$1")});z[X]=D=i(u,1,function(U){return U.replace(/^[^#]*#?(.*)$/,"$1")});D.noEscape=function(U){U=U||"";U=a.map(U.split(""),encodeURIComponent);ha=RegExp(U.join("|"),"g")};D.noEscape(",/");a.deparam=q=function(U,Z){var ea={},ra={"true":true,"false":false,"null":null};a.each(U.replace(/\+/g," ").split("&"),function(ja,la){var T=la.split("="),wa=p(T[0]),Da=ea,Ma=0,Fa=wa.split("]["),
Oa=Fa.length-1;if(/\[/.test(Fa[0])&&/\]$/.test(Fa[Oa])){Fa[Oa]=Fa[Oa].replace(/\]$/,"");Fa=Fa.shift().split("[").concat(Fa);Oa=Fa.length-1}else Oa=0;if(T.length===2){T=p(T[1]);if(Z)T=T&&!isNaN(T)?+T:T==="undefined"?f:ra[T]!==f?ra[T]:T;if(Oa)for(;Ma<=Oa;Ma++){wa=Fa[Ma]===""?Da.length:Fa[Ma];Da=Da[wa]=Ma<Oa?Da[wa]||(Fa[Ma+1]&&isNaN(Fa[Ma+1])?{}:[]):T}else if(a.isArray(ea[wa]))ea[wa].push(T);else ea[wa]=ea[wa]!==f?[ea[wa],T]:T}else if(wa)ea[wa]=Z?f:""});return ea};q[ka]=i(E,0);q[X]=M=i(E,1);a.elemUrlAttr||
(a.elemUrlAttr=function(U){return a.extend(Ra,U)})({a:ga,base:ga,iframe:"src",img:"src",input:"src",form:"action",link:ga,script:"src"});ma=a.elemUrlAttr;a.fn[ka]=i(e,ka);a.fn[X]=i(e,X);ba.pushState=N=function(U,Z){if(h(U)&&/^#/.test(U)&&Z===f)Z=2;var ea=U!==f;ea=D(H[qa][ga],ea?U:{},ea?Z:2);H[qa][ga]=ea+(/#/.test(ea)?"":"#")};ba.getState=I=function(U,Z){return U===f||typeof U==="boolean"?M(U):M(Z)[U]};ba.removeState=function(U){var Z={};if(U!==f){Z=I();a.each(a.isArray(U)?U:arguments,function(ea,
ra){delete Z[ra]})}N(Z,2)};ia.hashchange=a.extend(ia.hashchange,{add:function(U){function Z(ra){var ja=ra[X]=D();ra.getState=function(la,T){return la===f||typeof la==="boolean"?q(ja,la):q(ja,T)[la]};ea.apply(this,arguments)}var ea;if(a.isFunction(U)){ea=U;return Z}else{ea=U.handler;U.handler=Z}}})})(jQuery,this);
(function(a,H,h){function i(D){D=D||H[e][f];return D.replace(/^[^#]*#?(.*)$/,"$1")}var u,E=a.event.special,e="location",f="href",g=document.documentMode,p=a.browser.msie&&(g===h||g<8),z="onhashchange"in H&&!p;a.hashchangeDelay=100;E.hashchange=a.extend(E.hashchange,{setup:function(){if(z)return false;a(u.start)},teardown:function(){if(z)return false;a(u.stop)}});u=function(){function D(){N=I=function(ma){return ma};if(p){ba=a('<iframe src="javascript:0"/>').hide().insertAfter("body")[0].contentWindow;
I=function(){return i(ba.document[e][f])};N=function(ma,ia){if(ma!==ia){var ka=ba.document;ka.open().close();ka[e].hash="#"+ma}};N(i())}}var q={},M,ba,N,I;q.start=function(){if(!M){var ma=i();N||D();(function ia(){var ka=i(),X=I(ma);if(ka!==ma){N(ma=ka,X);a(H).trigger("hashchange")}else if(X!==ma)H[e][f]=H[e][f].replace(/#.*/,"")+"#"+X;M=setTimeout(ia,a.hashchangeDelay)})()}};q.stop=function(){if(!ba){M&&clearTimeout(M);M=0}};return q}()})(jQuery,this);(function(a){var H={},h;a.svgIcons=function(i,u){function E(U,Z){if(U!=="ajax"){if(ma)return;var ea=(ba=ga[0].contentDocument)&&ba.getElementById("svg_eof");if(!ea&&!(Z&&ea)){ia++;if(ia<50)setTimeout(E,20);else{f();ma=true}return}ma=true}M=a(ba.firstChild).children();if(u.no_img)setTimeout(function(){I||e()},500);else{ea=qa+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNzUiIGhlaWdodD0iMjc1Ij48L3N2Zz4%3D";N=a(new Image).attr({src:ea,width:0,height:0}).appendTo("body").load(function(){e(true)}).error(function(){e()})}}
function e(U,Z){if(!I){if(u.no_img)U=false;if(U){var ea=a(document.createElement("div"));ea.hide().appendTo("body")}if(Z){var ra=u.fallback_path?u.fallback_path:"";a.each(Z,function(Oa,Qa){a("#"+Oa);var Ga=a(new Image).attr({"class":"svg_icon",src:ra+Qa,width:D,height:q,alt:"icon"});Ra(Ga,Oa)})}else for(var ja=M.length,la=0;la<ja;la++){var T=M[la],wa=T.id;if(wa==="svg_eof")break;a("#"+wa);T=T.getElementsByTagNameNS(p,"svg")[0];var Da=document.createElementNS(p,"svg");Da.setAttributeNS(p,"viewBox",
[0,0,D,q].join(" "));var Ma=T.getAttribute("width"),Fa=T.getAttribute("height");T.removeAttribute("width");T.removeAttribute("height");T.getAttribute("viewBox")||T.setAttribute("viewBox",[0,0,Ma,Fa].join(" "));Da.setAttribute("xmlns",p);Da.setAttribute("width",D);Da.setAttribute("height",q);Da.setAttribute("xmlns:xlink",z);Da.setAttribute("class","svg_icon");X||(T=T.cloneNode(true));Da.appendChild(T);if(U){X||Da.cloneNode(true);ea.empty().append(Da);T=qa+g(ea.html());T=a(new Image).attr({"class":"svg_icon",
src:T})}else T=h(a(Da),la);Ra(T,wa)}u.placement&&a.each(u.placement,function(Oa,Qa){H[Qa]&&a(Oa).each(function(Ga){var Ca=H[Qa].clone();if(Ga>0&&!U)Ca=h(Ca,Ga,true);ha(a(this),Ca,Qa)})});if(!Z){U&&ea.remove();ga&&ga.remove();N&&N.remove()}u.resize&&a.resizeSvgIcons(u.resize);I=true;u.callback&&u.callback(H)}}function f(){if(i.indexOf(".svgz")!=-1){var U=i.replace(".svgz",".svg");window.console&&console.log(".svgz failed, trying with .svg");a.svgIcons(U,u)}else u.fallback&&e(false,u.fallback)}function g(U){if(window.btoa)return window.btoa(U);
var Z=Array(Math.floor((U.length+2)/3)*4),ea,ra,ja,la,T,wa,Da=0,Ma=0;do{ea=U.charCodeAt(Da++);ra=U.charCodeAt(Da++);ja=U.charCodeAt(Da++);la=ea>>2;ea=(ea&3)<<4|ra>>4;T=(ra&15)<<2|ja>>6;wa=ja&63;if(isNaN(ra))T=wa=64;else if(isNaN(ja))wa=64;Z[Ma++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(la);Z[Ma++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(ea);Z[Ma++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(T);Z[Ma++]=
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(wa)}while(Da<U.length);return Z.join("")}var p="http://www.w3.org/2000/svg",z="http://www.w3.org/1999/xlink",D=u.w?u.w:24,q=u.h?u.h:24,M,ba,N,I=false,ma=false,ia=0,ka=navigator.userAgent,X=!!window.opera;ka.indexOf("Safari/")>-1&&ka.indexOf("Chrome/");var qa="data:image/svg+xml;charset=utf-8;base64,";if(u.svgz){var ga=a('<object data="'+i+'" type=image/svg+xml>').appendTo("body").hide();try{ba=ga[0].contentDocument;ga.load(E);
E(0,true)}catch(Na){f()}}else{var va=new DOMParser;a.ajax({url:i,dataType:"string",success:function(U){if(U){ba=va.parseFromString(U,"text/xml");a(function(){E("ajax")})}else a(f)},error:function(U){if(window.opera)a(function(){f()});else if(U.responseText){ba=va.parseFromString(U.responseText,"text/xml");ba.childNodes.length||a(f);a(function(){E("ajax")})}else a(f)}})}var ha=function(U,Z,ea,ra){X&&Z.css("visibility","hidden");if(u.replace){ra&&Z.attr("id",ea);(ea=U.attr("class"))&&Z.attr("class",
"svg_icon "+ea);U.replaceWith(Z)}else U.append(Z);X&&setTimeout(function(){Z.removeAttr("style")},1)},Ra=function(U,Z){if(u.id_match===undefined||u.id_match!==false)ha(holder,U,Z,true);H[Z]=U};h=function(U,Z){var ea=U.find("defs");if(!ea.length)return U;ea=X?ea.find("*").filter(function(){return!!this.id}):ea.find("[id]");var ra=U[0].getElementsByTagName("*"),ja=ra.length;ea.each(function(la){var T=this.id;a(ba).find("#"+T);this.id=la="x"+T+Z+la;T="url(#"+T+")";var wa="url(#"+la+")";for(la=0;la<ja;la++){var Da=
ra[la];Da.getAttribute("fill")===T&&Da.setAttribute("fill",wa);Da.getAttribute("stroke")===T&&Da.setAttribute("stroke",wa);Da.getAttribute("filter")===T&&Da.setAttribute("filter",wa)}});return U}};a.getSvgIcon=function(i,u){var E=H[i];if(u&&E)E=h(E,0,true).clone(true);return E};a.resizeSvgIcons=function(i){var u=!a(".svg_icon:first").length;a.each(i,function(E,e){var f=a.isArray(e),g=f?e[0]:e,p=f?e[1]:e;if(u)E=E.replace(/\.svg_icon/g,"svg");a(E).each(function(){this.setAttribute("width",g);this.setAttribute("height",
p);if(window.opera&&window.widget){this.parentNode.style.width=g+"px";this.parentNode.style.height=p+"px"}})})}})(jQuery);(function(){function a(i,u,E){i=document.createElementNS(H.svg,i);if(h)for(var e in u)i.setAttribute(e,u[e]);else for(e in u){var f=u[e],g=i[e];if(g&&g.constructor==="SVGLength")g.baseVal.value=f;else i.setAttribute(e,f)}E&&E.appendChild(i);return i}var H={svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"};if(!window.console)window.console=new function(){this.log=function(){};this.dir=function(){}};$.jGraduate={Paint:function(i){i=i||{};this.alpha=isNaN(i.alpha)?100:i.alpha;if(i.copy){this.type=
i.copy.type;this.alpha=i.copy.alpha;this.radialGradient=this.linearGradient=this.solidColor=null;switch(this.type){case "solidColor":this.solidColor=i.copy.solidColor;break;case "linearGradient":this.linearGradient=i.copy.linearGradient.cloneNode(true);break;case "radialGradient":this.radialGradient=i.copy.radialGradient.cloneNode(true)}}else if(i.linearGradient){this.type="linearGradient";this.radialGradient=this.solidColor=null;this.linearGradient=i.linearGradient.cloneNode(true)}else if(i.radialGradient){this.type=
"radialGradient";this.linearGradient=this.solidColor=null;this.radialGradient=i.radialGradient.cloneNode(true)}else if(i.solidColor){this.type="solidColor";this.solidColor=i.solidColor}else{this.type="none";this.radialGradient=this.linearGradient=this.solidColor=null}}};jQuery.fn.jGraduateDefaults={paint:new $.jGraduate.Paint,window:{pickerTitle:"Drag markers to pick a paint"},images:{clientPath:"images/"},newstop:"inverse"};var h=navigator.userAgent.indexOf("Gecko/")>=0;jQuery.fn.jGraduate=function(i){var u=
arguments;return this.each(function(){function E(pa,V,ua,ya,aa){var Sa=aa||a("stop",{"stop-color":V,"stop-opacity":ua,offset:pa},va);if(aa){V=aa.getAttribute("stop-color");ua=aa.getAttribute("stop-opacity");pa=aa.getAttribute("offset")}else va.appendChild(Sa);if(ua===null)ua=1;aa=a("path",{d:"M-6.2,0.9c3.6-4,6.7-4.3,6.7-12.4c-0.2,7.9,3.1,8.8,6.5,12.4c3.5,3.8,2.9,9.6,0,12.3c-3.1,2.8-10.4,2.7-13.2,0C-9.6,9.9-9.4,4.4-6.2,0.9z",fill:"url(#jGraduate_trans)",transform:"translate("+(10+pa*X)+", 26)"},zb);
var Eb=a("path",{d:"M-6.2,0.9c3.6-4,6.7-4.3,6.7-12.4c-0.2,7.9,3.1,8.8,6.5,12.4c3.5,3.8,2.9,9.6,0,12.3c-3.1,2.8-10.4,2.7-13.2,0C-9.6,9.9-9.4,4.4-6.2,0.9z",fill:V,"fill-opacity":ua,transform:"translate("+(10+pa*X)+", 26)",stroke:"#000","stroke-width":1.5},zb);$(Eb).mousedown(function(Ab){e(this);Va=gb;ma.mousemove(p).mouseup(f);Bb=Pb.offset();Ab.preventDefault();return false}).data("stop",Sa).data("bg",aa).dblclick(function(){$("div.jGraduate_LightBox").show();for(var Ab=this,wb=+Sa.getAttribute("stop-opacity")||
1,tb=Sa.getAttribute("stop-color")||1,Fb=(parseFloat(wb)*255).toString(16);Fb.length<2;)Fb="0"+Fb;V=tb.substr(1)+Fb;$("#"+q+"_jGraduate_stopPicker").css({left:100,bottom:15}).jPicker({window:{title:"Pick the start color and opacity for the gradient"},images:{clientPath:D.images.clientPath},color:{active:V,alphaSupport:true}},function(Qb){tb=Qb.val("hex")?"#"+Qb.val("hex"):"none";wb=Qb.val("a")!==null?Qb.val("a")/256:1;Ab.setAttribute("fill",tb);Ab.setAttribute("fill-opacity",wb);Sa.setAttribute("stop-color",
tb);Sa.setAttribute("stop-opacity",wb);$("div.jGraduate_LightBox").hide();$("#"+q+"_jGraduate_stopPicker").hide()},null,function(){$("div.jGraduate_LightBox").hide();$("#"+q+"_jGraduate_stopPicker").hide()})});$(va).find("stop").each(function(){var Ab=$(this);if(+this.getAttribute("offset")>pa){if(!V){var wb=this.getAttribute("stop-color"),tb=this.getAttribute("stop-opacity");Sa.setAttribute("stop-color",wb);Eb.setAttribute("fill",wb);Sa.setAttribute("stop-opacity",tb===null?1:tb);Eb.setAttribute("fill-opacity",
tb===null?1:tb)}Ab.before(Sa);return false}});ya&&e(Eb);return Sa}function e(pa){gb&&gb.setAttribute("stroke","#000");pa.setAttribute("stroke","blue");gb=pa;gb.parentNode.appendChild(gb)}function f(){ma.unbind("mousemove",p);if(ub.getAttribute("display")!=="none"){ub.setAttribute("display","none");var pa=$(gb),V=pa.data("stop");pa=pa.data("bg");$([gb,V,pa]).remove()}Va=null}function g(){var pa=Wa?"rotate("+Wa+","+Ia+","+kb+") ":"";Ua===1&&Ja===1?va.removeAttribute("gradientTransform"):va.setAttribute("gradientTransform",
pa+"translate("+-Ia*(Ua-1)+","+-kb*(Ja-1)+") scale("+Ua+","+Ja+")")}function p(pa){var V=pa.pageX-Bb.left;pa=pa.pageY-Bb.top;V=V<10?10:V>X+10?X+10:V;var ua="translate("+V+", 26)";if(pa<-60||pa>130){ub.setAttribute("display","block");ub.setAttribute("transform",ua)}else ub.setAttribute("display","none");Va.setAttribute("transform",ua);$.data(Va,"bg").setAttribute("transform",ua);$.data(Va,"stop").setAttribute("offset",(V-10)/X);var ya=0;$(va).find("stop").each(function(){var aa=this.getAttribute("offset"),
Sa=$(this);if(aa<ya){Sa.prev().before(Sa);Aa=$(va).find("stop")}ya=aa})}var z=$(this),D=$.extend(true,{},jQuery.fn.jGraduateDefaults,i),q=z.attr("id"),M="#"+z.attr("id")+" ";if(M){var ba=function(){switch(z.paint.type){case "radialGradient":z.paint.linearGradient=null;break;case "linearGradient":z.paint.radialGradient=null;break;case "solidColor":z.paint.radialGradient=z.paint.linearGradient=null}$.isFunction(z.okCallback)&&z.okCallback(z.paint);z.hide()},N=function(){$.isFunction(z.cancelCallback)&&
z.cancelCallback();z.hide()};$.extend(true,z,{paint:new $.jGraduate.Paint({copy:D.paint}),okCallback:$.isFunction(u[1])&&u[1]||null,cancelCallback:$.isFunction(u[2])&&u[2]||null});z.position();var I=null,ma=$(window);if(z.paint.type=="none")z.paint=$.jGraduate.Paint({solidColor:"ffffff"});z.addClass("jGraduate_Picker");z.html('<ul class="jGraduate_tabs"><li class="jGraduate_tab_color jGraduate_tab_current" data-type="col">Solid Color</li><li class="jGraduate_tab_lingrad" data-type="lg">Linear Gradient</li><li class="jGraduate_tab_radgrad" data-type="rg">Radial Gradient</li></ul><div class="jGraduate_colPick"></div><div class="jGraduate_gradPick"></div><div class="jGraduate_LightBox"></div><div id="'+
q+'_jGraduate_stopPicker" class="jGraduate_stopPicker"></div>');var ia=$(M+"> .jGraduate_colPick"),ka=$(M+"> .jGraduate_gradPick");ka.html('<div id="'+q+'_jGraduate_Swatch" class="jGraduate_Swatch"><h2 class="jGraduate_Title">'+D.window.pickerTitle+'</h2><div id="'+q+'_jGraduate_GradContainer" class="jGraduate_GradContainer"></div><div id="'+q+'_jGraduate_StopSlider" class="jGraduate_StopSlider"></div></div><div class="jGraduate_Form jGraduate_Points jGraduate_lg_field"><div class="jGraduate_StopSection"><label class="jGraduate_Form_Heading">Begin Point</label><div class="jGraduate_Form_Section"><label>x:</label><input type="text" id="'+
q+'_jGraduate_x1" size="3" title="Enter starting x value between 0.0 and 1.0"/><label> y:</label><input type="text" id="'+q+'_jGraduate_y1" size="3" title="Enter starting y value between 0.0 and 1.0"/></div></div><div class="jGraduate_StopSection"><label class="jGraduate_Form_Heading">End Point</label><div class="jGraduate_Form_Section"><label>x:</label><input type="text" id="'+q+'_jGraduate_x2" size="3" title="Enter ending x value between 0.0 and 1.0"/><label> y:</label><input type="text" id="'+
q+'_jGraduate_y2" size="3" title="Enter ending y value between 0.0 and 1.0"/></div></div></div><div class="jGraduate_Form jGraduate_Points jGraduate_rg_field"><div class="jGraduate_StopSection"><label class="jGraduate_Form_Heading">Center Point</label><div class="jGraduate_Form_Section"><label>x:</label><input type="text" id="'+q+'_jGraduate_cx" size="3" title="Enter x value between 0.0 and 1.0"/><label> y:</label><input type="text" id="'+q+'_jGraduate_cy" size="3" title="Enter y value between 0.0 and 1.0"/></div></div><div class="jGraduate_StopSection"><label class="jGraduate_Form_Heading">Focal Point</label><div class="jGraduate_Form_Section"><label>Match center: <input type="checkbox" checked="checked" id="'+
q+'_jGraduate_match_ctr"/></label><br/><label>x:</label><input type="text" id="'+q+'_jGraduate_fx" size="3" title="Enter x value between 0.0 and 1.0"/><label> y:</label><input type="text" id="'+q+'_jGraduate_fy" size="3" title="Enter y value between 0.0 and 1.0"/></div></div></div><div class="jGraduate_StopSection jGraduate_SpreadMethod"><label class="jGraduate_Form_Heading">Spread method</label><div class="jGraduate_Form_Section"><select class="jGraduate_spreadMethod"><option value=pad selected>Pad</option><option value=reflect>Reflect</option><option value=repeat>Repeat</option></select></div></div><div class="jGraduate_Form"><div class="jGraduate_Slider jGraduate_RadiusField jGraduate_rg_field"><label class="prelabel">Radius:</label><div id="'+
q+'_jGraduate_Radius" class="jGraduate_SliderBar jGraduate_Radius" title="Click to set radius"><img id="'+q+'_jGraduate_RadiusArrows" class="jGraduate_RadiusArrows" src="'+D.images.clientPath+'rangearrows2.gif"></div><label><input type="text" id="'+q+'_jGraduate_RadiusInput" size="3" value="100"/>%</label></div><div class="jGraduate_Slider jGraduate_EllipField jGraduate_rg_field"><label class="prelabel">Ellip:</label><div id="'+q+'_jGraduate_Ellip" class="jGraduate_SliderBar jGraduate_Ellip" title="Click to set Ellip"><img id="'+
q+'_jGraduate_EllipArrows" class="jGraduate_EllipArrows" src="'+D.images.clientPath+'rangearrows2.gif"></div><label><input type="text" id="'+q+'_jGraduate_EllipInput" size="3" value="0"/>%</label></div><div class="jGraduate_Slider jGraduate_AngleField jGraduate_rg_field"><label class="prelabel">Angle:</label><div id="'+q+'_jGraduate_Angle" class="jGraduate_SliderBar jGraduate_Angle" title="Click to set Angle"><img id="'+q+'_jGraduate_AngleArrows" class="jGraduate_AngleArrows" src="'+D.images.clientPath+
'rangearrows2.gif"></div><label><input type="text" id="'+q+'_jGraduate_AngleInput" size="3" value="0"/>\u00ba&nbsp;</label></div><div class="jGraduate_Slider jGraduate_OpacField"><label class="prelabel">Opac:</label><div id="'+q+'_jGraduate_Opac" class="jGraduate_SliderBar jGraduate_Opac" title="Click to set Opac"><img id="'+q+'_jGraduate_OpacArrows" class="jGraduate_OpacArrows" src="'+D.images.clientPath+'rangearrows2.gif"></div><label><input type="text" id="'+q+'_jGraduate_OpacInput" size="3" value="100"/>%</label></div></div><div class="jGraduate_OkCancel"><input type="button" id="'+
q+'_jGraduate_Ok" class="jGraduate_Ok" value="OK"/><input type="button" id="'+q+'_jGraduate_Cancel" class="jGraduate_Cancel" value="Cancel"/></div>');var X=256,qa=X-0,ga=X-0,Na,va,ha,Ra={};$(".jGraduate_SliderBar").width(145);var U=$("#"+q+"_jGraduate_GradContainer")[0],Z=a("svg",{id:q+"_jgraduate_svg",width:X,height:X,xmlns:H.svg},U);Na=Na||z.paint.type;var ea=va=z.paint[Na],ra=z.paint.alpha,ja=Na==="solidColor";switch(Na){case "solidColor":case "linearGradient":if(!ja){va.id=q+"_lg_jgraduate_grad";
ea=va=Z.appendChild(va)}a("radialGradient",{id:q+"_rg_jgraduate_grad"},Z);if(Na==="linearGradient")break;case "radialGradient":if(!ja){va.id=q+"_rg_jgraduate_grad";ea=va=Z.appendChild(va)}a("linearGradient",{id:q+"_lg_jgraduate_grad"},Z)}if(ja){ea=va=$("#"+q+"_lg_jgraduate_grad")[0];I=z.paint[Na];E(0,"#"+I,1);var la=typeof D.newstop;if(la==="string")switch(D.newstop){case "same":E(1,"#"+I,1);break;case "inverse":la="";for(var T=0;T<6;T+=2){I.substr(T,2);var wa=(255-parseInt(I.substr(T,2),16)).toString(16);
if(wa.length<2)wa=0+wa;la+=wa}E(1,"#"+la,1);break;case "white":E(1,"#ffffff",1);break;case "black":E(1,"#000000",1)}else if(la==="object")E(1,D.newstop.color||"#"+I,"opac"in D.newstop?D.newstop.opac:1)}I=parseFloat(ea.getAttribute("x1")||0);la=parseFloat(ea.getAttribute("y1")||0);T=parseFloat(ea.getAttribute("x2")||1);wa=parseFloat(ea.getAttribute("y2")||0);var Da=parseFloat(ea.getAttribute("cx")||0.5),Ma=parseFloat(ea.getAttribute("cy")||0.5),Fa=parseFloat(ea.getAttribute("fx")||Da),Oa=parseFloat(ea.getAttribute("fy")||
Ma);ha=a("rect",{id:q+"_jgraduate_rect",x:0,y:0,width:qa,height:ga,fill:"url(#"+q+"_jgraduate_grad)","fill-opacity":ra/100},Z);var Qa=$("<div/>").attr({"class":"grad_coord jGraduate_lg_field",title:"Begin Stop"}).text(1).css({top:la*X,left:I*X}).data("coord","start").appendTo(U),Ga=Qa.clone().text(2).css({top:wa*X,left:T*X}).attr("title","End stop").data("coord","end").appendTo(U),Ca=$("<div/>").attr({"class":"grad_coord jGraduate_rg_field",title:"Center stop"}).text("C").css({top:Ma*X,left:Da*X}).data("coord",
"center").appendTo(U),Ha=Ca.clone().text("F").css({top:Oa*X,left:Fa*X,display:"none"}).attr("title","Focus point").data("coord","focus").appendTo(U);Ha[0].id=q+"_jGraduate_focusCoord";$(M+" .grad_coord");$.each(["x1","y1","x2","y2","cx","cy","fx","fy"],function(pa,V){var ua=va.getAttribute(V),ya=isNaN(V[1]);ua||(ua=ya?"0.5":V==="x2"?"1.0":"0.0");Ra[V]=$("#"+q+"_jGraduate_"+V).val(ua).change(function(){if(isNaN(parseFloat(this.value))||this.value<0)this.value=0;else if(this.value>1)this.value=1;if(!(V[0]===
"f"&&!lb))if(ya&&Na==="radialGradient"||!ya&&Na==="linearGradient")va.setAttribute(V,this.value);var aa=ya?V[0]==="c"?Ca:Ha:V[1]==="1"?Qa:Ga,Sa=V.indexOf("x")>=0?"left":"top";aa.css(Sa,this.value*X)}).change()});var Aa,zb,Pb=$("#"+q+"_jGraduate_StopSlider"),gb,mb,Va,ub=a("path",{d:"m9.75,-6l-19.5,19.5m0,-19.5l19.5,19.5",fill:"none",stroke:"#D00","stroke-width":5,display:"none"},mb),Bb,Ua=1,Ja=1,Wa=0,Ia=Da,kb=Ma;mb=a("svg",{width:"100%",height:45},Pb[0]);U=a("pattern",{width:16,height:16,patternUnits:"userSpaceOnUse",
id:"jGraduate_trans"},mb);a("image",{width:16,height:16},U).setAttributeNS(H.xlink,"xlink:href",D.images.clientPath+"map-opacity.png");$(mb).click(function(pa){Bb=Pb.offset();if(pa.target.tagName!=="path"){var V=pa.pageX-Bb.left-8;V=V<10?10:V>X+10?X+10:V;E(V/X,0,0,true);pa.stopPropagation()}});$(mb).mouseover(function(){mb.appendChild(ub)});zb=a("g",{},mb);a("line",{x1:10,y1:15,x2:X+10,y2:15,"stroke-width":2,stroke:"#000"},mb);var Cb=ka.find(".jGraduate_spreadMethod").change(function(){va.setAttribute("spreadMethod",
$(this).val())}),ab=null,cb=function(pa){var V=pa.pageX-vb.left,ua=pa.pageY-vb.top;V=V<0?0:V>X?X:V;ua=ua<0?0:ua>X?X:ua;ab.css("left",V).css("top",ua);V/=qa;ua/=ga;var ya=ab.data("coord"),aa=va;switch(ya){case "start":Ra.x1.val(V);Ra.y1.val(ua);aa.setAttribute("x1",V);aa.setAttribute("y1",ua);break;case "end":Ra.x2.val(V);Ra.y2.val(ua);aa.setAttribute("x2",V);aa.setAttribute("y2",ua);break;case "center":Ra.cx.val(V);Ra.cy.val(ua);aa.setAttribute("cx",V);aa.setAttribute("cy",ua);Ia=V;kb=ua;g();break;
case "focus":Ra.fx.val(V);Ra.fy.val(ua);aa.setAttribute("fx",V);aa.setAttribute("fy",ua);g()}pa.preventDefault()},db=function(){ab=null;ma.unbind("mousemove",cb).unbind("mouseup",db)};Aa=va.getElementsByTagNameNS(H.svg,"stop");if(za<2){for(;za<2;){va.appendChild(document.createElementNS(H.svg,"stop"));++za}Aa=va.getElementsByTagNameNS(H.svg,"stop")}var za=Aa.length;for(T=0;T<za;T++)E(0,0,0,0,Aa[T]);Cb.val(va.getAttribute("spreadMethod")||"pad");var vb,lb=false;ha.setAttribute("fill-opacity",ra/100);
$("#"+q+" div.grad_coord").mousedown(function(pa){pa.preventDefault();ab=$(this);ab.offset();vb=ab.parent().offset();ma.mousemove(cb).mouseup(db)});$("#"+q+"_jGraduate_Ok").bind("click",function(){z.paint.type=Na;z.paint[Na]=va.cloneNode(true);z.paint.solidColor=null;ba()});$("#"+q+"_jGraduate_Cancel").bind("click",function(){N()});if(Na==="radialGradient")if(lb)Ha.show();else{Ha.hide();Ra.fx.val("");Ra.fy.val("")}$("#"+q+"_jGraduate_match_ctr")[0].checked=!lb;var xb,Jb;$("#"+q+"_jGraduate_match_ctr").change(function(){lb=
!this.checked;Ha.toggle(lb);Ra.fx.val("");Ra.fy.val("");var pa=va;if(lb){var V=xb||0.5,ua=Jb||0.5;pa.setAttribute("fx",V);pa.setAttribute("fy",ua);Ra.fx.val(V);Ra.fy.val(ua)}else{xb=pa.getAttribute("fx");Jb=pa.getAttribute("fy");pa.removeAttribute("fx");pa.removeAttribute("fy")}});Aa=va.getElementsByTagNameNS(H.svg,"stop");za=Aa.length;if(za<2){for(;za<2;){va.appendChild(document.createElementNS(H.svg,"stop"));++za}Aa=va.getElementsByTagNameNS(H.svg,"stop")}var pb;ra=ka=0;if(Na==="radialGradient"){Z=
va.gradientTransform.baseVal;if(Z.numberOfItems===2){za=Z.getItem(0);Z=Z.getItem(1);if(za.type===2&&Z.type===3){za=Z.matrix;if(za.a!==1)ka=Math.round(-(1-za.a)*100);else if(za.d!==1)ka=Math.round((1-za.d)*100)}}else if(Z.numberOfItems===3){U=Z.getItem(0);za=Z.getItem(1);Z=Z.getItem(2);if(U.type===4&&za.type===2&&Z.type===3){ra=Math.round(U.angle);za=Z.matrix;if(za.a!==1)ka=Math.round(-(1-za.a)*100);else if(za.d!==1)ka=Math.round((1-za.d)*100)}}}ka={radius:{handle:"#"+q+"_jGraduate_RadiusArrows",input:"#"+
q+"_jGraduate_RadiusInput",val:(va.getAttribute("r")||0.5)*100},opacity:{handle:"#"+q+"_jGraduate_OpacArrows",input:"#"+q+"_jGraduate_OpacInput",val:z.paint.alpha||100},ellip:{handle:"#"+q+"_jGraduate_EllipArrows",input:"#"+q+"_jGraduate_EllipInput",val:ka},angle:{handle:"#"+q+"_jGraduate_AngleArrows",input:"#"+q+"_jGraduate_AngleInput",val:ra}};$.each(ka,function(pa,V){var ua=$(V.handle);ua.mousedown(function(ya){var aa=ua.parent();pb={type:pa,elem:ua,input:$(V.input),parent:aa,offset:aa.offset()};
ma.mousemove(Kb).mouseup(Rb);ya.preventDefault()});$(V.input).val(V.val).change(function(){var ya=+this.value,aa=0,Sa=Na==="radialGradient";switch(pa){case "radius":Sa&&va.setAttribute("r",ya/100);aa=Math.pow(ya/100,0.4)/2*145;break;case "opacity":z.paint.alpha=ya;ha.setAttribute("fill-opacity",ya/100);aa=ya*1.45;break;case "ellip":Ua=Ja=1;if(ya===0){aa=72.5;break}if(ya>99.5)ya=99.5;if(ya>0)Ja=1-ya/100;else Ua=-(ya/100)-1;aa=145*((ya+100)/2)/100;Sa&&g();break;case "angle":Wa=ya;aa=Wa/180;aa+=0.5;
aa*=145;Sa&&g()}if(aa>145)aa=145;else if(aa<0)aa=0;ua.css({"margin-left":aa-5})}).change()});var Kb=function(pa){var V=pa.pageX-pb.offset.left-parseInt(pb.parent.css("border-left-width"));if(V>145)V=145;if(V<=0)V=0;var ua=V-5;V/=145;switch(pb.type){case "radius":V=Math.pow(V*2,2.5);if(V>0.98&&V<1.02)V=1;if(V<=0.01)V=0.01;va.setAttribute("r",V);break;case "opacity":z.paint.alpha=parseInt(V*100);ha.setAttribute("fill-opacity",V);break;case "ellip":Ja=Ua=1;if(V<0.5){V/=0.5;Ua=V<=0?0.01:V}else if(V>0.5){V/=
0.5;V=2-V;Ja=V<=0?0.01:V}g();V-=1;if(Ja===V+1)V=Math.abs(V);break;case "angle":V-=0.5;Wa=V*=180;g();V/=100}pb.elem.css({"margin-left":ua});V=Math.round(V*100);pb.input.val(V);pa.preventDefault()},Rb=function(){ma.unbind("mousemove",Kb).unbind("mouseup",Rb);pb=null};for(ka=(z.paint.alpha*255/100).toString(16);ka.length<2;)ka="0"+ka;ka=ka.split(".")[0];I=z.paint.solidColor=="none"?"":z.paint.solidColor+ka;ja||(I=Aa[0].getAttribute("stop-color"));$.extend($.fn.jPicker.defaults.window,{alphaSupport:true,
effects:{type:"show",speed:0}});ia.jPicker({window:{title:D.window.pickerTitle},images:{clientPath:D.images.clientPath},color:{active:I,alphaSupport:true}},function(pa){z.paint.type="solidColor";z.paint.alpha=pa.val("ahex")?Math.round(pa.val("a")/255*100):100;z.paint.solidColor=pa.val("hex")?pa.val("hex"):"none";z.paint.radialGradient=null;ba()},null,function(){N()});var Lb=$(M+" .jGraduate_tabs li");Lb.click(function(){Lb.removeClass("jGraduate_tab_current");$(this).addClass("jGraduate_tab_current");
$(M+" > div").hide();var pa=$(this).attr("data-type");$(M+" .jGraduate_gradPick").show();if(pa==="rg"||pa==="lg"){$(".jGraduate_"+pa+"_field").show();$(".jGraduate_"+(pa==="lg"?"rg":"lg")+"_field").hide();$("#"+q+"_jgraduate_rect")[0].setAttribute("fill","url(#"+q+"_"+pa+"_jgraduate_grad)");Na=pa==="lg"?"linearGradient":"radialGradient";$("#"+q+"_jGraduate_OpacInput").val(z.paint.alpha).change();var V=$("#"+q+"_"+pa+"_jgraduate_grad")[0];if(va!==V){var ua=$(va).find("stop");$(V).empty().append(ua);
va=V;V=Cb.val();va.setAttribute("spreadMethod",V)}lb=pa==="rg"&&va.getAttribute("fx")!=null&&!(Da==Fa&&Ma==Oa);$("#"+q+"_jGraduate_focusCoord").toggle(lb);if(lb)$("#"+q+"_jGraduate_match_ctr")[0].checked=false}else{$(M+" .jGraduate_gradPick").hide();$(M+" .jGraduate_colPick").show()}});$(M+" > div").hide();Lb.removeClass("jGraduate_tab_current");var Sb;switch(z.paint.type){case "linearGradient":Sb=$(M+" .jGraduate_tab_lingrad");break;case "radialGradient":Sb=$(M+" .jGraduate_tab_radgrad");break;default:Sb=
$(M+" .jGraduate_tab_color")}z.show();setTimeout(function(){Sb.addClass("jGraduate_tab_current").click()},10)}else alert("Container element must have an id attribute to maintain unique id strings for sub-elements.")})}})();$.fn.SpinButton=function(a){function H(h,i){for(var u=h[i],E=document.body;(h=h.offsetParent)&&h!=E;)if(!$.browser.msie||h.currentStyle.position!="relative")u+=h[i];return u}return this.each(function(){this.repeating=false;this.spinCfg={min:a&&!isNaN(parseFloat(a.min))?Number(a.min):null,max:a&&!isNaN(parseFloat(a.max))?Number(a.max):null,step:a&&a.step?Number(a.step):1,stepfunc:a&&a.stepfunc?a.stepfunc:false,page:a&&a.page?Number(a.page):10,upClass:a&&a.upClass?a.upClass:"up",downClass:a&&a.downClass?
a.downClass:"down",reset:a&&a.reset?a.reset:this.value,delay:a&&a.delay?Number(a.delay):500,interval:a&&a.interval?Number(a.interval):100,_btn_width:20,_direction:null,_delay:null,_repeat:null,callback:a&&a.callback?a.callback:null};this.spinCfg.smallStep=a&&a.smallStep?a.smallStep:this.spinCfg.step/2;this.adjustValue=function(h){h=isNaN(this.value)?this.spinCfg.reset:$.isFunction(this.spinCfg.stepfunc)?this.spinCfg.stepfunc(this,h):Number((Number(this.value)+Number(h)).toFixed(5));if(this.spinCfg.min!==
null)h=Math.max(h,this.spinCfg.min);if(this.spinCfg.max!==null)h=Math.min(h,this.spinCfg.max);this.value=h;$.isFunction(this.spinCfg.callback)&&this.spinCfg.callback(this)};$(this).addClass(a&&a.spinClass?a.spinClass:"spin-button").mousemove(function(h){var i=h.pageX||h.x,u=h.pageY||h.y;h=h.target||h.srcElement;var E=svgEditor.tool_scale||1,e=$(h).height()/2;i=i>H(h,"offsetLeft")+h.offsetWidth*E-this.spinCfg._btn_width?u<H(h,"offsetTop")+e*E?1:-1:0;if(i!==this.spinCfg._direction){switch(i){case 1:$(this).removeClass(this.spinCfg.downClass).addClass(this.spinCfg.upClass);
break;case -1:$(this).removeClass(this.spinCfg.upClass).addClass(this.spinCfg.downClass);break;default:$(this).removeClass(this.spinCfg.upClass).removeClass(this.spinCfg.downClass)}this.spinCfg._direction=i}}).mouseout(function(){$(this).removeClass(this.spinCfg.upClass).removeClass(this.spinCfg.downClass);this.spinCfg._direction=null;window.clearInterval(this.spinCfg._repeat);window.clearTimeout(this.spinCfg._delay)}).mousedown(function(h){if(h.button===0&&this.spinCfg._direction!=0){var i=this,
u=h.shiftKey?i.spinCfg.smallStep:i.spinCfg.step,E=function(){i.adjustValue(i.spinCfg._direction*u)};E();i.spinCfg._delay=window.setTimeout(function(){E();i.spinCfg._repeat=window.setInterval(E,i.spinCfg.interval)},i.spinCfg.delay)}}).mouseup(function(){window.clearInterval(this.spinCfg._repeat);window.clearTimeout(this.spinCfg._delay)}).dblclick(function(){$.browser.msie&&this.adjustValue(this.spinCfg._direction*this.spinCfg.step)}).keydown(function(h){switch(h.keyCode){case 38:this.adjustValue(this.spinCfg.step);
break;case 40:this.adjustValue(-this.spinCfg.step);break;case 33:this.adjustValue(this.spinCfg.page);break;case 34:this.adjustValue(-this.spinCfg.page)}}).keypress(function(h){if(this.repeating)switch(h.keyCode){case 38:this.adjustValue(this.spinCfg.step);break;case 40:this.adjustValue(-this.spinCfg.step);break;case 33:this.adjustValue(this.spinCfg.page);break;case 34:this.adjustValue(-this.spinCfg.page)}else this.repeating=true}).keyup(function(h){this.repeating=false;switch(h.keyCode){case 38:case 40:case 33:case 34:case 13:this.adjustValue(0)}}).bind("mousewheel",
function(h){if(h.wheelDelta>=120)this.adjustValue(this.spinCfg.step);else h.wheelDelta<=-120&&this.adjustValue(-this.spinCfg.step);h.preventDefault()}).change(function(){this.adjustValue(0)});this.addEventListener&&this.addEventListener("DOMMouseScroll",function(h){if(h.detail>0)this.adjustValue(-this.spinCfg.step);else h.detail<0&&this.adjustValue(this.spinCfg.step);h.preventDefault()},false)})};function touchHandler(a){var H=a.changedTouches,h=H[0],i="";switch(a.type){case "touchstart":i="mousedown";break;case "touchmove":i="mousemove";break;case "touchend":i="mouseup";break;default:return}var u=document.createEvent("MouseEvent");u.initMouseEvent(i,true,true,window,1,h.screenX,h.screenY,h.clientX,h.clientY,false,false,false,false,0,null);if(H.length<2){h.target.dispatchEvent(u);a.preventDefault()}};jQuery&&function(){var a=$(window),H=$(document);$.extend($.fn,{contextMenu:function(h,i){if(h.menu==undefined)return false;if(h.inSpeed==undefined)h.inSpeed=150;if(h.outSpeed==undefined)h.outSpeed=75;if(h.inSpeed==0)h.inSpeed=-1;if(h.outSpeed==0)h.outSpeed=-1;$(this).each(function(){var u=$(this),E=$(u).offset(),e=$("#"+h.menu);e.addClass("contextMenu");$(this).bind("mousedown",function(f){$(this).mouseup(function(g){var p=$(this);p.unbind("mouseup");$(".contextMenu").hide();if(f.button===2||h.allowLeft||
f.ctrlKey&&svgedit.browser.isMac()){g.stopPropagation();if(u.hasClass("disabled"))return false;var z=g.pageX,D=g.pageY;g=a.width()-e.width();var q=a.height()-e.height();if(z>g-15)z=g-15;if(D>q-30)D=q-30;H.unbind("click");e.css({top:D,left:z}).fadeIn(h.inSpeed);e.find("A").mouseover(function(){e.find("LI.hover").removeClass("hover");$(this).parent().addClass("hover")}).mouseout(function(){e.find("LI.hover").removeClass("hover")});H.keypress(function(M){switch(M.keyCode){case 38:if(e.find("LI.hover").length){e.find("LI.hover").removeClass("hover").prevAll("LI:not(.disabled)").eq(0).addClass("hover");
e.find("LI.hover").length||e.find("LI:last").addClass("hover")}else e.find("LI:last").addClass("hover");break;case 40:if(e.find("LI.hover").length==0)e.find("LI:first").addClass("hover");else{e.find("LI.hover").removeClass("hover").nextAll("LI:not(.disabled)").eq(0).addClass("hover");e.find("LI.hover").length||e.find("LI:first").addClass("hover")}break;case 13:e.find("LI.hover A").trigger("click");break;case 27:H.trigger("click")}});e.find("A").unbind("mouseup");e.find("LI:not(.disabled) A").mouseup(function(){H.unbind("click").unbind("keypress");
$(".contextMenu").hide();i&&i($(this).attr("href").substr(1),$(p),{x:z-E.left,y:D-E.top,docX:z,docY:D});return false});setTimeout(function(){H.click(function(){H.unbind("click").unbind("keypress");e.fadeOut(h.outSpeed);return false})},0)}})});if($.browser.mozilla)$("#"+h.menu).each(function(){$(this).css({MozUserSelect:"none"})});else $.browser.msie?$("#"+h.menu).each(function(){$(this).bind("selectstart.disableTextSelect",function(){return false})}):$("#"+h.menu).each(function(){$(this).bind("mousedown.disableTextSelect",
function(){return false})});$(u).add($("UL.contextMenu")).bind("contextmenu",function(){return false})});return $(this)},disableContextMenuItems:function(h){if(h==undefined){$(this).find("LI").addClass("disabled");return $(this)}$(this).each(function(){if(h!=undefined)for(var i=h.split(","),u=0;u<i.length;u++)$(this).find('A[href="'+i[u]+'"]').parent().addClass("disabled")});return $(this)},enableContextMenuItems:function(h){if(h==undefined){$(this).find("LI.disabled").removeClass("disabled");return $(this)}$(this).each(function(){if(h!=
undefined)for(var i=h.split(","),u=0;u<i.length;u++)$(this).find('A[href="'+i[u]+'"]').parent().removeClass("disabled")});return $(this)},disableContextMenu:function(){$(this).each(function(){$(this).addClass("disabled")});return $(this)},enableContextMenu:function(){$(this).each(function(){$(this).removeClass("disabled")});return $(this)},destroyContextMenu:function(){$(this).each(function(){$(this).unbind("mousedown").unbind("mouseup")});return $(this)}})}(jQuery);var svgedit=svgedit||{};
(function(){if(!svgedit.browser)svgedit.browser={};var a=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect;svgedit.browser.supportsSvg=function(){return a};if(svgedit.browser.supportsSvg()){var H=navigator.userAgent,h=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=!!window.opera,u=H.indexOf("AppleWebKit")>=0,E=H.indexOf("Gecko/")>=0,e=H.indexOf("MSIE")>=0,f=H.indexOf("Chrome/")>=0,g=H.indexOf("Windows")>=0,p=H.indexOf("Macintosh")>=
0,z="ontouchstart"in window,D=!!h.querySelector,q=!!document.evaluate,M=function(){var qa=document.createElementNS("http://www.w3.org/2000/svg","path");qa.setAttribute("d","M0,0 10,10");var ga=qa.pathSegList;qa=qa.createSVGPathSegLinetoAbs(5,5);try{ga.replaceItem(qa,0);return true}catch(Na){}return false}(),ba=function(){var qa=document.createElementNS("http://www.w3.org/2000/svg","path");qa.setAttribute("d","M0,0 10,10");var ga=qa.pathSegList;qa=qa.createSVGPathSegLinetoAbs(5,5);try{ga.insertItemBefore(qa,
0);return true}catch(Na){}return false}(),N=function(){var qa=document.createElementNS("http://www.w3.org/2000/svg","svg"),ga=document.createElementNS("http://www.w3.org/2000/svg","svg");document.documentElement.appendChild(qa);ga.setAttribute("x",5);qa.appendChild(ga);var Na=document.createElementNS("http://www.w3.org/2000/svg","text");Na.textContent="a";ga.appendChild(Na);ga=Na.getStartPositionOfChar(0).x;document.documentElement.removeChild(qa);return ga===0}(),I=function(){var qa=document.createElementNS("http://www.w3.org/2000/svg",
"svg");document.documentElement.appendChild(qa);var ga=document.createElementNS("http://www.w3.org/2000/svg","path");ga.setAttribute("d","M0,0 C0,0 10,10 10,0");qa.appendChild(ga);ga=ga.getBBox();document.documentElement.removeChild(qa);return ga.height>4&&ga.height<5}(),ma=function(){var qa=document.createElementNS("http://www.w3.org/2000/svg","svg");document.documentElement.appendChild(qa);var ga=document.createElementNS("http://www.w3.org/2000/svg","path");ga.setAttribute("d","M0,0 10,0");var Na=
document.createElementNS("http://www.w3.org/2000/svg","path");Na.setAttribute("d","M5,0 15,0");var va=document.createElementNS("http://www.w3.org/2000/svg","g");va.appendChild(ga);va.appendChild(Na);qa.appendChild(va);ga=va.getBBox();document.documentElement.removeChild(qa);return ga.width==15}(),ia=function(){var qa=document.createElementNS("http://www.w3.org/2000/svg","rect");qa.setAttribute("x",0.1);(qa=qa.cloneNode(false).getAttribute("x").indexOf(",")==-1)||$.alert("NOTE: This version of Opera is known to contain bugs in SVG-edit.\n\t\tPlease upgrade to the <a href='http://opera.com'>latest version</a> in which the problems have been fixed.");
return qa}(),ka=function(){var qa=document.createElementNS("http://www.w3.org/2000/svg","rect");qa.setAttribute("style","vector-effect:non-scaling-stroke");return qa.style.vectorEffect==="non-scaling-stroke"}(),X=function(){var qa=document.createElementNS("http://www.w3.org/2000/svg","rect").transform.baseVal,ga=h.createSVGTransform();qa.appendItem(ga);return qa.getItem(0)==ga}();svgedit.browser.isOpera=function(){return i};svgedit.browser.isWebkit=function(){return u};svgedit.browser.isGecko=function(){return E};
svgedit.browser.isIE=function(){return e};svgedit.browser.isChrome=function(){return f};svgedit.browser.isWindows=function(){return g};svgedit.browser.isMac=function(){return p};svgedit.browser.isTouch=function(){return z};svgedit.browser.supportsSelectors=function(){return D};svgedit.browser.supportsXpath=function(){return q};svgedit.browser.supportsPathReplaceItem=function(){return M};svgedit.browser.supportsPathInsertItemBefore=function(){return ba};svgedit.browser.supportsPathBBox=function(){return I};
svgedit.browser.supportsHVLineContainerBBox=function(){return ma};svgedit.browser.supportsGoodTextCharPos=function(){return N};svgedit.browser.supportsEditableText=function(){return i};svgedit.browser.supportsGoodDecimals=function(){return ia};svgedit.browser.supportsNonScalingStroke=function(){return ka};svgedit.browser.supportsNativeTransformLists=function(){return X}}else window.location="browser-not-supported.html"})();svgedit=svgedit||{};
(function(){if(!svgedit.transformlist)svgedit.transformlist={};var a=document.createElementNS("http://www.w3.org/2000/svg","svg"),H={};svgedit.transformlist.SVGTransformList=function(h){this._elem=h||null;this._xforms=[];this._update=function(){var i="";a.createSVGMatrix();for(var u=0;u<this.numberOfItems;++u){var E=this._list.getItem(u);i=i;E=E;var e=E.matrix,f="";switch(E.type){case 1:f="matrix("+[e.a,e.b,e.c,e.d,e.e,e.f].join(",")+")";break;case 2:f="translate("+e.e+","+e.f+")";break;case 3:f=
e.a==e.d?"scale("+e.a+")":"scale("+e.a+","+e.d+")";break;case 4:var g=0;f=0;if(E.angle!=0){g=1-e.a;f=(g*e.f+e.b*e.e)/(g*g+e.b*e.b);g=(e.e-e.b*f)/g}f="rotate("+E.angle+" "+g+","+f+")"}i=i+(f+" ")}this._elem.setAttribute("transform",i)};this._list=this;this._init=function(){var i=this._elem.getAttribute("transform");if(i)for(var u=/\s*((scale|matrix|rotate|translate)\s*\(.*?\))\s*,?\s*/,E=true;E;){E=i.match(u);i=i.replace(u,"");if(E&&E[1]){var e=E[1].split(/\s*\(/),f=e[0];e=e[1].match(/\s*(.*?)\s*\)/);
e[1]=e[1].replace(/(\d)-/g,"$1 -");var g=e[1].split(/[, ]+/),p="abcdef".split(""),z=a.createSVGMatrix();$.each(g,function(M,ba){g[M]=parseFloat(ba);if(f=="matrix")z[p[M]]=g[M]});e=a.createSVGTransform();var D="set"+f.charAt(0).toUpperCase()+f.slice(1),q=f=="matrix"?[z]:g;if(f=="scale"&&q.length==1)q.push(q[0]);else if(f=="translate"&&q.length==1)q.push(0);else if(f=="rotate"&&q.length==1){q.push(0);q.push(0)}e[D].apply(e,q);this._list.appendItem(e)}}};this._removeFromOtherLists=function(i){if(i){var u=
false,E;for(E in H){for(var e=H[E],f=0,g=e._xforms.length;f<g;++f)if(e._xforms[f]==i){u=true;e.removeItem(f);break}if(u)break}}};this.numberOfItems=0;this.clear=function(){this.numberOfItems=0;this._xforms=[]};this.initialize=function(i){this.numberOfItems=1;this._removeFromOtherLists(i);this._xforms=[i]};this.getItem=function(i){if(i<this.numberOfItems&&i>=0)return this._xforms[i];throw{code:1};};this.insertItemBefore=function(i,u){var E=null;if(u>=0)if(u<this.numberOfItems){this._removeFromOtherLists(i);
E=Array(this.numberOfItems+1);for(var e=0;e<u;++e)E[e]=this._xforms[e];E[e]=i;for(var f=e+1;e<this.numberOfItems;++f,++e)E[f]=this._xforms[e];this.numberOfItems++;this._xforms=E;E=i;this._list._update()}else E=this._list.appendItem(i);return E};this.replaceItem=function(i,u){var E=null;if(u<this.numberOfItems&&u>=0){this._removeFromOtherLists(i);E=this._xforms[u]=i;this._list._update()}return E};this.removeItem=function(i){if(i<this.numberOfItems&&i>=0){for(var u=this._xforms[i],E=Array(this.numberOfItems-
1),e=0;e<i;++e)E[e]=this._xforms[e];for(i=e;i<this.numberOfItems-1;++i,++e)E[i]=this._xforms[e+1];this.numberOfItems--;this._xforms=E;this._list._update();return u}else throw{code:1};};this.appendItem=function(i){this._removeFromOtherLists(i);this._xforms.push(i);this.numberOfItems++;this._list._update();return i}};svgedit.transformlist.resetListMap=function(){H={}};svgedit.transformlist.removeElementFromListMap=function(h){h.id&&H[h.id]&&delete H[h.id]};svgedit.transformlist.getTransformList=function(h){if(svgedit.browser.supportsNativeTransformLists())if(h.transform)return h.transform.baseVal;
else if(h.gradientTransform)return h.gradientTransform.baseVal;else{if(h.patternTransform)return h.patternTransform.baseVal}else{var i=h.id;i||(i="temp");var u=H[i];if(!u||i=="temp"){H[i]=new svgedit.transformlist.SVGTransformList(h);H[i]._init();u=H[i]}return u}return null}})();svgedit=svgedit||{};
(function(){if(!svgedit.math)svgedit.math={};var a=document.createElementNS("http://www.w3.org/2000/svg","svg");svgedit.math.transformPoint=function(H,h,i){return{x:i.a*H+i.c*h+i.e,y:i.b*H+i.d*h+i.f}};svgedit.math.isIdentity=function(H){return H.a===1&&H.b===0&&H.c===0&&H.d===1&&H.e===0&&H.f===0};svgedit.math.matrixMultiply=function(){for(var H=arguments,h=H.length,i=H[h-1];h-- >1;)i=H[h-1].multiply(i);if(Math.abs(i.a)<1.0E-14)i.a=0;if(Math.abs(i.b)<1.0E-14)i.b=0;if(Math.abs(i.c)<1.0E-14)i.c=0;if(Math.abs(i.d)<
1.0E-14)i.d=0;if(Math.abs(i.e)<1.0E-14)i.e=0;if(Math.abs(i.f)<1.0E-14)i.f=0;return i};svgedit.math.hasMatrixTransform=function(H){if(!H)return false;for(var h=H.numberOfItems;h--;){var i=H.getItem(h);if(i.type==1&&!svgedit.math.isIdentity(i.matrix))return true}return false};svgedit.math.transformBox=function(H,h,i,u,E){var e={x:H,y:h},f={x:H+i,y:h};i={x:H+i,y:h+u};H={x:H,y:h+u};h=svgedit.math.transformPoint;e=h(e.x,e.y,E);var g=u=e.x,p=e.y,z=e.y;f=h(f.x,f.y,E);u=Math.min(u,f.x);g=Math.max(g,f.x);
p=Math.min(p,f.y);z=Math.max(z,f.y);H=h(H.x,H.y,E);u=Math.min(u,H.x);g=Math.max(g,H.x);p=Math.min(p,H.y);z=Math.max(z,H.y);i=h(i.x,i.y,E);u=Math.min(u,i.x);g=Math.max(g,i.x);p=Math.min(p,i.y);z=Math.max(z,i.y);return{tl:e,tr:f,bl:H,br:i,aabox:{x:u,y:p,width:g-u,height:z-p}}};svgedit.math.transformListToTransform=function(H,h,i){if(H==null)return a.createSVGTransformFromMatrix(a.createSVGMatrix());h=h==undefined?0:h;i=i==undefined?H.numberOfItems-1:i;h=parseInt(h);i=parseInt(i);if(h>i){var u=i;i=h;
h=u}u=a.createSVGMatrix();for(h=h;h<=i;++h){var E=h>=0&&h<H.numberOfItems?H.getItem(h).matrix:a.createSVGMatrix();u=svgedit.math.matrixMultiply(u,E)}return a.createSVGTransformFromMatrix(u)};svgedit.math.getMatrix=function(H){H=svgedit.transformlist.getTransformList(H);return svgedit.math.transformListToTransform(H).matrix};svgedit.math.snapToAngle=function(H,h,i,u){var E=Math.PI/4;i=i-H;var e=u-h;u=Math.sqrt(i*i+e*e);E=Math.round(Math.atan2(e,i)/E)*E;return{x:H+u*Math.cos(E),y:h+u*Math.sin(E),a:E}};
svgedit.math.rectsIntersect=function(H,h){return h.x<H.x+H.width&&h.x+h.width>H.x&&h.y<H.y+H.height&&h.y+h.height>H.y}})();svgedit=svgedit||{};
(function(){if(!svgedit.units)svgedit.units={};var a=["x","x1","cx","rx","width"],H=["y","y1","cy","ry","height"],h=$.merge(["r","radius"],a);$.merge(h,H);var i,u={px:1};svgedit.units.init=function(e){i=e;e=document.createElementNS("http://www.w3.org/2000/svg","svg");document.body.appendChild(e);var f=document.createElementNS("http://www.w3.org/2000/svg","rect");f.setAttribute("width","1em");f.setAttribute("height","1ex");f.setAttribute("x","1in");e.appendChild(f);f=f.getBBox();document.body.removeChild(e);
e=f.x;u.em=f.width;u.ex=f.height;u["in"]=e;u.cm=e/2.54;u.mm=e/25.4;u.pt=e/72;u.pc=e/6;u["%"]=0};svgedit.units.getTypeMap=function(){return u};svgedit.units.shortFloat=function(e){var f=i.getRoundDigits();if(isNaN(e)){if($.isArray(e))return svgedit.units.shortFloat(e[0])+","+svgedit.units.shortFloat(e[1])}else return+(+e).toFixed(f);return parseFloat(e).toFixed(f)-0};svgedit.units.convertUnit=function(e,f){f=f||i.getBaseUnit();return svgedit.unit.shortFloat(e/u[f])};svgedit.units.setUnitAttr=function(e,
f,g){isNaN(g)||e.getAttribute(f);e.setAttribute(f,g)};var E={line:["x1","x2","y1","y2"],circle:["cx","cy","r"],ellipse:["cx","cy","rx","ry"],foreignObject:["x","y","width","height"],rect:["x","y","width","height"],image:["x","y","width","height"],use:["x","y","width","height"],text:["x","y"]};svgedit.units.convertAttrs=function(e){var f=e.tagName,g=i.getBaseUnit();if(f=E[f])for(var p=f.length,z=0;z<p;z++){var D=f[z],q=e.getAttribute(D);if(q)isNaN(q)||e.setAttribute(D,q/u[g]+g)}};svgedit.units.convertToNum=
function(e,f){if(!isNaN(f))return f-0;if(f.substr(-1)==="%"){var g=f.substr(0,f.length-1)/100,p=i.getWidth(),z=i.getHeight();return a.indexOf(e)>=0?g*p:H.indexOf(e)>=0?g*z:g*Math.sqrt(p*p+z*z)/Math.sqrt(2)}else{p=f.substr(-2);g=f.substr(0,f.length-2);return g*u[p]}};svgedit.units.isValidUnit=function(e,f,g){var p=false;if(h.indexOf(e)>=0)if(isNaN(f)){f=f.toLowerCase();$.each(u,function(q){if(!p)if(RegExp("^-?[\\d\\.]+"+q+"$").test(f))p=true})}else p=true;else if(e=="id"){e=false;try{var z=i.getElement(f);
e=z==null||z===g}catch(D){}return e}else p=true;return p}})();svgedit=svgedit||{};
(function(){function a(e){if(svgedit.browser.supportsHVLineContainerBBox())try{return e.getBBox()}catch(f){}var g=$.data(e,"ref"),p=null;if(g){var z=$(g).children().clone().attr("visibility","hidden");$(E).append(z);p=z.filter("line, path")}else p=$(e).find("line, path");var D=false;if(p.length){p.each(function(){var q=this.getBBox();if(!q.width||!q.height)D=true});if(D){e=g?z:$(e).children();ret=getStrokedBBox(e)}else ret=e.getBBox()}else ret=e.getBBox();g&&z.remove();return ret}if(!svgedit.utilities)svgedit.utilities=
{};var H="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use".split(","),h=null,i=null,u=null,E=null;svgedit.utilities.init=function(e){h=e;i=e.getDOMDocument();u=e.getDOMContainer();E=e.getSVGRoot()};svgedit.utilities.toXml=function(e){return $("<p/>").text(e).html()};svgedit.utilities.fromXml=function(e){return $("<p/>").html(e).text()};svgedit.utilities.encode64=function(e){e=svgedit.utilities.convertToXMLReferences(e);if(window.btoa)return window.btoa(e);
var f=Array(Math.floor((e.length+2)/3)*4),g,p,z,D,q,M,ba=0,N=0;do{g=e.charCodeAt(ba++);p=e.charCodeAt(ba++);z=e.charCodeAt(ba++);D=g>>2;g=(g&3)<<4|p>>4;q=(p&15)<<2|z>>6;M=z&63;if(isNaN(p))q=M=64;else if(isNaN(z))M=64;f[N++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(D);f[N++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g);f[N++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(q);f[N++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(M)}while(ba<
e.length);return f.join("")};svgedit.utilities.decode64=function(e){if(window.atob)return window.atob(e);var f="",g,p,z="",D,q="",M=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(M++));p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(M++));D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(M++));q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(M++));
g=g<<2|p>>4;p=(p&15)<<4|D>>2;z=(D&3)<<6|q;f+=String.fromCharCode(g);if(D!=64)f+=String.fromCharCode(p);if(q!=64)f+=String.fromCharCode(z)}while(M<e.length);return unescape(f)};svgedit.utilities.convertToXMLReferences=function(e){for(var f="",g=0;g<e.length;g++){var p=e.charCodeAt(g);if(p<128)f+=e[g];else if(p>127)f+="&#"+p+";"}return f};svgedit.utilities.text2xml=function(e){if(e.indexOf("<svg:svg")>=0)e=e.replace(/<(\/?)svg:/g,"<$1").replace("xmlns:svg","xmlns");var f;try{var g=window.DOMParser?
new DOMParser:new ActiveXObject("Microsoft.XMLDOM");g.async=false}catch(p){throw Error("XML Parser could not be instantiated");}try{f=g.loadXML?g.loadXML(e)?g:false:g.parseFromString(e,"text/xml")}catch(z){throw Error("Error parsing XML string");}return f};svgedit.utilities.bboxToObj=function(e){return{x:e.x,y:e.y,width:e.width,height:e.height}};svgedit.utilities.walkTree=function(e,f){if(e&&e.nodeType==1){f(e);for(var g=e.childNodes.length;g--;)svgedit.utilities.walkTree(e.childNodes.item(g),f)}};
svgedit.utilities.walkTreePost=function(e,f){if(e&&e.nodeType==1){for(var g=e.childNodes.length;g--;)svgedit.utilities.walkTree(e.childNodes.item(g),f);f(e)}};svgedit.utilities.getUrlFromAttr=function(e){if(e)if(e.indexOf('url("')===0)return e.substring(5,e.indexOf('"',6));else if(e.indexOf("url('")===0)return e.substring(5,e.indexOf("'",6));else if(e.indexOf("url(")===0)return e.substring(4,e.indexOf(")"));return null};svgedit.utilities.getHref=function(e){return e.getAttributeNS("http://www.w3.org/1999/xlink",
"href")};svgedit.utilities.setHref=function(e,f){e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f)};svgedit.utilities.findDefs=function(e){e=h.getSVGContent().documentElement;var f=e.getElementsByTagNameNS("http://www.w3.org/2000/svg","defs");return f=f.length>0?f[0]:e.insertBefore(e.ownerDocument.createElementNS("http://www.w3.org/2000/svg","defs"),e.firstChild.nextSibling)};svgedit.utilities.getPathBBox=function(e){var f=e.pathSegList,g=f.numberOfItems;e=[[],[]];var p=f.getItem(0),
z=[p.x,p.y];for(p=0;p<g;p++){var D=f.getItem(p);if(typeof D.x!="undefined"){e[0].push(z[0]);e[1].push(z[1]);if(D.x1){for(var q=[D.x1,D.y1],M=[D.x2,D.y2],ba=[D.x,D.y],N=0;N<2;N++){D=function(X){return Math.pow(1-X,3)*z[N]+3*Math.pow(1-X,2)*X*q[N]+3*(1-X)*Math.pow(X,2)*M[N]+Math.pow(X,3)*ba[N]};var I=6*z[N]-12*q[N]+6*M[N],ma=-3*z[N]+9*q[N]-9*M[N]+3*ba[N],ia=3*q[N]-3*z[N];if(ma==0){if(I!=0){I=-ia/I;0<I&&I<1&&e[N].push(D(I))}}else{ia=Math.pow(I,2)-4*ia*ma;if(!(ia<0)){var ka=(-I+Math.sqrt(ia))/(2*ma);
0<ka&&ka<1&&e[N].push(D(ka));I=(-I-Math.sqrt(ia))/(2*ma);0<I&&I<1&&e[N].push(D(I))}}}z=ba}else{e[0].push(D.x);e[1].push(D.y)}}}f=Math.min.apply(null,e[0]);g=Math.max.apply(null,e[0])-f;p=Math.min.apply(null,e[1]);e=Math.max.apply(null,e[1])-p;return{x:f,y:p,width:g,height:e}};svgedit.utilities.getBBox=function(e){var f=e||h.geSelectedElements()[0];if(e.nodeType!=1)return null;e=null;var g=f.nodeName;switch(g){case "text":if(f.textContent===""){f.textContent="a";e=f.getBBox();f.textContent=""}else try{e=
f.getBBox()}catch(p){}break;case "path":if(svgedit.browser.supportsPathBBox())try{e=f.getBBox()}catch(z){}else e=svgedit.utilities.getPathBBox(f);break;case "g":case "a":e=a(f);break;default:if(g==="use")e=a(f,true);if(g==="use"){e||(e=f.getBBox());if(!svgedit.browser.isWebkit()){g={};g.width=e.width;g.height=e.height;g.x=e.x+parseFloat(f.getAttribute("x")||0);g.y=e.y+parseFloat(f.getAttribute("y")||0);e=g}}else if(~H.indexOf(g))try{e=f.getBBox()}catch(D){f=$(f).closest("foreignObject");if(f.length)try{e=
f[0].getBBox()}catch(q){e=null}else e=null}}if(e)e=svgedit.utilities.bboxToObj(e);return e};svgedit.utilities.getRotationAngle=function(e,f){var g=e||h.getSelectedElements()[0];g=svgedit.transformlist.getTransformList(g);if(!g)return 0;for(var p=g.numberOfItems,z=0;z<p;++z){var D=g.getItem(z);if(D.type==4)return f?D.angle*Math.PI/180:D.angle}return 0};svgedit.utilities.getElem=svgedit.browser.supportsSelectors()?function(e){return E.querySelector("#"+e)}:svgedit.browser.supportsXpath()?function(e){return i.evaluate('svg:svg[@id="svgroot"]//svg:*[@id="'+
e+'"]',u,function(){return"http://www.w3.org/2000/svg"},9,null).singleNodeValue}:function(e){return $(E).find("[id="+e+"]")[0]};svgedit.utilities.assignAttributes=function(e,f,g,p){g||(g=0);svgedit.browser.isOpera()||E.suspendRedraw(g);for(var z in f)if(g=z.substr(0,4)==="xml:"?"http://www.w3.org/XML/1998/namespace":z.substr(0,6)==="xlink:"?"http://www.w3.org/1999/xlink":null)e.setAttributeNS(g,z,f[z]);else p?svgedit.units.setUnitAttr(e,z,f[z]):e.setAttribute(z,f[z]);svgedit.browser.isOpera()||E.unsuspendRedraw(null)};
svgedit.utilities.cleanupElement=function(e){var f=E.suspendRedraw(60),g={"fill-opacity":1,"stop-opacity":1,opacity:1,stroke:"none","stroke-dasharray":"none","stroke-linejoin":"miter","stroke-linecap":"butt","stroke-opacity":1,"stroke-width":1,rx:0,ry:0},p;for(p in g){var z=g[p];e.getAttribute(p)==z&&e.removeAttribute(p)}E.unsuspendRedraw(f)}})();svgedit=svgedit||{};
(function(){if(!svgedit.sanitize)svgedit.sanitize={};var a={};a["http://www.w3.org/1999/xlink"]="xlink";a["http://www.w3.org/XML/1998/namespace"]="xml";a["http://www.w3.org/2000/xmlns/"]="xmlns";a["http://svg-edit.googlecode.com"]="se";a["http://www.w3.org/1999/xhtml"]="xhtml";a["http://www.w3.org/1998/Math/MathML"]="mathml";var H={};$.each(a,function(u,E){H[E]=u});var h={a:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","mask","opacity","stroke","stroke-dasharray",
"stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","xlink:href","xlink:title"],circle:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask","opacity","r","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],clipPath:["class",
"clipPathUnits","id"],defs:[],style:["type"],desc:[],ellipse:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],feGaussianBlur:["class","color-interpolation-filters","id","requiredFeatures","stdDeviation"],filter:["class","color-interpolation-filters",
"filterRes","filterUnits","height","id","primitiveUnits","requiredFeatures","width","x","xlink:href","y"],foreignObject:["class","font-size","height","id","opacity","requiredFeatures","style","transform","width","x","y"],g:["class","clip-path","clip-rule","id","display","fill","fill-opacity","fill-rule","filter","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage",
"transform","font-family","font-size","font-style","font-weight","text-anchor"],image:["class","clip-path","clip-rule","filter","height","id","mask","opacity","requiredFeatures","style","systemLanguage","transform","width","x","xlink:href","xlink:title","y"],line:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin",
"stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","x1","x2","y1","y2"],linearGradient:["class","id","gradientTransform","gradientUnits","requiredFeatures","spreadMethod","systemLanguage","x1","x2","xlink:href","y1","y2"],marker:["id","class","markerHeight","markerUnits","markerWidth","orient","preserveAspectRatio","refX","refY","systemLanguage","viewBox"],mask:["class","height","id","maskContentUnits","maskUnits","width","x","y"],metadata:["class","id"],path:["class",
"clip-path","clip-rule","d","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],pattern:["class","height","id","patternContentUnits","patternTransform","patternUnits","requiredFeatures","style","systemLanguage","viewBox","width","x","xlink:href","y"],polygon:["class",
"clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","id","class","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],polyline:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","marker-end","marker-mid","marker-start","mask","opacity","points",
"requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],radialGradient:["class","cx","cy","fx","fy","gradientTransform","gradientUnits","id","r","requiredFeatures","spreadMethod","systemLanguage","xlink:href"],rect:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray",
"stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","width","x","y"],stop:["class","id","offset","requiredFeatures","stop-color","stop-opacity","style","systemLanguage"],svg:["class","clip-path","clip-rule","filter","id","height","mask","preserveAspectRatio","requiredFeatures","style","systemLanguage","viewBox","width","x","xmlns","xmlns:se","xmlns:xlink","y"],"switch":["class","id","requiredFeatures","systemLanguage"],
symbol:["class","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","opacity","preserveAspectRatio","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","viewBox"],text:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity",
"requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","transform","x","xml:space","y"],textPath:["class","id","method","requiredFeatures","spacing","startOffset","style","systemLanguage","transform","xlink:href"],title:[],tspan:["class","clip-path","clip-rule","dx","dy","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight",
"id","mask","opacity","requiredFeatures","rotate","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","textLength","transform","x","xml:space","y"],use:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width",
"style","transform","width","x","xlink:href","y"],annotation:["encoding"],"annotation-xml":["encoding"],maction:["actiontype","other","selection"],math:["class","id","display","xmlns"],menclose:["notation"],merror:[],mfrac:["linethickness"],mi:["mathvariant"],mmultiscripts:[],mn:[],mo:["fence","lspace","maxsize","minsize","rspace","stretchy"],mover:[],mpadded:["lspace","width","height","depth","voffset"],mphantom:[],mprescripts:[],mroot:[],mrow:["xlink:href","xlink:type","xmlns:xlink"],mspace:["depth",
"height","width"],msqrt:[],mstyle:["displaystyle","mathbackground","mathcolor","mathvariant","scriptlevel"],msub:[],msubsup:[],msup:[],mtable:["align","columnalign","columnlines","columnspacing","displaystyle","equalcolumns","equalrows","frame","rowalign","rowlines","rowspacing","width"],mtd:["columnalign","columnspan","rowalign","rowspan"],mtext:[],mtr:["columnalign","rowalign"],munder:[],munderover:[],none:[],semantics:[]},i={};$.each(h,function(u,E){var e={};$.each(E,function(f,g){if(g.indexOf(":")>=
0){var p=g.split(":");e[p[1]]=H[p[0]]}else e[g]=g=="xmlns"?"http://www.w3.org/2000/xmlns/":null});i[u]=e});svgedit.sanitize.getNSMap=function(){return a};svgedit.sanitize.sanitizeSvg=function(u){if(u.nodeType==3){u.nodeValue=u.nodeValue.replace(/^\s+|\s+$/g,"");u.nodeValue.length||u.parentNode.removeChild(u)}if(u.nodeType==1){var E=u.parentNode;if(u.ownerDocument&&E){var e=h[u.nodeName],f=i[u.nodeName];if(e!=undefined){for(var g=[],p=u.attributes.length;p--;){var z=u.attributes.item(p),D=z.nodeName,
q=z.localName,M=z.namespaceURI;if(!(f.hasOwnProperty(q)&&M==f[q]&&M!="http://www.w3.org/2000/xmlns/")&&!(M=="http://www.w3.org/2000/xmlns/"&&a[z.nodeValue])){D.indexOf("se:")==0&&g.push([D,z.nodeValue]);u.removeAttributeNS(M,q)}if(svgedit.browser.isGecko())switch(D){case "transform":case "gradientTransform":case "patternTransform":q=z.nodeValue.replace(/(\d)-/g,"$1 -");u.setAttribute(D,q)}if(D=="style"){z=z.nodeValue.split(";");for(D=z.length;D--;){q=z[D].split(":");e.indexOf(q[0])>=0&&u.setAttribute(q[0],
q[1])}u.removeAttribute("style")}}$.each(g,function(ba,N){u.setAttributeNS("http://svg-edit.googlecode.com",N[0],N[1])});if((p=svgedit.utilities.getHref(u))&&["filter","linearGradient","pattern","radialGradient","textPath","use"].indexOf(u.nodeName)>=0)if(p[0]!="#"){svgedit.utilities.setHref(u,"");u.removeAttributeNS("http://www.w3.org/1999/xlink","href")}if(u.nodeName=="use"&&!svgedit.utilities.getHref(u))E.removeChild(u);else{$.each(["clip-path","fill","filter","marker-end","marker-mid","marker-start",
"mask","stroke"],function(ba,N){var I=u.getAttribute(N);if(I)if((I=svgedit.utilities.getUrlFromAttr(I))&&I[0]!=="#"){u.setAttribute(N,"");u.removeAttribute(N)}});for(p=u.childNodes.length;p--;)svgedit.sanitize.sanitizeSvg(u.childNodes.item(p))}}else{for(e=[];u.hasChildNodes();)e.push(E.insertBefore(u.firstChild,u));E.removeChild(u);for(p=e.length;p--;)svgedit.sanitize.sanitizeSvg(e[p])}}}}})();svgedit=svgedit||{};
(function(){if(!svgedit.history)svgedit.history={};svgedit.history.HistoryEventTypes={BEFORE_APPLY:"before_apply",AFTER_APPLY:"after_apply",BEFORE_UNAPPLY:"before_unapply",AFTER_UNAPPLY:"after_unapply"};svgedit.history.MoveElementCommand=function(a,H,h,i){this.elem=a;this.text=i?"Move "+a.tagName+" to "+i:"Move "+a.tagName;this.oldNextSibling=H;this.oldParent=h;this.newNextSibling=a.nextSibling;this.newParent=a.parentNode};svgedit.history.MoveElementCommand.type=function(){return"svgedit.history.MoveElementCommand"};svgedit.history.MoveElementCommand.prototype.type=
svgedit.history.MoveElementCommand.type;svgedit.history.MoveElementCommand.prototype.getText=function(){return this.text};svgedit.history.MoveElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);this.elem=this.newParent.insertBefore(this.elem,this.newNextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)};svgedit.history.MoveElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,
this);this.elem=this.oldParent.insertBefore(this.elem,this.oldNextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.MoveElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.InsertElementCommand=function(a,H){this.elem=a;this.text=H||"Create "+a.tagName;this.parent=a.parentNode;this.nextSibling=this.elem.nextSibling};svgedit.history.InsertElementCommand.type=function(){return"svgedit.history.InsertElementCommand"};svgedit.history.InsertElementCommand.prototype.type=
svgedit.history.InsertElementCommand.type;svgedit.history.InsertElementCommand.prototype.getText=function(){return this.text};svgedit.history.InsertElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);this.elem=this.parent.insertBefore(this.elem,this.nextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)};svgedit.history.InsertElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,
this);this.parent=this.elem.parentNode;this.elem=this.elem.parentNode.removeChild(this.elem);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.InsertElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.RemoveElementCommand=function(a,H,h,i){this.elem=a;this.text=i||"Delete "+a.tagName;this.nextSibling=H;this.parent=h;svgedit.transformlist.removeElementFromListMap(a)};svgedit.history.RemoveElementCommand.type=function(){return"svgedit.history.RemoveElementCommand"};
svgedit.history.RemoveElementCommand.prototype.type=svgedit.history.RemoveElementCommand.type;svgedit.history.RemoveElementCommand.prototype.getText=function(){return this.text};svgedit.history.RemoveElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);svgedit.transformlist.removeElementFromListMap(this.elem);this.parent=this.elem.parentNode;this.elem=this.parent.removeChild(this.elem);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,
this)};svgedit.history.RemoveElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);svgedit.transformlist.removeElementFromListMap(this.elem);this.nextSibling==null&&window.console&&console.log("Error: reference element was lost");this.parent.insertBefore(this.elem,this.nextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.RemoveElementCommand.prototype.elements=function(){return[this.elem]};
svgedit.history.ChangeElementCommand=function(a,H,h){this.elem=a;this.text=h?"Change "+a.tagName+" "+h:"Change "+a.tagName;this.newValues={};this.oldValues=H;for(var i in H)this.newValues[i]=i=="#text"?a.textContent:i=="#href"?svgedit.utilities.getHref(a):a.getAttribute(i)};svgedit.history.ChangeElementCommand.type=function(){return"svgedit.history.ChangeElementCommand"};svgedit.history.ChangeElementCommand.prototype.type=svgedit.history.ChangeElementCommand.type;svgedit.history.ChangeElementCommand.prototype.getText=
function(){return this.text};svgedit.history.ChangeElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);var H=false,h;for(h in this.newValues){if(this.newValues[h])if(h=="#text")this.elem.textContent=this.newValues[h];else h=="#href"?svgedit.utilities.setHref(this.elem,this.newValues[h]):this.elem.setAttribute(h,this.newValues[h]);else if(h=="#text")this.elem.textContent="";else{this.elem.setAttribute(h,"");this.elem.removeAttribute(h)}if(h==
"transform")H=true}if(!H)if(H=svgedit.utilities.getRotationAngle(this.elem)){h=elem.getBBox();H=["rotate(",H," ",h.x+h.width/2,",",h.y+h.height/2,")"].join("");H!=elem.getAttribute("transform")&&elem.setAttribute("transform",H)}a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this);return true};svgedit.history.ChangeElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);var H=false,h;for(h in this.oldValues){if(this.oldValues[h])if(h==
"#text")this.elem.textContent=this.oldValues[h];else h=="#href"?svgedit.utilities.setHref(this.elem,this.oldValues[h]):this.elem.setAttribute(h,this.oldValues[h]);else if(h=="#text")this.elem.textContent="";else this.elem.removeAttribute(h);if(h=="transform")H=true}if(!H)if(H=svgedit.utilities.getRotationAngle(this.elem)){h=elem.getBBox();H=["rotate(",H," ",h.x+h.width/2,",",h.y+h.height/2,")"].join("");H!=elem.getAttribute("transform")&&elem.setAttribute("transform",H)}svgedit.transformlist.removeElementFromListMap(this.elem);
a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this);return true};svgedit.history.ChangeElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.BatchCommand=function(a){this.text=a||"Batch Command";this.stack=[]};svgedit.history.BatchCommand.type=function(){return"svgedit.history.BatchCommand"};svgedit.history.BatchCommand.prototype.type=svgedit.history.BatchCommand.type;svgedit.history.BatchCommand.prototype.getText=function(){return this.text};svgedit.history.BatchCommand.prototype.apply=
function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);for(var H=this.stack.length,h=0;h<H;++h)this.stack[h].apply(a);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)};svgedit.history.BatchCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);for(var H=this.stack.length-1;H>=0;H--)this.stack[H].unapply(a);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,
this)};svgedit.history.BatchCommand.prototype.elements=function(){for(var a=[],H=this.stack.length;H--;)for(var h=this.stack[H].elements(),i=h.length;i--;)a.indexOf(h[i])==-1&&a.push(h[i]);return a};svgedit.history.BatchCommand.prototype.addSubCommand=function(a){this.stack.push(a)};svgedit.history.BatchCommand.prototype.isEmpty=function(){return this.stack.length==0};svgedit.history.UndoManager=function(a){this.handler_=a||null;this.undoStackPointer=0;this.undoStack=[];this.undoChangeStackPointer=
-1;this.undoableChangeStack=[]};svgedit.history.UndoManager.prototype.resetUndoStack=function(){this.undoStack=[];this.undoStackPointer=0};svgedit.history.UndoManager.prototype.getUndoStackSize=function(){return this.undoStackPointer};svgedit.history.UndoManager.prototype.getRedoStackSize=function(){return this.undoStack.length-this.undoStackPointer};svgedit.history.UndoManager.prototype.getNextUndoCommandText=function(){return this.undoStackPointer>0?this.undoStack[this.undoStackPointer-1].getText():
""};svgedit.history.UndoManager.prototype.getNextRedoCommandText=function(){return this.undoStackPointer<this.undoStack.length?this.undoStack[this.undoStackPointer].getText():""};svgedit.history.UndoManager.prototype.undo=function(){this.undoStackPointer>0&&this.undoStack[--this.undoStackPointer].unapply(this.handler_)};svgedit.history.UndoManager.prototype.redo=function(){this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0&&this.undoStack[this.undoStackPointer++].apply(this.handler_)};
svgedit.history.UndoManager.prototype.addCommandToHistory=function(a){if(this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0)this.undoStack=this.undoStack.splice(0,this.undoStackPointer);this.undoStack.push(a);this.undoStackPointer=this.undoStack.length};svgedit.history.UndoManager.prototype.beginUndoableChange=function(a,H){for(var h=++this.undoChangeStackPointer,i=H.length,u=Array(i),E=Array(i);i--;){var e=H[i];if(e!=null){E[i]=e;u[i]=e.getAttribute(a)}}this.undoableChangeStack[h]=
{attrName:a,oldValues:u,elements:E}};svgedit.history.UndoManager.prototype.finishUndoableChange=function(){for(var a=this.undoChangeStackPointer--,H=this.undoableChangeStack[a],h=H.elements.length,i=H.attrName,u=new svgedit.history.BatchCommand("Change "+i);h--;){var E=H.elements[h];if(E!=null){var e={};e[i]=H.oldValues[h];e[i]!=E.getAttribute(i)&&u.addSubCommand(new svgedit.history.ChangeElementCommand(E,e,i))}}this.undoableChangeStack[a]=null;return u}})();svgedit=svgedit||{};
(function(){if(!svgedit.select)svgedit.select={};var a,H,h;svgedit.select.Selector=function(i,u){this.id=i;this.selectedElement=u;this.locked=true;this.selectorGroup=a.createSVGElement({element:"g",attr:{id:"selectorGroup"+this.id}});this.selectorRect=this.selectorGroup.appendChild(a.createSVGElement({element:"path",attr:{id:"selectedBox"+this.id,fill:"none",stroke:"#4F80FF","stroke-width":"1",style:"pointer-events:none"}}));this.gripCoords={nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null};
this.reset(this.selectedElement)};svgedit.select.Selector.prototype.reset=function(i){this.locked=true;this.selectedElement=i;this.resize();this.selectorGroup.setAttribute("display","inline")};svgedit.select.Selector.prototype.updateGripCursors=function(i){var u=[];i=Math.round(i/45);if(i<0)i+=8;for(var E in h.selectorGrips)u.push(E);for(;i>0;){u.push(u.shift());i--}i=0;for(E in h.selectorGrips){h.selectorGrips[E].setAttribute("style","cursor:"+u[i]+"-resize");i++}};svgedit.select.Selector.prototype.showGrips=
function(i){h.selectorGripsGroup.setAttribute("display",i?"inline":"none");var u=this.selectedElement;this.hasGrips=i;if(u&&i){this.selectorGroup.appendChild(h.selectorGripsGroup);this.updateGripCursors(svgedit.utilities.getRotationAngle(u))}};svgedit.select.Selector.prototype.resize=function(){var i=this.selectorRect,u=h,E=u.selectorGrips,e=this.selectedElement,f=e.getAttribute("stroke-width"),g=a.currentZoom(),p=1/g;if(e.getAttribute("stroke")!=="none"&&!isNaN(f))p+=f/2;var z=e.tagName;if(z==="text")p+=
2/g;f=svgedit.transformlist.getTransformList(e);f=svgedit.math.transformListToTransform(f).matrix;f.e*=g;f.f*=g;var D=svgedit.utilities.getBBox(e);if(z==="g"&&!$.data(e,"gsvg"))if(z=a.getStrokedBBox(e.childNodes))D=z;z=D.x;var q=D.y,M=D.width;D=D.height;p*=g;g=svgedit.math.transformBox(z*g,q*g,M*g,D*g,f);f=g.aabox;z=f.x-p;q=f.y-p;M=f.width+p*2;var ba=f.height+p*2;f=z+M/2;D=q+ba/2;if(e=svgedit.utilities.getRotationAngle(e)){z=a.svgRoot().createSVGTransform();z.setRotate(-e,f,D);z=z.matrix;g.tl=svgedit.math.transformPoint(g.tl.x,
g.tl.y,z);g.tr=svgedit.math.transformPoint(g.tr.x,g.tr.y,z);g.bl=svgedit.math.transformPoint(g.bl.x,g.bl.y,z);g.br=svgedit.math.transformPoint(g.br.x,g.br.y,z);z=g.tl;M=z.x;ba=z.y;var N=z.x,I=z.y;z=Math.min;q=Math.max;M=z(M,z(g.tr.x,z(g.bl.x,g.br.x)))-p;ba=z(ba,z(g.tr.y,z(g.bl.y,g.br.y)))-p;N=q(N,q(g.tr.x,q(g.bl.x,g.br.x)))+p;I=q(I,q(g.tr.y,q(g.bl.y,g.br.y)))+p;z=M;q=ba;M=N-M;ba=I-ba}p=a.svgRoot().suspendRedraw(100);i.setAttribute("d","M"+z+","+q+" L"+(z+M)+","+q+" "+(z+M)+","+(q+ba)+" "+z+","+(q+
ba)+"z");this.selectorGroup.setAttribute("transform",e?"rotate("+[e,f,D].join(",")+")":"");z-=3.5;q-=3.5;this.gripCoords={nw:[z,q],ne:[z+M,q],sw:[z,q+ba],se:[z+M,q+ba],n:[z+M/2,q],w:[z,q+ba/2],e:[z+M,q+ba/2],s:[z+M/2,q+ba]};for(var ma in this.gripCoords){i=this.gripCoords[ma];E[ma].setAttribute("x",i[0]);E[ma].setAttribute("y",i[1])}this.rotateCoords={nw:[z,q],ne:[z+M+8,q],sw:[z,q+ba+8],se:[z+M+8,q+ba+8]};for(ma in this.rotateCoords){i=this.rotateCoords[ma];u.rotateGrips[ma].setAttribute("cx",i[0]);
u.rotateGrips[ma].setAttribute("cy",i[1])}a.svgRoot().unsuspendRedraw(p)};svgedit.select.SelectorManager=function(){this.rubberBandBox=this.selectorParentGroup=null;this.selectors=[];this.selectorMap={};this.selectorGrips={nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null};this.selectorGripsGroup=null;this.rotateGrips={nw:null,ne:null,se:null,sw:null};this.initGroup()};svgedit.select.SelectorManager.prototype.initGroup=function(){this.selectorParentGroup&&this.selectorParentGroup.parentNode&&
this.selectorParentGroup.parentNode.removeChild(this.selectorParentGroup);this.selectorParentGroup=a.createSVGElement({element:"g",attr:{id:"selectorParentGroup"}});this.selectorGripsGroup=a.createSVGElement({element:"g",attr:{display:"none"}});this.selectorParentGroup.appendChild(this.selectorGripsGroup);a.svgRoot().appendChild(this.selectorParentGroup);this.selectorMap={};this.selectors=[];this.rubberBandBox=null;for(var i in this.rotateGrips){var u=a.createSVGElement({element:"circle",attr:{id:"selectorGrip_rotate_"+
i,fill:"transparent",r:8,stroke:"transparent","stroke-width":0,style:"cursor:url("+H.imgPath+"rotate.png) 12 12, auto;"}});$.data(u,"dir",i);$.data(u,"type","rotate");this.rotateGrips[i]=this.selectorGripsGroup.appendChild(u)}for(i in this.selectorGrips){u=a.createSVGElement({element:"rect",attr:{id:"selectorGrip_resize_"+i,width:7,height:7,fill:"#4F80FF",stroke:"transparent","stroke-width":2,style:"cursor:"+i+"-resize","pointer-events":"all"}});$.data(u,"dir",i);$.data(u,"type","resize");this.selectorGrips[i]=
this.selectorGripsGroup.appendChild(u)}if(!$("#canvasBackground").length){i=H.dimensions;i=a.createSVGElement({element:"svg",attr:{id:"canvasBackground",width:i[0],height:i[1],x:0,y:0,overflow:svgedit.browser.isWebkit()?"none":"visible",style:"pointer-events:none"}});u=a.createSVGElement({element:"rect",attr:{width:"100%",height:"100%",x:0,y:0,"stroke-width":1,stroke:"#000",fill:"#FFF",style:"pointer-events:none"}});i.appendChild(u);a.svgRoot().insertBefore(i,a.svgContent())}};svgedit.select.SelectorManager.prototype.requestSelector=
function(i){if(i==null)return null;var u=this.selectors.length;if(typeof this.selectorMap[i.id]=="object"){this.selectorMap[i.id].locked=true;return this.selectorMap[i.id]}for(var E=0;E<u;++E)if(this.selectors[E]&&!this.selectors[E].locked){this.selectors[E].locked=true;this.selectors[E].reset(i);this.selectorMap[i.id]=this.selectors[E];return this.selectors[E]}this.selectors[u]=new svgedit.select.Selector(u,i);this.selectorParentGroup.appendChild(this.selectors[u].selectorGroup);this.selectorMap[i.id]=
this.selectors[u];return this.selectors[u]};svgedit.select.SelectorManager.prototype.releaseSelector=function(i){if(i!=null)for(var u=this.selectors.length,E=this.selectorMap[i.id],e=0;e<u;++e)if(this.selectors[e]&&this.selectors[e]==E){E.locked==false&&console.log("WARNING! selector was released but was already unlocked");delete this.selectorMap[i.id];E.locked=false;E.selectedElement=null;E.showGrips(false);try{E.selectorGroup.setAttribute("display","none")}catch(f){}break}};svgedit.select.SelectorManager.prototype.getRubberBandBox=
function(){if(!this.rubberBandBox)this.rubberBandBox=this.selectorParentGroup.appendChild(a.createSVGElement({element:"rect",attr:{id:"selectorRubberBand",fill:"transparent",stroke:"#666","stroke-width":1,"stroke-dasharray":"3,2",display:"none",style:"pointer-events:none"}}));return this.rubberBandBox};svgedit.select.init=function(i,u){H=i;a=u;h=new svgedit.select.SelectorManager};svgedit.select.getSelectorManager=function(){return h}})();svgedit=svgedit||{};
(function(){if(!svgedit.draw)svgedit.draw={};var a="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use".split(","),H={LET_DOCUMENT_DECIDE:0,ALWAYS_RANDOMIZE:1,NEVER_RANDOMIZE:2},h=H.LET_DOCUMENT_DECIDE;svgedit.draw.Layer=function(i,u){this.name_=i;this.group_=u};svgedit.draw.Layer.prototype.getName=function(){return this.name_};svgedit.draw.Layer.prototype.getGroup=function(){return this.group_};svgedit.draw.randomizeIds=function(i,u){h=i==false?H.NEVER_RANDOMIZE:
H.ALWAYS_RANDOMIZE;if(h==H.ALWAYS_RANDOMIZE&&!u.getNonce())u.setNonce(Math.floor(Math.random()*100001));else h==H.NEVER_RANDOMIZE&&u.getNonce()&&u.clearNonce()};svgedit.draw.Drawing=function(i,u){if(!i||!i.tagName||!i.namespaceURI||i.tagName!="svg"||i.namespaceURI!="http://www.w3.org/2000/svg")throw"Error: svgedit.draw.Drawing instance initialized without a <svg> element";this.svgElem_=i;this.obj_num=0;this.idPrefix=u||"svg_";this.releasedNums=[];this.all_layers=[];this.current_layer=null;this.nonce_=
"";var E=this.svgElem_.getAttributeNS("http://svg-edit.googlecode.com","nonce");if(E&&h!=H.NEVER_RANDOMIZE)this.nonce_=E;else h==H.ALWAYS_RANDOMIZE&&this.setNonce(Math.floor(Math.random()*100001))};svgedit.draw.Drawing.prototype.getElem_=function(i){return this.svgElem_.querySelector?this.svgElem_.querySelector("#"+i):$(this.svgElem_).find("[id="+i+"]")[0]};svgedit.draw.Drawing.prototype.getSvgElem=function(){return this.svgElem_};svgedit.draw.Drawing.prototype.getNonce=function(){return this.nonce_};
svgedit.draw.Drawing.prototype.setNonce=function(i){this.svgElem_.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:se","http://svg-edit.googlecode.com");this.svgElem_.setAttributeNS("http://svg-edit.googlecode.com","se:nonce",i);this.nonce_=i};svgedit.draw.Drawing.prototype.clearNonce=function(){this.nonce_=""};svgedit.draw.Drawing.prototype.getId=function(){return this.nonce_?this.idPrefix+this.nonce_+"_"+this.obj_num:this.idPrefix+this.obj_num};svgedit.draw.Drawing.prototype.getNextId=function(){var i=
this.obj_num,u=false;if(this.releasedNums.length>0){this.obj_num=this.releasedNums.pop();u=true}else this.obj_num++;for(var E=this.getId();this.getElem_(E);){if(u){this.obj_num=i;u=false}this.obj_num++;E=this.getId()}if(u)this.obj_num=i;return E};svgedit.draw.Drawing.prototype.releaseId=function(i){var u=this.idPrefix+(this.nonce_?this.nonce_+"_":"");if(typeof i!="string"||i.indexOf(u)!=0)return false;i=parseInt(i.substr(u.length));if(typeof i!="number"||i<=0||this.releasedNums.indexOf(i)!=-1)return false;
this.releasedNums.push(i);return true};svgedit.draw.Drawing.prototype.getNumLayers=function(){return this.all_layers.length};svgedit.draw.Drawing.prototype.hasLayer=function(i){for(var u=0;u<this.getNumLayers();u++)if(this.all_layers[u][0]==i)return true;return false};svgedit.draw.Drawing.prototype.getLayerName=function(i){if(i>=0&&i<this.getNumLayers())return this.all_layers[i][0];return""};svgedit.draw.Drawing.prototype.getCurrentLayer=function(){return this.current_layer};svgedit.draw.Drawing.prototype.getCurrentLayerName=
function(){for(var i=0;i<this.getNumLayers();++i)if(this.all_layers[i][1]==this.current_layer)return this.getLayerName(i);return""};svgedit.draw.Drawing.prototype.setCurrentLayer=function(i){for(var u=0;u<this.getNumLayers();++u)if(i==this.getLayerName(u)){if(this.current_layer!=this.all_layers[u][1]){this.current_layer.setAttribute("style","pointer-events:none");this.current_layer=this.all_layers[u][1];this.current_layer.setAttribute("style","pointer-events:all")}return true}return false};svgedit.draw.Drawing.prototype.deleteCurrentLayer=
function(){if(this.current_layer&&this.getNumLayers()>1){var i=this.current_layer.parentNode.removeChild(this.current_layer);this.identifyLayers();return i}return null};svgedit.draw.Drawing.prototype.identifyLayers=function(){this.all_layers=[];for(var i=this.svgElem_.childNodes.length,u=[],E=[],e=null,f=false,g=0;g<i;++g){var p=this.svgElem_.childNodes.item(g);if(p&&p.nodeType==1)if(p.tagName=="g"){f=true;var z=$("title",p).text();if(!z&&svgedit.browser.isOpera()&&p.querySelectorAll)z=$(p.querySelectorAll("title")).text();
if(z){E.push(z);this.all_layers.push([z,p]);e=p;svgedit.utilities.walkTree(p,function(D){D.setAttribute("style","pointer-events:inherit")});e.setAttribute("style","pointer-events:none")}else u.push(p)}else if(~a.indexOf(p.nodeName)){svgedit.utilities.getBBox(p);u.push(p)}}i=this.svgElem_.ownerDocument;if(u.length>0||!f){for(g=1;E.indexOf("Layer "+g)>=0;)g++;E="Layer "+g;e=i.createElementNS("http://www.w3.org/2000/svg","g");f=i.createElementNS("http://www.w3.org/2000/svg","title");f.textContent=E;
e.appendChild(f);for(f=0;f<u.length;++f)e.appendChild(u[f]);this.svgElem_.appendChild(e);this.all_layers.push([E,e])}svgedit.utilities.walkTree(e,function(D){D.setAttribute("style","pointer-events:inherit")});this.current_layer=e;this.current_layer.setAttribute("style","pointer-events:all")};svgedit.draw.Drawing.prototype.createLayer=function(i){var u=this.svgElem_.ownerDocument,E=u.createElementNS("http://www.w3.org/2000/svg","g");u=u.createElementNS("http://www.w3.org/2000/svg","title");u.textContent=
i;E.appendChild(u);this.svgElem_.appendChild(E);this.identifyLayers();return E};svgedit.draw.Drawing.prototype.getLayerVisibility=function(i){for(var u=null,E=0;E<this.getNumLayers();++E)if(this.getLayerName(E)==i){u=this.all_layers[E][1];break}if(!u)return false;return u.getAttribute("display")!="none"};svgedit.draw.Drawing.prototype.setLayerVisibility=function(i,u){if(typeof u!="boolean")return null;for(var E=null,e=0;e<this.getNumLayers();++e)if(this.getLayerName(e)==i){E=this.all_layers[e][1];
break}if(!E)return null;E.getAttribute("display");E.setAttribute("display",u?"inline":"none");return E};svgedit.draw.Drawing.prototype.getLayerOpacity=function(i){for(var u=0;u<this.getNumLayers();++u)if(this.getLayerName(u)==i){(i=this.all_layers[u][1].getAttribute("opacity"))||(i="1.0");return parseFloat(i)}return null};svgedit.draw.Drawing.prototype.setLayerOpacity=function(i,u){if(!(typeof u!="number"||u<0||u>1))for(var E=0;E<this.getNumLayers();++E)if(this.getLayerName(E)==i){this.all_layers[E][1].setAttribute("opacity",
u);break}}})();svgedit=svgedit||{};
(function(){if(!svgedit.path)svgedit.path={};var a={pathNodeTooltip:"Drag node to move it. Double-click node to change segment type",pathCtrlPtTooltip:"Drag control point to adjust curve properties"},H={2:["x","y"],4:["x","y"],6:["x","y","x1","y1","x2","y2"],8:["x","y","x1","y1"],10:["x","y","r1","r2","angle","largeArcFlag","sweepFlag"],12:["x"],14:["y"],16:["x","y","x2","y2"],18:["x","y"]},h=[],i=true,u={};svgedit.path.setLinkControlPoints=function(f){i=f};var E=svgedit.path.path=null;svgedit.path.init=
function(f){E=f;h=[0,"ClosePath"];$.each(["Moveto","Lineto","CurvetoCubic","CurvetoQuadratic","Arc","LinetoHorizontal","LinetoVertical","CurvetoCubicSmooth","CurvetoQuadraticSmooth"],function(g,p){h.push(p+"Abs");h.push(p+"Rel")})};svgedit.path.insertItemBefore=function(f,g,p){f=f.pathSegList;if(svgedit.browser.supportsPathInsertItemBefore())f.insertItemBefore(g,p);else{for(var z=f.numberOfItems,D=[],q=0;q<z;q++){var M=f.getItem(q);D.push(M)}f.clear();for(q=0;q<z;q++){q==p&&f.appendItem(g);f.appendItem(D[q])}}};
svgedit.path.ptObjToArr=function(f,g){for(var p=H[f],z=p.length,D=Array(z),q=0;q<z;q++)D[q]=g[p[q]];return D};svgedit.path.getGripPt=function(f,g){var p={x:g?g.x:f.item.x,y:g?g.y:f.item.y},z=f.path;if(z.matrix)p=svgedit.math.transformPoint(p.x,p.y,z.matrix);p.x*=E.getCurrentZoom();p.y*=E.getCurrentZoom();return p};svgedit.path.getPointFromGrip=function(f,g){var p={x:f.x,y:f.y};if(g.matrix){f=svgedit.math.transformPoint(p.x,p.y,g.imatrix);p.x=f.x;p.y=f.y}p.x/=E.getCurrentZoom();p.y/=E.getCurrentZoom();
return p};svgedit.path.addPointGrip=function(f,g,p){var z=svgedit.path.getGripContainer(),D=svgedit.utilities.getElem("pathpointgrip_"+f);if(!D){D=document.createElementNS("http://www.w3.org/2000/svg","rect");svgedit.utilities.assignAttributes(D,{id:"pathpointgrip_"+f,display:"none",width:5,height:5,fill:"#fff",stroke:"#4F80FF","stroke-width":1,cursor:"move",style:"pointer-events:all","xlink:title":a.pathNodeTooltip});D=z.appendChild(D);$("#pathpointgrip_"+f).dblclick(function(){svgedit.path.path&&
svgedit.path.path.setSegType()})}g&&p&&svgedit.utilities.assignAttributes(D,{x:g-2.5,y:p-2.5,display:"inline"});return D};svgedit.path.getGripContainer=function(){var f=svgedit.utilities.getElem("pathpointgrip_container");if(!f){f=svgedit.utilities.getElem("selectorParentGroup").appendChild(document.createElementNS("http://www.w3.org/2000/svg","g"));f.id="pathpointgrip_container"}return f};svgedit.path.addCtrlGrip=function(f){var g=svgedit.utilities.getElem("ctrlpointgrip_"+f);if(g)return g;g=document.createElementNS("http://www.w3.org/2000/svg",
"circle");svgedit.utilities.assignAttributes(g,{id:"ctrlpointgrip_"+f,display:"none",r:3,fill:"#4F80FF",cursor:"move",style:"pointer-events:all","xlink:title":a.pathCtrlPtTooltip});svgedit.path.getGripContainer().appendChild(g);return g};svgedit.path.getCtrlLine=function(f){var g=svgedit.utilities.getElem("ctrlLine_"+f);if(g)return g;g=document.createElementNS("http://www.w3.org/2000/svg","line");svgedit.utilities.assignAttributes(g,{id:"ctrlLine_"+f,stroke:"#4F80FF","stroke-width":1,style:"pointer-events:none"});
svgedit.path.getGripContainer().appendChild(g);return g};svgedit.path.getPointGrip=function(f,g){var p=svgedit.path.addPointGrip(f.index);if(g){var z=svgedit.path.getGripPt(f);svgedit.utilities.assignAttributes(p,{cx:z.x,cy:z.y,display:"inline"})}return p};svgedit.path.getControlPoints=function(f){var g=f.item,p=f.index;if(!("x1"in g)||!("x2"in g))return null;var z={};svgedit.path.getGripContainer();for(var D=[svgedit.path.path.segs[p-1].item,g],q=1;q<3;q++){var M=p+"c"+q,ba=z["c"+q+"_line"]=svgedit.path.getCtrlLine(M),
N=svgedit.path.getGripPt(f,{x:g["x"+q],y:g["y"+q]}),I=svgedit.path.getGripPt(f,{x:D[q-1].x,y:D[q-1].y});svgedit.utilities.assignAttributes(ba,{x1:N.x,y1:N.y,x2:I.x,y2:I.y,display:"inline"});z["c"+q+"_line"]=ba;pointGrip=z["c"+q]=svgedit.path.addCtrlGrip(M);svgedit.utilities.assignAttributes(pointGrip,{cx:N.x,cy:N.y,display:"inline"});z["c"+q]=pointGrip}return z};svgedit.path.replacePathSeg=function(f,g,p,z){z=z||svgedit.path.path.elem;f=z["createSVGPathSeg"+h[f]].apply(z,p);if(svgedit.browser.supportsPathReplaceItem())z.pathSegList.replaceItem(f,
g);else{p=z.pathSegList;z=p.numberOfItems;for(var D=[],q=0;q<z;q++){var M=p.getItem(q);D.push(M)}p.clear();for(q=0;q<z;q++)q==g?p.appendItem(f):p.appendItem(D[q])}};svgedit.path.getSegSelector=function(f,g){var p=f.index,z=svgedit.utilities.getElem("segline_"+p);if(!z){var D=svgedit.path.getGripContainer();z=document.createElementNS("http://www.w3.org/2000/svg","path");svgedit.utilities.assignAttributes(z,{id:"segline_"+p,display:"none",fill:"none",stroke:"#0FF","stroke-width":2,style:"pointer-events:none",
d:"M0,0 0,0"});D.appendChild(z)}if(g){p=f.prev;if(!p){z.setAttribute("display","none");return z}p=svgedit.path.getGripPt(p);svgedit.path.replacePathSeg(2,0,[p.x,p.y],z);D=svgedit.path.ptObjToArr(f.type,f.item,true);for(var q=0;q<D.length;q+=2){p=svgedit.path.getGripPt(f,{x:D[q],y:D[q+1]});D[q]=p.x;D[q+1]=p.y}svgedit.path.replacePathSeg(f.type,1,D,z)}return z};svgedit.path.smoothControlPoints=this.smoothControlPoints=function(f,g,p){var z=f.x-p.x,D=f.y-p.y,q=g.x-p.x,M=g.y-p.y;if((z!=0||D!=0)&&(q!=
0||M!=0)){f=Math.atan2(D,z);g=Math.atan2(M,q);z=Math.sqrt(z*z+D*D);q=Math.sqrt(q*q+M*M);D=E.getSVGRoot().createSVGPoint();M=E.getSVGRoot().createSVGPoint();if(f<0)f+=2*Math.PI;if(g<0)g+=2*Math.PI;var ba=Math.abs(f-g),N=Math.abs(Math.PI-ba)/2;if(f-g>0){f=ba<Math.PI?f+N:f-N;g=ba<Math.PI?g-N:g+N}else{f=ba<Math.PI?f-N:f+N;g=ba<Math.PI?g+N:g-N}D.x=z*Math.cos(f)+p.x;D.y=z*Math.sin(f)+p.y;M.x=q*Math.cos(g)+p.x;M.y=q*Math.sin(g)+p.y;return[D,M]}};svgedit.path.Segment=function(f,g){this.selected=false;this.index=
f;this.item=g;this.type=g.pathSegType;this.ctrlpts=[];this.segsel=this.ptgrip=null};svgedit.path.Segment.prototype.showCtrlPts=function(f){for(var g in this.ctrlpts)this.ctrlpts[g].setAttribute("display",f?"inline":"none")};svgedit.path.Segment.prototype.selectCtrls=function(){$("#ctrlpointgrip_"+this.index+"c1, #ctrlpointgrip_"+this.index+"c2").attr("fill","#4F80FF")};svgedit.path.Segment.prototype.show=function(f){if(this.ptgrip){this.ptgrip.setAttribute("display",f?"inline":"none");this.segsel.setAttribute("display",
f?"inline":"none");this.showCtrlPts(f)}};svgedit.path.Segment.prototype.select=function(f){if(this.ptgrip){this.ptgrip.setAttribute("stroke",f?"#0FF":"#00F");this.segsel.setAttribute("display",f?"inline":"none");this.ctrlpts&&this.selectCtrls(f);this.selected=f}};svgedit.path.Segment.prototype.addGrip=function(){this.ptgrip=svgedit.path.getPointGrip(this,true);this.ctrlpts=svgedit.path.getControlPoints(this,true);this.segsel=svgedit.path.getSegSelector(this,true)};svgedit.path.Segment.prototype.update=
function(f){if(this.ptgrip){var g=svgedit.path.getGripPt(this);svgedit.utilities.assignAttributes(this.ptgrip,this.ptgrip.nodeName=="rect"?{x:g.x-2.5,y:g.y-2.5}:{cx:g.x,cy:g.y});svgedit.path.getSegSelector(this,true);if(this.ctrlpts){if(f){this.item=svgedit.path.path.elem.pathSegList.getItem(this.index);this.type=this.item.pathSegType}svgedit.path.getControlPoints(this)}}};svgedit.path.Segment.prototype.move=function(f,g){var p=this.item;p=this.ctrlpts?[p.x+=f,p.y+=g,p.x1,p.y1,p.x2+=f,p.y2+=g]:[p.x+=
f,p.y+=g];svgedit.path.replacePathSeg(this.type,this.index,p);if(this.next&&this.next.ctrlpts){p=this.next.item;p=[p.x,p.y,p.x1+=f,p.y1+=g,p.x2,p.y2];svgedit.path.replacePathSeg(this.next.type,this.next.index,p)}if(this.mate){p=this.mate.item;p=[p.x+=f,p.y+=g];svgedit.path.replacePathSeg(this.mate.type,this.mate.index,p)}this.update(true);this.next&&this.next.update(true)};svgedit.path.Segment.prototype.setLinked=function(f){var g,p,z;if(f==2){p=1;g=this.next;if(!g)return;z=this.item}else{p=2;g=this.prev;
if(!g)return;z=g.item}var D=g.item;D["x"+p]=z.x+(z.x-this.item["x"+f]);D["y"+p]=z.y+(z.y-this.item["y"+f]);svgedit.path.replacePathSeg(g.type,g.index,[D.x,D.y,D.x1,D.y1,D.x2,D.y2]);g.update(true)};svgedit.path.Segment.prototype.moveCtrl=function(f,g,p){var z=this.item;z["x"+f]+=g;z["y"+f]+=p;svgedit.path.replacePathSeg(this.type,this.index,[z.x,z.y,z.x1,z.y1,z.x2,z.y2]);this.update(true)};svgedit.path.Segment.prototype.setType=function(f,g){svgedit.path.replacePathSeg(f,this.index,g);this.type=f;
this.item=svgedit.path.path.elem.pathSegList.getItem(this.index);this.showCtrlPts(f===6);this.ctrlpts=svgedit.path.getControlPoints(this);this.update(true)};svgedit.path.Path=function(f){if(!f||f.tagName!=="path")throw"svgedit.path.Path constructed without a <path> element";this.elem=f;this.segs=[];this.selected_pts=[];svgedit.path.path=this;this.init()};svgedit.path.Path.prototype.init=function(){$(svgedit.path.getGripContainer()).find("*").attr("display","none");var f=this.elem.pathSegList,g=f.numberOfItems;
this.segs=[];this.selected_pts=[];this.first_seg=null;for(var p=0;p<g;p++){var z=f.getItem(p);z=new svgedit.path.Segment(p,z);z.path=this;this.segs.push(z)}f=this.segs;z=null;for(p=0;p<g;p++){var D=f[p],q=p+1>=g?null:f[p+1],M=p-1<0?null:f[p-1];if(D.type===2){if(M&&M.type!==1){q=f[z];q.next=f[z+1];q.next.prev=q;q.addGrip()}z=p}else if(q&&q.type===1){D.next=f[z+1];D.next.prev=D;D.mate=f[z];D.addGrip();if(this.first_seg==null)this.first_seg=D}else if(q){if(D.type!==1){D.addGrip();if(q&&q.type!==2){D.next=
q;D.next.prev=D}}}else if(D.type!==1){q=f[z];q.next=f[z+1];q.next.prev=q;q.addGrip();D.addGrip();if(!this.first_seg)this.first_seg=f[z]}}return this};svgedit.path.Path.prototype.eachSeg=function(f){for(var g=this.segs.length,p=0;p<g;p++)if(f.call(this.segs[p],p)===false)break};svgedit.path.Path.prototype.addSeg=function(f){var g=this.segs[f];if(g.prev){var p=g.prev,z;switch(g.item.pathSegType){case 4:var D=(g.item.x+p.item.x)/2,q=(g.item.y+p.item.y)/2;z=this.elem.createSVGPathSegLinetoAbs(D,q);break;
case 6:z=(p.item.x+g.item.x1)/2;var M=(g.item.x1+g.item.x2)/2,ba=(g.item.x2+g.item.x)/2,N=(z+M)/2;M=(M+ba)/2;D=(N+M)/2;var I=(p.item.y+g.item.y1)/2,ma=(g.item.y1+g.item.y2)/2;p=(g.item.y2+g.item.y)/2;var ia=(I+ma)/2;ma=(ma+p)/2;q=(ia+ma)/2;z=this.elem.createSVGPathSegCurvetoCubicAbs(D,q,z,I,N,ia);svgedit.path.replacePathSeg(g.type,f,[g.item.x,g.item.y,M,ma,ba,p])}svgedit.path.insertItemBefore(this.elem,z,f)}};svgedit.path.Path.prototype.deleteSeg=function(f){var g=this.segs[f],p=this.elem.pathSegList;
g.show(false);var z=g.next;if(g.mate){var D=[z.item.x,z.item.y];svgedit.path.replacePathSeg(2,z.index,D);svgedit.path.replacePathSeg(4,g.index,D);p.removeItem(g.mate.index)}else{if(!g.prev){D=[z.item.x,z.item.y];svgedit.path.replacePathSeg(2,g.next.index,D)}p.removeItem(f)}};svgedit.path.Path.prototype.subpathIsClosed=function(f){var g=false;svgedit.path.path.eachSeg(function(p){if(p<=f)return true;if(this.type===2)return false;else if(this.type===1){g=true;return false}});return g};svgedit.path.Path.prototype.removePtFromSelection=
function(f){var g=this.selected_pts.indexOf(f);if(g!=-1){this.segs[f].select(false);this.selected_pts.splice(g,1)}};svgedit.path.Path.prototype.clearSelection=function(){this.eachSeg(function(){this.select(false)});this.selected_pts=[]};svgedit.path.Path.prototype.storeD=function(){this.last_d=this.elem.getAttribute("d")};svgedit.path.Path.prototype.show=function(f){this.eachSeg(function(){this.show(f)});f&&this.selectPt(this.first_seg.index);return this};svgedit.path.Path.prototype.movePts=function(f,
g){for(var p=this.selected_pts.length;p--;)this.segs[this.selected_pts[p]].move(f,g)};svgedit.path.Path.prototype.moveCtrl=function(f,g){var p=this.segs[this.selected_pts[0]];p.moveCtrl(this.dragctrl,f,g);i&&p.setLinked(this.dragctrl)};svgedit.path.Path.prototype.setSegType=function(f){this.storeD();for(var g=this.selected_pts.length,p;g--;){var z=this.segs[this.selected_pts[g]],D=z.prev;if(D){if(!f){p="Toggle Path Segment Type";f=z.type==6?4:6}f-=0;var q=z.item.x,M=z.item.y,ba=D.item.x;D=D.item.y;
var N;switch(f){case 6:if(z.olditem){ba=z.olditem;N=[q,M,ba.x1,ba.y1,ba.x2,ba.y2]}else{N=q-ba;var I=M-D;N=[q,M,ba+N/3,D+I/3,q-N/3,M-I/3]}break;case 4:N=[q,M];z.olditem=z.item}z.setType(f,N)}}svgedit.path.path.endChanges(p)};svgedit.path.Path.prototype.selectPt=function(f,g){this.clearSelection();f==null&&this.eachSeg(function(p){if(this.prev)f=p});this.addPtsToSelection(f);if(g){this.dragctrl=g;i&&this.segs[f].setLinked(g)}};svgedit.path.Path.prototype.update=function(){var f=this.elem;if(svgedit.utilities.getRotationAngle(f)){this.matrix=
svgedit.math.getMatrix(f);this.imatrix=this.matrix.inverse()}else this.imatrix=this.matrix=null;this.eachSeg(function(g){this.item=f.pathSegList.getItem(g);this.update()});return this};svgedit.path.getPath_=function(f){var g=u[f.id];g||(g=u[f.id]=new svgedit.path.Path(f));return g};svgedit.path.removePath_=function(f){f in u&&delete u[f]};var e=function(f,g){dx=f-oldcx;dy=g-oldcy;r=Math.sqrt(dx*dx+dy*dy);theta=Math.atan2(dy,dx)+angle;dx=r*Math.cos(theta)+oldcx;dy=r*Math.sin(theta)+oldcy;dx-=newcx;
dy-=newcy;r=Math.sqrt(dx*dx+dy*dy);theta=Math.atan2(dy,dx)-angle;return{x:(r*Math.cos(theta)+newcx)/1,y:(r*Math.sin(theta)+newcy)/1}};svgedit.path.recalcRotatedPath=function(){var f=svgedit.path.path.elem,g=svgedit.utilities.getRotationAngle(f,true);if(g){var p=svgedit.utilities.getBBox(f),z=svgedit.path.path.oldbbox,D=z.x+z.width/2,q=z.y+z.height/2;z=p.x+p.width/2;p=p.y+p.height/2;z=z-D;var M=p-q;p=Math.sqrt(z*z+M*M);M=Math.atan2(M,z)+g;z=p*Math.cos(M)+D;p=p*Math.sin(M)+q;D=f.pathSegList;for(q=D.numberOfItems;q;){q-=
1;M=D.getItem(q);var ba=M.pathSegType;if(ba!=1){var N=e(M.x,M.y);N=[N.x,N.y];if(M.x1!=null&&M.x2!=null){c_vals1=e(M.x1,M.y1);c_vals2=e(M.x2,M.y2);N.splice(N.length,0,c_vals1.x,c_vals1.y,c_vals2.x,c_vals2.y)}svgedit.path.replacePathSeg(ba,q,N)}}svgedit.utilities.getBBox(f);D=svgroot.createSVGTransform();f=svgedit.transformlist.getTransformList(f);D.setRotate(g*180/Math.PI,z,p);f.replaceItem(D,0)}};svgedit.path.clearData=function(){u={}}})();if(!window.console){window.console={};window.console.log=function(){};window.console.dir=function(){}}if(window.opera){window.console.log=function(a){opera.postError(a)};window.console.dir=function(){}}
(function(){var a=jQuery.fn.attr;jQuery.fn.attr=function(H,h){var i=this.length;if(!i)return a.apply(this,arguments);for(var u=0;u<i;u++){var E=this[u];if(E.namespaceURI==="http://www.w3.org/2000/svg")if(h!==undefined)E.setAttribute(H,h);else if($.isArray(H)){i=H.length;for(u={};i--;){var e=H[i],f=E.getAttribute(e);if(f||f==="0")f=isNaN(f)?f:f-0;u[e]=f}return u}else if(typeof H==="object")for(e in H)E.setAttribute(e,H[e]);else{if((f=E.getAttribute(H))||f==="0")f=isNaN(f)?f:f-0;return f}else return a.apply(this,
arguments)}return this}})();
$.SvgCanvas=function(a,H){function h(b,c){for(var d=svgedit.utilities.getBBox(b),n=0;n<2;n++){var m=n===0?"fill":"stroke",A=b.getAttribute(m);if(A&&A.indexOf("url(")===0){A=Sa(A);if(A.tagName==="linearGradient"){var o=A.getAttribute("x1")||0,l=A.getAttribute("y1")||0,s=A.getAttribute("x2")||1,B=A.getAttribute("y2")||0;o=d.width*o+d.x;l=d.height*l+d.y;s=d.width*s+d.x;B=d.height*B+d.y;o=ka(o,l,c);B=ka(s,B,c);s={};s.x1=(o.x-d.x)/d.width;s.y1=(o.y-d.y)/d.height;s.x2=(B.x-d.x)/d.width;s.y2=(B.y-d.y)/d.height;
A=A.cloneNode(true);$(A).attr(s);A.id=ya();ib().appendChild(A);b.setAttribute(m,"url(#"+A.id+")")}}}}var i="http://www.w3.org/2000/svg",u={show_outside_canvas:true,selectNew:true,dimensions:[640,480]};H&&$.extend(u,H);var E=u.dimensions,e=this,f=a.ownerDocument,g=f.importNode(svgedit.utilities.text2xml('<svg id="svgroot" xmlns="'+i+'" xlinkns="http://www.w3.org/1999/xlink" width="'+E[0]+'" height="'+E[1]+'" x="'+E[0]+'" y="'+E[1]+'" overflow="visible"><defs><filter id="canvashadow" filterUnits="objectBoundingBox"><feGaussianBlur in="SourceAlpha" stdDeviation="4" result="blur"/><feOffset in="blur" dx="5" dy="5" result="offsetBlur"/><feMerge><feMergeNode in="offsetBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs></svg>').documentElement,
true);a.appendChild(g);var p=f.createElementNS(i,"svg");(e.clearSvgContentElement=function(){for(;p.firstChild;)p.removeChild(p.firstChild);$(p).attr({id:"svgcontent",width:E[0],height:E[1],x:E[0],y:E[1],overflow:u.show_outside_canvas?"visible":"hidden",xmlns:i,"xmlns:se":"http://svg-edit.googlecode.com","xmlns:xlink":"http://www.w3.org/1999/xlink"}).appendTo(g);var b=f.createComment(" Created with SVG-edit - http://svg-edit.googlecode.com/ ");p.appendChild(b)})();var z="svg_";e.setIdPrefix=function(b){z=
b};e.current_drawing_=new svgedit.draw.Drawing(p,z);var D=e.getCurrentDrawing=function(){return e.current_drawing_},q=1,M=null,ba={shape:{fill:(u.initFill.color=="none"?"":"#")+u.initFill.color,fill_paint:null,fill_opacity:u.initFill.opacity,stroke:"#"+u.initStroke.color,stroke_paint:null,stroke_opacity:u.initStroke.opacity,stroke_width:u.initStroke.width,stroke_dasharray:"none",stroke_linejoin:"miter",stroke_linecap:"butt",opacity:u.initOpacity}};ba.text=$.extend(true,{},ba.shape);$.extend(ba.text,
{fill:"#000000",stroke_width:0,font_size:24,font_family:"Junction"});var N=ba.shape,I=Array(1),ma=this.addSvgElementFromJson=function(b){var c=svgedit.utilities.getElem(b.attr.id),d=D().getCurrentLayer();if(c&&b.element!=c.tagName){d.removeChild(c);c=null}if(!c){c=f.createElementNS(i,b.element);if(d)(M||d).appendChild(c)}b.curStyles&&svgedit.utilities.assignAttributes(c,{fill:N.fill,stroke:N.stroke,"stroke-width":N.stroke_width,"stroke-dasharray":N.stroke_dasharray,"stroke-linejoin":N.stroke_linejoin,
"stroke-linecap":N.stroke_linecap,"stroke-opacity":N.stroke_opacity,"fill-opacity":N.fill_opacity,opacity:N.opacity/2,style:"pointer-events:inherit"},100);svgedit.utilities.assignAttributes(c,b.attr,100);svgedit.utilities.cleanupElement(c);return c},ia=e.getTransformList=svgedit.transformlist.getTransformList,ka=svgedit.math.transformPoint,X=e.matrixMultiply=svgedit.math.matrixMultiply,qa=e.hasMatrixTransform=svgedit.math.hasMatrixTransform,ga=e.transformListToTransform=svgedit.math.transformListToTransform,
Na=svgedit.math.snapToAngle,va=svgedit.math.getMatrix;svgedit.units.init({getBaseUnit:function(){return u.baseUnit},getElement:svgedit.utilities.getElem,getHeight:function(){return p.getAttribute("height")/q},getWidth:function(){return p.getAttribute("width")/q},getRoundDigits:function(){return Ua.round_digits}});var ha=e.convertToNum=svgedit.units.convertToNum;svgedit.utilities.init({getDOMDocument:function(){return f},getDOMContainer:function(){return a},getSVGRoot:function(){return g},getSelectedElements:function(){return I},
getSVGContent:function(){return p}});var Ra=e.getUrlFromAttr=svgedit.utilities.getUrlFromAttr,U=e.getHref=svgedit.utilities.getHref,Z=e.setHref=svgedit.utilities.setHref,ea=svgedit.utilities.getPathBBox;e.getBBox=svgedit.utilities.getBBox;var ra=e.getRotationAngle=svgedit.utilities.getRotationAngle,ja=e.getElem=svgedit.utilities.getElem,la=e.assignAttributes=svgedit.utilities.assignAttributes,T=this.cleanupElement=svgedit.utilities.cleanupElement,wa=svgedit.sanitize.getNSMap(),Da=e.sanitizeSvg=svgedit.sanitize.sanitizeSvg,
Ma=svgedit.history.MoveElementCommand,Fa=svgedit.history.InsertElementCommand,Oa=svgedit.history.RemoveElementCommand,Qa=svgedit.history.ChangeElementCommand,Ga=svgedit.history.BatchCommand;e.undoMgr=new svgedit.history.UndoManager({handleHistoryEvent:function(b,c){var d=svgedit.history.HistoryEventTypes;if(b==d.BEFORE_UNAPPLY||b==d.BEFORE_APPLY)e.clearSelection();else if(b==d.AFTER_APPLY||b==d.AFTER_UNAPPLY){var n=c.elements();e.pathActions.clear();aa("changed",n);n=c.type();d=b==d.AFTER_APPLY;if(n==
Ma.type()){d=d?c.newParent:c.oldParent;d==p&&e.identifyLayers()}else if(n==Fa.type()||n==Oa.type()){c.parent==p&&e.identifyLayers();if(n==Fa.type())d&&mb(c.elem);else d||mb(c.elem);c.elem.tagName==="use"&&Tb(c.elem)}else if(n==Qa.type()){c.elem.tagName=="title"&&c.elem.parentNode.parentNode==p&&e.identifyLayers();d=d?c.newValues:c.oldValues;d.stdDeviation&&e.setBlurOffsets(c.elem.parentNode,d.stdDeviation);if(c.elem.tagName==="use"&&svgedit.browser.isWebkit()){n=c.elem;if(!n.getAttribute("x")&&!n.getAttribute("y")){d=
n.parentNode;var m=n.nextSibling;d.removeChild(n);d.insertBefore(n,m)}}}}}});var Ca=function(b){e.undoMgr.addCommandToHistory(b)};svgedit.select.init(u,{createSVGElement:function(b){return e.addSvgElementFromJson(b)},svgRoot:function(){return g},svgContent:function(){return p},currentZoom:function(){return q},getStrokedBBox:function(b){return e.getStrokedBBox([b])}});var Ha=this.selectorManager=svgedit.select.getSelectorManager();svgedit.path.init({getCurrentZoom:function(){return q},getSVGRoot:function(){return g}});
svgedit.utilities.snapToGrid=function(b){var c=u.snappingStep,d=u.baseUnit;if(d!=="px")c*=svgedit.units.getTypeMap()[d];return b=Math.round(b/c)*c};var Aa=svgedit.utilities.snapToGrid,zb={exportNoBlur:"Blurred elements will appear as un-blurred",exportNoforeignObject:"foreignObject elements will not appear",exportNoDashArray:"Strokes will appear filled",exportNoText:"Text may not appear as expected"},Pb=["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],gb=$.data,
mb=function(b){var c=$(b).attr(Pb),d;for(d in c){var n=c[d];if(n&&n.indexOf("url(")===0){n=Ra(n).substr(1);if(!ja(n)){ib().appendChild(Jb[n]);delete Jb[n]}}}b=b.getElementsByTagName("*");if(b.length){c=0;for(d=b.length;c<d;c++)mb(b[c])}},Va={},ub=u.imgPath+"logo.png",Bb=[],Ua={round_digits:5},Ja=false,Wa=null,Ia="select",kb="none",Cb={},ab=ba.text,cb=N,db=null,za=null,vb=[],lb={},xb=null,Jb={};e.clipBoard=[];var pb=this.runExtensions=function(b,c,d){var n=false;if(d)n=[];$.each(lb,function(m,A){if(b in
A)if(d)n.push(A[b](c));else n=A[b](c)});return n};this.addExtension=function(b,c){if(b in lb)console.log('Cannot add extension "'+b+'", an extension by that name already exists"');else{var d=$.isFunction(c)?c($.extend(e.getPrivateMethods(),{svgroot:g,svgcontent:p,nonce:D().getNonce(),selectorManager:Ha})):c;lb[b]=d;aa("extension_added",d)}};var Kb=this.round=function(b){return parseInt(b*q)/q},Rb=this.getIntersectionList=function(b){if(za==null)return null;var c=M||D().getCurrentLayer();vb.length||
(vb=Sb(c));var d=null;try{d=c.getIntersectionList(b,null)}catch(n){}if(d==null||typeof d.item!="function"){d=[];if(b)b=b;else{b=za.getBBox();c={};for(var m in b)c[m]=b[m]/q;b=c}for(m=vb.length;m--;)b.width&&b.width&&svgedit.math.rectsIntersect(b,vb[m].bbox)&&d.push(vb[m].elem)}return d};getStrokedBBox=this.getStrokedBBox=function(b){b||(b=Lb());if(!b.length)return false;var c=function(B){try{var w=svgedit.utilities.getBBox(B),v=svgedit.utilities.getRotationAngle(B);if(v&&v%90||svgedit.math.hasMatrixTransform(svgedit.transformlist.getTransformList(B))){v=
false;if(["ellipse","path","line","polyline","polygon"].indexOf(B.tagName)>=0)w=v=e.convertToPath(B,true);else if(B.tagName=="rect"){var C=B.getAttribute("rx"),F=B.getAttribute("ry");if(C||F)w=v=e.convertToPath(B,true)}if(!v){var J=B.cloneNode(true),K=document.createElementNS(i,"g"),P=B.parentNode;P.appendChild(K);K.appendChild(J);w=svgedit.utilities.bboxToObj(K.getBBox());P.removeChild(K)}}return w}catch(ca){console.log(B,ca);return null}},d;$.each(b,function(){if(!d)if(this.parentNode)d=c(this)});
if(d==null)return null;var n=d.x+d.width,m=d.y+d.height,A=d.x,o=d.y,l=function(B){var w=B.getAttribute("stroke-width"),v=0;if(B.getAttribute("stroke")!="none"&&!isNaN(w))v+=w/2;return v},s=[];$.each(b,function(B,w){var v=c(w);if(v){var C=l(w);A=Math.min(A,v.x-C);o=Math.min(o,v.y-C);s.push(v)}});d.x=A;d.y=o;$.each(b,function(B,w){var v=s[B];if(v&&w.nodeType==1){var C=l(w);n=Math.max(n,v.x+v.width+C);m=Math.max(m,v.y+v.height+C)}});d.width=n-A;d.height=m-o;return d};var Lb=this.getVisibleElements=function(b){b||
(b=$(p).children());var c=[];$(b).children().each(function(d,n){try{n.getBBox()&&c.push(n)}catch(m){}});return c.reverse()},Sb=this.getVisibleElementsAndBBoxes=function(b){b||(b=$(p).children());var c=[];$(b).children().each(function(d,n){try{n.getBBox()&&c.push({elem:n,bbox:getStrokedBBox([n])})}catch(m){}});return c.reverse()},pa=this.groupSvgElem=function(b){var c=document.createElementNS(i,"g");b.parentNode.replaceChild(c,b);$(c).append(b).data("gsvg",b)[0].id=ya()},V=function(b){var c=document.createElementNS(b.namespaceURI,
b.nodeName);c.removeAttribute("id");$.each(b.attributes,function(n,m){m.localName!="-moz-math-font-style"&&c.setAttributeNS(m.namespaceURI,m.nodeName,m.nodeValue)});if(svgedit.browser.isWebkit()&&b.nodeName=="path"){var d=La.convertPath(b);c.setAttribute("d",d)}$.each(b.childNodes,function(n,m){switch(m.nodeType){case 1:c.appendChild(V(m));break;case 3:c.textContent=m.nodeValue}});if($(b).data("gsvg"))$(c).data("gsvg",c.firstChild);else if($(b).data("symbol")){b=$(b).data("symbol");$(c).data("ref",
b).data("symbol",b)}else c.tagName=="image"&&Yb(c);c.id=ya();console.log(c);return c},ua,ya,aa;(function(b){var c={};ua=b.getId=function(){return D().getId()};ya=b.getNextId=function(){return D().getNextId()};aa=b.call=function(d,n){if(c[d])return c[d](this,n)};b.bind=function(d,n){var m=c[d];c[d]=n;return m}})(e);this.prepareSvg=function(b){this.sanitizeSvg(b.documentElement);b=b.getElementsByTagNameNS(i,"path");for(var c=0,d=b.length;c<d;++c){var n=b[c];n.setAttribute("d",La.convertPath(n));La.fixEnd(n)}};
var Sa=this.getRefElem=function(b){return ja(Ra(b).substr(1))},Eb=function(b){if(!svgedit.browser.isGecko())return b;var c=b.cloneNode(true);b.parentNode.insertBefore(c,b);b.parentNode.removeChild(b);Ha.releaseSelector(b);I[0]=c;Ha.requestSelector(c).showGrips(true);return c};this.setRotationAngle=function(b,c){b=parseFloat(b);var d=I[0],n=d.getAttribute("transform"),m=svgedit.utilities.getBBox(d),A=m.x+m.width/2,o=m.y+m.height/2;m=ia(d);m.numberOfItems>0&&m.getItem(0).type==4&&m.removeItem(0);if(b!=
0){A=ka(A,o,ga(m).matrix);o=g.createSVGTransform();o.setRotate(b,A.x,A.y);m.numberOfItems?m.insertItemBefore(o,0):m.appendItem(o)}else m.numberOfItems==0&&d.removeAttribute("transform");if(!c){m=d.getAttribute("transform");d.setAttribute("transform",n);jb("transform",m,I);aa("changed",I)}ja("pathpointgrip_container");d=Ha.requestSelector(I[0]);d.resize();d.updateGripCursors(b)};var Ab=this.recalculateAllSelectedDimensions=function(){for(var b=new Ga(kb=="none"?"position":"size"),c=I.length;c--;){var d=
nb(I[c]);d&&b.addSubCommand(d)}if(!b.isEmpty()){Ca(b);aa("changed",I)}},wb=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"],tb=function(b){console.log([b.a,b.b,b.c,b.d,b.e,b.f])},Fb=this.remapElement=function(b,c,d){var n=u.gridSnapping&&b.parentNode.parentNode.localName==="svg",m=function(){if(n)for(var v in c)c[v]=Aa(c[v]);la(b,c,1E3,true)};box=svgedit.utilities.getBBox(b);for(var A=0;A<2;A++){var o=A===0?"fill":"stroke",l=b.getAttribute(o);if(l&&l.indexOf("url(")===
0)if(d.a<0||d.d<0){l=Sa(l).cloneNode(true);if(d.a<0){var s=l.getAttribute("x1"),B=l.getAttribute("x2");l.setAttribute("x1",-(s-1));l.setAttribute("x2",-(B-1))}if(d.d<0){s=l.getAttribute("y1");B=l.getAttribute("y2");l.setAttribute("y1",-(s-1));l.setAttribute("y2",-(B-1))}l.id=ya();ib().appendChild(l);b.setAttribute(o,"url(#"+l.id+")")}}A=b.tagName;if(A==="g"||A==="text"||A==="use")if(d.a==1&&d.b==0&&d.c==0&&d.d==1&&(d.e!=0||d.f!=0)){o=ga(b).matrix;o=X(o.inverse(),d,o);c.x=parseFloat(c.x)+o.e;c.y=parseFloat(c.y)+
o.f}else{o=ia(b);l=g.createSVGTransform();l.setMatrix(X(ga(o).matrix,d));o.clear();o.appendItem(l)}switch(A){case "foreignObject":case "rect":case "image":if(A==="image"&&(d.a<0||d.d<0)){o=ia(b);l=g.createSVGTransform();l.setMatrix(X(ga(o).matrix,d));o.clear();o.appendItem(l)}else{o=ka(c.x,c.y,d);c.width=d.a*c.width;c.height=d.d*c.height;c.x=o.x+Math.min(0,c.width);c.y=o.y+Math.min(0,c.height);c.width=Math.abs(c.width);c.height=Math.abs(c.height)}m();break;case "ellipse":A=ka(c.cx,c.cy,d);c.cx=A.x;
c.cy=A.y;c.rx=d.a*c.rx;c.ry=d.d*c.ry;c.rx=Math.abs(c.rx);c.ry=Math.abs(c.ry);m();break;case "circle":A=ka(c.cx,c.cy,d);c.cx=A.x;c.cy=A.y;A=svgedit.math.transformBox(box.x,box.y,box.width,box.height,d);c.r=Math.min((A.tr.x-A.tl.x)/2,(A.bl.y-A.tl.y)/2);if(c.r)c.r=Math.abs(c.r);m();break;case "line":o=ka(c.x1,c.y1,d);s=ka(c.x2,c.y2,d);c.x1=o.x;c.y1=o.y;c.x2=s.x;c.y2=s.y;case "text":d=b.querySelectorAll("tspan");for(A=d.length;A--;){o=ha("x",b.getAttribute("x"));l=ha("x",d[A].getAttribute("x"));s=ha("y",
b.getAttribute("y"));B=ha("y",d[A].getAttribute("y"));var w={};if(!isNaN(o)&&!isNaN(l)&&o!=0&&l!=0&&c.x)w.x=c.x-(o-l);if(!isNaN(s)&&!isNaN(B)&&s!=0&&B!=0&&c.y)w.y=c.y-(s-B);if(w.x||w.y)la(d[A],w,1E3,true)}m();break;case "use":m();break;case "g":(m=$(b).data("gsvg"))&&la(m,c,1E3,true);break;case "polyline":case "polygon":m=c.points.length;for(A=0;A<m;++A){B=c.points[A];B=ka(B.x,B.y,d);c.points[A].x=B.x;c.points[A].y=B.y}m=c.points.length;d="";for(A=0;A<m;++A){B=c.points[A];d+=B.x+","+B.y+" "}b.setAttribute("points",
d);break;case "path":o=b.pathSegList;m=o.numberOfItems;c.d=Array(m);for(A=0;A<m;++A){l=o.getItem(A);c.d[A]={type:l.pathSegType,x:l.x,y:l.y,x1:l.x1,y1:l.y1,x2:l.x2,y2:l.y2,r1:l.r1,r2:l.r2,angle:l.angle,largeArcFlag:l.largeArcFlag,sweepFlag:l.sweepFlag}}m=c.d.length;A=c.d[0];w=ka(A.x,A.y,d);c.d[0].x=w.x;c.d[0].y=w.y;for(A=1;A<m;++A){l=c.d[A];o=l.type;if(o%2==0){B=ka(l.x!=undefined?l.x:w.x,l.y!=undefined?l.y:w.y,d);o=ka(l.x1,l.y1,d);s=ka(l.x2,l.y2,d);l.x=B.x;l.y=B.y;l.x1=o.x;l.y1=o.y;l.x2=s.x;l.y2=s.y}else{l.x=
d.a*l.x;l.y=d.d*l.y;l.x1=d.a*l.x1;l.y1=d.d*l.y1;l.x2=d.a*l.x2;l.y2=d.d*l.y2}l.r1=d.a*l.r1;l.r2=d.d*l.r2}d="";m=c.d.length;for(A=0;A<m;++A){l=c.d[A];o=l.type;d+=wb[o];switch(o){case 13:case 12:d+=l.x+" ";break;case 15:case 14:d+=l.y+" ";break;case 3:case 5:case 19:case 2:case 4:case 18:d+=l.x+","+l.y+" ";break;case 7:case 6:d+=l.x1+","+l.y1+" "+l.x2+","+l.y2+" "+l.x+","+l.y+" ";break;case 9:case 8:d+=l.x1+","+l.y1+" "+l.x+","+l.y+" ";break;case 11:case 10:d+=l.r1+","+l.r2+" "+l.angle+" "+ +l.largeArcFlag+
" "+ +l.sweepFlag+" "+l.x+","+l.y+" ";break;case 17:case 16:d+=l.x2+","+l.y2+" "+l.x+","+l.y+" "}}b.setAttribute("d",d)}},Qb=function(b,c,d){b=Sa(b).firstChild;var n=ia(b),m=g.createSVGTransform();m.setTranslate(c,d);n.appendItem(m);nb(b)},nb=this.recalculateDimensions=function(b){if(b==null)return null;var c=ia(b);if(c&&c.numberOfItems>0){for(var d=c.numberOfItems;d--;){var n=c.getItem(d);if(n.type===0)c.removeItem(d);else if(n.type===1)svgedit.math.isIdentity(n.matrix)&&c.removeItem(d);else n.type===
4&&n.angle===0&&c.removeItem(d)}if(c.numberOfItems===1&&ra(b))return null}if(!c||c.numberOfItems==0){b.removeAttribute("transform");return null}if(c){d=c.numberOfItems;for(var m=[];d--;){n=c.getItem(d);if(n.type===1)m.push([n.matrix,d]);else if(m.length)m=[]}if(m.length===2){d=g.createSVGTransformFromMatrix(X(m[1][0],m[0][0]));c.removeItem(m[0][1]);c.removeItem(m[1][1]);c.insertItemBefore(d,m[1][1])}d=c.numberOfItems;if(d>=2&&c.getItem(d-2).type===1&&c.getItem(d-1).type===2){m=g.createSVGTransform();
n=X(c.getItem(d-2).matrix,c.getItem(d-1).matrix);m.setMatrix(n);c.removeItem(d-2);c.removeItem(d-2);c.appendItem(m)}}switch(b.tagName){case "line":case "polyline":case "polygon":case "path":break;default:if(c.numberOfItems===1&&c.getItem(0).type===1||c.numberOfItems===2&&c.getItem(0).type===1&&c.getItem(0).type===4)return null}var A=$(b).data("gsvg");d=new Ga("Transform");var o={},l=null;n=[];switch(b.tagName){case "line":n=["x1","y1","x2","y2"];break;case "circle":n=["cx","cy","r"];break;case "ellipse":n=
["cx","cy","rx","ry"];break;case "foreignObject":case "rect":case "image":n=["width","height","x","y"];break;case "use":case "text":case "tspan":n=["x","y"];break;case "polygon":case "polyline":l={};l.points=b.getAttribute("points");m=b.points;var s=m.numberOfItems;o.points=Array(s);for(var B=0;B<s;++B){var w=m.getItem(B);o.points[B]={x:w.x,y:w.y}}break;case "path":l={};l.d=b.getAttribute("d");o.d=b.getAttribute("d")}if(n.length){o=$(b).attr(n);$.each(o,function(yb,Gb){o[yb]=ha(yb,Gb)})}else if(A)o=
{x:$(A).attr("x")||0,y:$(A).attr("y")||0};if(l==null){l=$.extend(true,{},o);$.each(l,function(yb,Gb){l[yb]=ha(yb,Gb)})}l.transform=Wa?Wa:"";if(b.tagName=="g"&&!A||b.tagName=="a"){m=svgedit.utilities.getBBox(b);var v={x:m.x+m.width/2,y:m.y+m.height/2},C=ka(m.x+m.width/2,m.y+m.height/2,ga(c).matrix);n=g.createSVGMatrix();if(m=ra(b)){B=m*Math.PI/180;s=Math.abs(B)>1.0E-10?Math.sin(B)/(1-Math.cos(B)):2/B;for(B=0;B<c.numberOfItems;++B){n=c.getItem(B);if(n.type==4){n=n.matrix;v.y=(s*n.e+n.f)/2;v.x=(n.e-
s*n.f)/2;c.removeItem(B);break}}}B=n=A=0;var F=c.numberOfItems;if(F)var J=c.getItem(0).matrix;if(F>=3&&c.getItem(F-2).type==3&&c.getItem(F-3).type==2&&c.getItem(F-1).type==2){B=3;var K=c.getItem(F-3).matrix,P=c.getItem(F-2).matrix,ca=c.getItem(F-1).matrix;s=b.childNodes;for(w=s.length;w--;){var fa=s.item(w);n=A=0;if(fa.nodeType==1){var R=ia(fa);if(R){n=ga(R).matrix;A=ra(fa);var W=Wa,Y=[];Wa=fa.getAttribute("transform");if(A||qa(R)){var na=g.createSVGTransform();na.setMatrix(X(K,P,ca,n));R.clear();
R.appendItem(na);Y.push(na)}else{A=X(n.inverse(),ca,n);na=g.createSVGMatrix();na.e=-A.e;na.f=-A.f;n=X(na.inverse(),n.inverse(),K,P,ca,n,A.inverse());var Xa=g.createSVGTransform(),qb=g.createSVGTransform(),Hb=g.createSVGTransform();Xa.setTranslate(A.e,A.f);qb.setScale(n.a,n.d);Hb.setTranslate(na.e,na.f);R.appendItem(Hb);R.appendItem(qb);R.appendItem(Xa);Y.push(Hb);Y.push(qb);Y.push(Xa)}d.addSubCommand(nb(fa));Wa=W}}}c.removeItem(F-1);c.removeItem(F-2);c.removeItem(F-3)}else if(F>=3&&c.getItem(F-1).type==
1){B=3;n=ga(c).matrix;na=g.createSVGTransform();na.setMatrix(n);c.clear();c.appendItem(na)}else if((F==1||F>1&&c.getItem(1).type!=3)&&c.getItem(0).type==2){B=2;A=ga(c).matrix;c.removeItem(0);n=ga(c).matrix.inverse();n=X(n,A);A=n.e;n=n.f;if(A!=0||n!=0){s=b.childNodes;w=s.length;for(F=[];w--;){fa=s.item(w);if(fa.nodeType==1){if(fa.getAttribute("clip-path")){W=fa.getAttribute("clip-path");if(F.indexOf(W)===-1){Qb(W,A,n);F.push(W)}}W=Wa;Wa=fa.getAttribute("transform");if(R=ia(fa)){K=g.createSVGTransform();
K.setTranslate(A,n);R.numberOfItems?R.insertItemBefore(K,0):R.appendItem(K);d.addSubCommand(nb(fa));R=b.getElementsByTagNameNS(i,"use");fa="#"+fa.id;for(K=R.length;K--;){P=R.item(K);if(fa==U(P)){ca=g.createSVGTransform();ca.setTranslate(-A,-n);ia(P).insertItemBefore(ca,0);d.addSubCommand(nb(P))}}Wa=W}}}F=[];Wa=W}}else if(F==1&&c.getItem(0).type==1&&!m){B=1;n=c.getItem(0).matrix;s=b.childNodes;for(w=s.length;w--;){fa=s.item(w);if(fa.nodeType==1){W=Wa;Wa=fa.getAttribute("transform");if(R=ia(fa)){A=
X(n,ga(R).matrix);F=g.createSVGTransform();F.setMatrix(A);R.clear();R.appendItem(F,0);d.addSubCommand(nb(fa));Wa=W;W=fa.getAttribute("stroke-width");fa.getAttribute("stroke")!=="none"&&!isNaN(W)&&fa.setAttribute("stroke-width",W*((Math.abs(A.a)+Math.abs(A.d))/2))}}}c.clear()}else{if(m){v=g.createSVGTransform();v.setRotate(m,C.x,C.y);c.numberOfItems?c.insertItemBefore(v,0):c.appendItem(v)}c.numberOfItems==0&&b.removeAttribute("transform");return null}if(B==2){if(m){C={x:v.x+J.e,y:v.y+J.f};v=g.createSVGTransform();
v.setRotate(m,C.x,C.y);c.numberOfItems?c.insertItemBefore(v,0):c.appendItem(v)}}else if(B==3){n=ga(c).matrix;J=g.createSVGTransform();J.setRotate(m,v.x,v.y);J=J.matrix;v=g.createSVGTransform();v.setRotate(m,C.x,C.y);C=v.matrix.inverse();W=n.inverse();C=X(W,C,J,n);A=C.e;n=C.f;if(A!=0||n!=0){s=b.childNodes;for(w=s.length;w--;){fa=s.item(w);if(fa.nodeType==1){W=Wa;Wa=fa.getAttribute("transform");R=ia(fa);K=g.createSVGTransform();K.setTranslate(A,n);R.numberOfItems?R.insertItemBefore(K,0):R.appendItem(K);
d.addSubCommand(nb(fa));Wa=W}}}if(m)c.numberOfItems?c.insertItemBefore(v,0):c.appendItem(v)}}else{m=svgedit.utilities.getBBox(b);if(!m&&b.tagName!="path")return null;n=g.createSVGMatrix();if(A=ra(b)){v={x:m.x+m.width/2,y:m.y+m.height/2};C=ka(m.x+m.width/2,m.y+m.height/2,ga(c).matrix);B=A*Math.PI/180;s=Math.abs(B)>1.0E-10?Math.sin(B)/(1-Math.cos(B)):2/B;for(B=0;B<c.numberOfItems;++B){n=c.getItem(B);if(n.type==4){n=n.matrix;v.y=(s*n.e+n.f)/2;v.x=(n.e-s*n.f)/2;c.removeItem(B);break}}}B=0;F=c.numberOfItems;
if(!svgedit.browser.isWebkit())if((J=b.getAttribute("fill"))&&J.indexOf("url(")===0){J=Sa(J);W="pattern";if(J.tagName!==W)W="gradient";if(J.getAttribute(W+"Units")==="userSpaceOnUse"){n=ga(c).matrix;m=ia(J);m=ga(m).matrix;n=X(n,m);m="matrix("+[n.a,n.b,n.c,n.d,n.e,n.f].join(",")+")";J.setAttribute(W+"Transform",m)}}if(F>=3&&c.getItem(F-2).type==3&&c.getItem(F-3).type==2&&c.getItem(F-1).type==2){B=3;n=ga(c,F-3,F-1).matrix;c.removeItem(F-1);c.removeItem(F-2);c.removeItem(F-3)}else if(F==4&&c.getItem(F-
1).type==1){B=3;n=ga(c).matrix;na=g.createSVGTransform();na.setMatrix(n);c.clear();c.appendItem(na);n=g.createSVGMatrix()}else if((F==1||F>1&&c.getItem(1).type!=3)&&c.getItem(0).type==2){B=2;J=c.getItem(0).matrix;W=ga(c,1).matrix;m=W.inverse();n=X(m,J,W);c.removeItem(0)}else if(F==1&&c.getItem(0).type==1&&!A){n=ga(c).matrix;switch(b.tagName){case "line":o=$(b).attr(["x1","y1","x2","y2"]);case "polyline":case "polygon":o.points=b.getAttribute("points");if(o.points){m=b.points;s=m.numberOfItems;o.points=
Array(s);for(B=0;B<s;++B){w=m.getItem(B);o.points[B]={x:w.x,y:w.y}}}case "path":o.d=b.getAttribute("d");B=1;c.clear()}}else{B=4;if(A){v=g.createSVGTransform();v.setRotate(A,C.x,C.y);c.numberOfItems?c.insertItemBefore(v,0):c.appendItem(v)}c.numberOfItems==0&&b.removeAttribute("transform");return null}if(B==1||B==2||B==3)Fb(b,o,n);if(B==2){if(A){qa(c)||(C={x:v.x+n.e,y:v.y+n.f});v=g.createSVGTransform();v.setRotate(A,C.x,C.y);c.numberOfItems?c.insertItemBefore(v,0):c.appendItem(v)}}else if(B==3&&A){n=
ga(c).matrix;J=g.createSVGTransform();J.setRotate(A,v.x,v.y);J=J.matrix;v=g.createSVGTransform();v.setRotate(A,C.x,C.y);C=v.matrix.inverse();W=n.inverse();C=X(W,C,J,n);Fb(b,o,C);if(A)c.numberOfItems?c.insertItemBefore(v,0):c.appendItem(v)}}c.numberOfItems==0&&b.removeAttribute("transform");d.addSubCommand(new Qa(b,l));return d},Mb=null,Ta=this.clearSelection=function(b){if(I[0]!=null)for(var c=I.length,d=0;d<c;++d){var n=I[d];if(n==null)break;Ha.releaseSelector(n);I[d]=null}b||aa("selected",I)},eb=
this.addToSelection=function(b,c){if(b.length!=0){for(var d=0;d<I.length;){if(I[d]==null)break;++d}for(var n=b.length;n--;){var m=b[n];if(m&&svgedit.utilities.getBBox(m)){if(m.tagName==="a"&&m.childNodes.length===1)m=m.firstChild;if(I.indexOf(m)==-1){I[d]=m;d++;m=Ha.requestSelector(m);I.length>1&&m.showGrips(false)}}}aa("selected",I);c||I.length==1?Ha.requestSelector(I[0]).showGrips(true):Ha.requestSelector(I[0]).showGrips(false);for(I.sort(function(A,o){if(A&&o&&A.compareDocumentPosition)return 3-
(o.compareDocumentPosition(A)&6);else if(A==null)return 1});I[0]==null;)I.shift(0)}},Ib=this.selectOnly=function(b,c){Ta(true);eb(b,c)};this.removeFromSelection=function(b){if(I[0]!=null)if(b.length!=0){var c=Array(I.length);j=0;len=I.length;for(var d=0;d<len;++d){var n=I[d];if(n)if(b.indexOf(n)==-1){c[j]=n;j++}else Ha.releaseSelector(n)}I=c}};this.selectAllInCurrentLayer=function(){var b=D().getCurrentLayer();if(b){Ia="select";Ib($(M||b).children())}};var Zb=this.getMouseTarget=function(b){if(b==
null)return null;b=b.target;if(b.correspondingUseElement)b=b.correspondingUseElement;if(["http://www.w3.org/1998/Math/MathML","http://www.w3.org/1999/xhtml"].indexOf(b.namespaceURI)>=0&&b.id!="svgcanvas")for(;b.nodeName!="foreignObject";){b=b.parentNode;if(!b)return g}var c=D().getCurrentLayer();if([g,a,p,c].indexOf(b)>=0)return g;if($(b).closest("#selectorParentGroup").length)return Ha.selectorParentGroup;for(;b.parentNode!==(M||c);)b=b.parentNode;return b};(function(){var b=null,c=null,d=null,n=
null,m=null,A={},o={minx:null,miny:null,maxx:null,maxy:null};$(a).mousedown(function(l){if(!(e.spaceKey||l.button===1)){var s=l.button===2;l.altKey&&svgCanvas.cloneSelectedElements(0,0);Mb=p.getScreenCTM().inverse();var B=ka(l.pageX,l.pageY,Mb),w=B.x*q,v=B.y*q;l.preventDefault();if(s){Ia="select";xb=B}B=w/q;v=v/q;var C=Zb(l);if(C.tagName==="a"&&C.childNodes.length===1)C=C.firstChild;w=n=c=B;var F=m=d=v;if(u.gridSnapping){B=Aa(B);v=Aa(v);c=Aa(c);d=Aa(d)}if(C==Ha.selectorParentGroup&&I[0]!=null){C=
l.target;var J=gb(C,"type");if(J=="rotate"){Ia="rotate";current_rotate_mode=gb(C,"dir")}else if(J=="resize"){Ia="resize";kb=gb(C,"dir")}C=I[0]}Wa=C.getAttribute("transform");J=ia(C);switch(Ia){case "select":Ja=true;kb="none";if(s)Ja=false;if(C!=g){if(I.indexOf(C)==-1){l.shiftKey||Ta(true);eb([C]);db=C;La.clear()}if(!s)for(s=0;s<I.length;++s)if(I[s]!=null){var K=ia(I[s]);K.numberOfItems?K.insertItemBefore(g.createSVGTransform(),0):K.appendItem(g.createSVGTransform())}}else if(!s){Ta();Ia="multiselect";
if(za==null)za=Ha.getRubberBandBox();n*=q;m*=q;la(za,{x:n,y:m,width:0,height:0,display:"inline"},100)}break;case "zoom":Ja=true;if(za==null)za=Ha.getRubberBandBox();la(za,{x:w*q,y:w*q,width:0,height:0,display:"inline"},100);break;case "resize":Ja=true;c=B;d=v;A=svgedit.utilities.getBBox($("#selectedBox0")[0]);var P={};$.each(A,function(ca,fa){P[ca]=fa/q});A=P;s=ra(C)?1:0;if(qa(J)){J.insertItemBefore(g.createSVGTransform(),s);J.insertItemBefore(g.createSVGTransform(),s);J.insertItemBefore(g.createSVGTransform(),
s)}else{J.appendItem(g.createSVGTransform());J.appendItem(g.createSVGTransform());J.appendItem(g.createSVGTransform());if(svgedit.browser.supportsNonScalingStroke()){if(B=svgedit.browser.isChrome())K=function(ca){var fa=ca.getAttributeNS(null,"stroke");ca.removeAttributeNS(null,"stroke");setTimeout(function(){ca.setAttributeNS(null,"stroke",fa)},1)};C.style.vectorEffect="non-scaling-stroke";B&&K(C);v=C.getElementsByTagName("*");w=v.length;for(s=0;s<w;s++){v[s].style.vectorEffect="non-scaling-stroke";
B&&K(v[s])}}}break;case "fhellipse":case "fhrect":case "fhpath":Ja=true;b=w+","+F+" ";K=N.stroke_width==0?1:N.stroke_width;ma({element:"polyline",curStyles:true,attr:{points:b,id:ya(),fill:"none",opacity:N.opacity/2,"stroke-linecap":"round",style:"pointer-events:none"}});o.minx=w;o.maxx=w;o.miny=F;o.maxy=F;break;case "image":Ja=true;K=ma({element:"image",attr:{x:B,y:v,width:0,height:0,id:ya(),opacity:N.opacity/2,style:"pointer-events:inherit"}});Z(K,ub);Yb(K);break;case "square":case "rect":Ja=true;
c=B;d=v;ma({element:"rect",curStyles:true,attr:{x:B,y:v,width:0,height:0,id:ya(),opacity:N.opacity/2}});break;case "line":Ja=true;K=N.stroke_width==0?1:N.stroke_width;ma({element:"line",curStyles:true,attr:{x1:B,y1:v,x2:B,y2:v,id:ya(),stroke:N.stroke,"stroke-width":K,"stroke-dasharray":N.stroke_dasharray,"stroke-linejoin":N.stroke_linejoin,"stroke-linecap":N.stroke_linecap,"stroke-opacity":N.stroke_opacity,fill:"none",opacity:N.opacity/2,style:"pointer-events:none"}});break;case "circle":Ja=true;
ma({element:"circle",curStyles:true,attr:{cx:B,cy:v,r:0,id:ya(),opacity:N.opacity/2}});break;case "ellipse":Ja=true;ma({element:"ellipse",curStyles:true,attr:{cx:B,cy:v,rx:0,ry:0,id:ya(),opacity:N.opacity/2}});break;case "text":Ja=true;ma({element:"text",curStyles:true,attr:{x:B,y:v,id:ya(),fill:ab.fill,"stroke-width":ab.stroke_width,"font-size":ab.font_size,"font-family":ab.font_family,"text-anchor":"middle","xml:space":"preserve",opacity:N.opacity}});break;case "path":case "pathedit":c*=q;d*=q;
La.mouseDown(l,C,c,d);Ja=true;break;case "textedit":c*=q;d*=q;fb.mouseDown(l,C,c,d);Ja=true;break;case "rotate":Ja=true;e.undoMgr.beginUndoableChange("transform",I);document.getElementById("workarea").className="rotate"}l=pb("mouseDown",{event:l,start_x:c,start_y:d,selectedElements:I},true);$.each(l,function(ca,fa){if(fa&&fa.started)Ja=true})}}).mousemove(function(l){if(Ja)if(!(l.button===1||e.spaceKey)){var s=I[0],B=ka(l.pageX,l.pageY,Mb),w=B.x*q;B=B.y*q;var v=ja(ua()),C=x=w/q,F=y=B/q;if(u.gridSnapping){x=
Aa(x);y=Aa(y)}l.preventDefault();switch(Ia){case "select":if(I[0]!==null){C=x-c;var J=y-d;if(u.gridSnapping){C=Aa(C);J=Aa(J)}if(l.shiftKey){var K=Na(c,d,x,y);x=K.x;y=K.y}if(C!=0||J!=0){K=I.length;for(F=0;F<K;++F){s=I[F];if(s==null)break;var P=g.createSVGTransform();v=ia(s);P.setTranslate(C,J);v.numberOfItems?v.replaceItem(P,0):v.appendItem(P);Ha.requestSelector(s).resize()}aa("transition",I)}}break;case "multiselect":C*=q;F*=q;la(za,{x:Math.min(n,C),y:Math.min(m,F),width:Math.abs(C-n),height:Math.abs(F-
m)},100);v=[];C=[];P=Rb();K=I.length;for(F=0;F<K;++F){J=P.indexOf(I[F]);if(J==-1)v.push(I[F]);else P[J]=null}K=P.length;for(F=0;F<K;++F)P[F]&&C.push(P[F]);v.length>0&&e.removeFromSelection(v);C.length>0&&eb(C);break;case "resize":v=ia(s);C=(K=qa(v))?A:svgedit.utilities.getBBox(s);F=C.x;P=C.y;var ca=C.width,fa=C.height;C=x-c;J=y-d;if(u.gridSnapping){C=Aa(C);J=Aa(J);fa=Aa(fa);ca=Aa(ca)}var R=ra(s);if(R){var W=Math.sqrt(C*C+J*J);J=Math.atan2(J,C)-R*Math.PI/180;C=W*Math.cos(J);J=W*Math.sin(J)}if(kb.indexOf("n")==
-1&&kb.indexOf("s")==-1)J=0;if(kb.indexOf("e")==-1&&kb.indexOf("w")==-1)C=0;var Y=W=0,na=fa?(fa+J)/fa:1,Xa=ca?(ca+C)/ca:1;if(kb.indexOf("n")>=0){na=fa?(fa-J)/fa:1;Y=fa}if(kb.indexOf("w")>=0){Xa=ca?(ca-C)/ca:1;W=ca}C=g.createSVGTransform();J=g.createSVGTransform();ca=g.createSVGTransform();if(u.gridSnapping){F=Aa(F);W=Aa(W);P=Aa(P);Y=Aa(Y)}C.setTranslate(-(F+W),-(P+Y));if(l.shiftKey)if(Xa==1)Xa=na;else na=Xa;J.setScale(Xa,na);ca.setTranslate(F+W,P+Y);if(K){K=R?1:0;v.replaceItem(C,2+K);v.replaceItem(J,
1+K);v.replaceItem(ca,0+K)}else{K=v.numberOfItems;v.replaceItem(ca,K-3);v.replaceItem(J,K-2);v.replaceItem(C,K-1)}Ha.requestSelector(s).resize();aa("transition",I);break;case "zoom":C*=q;F*=q;la(za,{x:Math.min(n*q,C),y:Math.min(m*q,F),width:Math.abs(C-n*q),height:Math.abs(F-m*q)},100);break;case "text":la(v,{x:x,y:y},1E3);break;case "line":C=null;window.opera||g.suspendRedraw(1E3);if(u.gridSnapping){x=Aa(x);y=Aa(y)}F=x;K=y;if(l.shiftKey){K=Na(c,d,F,K);F=K.x;K=K.y}v.setAttributeNS(null,"x2",F);v.setAttributeNS(null,
"y2",K);window.opera||g.unsuspendRedraw(C);break;case "foreignObject":case "square":case "rect":case "image":C=Math.abs(x-c);K=Math.abs(y-d);if(Ia=="square"||l.shiftKey){C=K=Math.max(C,K);F=c<x?c:c-C;P=d<y?d:d-K}else{F=Math.min(c,x);P=Math.min(d,y)}if(u.gridSnapping){C=Aa(C);K=Aa(K);F=Aa(F);P=Aa(P)}la(v,{width:C,height:K,x:F,y:P},1E3);break;case "circle":C=$(v).attr(["cx","cy"]);K=C.cx;F=C.cy;C=Math.sqrt((x-K)*(x-K)+(y-F)*(y-F));if(u.gridSnapping)C=Aa(C);v.setAttributeNS(null,"r",C);break;case "ellipse":C=
$(v).attr(["cx","cy"]);K=C.cx;F=C.cy;C=null;window.opera||g.suspendRedraw(1E3);if(u.gridSnapping){x=Aa(x);K=Aa(K);y=Aa(y);F=Aa(F)}v.setAttributeNS(null,"rx",Math.abs(x-K));v.setAttributeNS(null,"ry",Math.abs(l.shiftKey?x-K:y-F));window.opera||g.unsuspendRedraw(C);break;case "fhellipse":case "fhrect":o.minx=Math.min(C,o.minx);o.maxx=Math.max(C,o.maxx);o.miny=Math.min(F,o.miny);o.maxy=Math.max(F,o.maxy);case "fhpath":b+=+C+","+F+" ";v.setAttributeNS(null,"points",b);break;case "path":case "pathedit":x*=
q;y*=q;if(u.gridSnapping){x=Aa(x);y=Aa(y);c=Aa(c);d=Aa(d)}if(l.shiftKey){if(K=svgedit.path.path){v=K.dragging?K.dragging[0]:c;K=K.dragging?K.dragging[1]:d}else{v=c;K=d}K=Na(v,K,x,y);x=K.x;y=K.y}if(za&&za.getAttribute("display")!=="none"){C*=q;F*=q;la(za,{x:Math.min(n*q,C),y:Math.min(m*q,F),width:Math.abs(C-n*q),height:Math.abs(F-m*q)},100)}La.mouseMove(l,x,y);break;case "textedit":x*=q;y*=q;fb.mouseMove(w,B);break;case "rotate":C=svgedit.utilities.getBBox(s);K=C.x+C.width/2;F=C.y+C.height/2;v=va(s);
v=ka(K,F,v);K=v.x;F=v.y;v=C.x;P=C.y;if(current_rotate_mode=="nw")v=C.x+C.width;if(current_rotate_mode=="se")P=C.y+C.height;if(current_rotate_mode=="sw"){v=C.x+C.width;P=C.y+C.height}compensation_angle=(Math.atan2(F-P,K-v)*(180/Math.PI)-90)%360;R=(Math.atan2(F-y,K-x)*(180/Math.PI)-90)%360;R+=compensation_angle;if(u.gridSnapping)R=Aa(R);if(l.shiftKey)R=Math.round(R/45)*45;e.setRotationAngle(R<-180?360+R:R,true);aa("transition",I)}pb("mouseMove",{event:l,mouse_x:w,mouse_y:B,selected:s})}}).click(function(l){l.preventDefault();
return false}).dblclick(function(l){var s=l.target.parentNode;if(s!==M){var B=Zb(l),w=B.tagName;if(w==="text"&&Ia!=="textedit"){l=ka(l.pageX,l.pageY,Mb);fb.select(B,l.x,l.y)}if((w==="g"||w==="a")&&ra(B)){ec(B);B=I[0];Ta(true)}M&&$b();s.tagName!=="g"&&s.tagName!=="a"||s===D().getCurrentLayer()||B===Ha.selectorParentGroup||mc(B)}}).mouseup(function(l){if(l.button!==2){var s=db;db=null;if(Ja){var B=ka(l.pageX,l.pageY,Mb),w=B.x*q;B=B.y*q;var v=w/q,C=B/q,F=ja(ua()),J=false;Ja=false;switch(Ia){case "resize":case "multiselect":if(za!=
null){za.setAttribute("display","none");vb=[]}Ia="select";case "select":if(I[0]!=null){if(I[1]==null){w=I[0];switch(w.tagName){case "g":case "use":case "image":case "foreignObject":break;default:cb.fill=w.getAttribute("fill");cb.fill_opacity=w.getAttribute("fill-opacity");cb.stroke=w.getAttribute("stroke");cb.stroke_opacity=w.getAttribute("stroke-opacity");cb.stroke_width=w.getAttribute("stroke-width");cb.stroke_dasharray=w.getAttribute("stroke-dasharray");cb.stroke_linejoin=w.getAttribute("stroke-linejoin");
cb.stroke_linecap=w.getAttribute("stroke-linecap")}if(w.tagName=="text"){ab.font_size=w.getAttribute("font-size");ab.font_family=w.getAttribute("font-family")}Ha.requestSelector(w).showGrips(true)}Ab();if(v!=n||C!=m){l=I.length;for(w=0;w<l;++w){if(I[w]==null)break;I[w].firstChild||Ha.requestSelector(I[w]).resize()}}else{w=l.target;if(I[0].nodeName==="path"&&I[1]==null)La.select(I[0]);else l.shiftKey&&s!=w&&e.removeFromSelection([w])}if(svgedit.browser.supportsNonScalingStroke())if(l=I[0]){l.removeAttribute("style");
svgedit.utilities.walkTree(l,function(ca){ca.removeAttribute("style")})}}return;case "zoom":za!=null&&za.setAttribute("display","none");aa("zoomed",{x:Math.min(n,v),y:Math.min(m,C),width:Math.abs(v-n),height:Math.abs(C-m),factor:l.altKey?0.5:2});return;case "fhpath":s=F.getAttribute("points");v=s.indexOf(",");if(J=v>=0?s.indexOf(",",v+1)>=0:s.indexOf(" ",s.indexOf(" ")+1)>=0)F=La.smoothPolylineIntoPath(F);break;case "line":s=$(F).attr(["x1","x2","y1","y2"]);J=s.x1!=s.x2||s.y1!=s.y2;break;case "foreignObject":case "square":case "rect":case "image":s=
$(F).attr(["width","height"]);J=s.width!=0||s.height!=0||Ia==="image";break;case "circle":J=F.getAttribute("r")!=0;break;case "ellipse":s=$(F).attr(["rx","ry"]);J=s.rx!=null||s.ry!=null;break;case "fhellipse":if(o.maxx-o.minx>0&&o.maxy-o.miny>0){F=ma({element:"ellipse",curStyles:true,attr:{cx:(o.minx+o.maxx)/2,cy:(o.miny+o.maxy)/2,rx:(o.maxx-o.minx)/2,ry:(o.maxy-o.miny)/2,id:ua()}});aa("changed",[F]);J=true}break;case "fhrect":if(o.maxx-o.minx>0&&o.maxy-o.miny>0){F=ma({element:"rect",curStyles:true,
attr:{x:o.minx,y:o.miny,width:o.maxx-o.minx,height:o.maxy-o.miny,id:ua()}});aa("changed",[F]);J=true}break;case "text":J=true;Ib([F]);fb.start(F);break;case "path":F=null;Ja=true;s=La.mouseUp(l,F,w,B);F=s.element;J=s.keep;break;case "pathedit":J=true;F=null;La.mouseUp(l);break;case "textedit":J=false;F=null;fb.mouseUp(l,w,B);break;case "rotate":J=true;F=null;Ia="select";s=e.undoMgr.finishUndoableChange();s.isEmpty()||Ca(s);Ab();aa("changed",I)}w=pb("mouseUp",{event:l,mouse_x:w,mouse_y:B},true);$.each(w,
function(ca,fa){if(fa){J=fa.keep||J;F=fa.element;Ja=fa.started||Ja}});if(!J&&F!=null){D().releaseId(ua());F.parentNode.removeChild(F);F=null;for(w=l.target;w.parentNode.parentNode.tagName=="g";)w=w.parentNode;if((Ia!="path"||!drawn_path)&&w.parentNode.id!="selectorParentGroup"&&w.id!="svgcanvas"&&w.id!="svgroot"){e.setMode("select");Ib([w],true)}}else if(F!=null){e.addedNew=true;l=0.2;var K;if(false.beginElement&&F.getAttribute("opacity")!=N.opacity){K=$(false).clone().attr({to:N.opacity,dur:l}).appendTo(F);
try{K[0].beginElement()}catch(P){}}else l=0;setTimeout(function(){K&&K.remove();F.setAttribute("opacity",N.opacity);F.setAttribute("style","pointer-events:inherit");T(F);if(Ia==="path")La.toEditMode(F);else u.selectNew&&Ib([F],true);Ca(new Fa(F));aa("changed",[F])},l*1E3)}Wa=null}}});$(a).bind("mousewheel DOMMouseScroll",function(l){if(l.shiftKey){l.preventDefault();Mb=p.getScreenCTM().inverse();var s=ka(l.pageX,l.pageY,Mb);s={x:s.x,y:s.y,width:0,height:0};if(l.wheelDelta)if(l.wheelDelta>=120)s.factor=
2;else{if(l.wheelDelta<=-120)s.factor=0.5}else if(l.detail)if(l.detail>0)s.factor=0.5;else if(l.detail<0)s.factor=2;s.factor&&aa("zoomed",s)}})})();var Yb=function(b){$(b).click(function(c){c.preventDefault()})},fb=e.textActions=function(){function b(R){var W=B.value==="";$(B).focus();if(!arguments.length)if(W)R=0;else{if(B.selectionEnd!==B.selectionStart)return;R=B.selectionEnd}var Y;Y=F[R];W||B.setSelectionRange(R,R);w=ja("text_cursor");if(!w){w=document.createElementNS(i,"line");la(w,{id:"text_cursor",
stroke:"#333","stroke-width":1});w=ja("selectorParentGroup").appendChild(w)}C||(C=setInterval(function(){var na=w.getAttribute("display")==="none";w.setAttribute("display",na?"inline":"none")},600));W=A(Y.x,J.y);Y=A(Y.x,J.y+J.height);la(w,{x1:W.x,y1:W.y,x2:Y.x,y2:Y.y,visibility:"visible",display:"inline"});v&&v.setAttribute("d","")}function c(R,W,Y){if(R===W)b(W);else{Y||B.setSelectionRange(R,W);v=ja("text_selectblock");if(!v){v=document.createElementNS(i,"path");la(v,{id:"text_selectblock",fill:"green",
opacity:0.5,style:"pointer-events:none"});ja("selectorParentGroup").appendChild(v)}R=F[R];var na=F[W];w.setAttribute("visibility","hidden");W=A(R.x,J.y);Y=A(R.x+(na.x-R.x),J.y);var Xa=A(R.x,J.y+J.height);R=A(R.x+(na.x-R.x),J.y+J.height);la(v,{d:"M"+W.x+","+W.y+" L"+Y.x+","+Y.y+" "+R.x+","+R.y+" "+Xa.x+","+Xa.y+"z",display:"inline"})}}function d(R,W){var Y=g.createSVGPoint();Y.x=R;Y.y=W;if(F.length==1)return 0;Y=s.getCharNumAtPosition(Y);if(Y<0){Y=F.length-2;if(R<=F[0].x)Y=0}else if(Y>=F.length-2)Y=
F.length-2;var na=F[Y];R>na.x+na.width/2&&Y++;return Y}function n(R,W,Y){var na=B.selectionStart;R=d(R,W);c(Math.min(na,R),Math.max(na,R),!Y)}function m(R,W){var Y={x:R,y:W};Y.x/=q;Y.y/=q;if(K){var na=ka(Y.x,Y.y,K.inverse());Y.x=na.x;Y.y=na.y}return Y}function A(R,W){var Y={x:R,y:W};if(K){var na=ka(Y.x,Y.y,K);Y.x=na.x;Y.y=na.y}Y.x*=q;Y.y*=q;return Y}function o(R){c(0,s.textContent.length);$(this).unbind(R)}function l(R){if(fa&&s){var W=ka(R.pageX,R.pageY,Mb);W=m(W.x*q,W.y*q);W=d(W.x,W.y);var Y=s.textContent,
na=Y.substr(0,W).replace(/[a-z0-9]+$/i,"").length;Y=Y.substr(W).match(/^[a-z0-9]+/i);c(na,(Y?Y[0].length:0)+W);$(R.target).click(o);setTimeout(function(){$(R.target).unbind("click",o)},300)}}var s,B,w,v,C,F=[],J,K,P,ca,fa;return{select:function(R,W,Y){s=R;fb.toEditMode(W,Y)},start:function(R){s=R;fb.toEditMode()},mouseDown:function(R,W,Y,na){R=m(Y,na);B.focus();b(d(R.x,R.y));P=Y;ca=na},mouseMove:function(R,W){var Y=m(R,W);n(Y.x,Y.y)},mouseUp:function(R,W,Y){var na=m(W,Y);n(na.x,na.y,true);R.target!==
s&&W<P+2&&W>P-2&&Y<ca+2&&Y>ca-2&&fb.toSelectMode(true)},setCursor:b,toEditMode:function(R,W){fa=false;Ia="textedit";Ha.requestSelector(s).showGrips(false);Ha.requestSelector(s);fb.init();$(s).css("cursor","text");if(arguments.length){var Y=m(R,W);b(d(Y.x,Y.y))}else b();setTimeout(function(){fa=true},300)},toSelectMode:function(R){Ia="select";clearInterval(C);C=null;v&&$(v).attr("display","none");w&&$(w).attr("visibility","hidden");$(s).css("cursor","move");if(R){Ta();$(s).css("cursor","move");aa("selected",
[s]);eb([s],true)}s&&!s.textContent.length&&e.deleteSelectedElements();$(B).blur();s=false},setInputElem:function(R){B=R},clear:function(){Ia=="textedit"&&fb.toSelectMode()},init:function(){if(s){if(!s.parentNode){s=I[0];Ha.requestSelector(s).showGrips(false)}var R=s.textContent.length,W=s.getAttribute("transform");J=svgedit.utilities.getBBox(s);K=W?va(s):null;F=Array(R);B.focus();$(s).unbind("dblclick",l).dblclick(l);if(!R)var Y={x:J.x+J.width/2,width:0};for(W=0;W<R;W++){var na=s.getStartPositionOfChar(W);
Y=s.getEndPositionOfChar(W);if(!svgedit.browser.supportsGoodTextCharPos()){var Xa=e.contentW*q;na.x-=Xa;Y.x-=Xa;na.x/=q;Y.x/=q}F[W]={x:na.x,y:J.y,width:Y.x-na.x,height:J.height}}F.push({x:Y.x,width:0});c(B.selectionStart,B.selectionEnd,true)}}}}(),La=e.pathActions=function(){var b=false,c,d,n;svgedit.path.Path.prototype.endChanges=function(o){if(svgedit.browser.isWebkit()){var l=this.elem;l.setAttribute("d",La.convertPath(l))}o=new Qa(this.elem,{d:this.last_d},o);Ca(o);aa("changed",[this.elem])};
svgedit.path.Path.prototype.addPtsToSelection=function(o){$.isArray(o)||(o=[o]);for(var l=0;l<o.length;l++){var s=o[l],B=this.segs[s];B.ptgrip&&this.selected_pts.indexOf(s)==-1&&s>=0&&this.selected_pts.push(s)}this.selected_pts.sort();l=this.selected_pts.length;for(o=Array(l);l--;){B=this.segs[this.selected_pts[l]];B.select(true);o[l]=B.ptgrip}La.canDeleteNodes=true;La.closed_subpath=this.subpathIsClosed(this.selected_pts[0]);aa("selected",o)};var m=c=null,A=false;return{mouseDown:function(o,l,s,
B){if(Ia==="path"){mouse_x=s;mouse_y=B;B=mouse_x/q;l=mouse_y/q;s=ja("path_stretch_line");d=[B,l];if(u.gridSnapping){B=Aa(B);l=Aa(l);mouse_x=Aa(mouse_x);mouse_y=Aa(mouse_y)}if(!s){s=document.createElementNS(i,"path");la(s,{id:"path_stretch_line",stroke:"#22C","stroke-width":"0.5",fill:"none"});s=ja("selectorParentGroup").appendChild(s)}s.setAttribute("display","inline");var w=null;if(m){w=m.pathSegList;for(var v=w.numberOfItems,C=6/q,F=false;v;){v--;var J=w.getItem(v),K=J.x;J=J.y;if(B>=K-C&&B<=K+C&&
l>=J-C&&l<=J+C){F=true;break}}C=ua();svgedit.path.removePath_(C);C=ja(C);K=w.numberOfItems;if(F){if(v<=1&&K>=2){B=w.getItem(0).x;l=w.getItem(0).y;o=s.pathSegList.getItem(1);o=o.pathSegType===4?m.createSVGPathSegLinetoAbs(B,l):m.createSVGPathSegCurvetoCubicAbs(B,l,o.x1/q,o.y1/q,B,l);B=m.createSVGPathSegClosePath();w.appendItem(o);w.appendItem(B)}else if(K<3)return w=false;$(s).remove();element=C;m=null;Ja=false;if(b){svgedit.path.path.matrix&&Fb(C,{},svgedit.path.path.matrix.inverse());s=C.getAttribute("d");
o=$(svgedit.path.path.elem).attr("d");$(svgedit.path.path.elem).attr("d",o+s);$(C).remove();svgedit.path.path.matrix&&svgedit.path.recalcRotatedPath();svgedit.path.path.init();La.toEditMode(svgedit.path.path.elem);svgedit.path.path.selectPt();return false}}else{if(!$.contains(a,Zb(o))){console.log("Clicked outside canvas");return false}w=m.pathSegList.numberOfItems;v=m.pathSegList.getItem(w-1);C=v.x;v=v.y;if(o.shiftKey){o=Na(C,v,B,l);B=o.x;l=o.y}o=s.pathSegList.getItem(1);o=o.pathSegType===4?m.createSVGPathSegLinetoAbs(Kb(B),
Kb(l)):m.createSVGPathSegCurvetoCubicAbs(Kb(B),Kb(l),o.x1/q,o.y1/q,o.x2/q,o.y2/q);m.pathSegList.appendItem(o);B*=q;l*=q;s.setAttribute("d",["M",B,l,B,l].join(" "));s=w;if(b)s+=svgedit.path.path.segs.length;svgedit.path.addPointGrip(s,B,l)}}else{d_attr="M"+B+","+l+" ";m=ma({element:"path",curStyles:true,attr:{d:d_attr,id:ya(),opacity:N.opacity/2}});s.setAttribute("d",["M",mouse_x,mouse_y,mouse_x,mouse_y].join(" "));s=b?svgedit.path.path.segs.length:0;svgedit.path.addPointGrip(s,mouse_x,mouse_y)}}else if(svgedit.path.path){svgedit.path.path.storeD();
C=o.target.id;if(C.substr(0,14)=="pathpointgrip_"){l=svgedit.path.path.cur_pt=parseInt(C.substr(14));svgedit.path.path.dragging=[s,B];w=svgedit.path.path.segs[l];if(o.shiftKey)w.selected?svgedit.path.path.removePtFromSelection(l):svgedit.path.path.addPtsToSelection(l);else{if(svgedit.path.path.selected_pts.length<=1||!w.selected)svgedit.path.path.clearSelection();svgedit.path.path.addPtsToSelection(l)}}else if(C.indexOf("ctrlpointgrip_")==0){svgedit.path.path.dragging=[s,B];o=C.split("_")[1].split("c");
l=o[0]-0;svgedit.path.path.selectPt(l,o[1]-0)}if(!svgedit.path.path.dragging){if(za==null)za=Ha.getRubberBandBox();la(za,{x:s*q,y:B*q,width:0,height:0,display:"inline"},100)}}},mouseMove:function(o,l,s){A=true;if(Ia==="path"){if(m){var B=m.pathSegList,w=B.numberOfItems-1;if(d){var v=svgedit.path.addCtrlGrip("1c1"),C=svgedit.path.addCtrlGrip("0c2");v.setAttribute("cx",l);v.setAttribute("cy",s);v.setAttribute("display","inline");v=d[0];var F=d[1];B.getItem(w);var J=v+(v-l/q),K=F+(F-s/q);if(!o.altKey){C.setAttribute("cx",
J*q);C.setAttribute("cy",K*q);C.setAttribute("display","inline")}C=svgedit.path.getCtrlLine(1);var P=svgedit.path.getCtrlLine(2);la(C,{x1:l,y1:s,x2:v,y2:F,display:"inline"});o.altKey||la(P,{x1:J*q,y1:K*q,x2:v,y2:F,display:"inline"});if(w===0)n=[l,s];else{B=B.getItem(w-1);l=B.x;s=B.y;if(B.pathSegType===6){l+=l-B.x2;s+=s-B.y2}else if(n){l=n[0]/q;s=n[1]/q}svgedit.path.replacePathSeg(6,w,[v,F,l,s,J,K],m)}}else if(v=ja("path_stretch_line")){w=B.getItem(w);if(w.pathSegType===6)svgedit.path.replacePathSeg(6,
1,[l,s,(w.x+(w.x-w.x2))*q,(w.y+(w.y-w.y2))*q,l,s],v);else n?svgedit.path.replacePathSeg(6,1,[l,s,n[0],n[1],l,s],v):svgedit.path.replacePathSeg(4,1,[l,s],v)}}}else if(svgedit.path.path.dragging){v=svgedit.path.getPointFromGrip({x:svgedit.path.path.dragging[0],y:svgedit.path.path.dragging[1]},svgedit.path.path);F=svgedit.path.getPointFromGrip({x:l,y:s},svgedit.path.path);w=F.x-v.x;v=F.y-v.y;svgedit.path.path.dragging=[l,s];svgedit.path.path.dragctrl?svgedit.path.path.moveCtrl(w,v):svgedit.path.path.movePts(w,
v)}else{svgedit.path.path.selected_pts=[];svgedit.path.path.eachSeg(function(){if(this.next||this.prev){var ca=za.getBBox(),fa=svgedit.path.getGripPt(this);ca=svgedit.math.rectsIntersect(ca,{x:fa.x,y:fa.y,width:0,height:0});this.select(ca);ca&&svgedit.path.path.selected_pts.push(this.index)}})}},mouseUp:function(o,l){if(Ia==="path"){d=null;if(!m){l=ja(ua());Ja=false;n=null}return{keep:true,element:l}}if(svgedit.path.path.dragging){var s=svgedit.path.path.cur_pt;svgedit.path.path.dragging=false;svgedit.path.path.dragctrl=
false;svgedit.path.path.update();A&&svgedit.path.path.endChanges("Move path point(s)");!o.shiftKey&&!A&&svgedit.path.path.selectPt(s)}else if(za&&za.getAttribute("display")!="none"){za.setAttribute("display","none");za.getAttribute("width")<=2&&za.getAttribute("height")<=2&&La.toSelectMode(o.target)}else La.toSelectMode(o.target);A=false},toEditMode:function(o){svgedit.path.path=svgedit.path.getPath_(o);Ia="pathedit";Ta();svgedit.path.path.show(true).update();svgedit.path.path.oldbbox=svgedit.utilities.getBBox(svgedit.path.path.elem);
b=false},toSelectMode:function(o){var l=o==svgedit.path.path.elem;Ia="select";svgedit.path.path.show(false);c=false;Ta();svgedit.path.path.matrix&&svgedit.path.recalcRotatedPath();if(l){aa("selected",[o]);eb([o],true)}},addSubPath:function(o){if(o){Ia="path";b=true}else{La.clear(true);La.toEditMode(svgedit.path.path.elem)}},select:function(o){if(c===o){La.toEditMode(o);Ia="pathedit"}else c=o},reorient:function(){var o=I[0];if(o)if(ra(o)!=0){var l=new Ga("Reorient path"),s={d:o.getAttribute("d"),transform:o.getAttribute("transform")};
l.addSubCommand(new Qa(o,s));Ta();this.resetOrientation(o);Ca(l);svgedit.path.getPath_(o).show(false).matrix=null;this.clear();eb([o],true);aa("changed",I)}},clear:function(){c=null;if(m){var o=ja(ua());$(ja("path_stretch_line")).remove();$(o).remove();$(ja("pathpointgrip_container")).find("*").attr("display","none");m=n=null;Ja=false}else Ia=="pathedit"&&this.toSelectMode();svgedit.path.path&&svgedit.path.path.init().show(false)},resetOrientation:function(o){if(o==null||o.nodeName!="path")return false;
var l=ia(o),s=ga(l).matrix;l.clear();o.removeAttribute("transform");l=o.pathSegList;for(var B=l.numberOfItems,w=0;w<B;++w){var v=l.getItem(w),C=v.pathSegType;if(C!=1){var F=[];$.each(["",1,2],function(J,K){var P=v["x"+K],ca=v["y"+K];if(P!==undefined&&ca!==undefined){P=ka(P,ca,s);F.splice(F.length,0,P.x,P.y)}});svgedit.path.replacePathSeg(C,w,F,o)}}h(o,s)},zoomChange:function(){Ia=="pathedit"&&svgedit.path.path.update()},getNodePoint:function(){var o=svgedit.path.path.segs[svgedit.path.path.selected_pts.length?
svgedit.path.path.selected_pts[0]:1];return{x:o.item.x,y:o.item.y,type:o.type}},linkControlPoints:function(o){svgedit.path.setLinkControlPoints(o)},clonePathNode:function(){svgedit.path.path.storeD();for(var o=svgedit.path.path.selected_pts,l=o.length,s=[];l--;){var B=o[l];svgedit.path.path.addSeg(B);s.push(B+l);s.push(B+l+1)}svgedit.path.path.init().addPtsToSelection(s);svgedit.path.path.endChanges("Clone path node(s)")},opencloseSubPath:function(){var o=svgedit.path.path.selected_pts;if(o.length===
1){var l=svgedit.path.path.elem,s=l.pathSegList,B=o[0],w=null,v=null;svgedit.path.path.eachSeg(function(K){if(this.type===2&&K<=B)v=this.item;if(K<=B)return true;if(this.type===2){w=K;return false}else if(this.type===1)return w=false});if(w==null)w=svgedit.path.path.segs.length-1;if(w!==false){var C=l.createSVGPathSegLinetoAbs(v.x,v.y),F=l.createSVGPathSegClosePath();if(w==svgedit.path.path.segs.length-1){s.appendItem(C);s.appendItem(F)}else{svgedit.path.insertItemBefore(l,F,w);svgedit.path.insertItemBefore(l,
C,w)}svgedit.path.path.init().selectPt(w+1)}else if(svgedit.path.path.segs[B].mate){s.removeItem(B);s.removeItem(B);svgedit.path.path.init().selectPt(B-1)}else{for(o=0;o<s.numberOfItems;o++){var J=s.getItem(o);if(J.pathSegType===2)C=o;else if(o===B)s.removeItem(C);else if(J.pathSegType===1&&B<o){F=o-1;s.removeItem(o);break}}for(o=B-C-1;o--;)svgedit.path.insertItemBefore(l,s.getItem(C),F);l=s.getItem(C);svgedit.path.replacePathSeg(2,C,[l.x,l.y]);o=B;svgedit.path.path.init().selectPt(0)}}},deletePathNode:function(){if(La.canDeleteNodes){svgedit.path.path.storeD();
for(var o=svgedit.path.path.selected_pts,l=o.length;l--;)svgedit.path.path.deleteSeg(o[l]);var s=function(){var B=svgedit.path.path.elem.pathSegList,w=B.numberOfItems,v=function(J,K){for(;K--;)B.removeItem(J)};if(w<=1)return true;for(;w--;){var C=B.getItem(w);if(C.pathSegType===1){C=B.getItem(w-1);var F=B.getItem(w-2);if(C.pathSegType===2){v(w-1,2);s();break}else if(F.pathSegType===2){v(w-2,3);s();break}}else if(C.pathSegType===2)if(w>0){C=B.getItem(w-1).pathSegType;if(C===2){v(w-1,1);s();break}else if(C===
1&&B.numberOfItems-1===w){v(w,1);s();break}}}return false};s();if(svgedit.path.path.elem.pathSegList.numberOfItems<=1){La.toSelectMode(svgedit.path.path.elem);e.deleteSelectedElements()}else{svgedit.path.path.init();svgedit.path.path.clearSelection();if(window.opera){o=$(svgedit.path.path.elem);o.attr("d",o.attr("d"))}svgedit.path.path.endChanges("Delete path node(s)")}}},smoothPolylineIntoPath:function(o){var l=o.points,s=l.numberOfItems;if(s>=4){var B=l.getItem(0),w=null;o=[];o.push(["M",B.x,",",
B.y," C"].join(""));for(var v=1;v<=s-4;v+=3){var C=l.getItem(v),F=l.getItem(v+1),J=l.getItem(v+2);if(w)if((B=svgedit.path.smoothControlPoints(w,C,B))&&B.length==2){C=o[o.length-1].split(",");C[2]=B[0].x;C[3]=B[0].y;o[o.length-1]=C.join(",");C=B[1]}o.push([C.x,C.y,F.x,F.y,J.x,J.y].join(","));B=J;w=F}for(o.push("L");v<s;++v){F=l.getItem(v);o.push([F.x,F.y].join(","))}o=o.join(" ");o=ma({element:"path",curStyles:true,attr:{id:ua(),d:o,fill:"none"}})}return o},setSegType:function(o){svgedit.path.path.setSegType(o)},
moveNode:function(o,l){var s=svgedit.path.path.selected_pts;if(s.length){svgedit.path.path.storeD();s=svgedit.path.path.segs[s[0]];var B={x:0,y:0};B[o]=l-s.item[o];s.move(B.x,B.y);svgedit.path.path.endChanges("Move path point")}},fixEnd:function(o){for(var l=o.pathSegList,s=l.numberOfItems,B,w=0;w<s;++w){var v=l.getItem(w);if(v.pathSegType===2)B=v;if(v.pathSegType===1){v=l.getItem(w-1);if(v.x!=B.x||v.y!=B.y){l=o.createSVGPathSegLinetoAbs(B.x,B.y);svgedit.path.insertItemBefore(o,l,w);La.fixEnd(o);
break}}}svgedit.browser.isWebkit()&&o.setAttribute("d",La.convertPath(o))},convertPath:function(o,l){for(var s=o.pathSegList,B=s.numberOfItems,w=0,v=0,C="",F=null,J=0;J<B;++J){var K=s.getItem(J),P=K.x||0,ca=K.y||0,fa=K.x1||0,R=K.y1||0,W=K.x2||0,Y=K.y2||0,na=K.pathSegType,Xa=wb[na]["to"+(l?"Lower":"Upper")+"Case"](),qb=function(Hb,yb,Gb){yb=yb?" "+yb.join(" "):"";Gb=Gb?" "+svgedit.units.shortFloat(Gb):"";$.each(Hb,function(ac,jc){Hb[ac]=svgedit.units.shortFloat(jc)});C+=Xa+Hb.join(" ")+yb+Gb};switch(na){case 1:C+=
"z";break;case 12:P-=w;case 13:if(l){w+=P;Xa="l"}else{P+=w;w=P;Xa="L"}qb([[P,v]]);break;case 14:ca-=v;case 15:if(l){v+=ca;Xa="l"}else{ca+=v;v=ca;Xa="L"}qb([[w,ca]]);break;case 2:case 4:case 18:P-=w;ca-=v;case 5:case 3:if(F&&s.getItem(J-1).pathSegType===1&&!l){w=F[0];v=F[1]}case 19:if(l){w+=P;v+=ca}else{P+=w;ca+=v;w=P;v=ca}if(na===3)F=[w,v];qb([[P,ca]]);break;case 6:P-=w;fa-=w;W-=w;ca-=v;R-=v;Y-=v;case 7:if(l){w+=P;v+=ca}else{P+=w;fa+=w;W+=w;ca+=v;R+=v;Y+=v;w=P;v=ca}qb([[fa,R],[W,Y],[P,ca]]);break;
case 8:P-=w;fa-=w;ca-=v;R-=v;case 9:if(l){w+=P;v+=ca}else{P+=w;fa+=w;ca+=v;R+=v;w=P;v=ca}qb([[fa,R],[P,ca]]);break;case 10:P-=w;ca-=v;case 11:if(l){w+=P;v+=ca}else{P+=w;ca+=v;w=P;v=ca}qb([[K.r1,K.r2]],[K.angle,K.largeArcFlag?1:0,K.sweepFlag?1:0],[P,ca]);break;case 16:P-=w;W-=w;ca-=v;Y-=v;case 17:if(l){w+=P;v+=ca}else{P+=w;W+=w;ca+=v;Y+=v;w=P;v=ca}qb([[W,Y],[P,ca]])}}return C}}}(),fc=this.removeUnusedDefElems=function(){var b=p.getElementsByTagNameNS(i,"defs");if(!b||!b.length)return 0;for(var c=[],
d=0,n=["fill","stroke","filter","marker-start","marker-mid","marker-end"],m=n.length,A=p.getElementsByTagNameNS(i,"*"),o=A.length,l=0;l<o;l++){for(var s=A[l],B=0;B<m;B++){var w=Ra(s.getAttribute(n[B]));w&&c.push(w.substr(1))}(s=U(s))&&s.indexOf("#")===0&&c.push(s.substr(1))}b=$(b).find("linearGradient, radialGradient, filter, marker, svg, symbol");defelem_ids=[];for(l=b.length;l--;){n=b[l];m=n.id;if(c.indexOf(m)<0){Jb[m]=n;n.parentNode.removeChild(n);d++}}return d};this.svgCanvasToString=function(){for(;fc()>
0;);La.clear(true);$.each(p.childNodes,function(d,n){d&&n.nodeType===8&&n.data.indexOf("Created with")>=0&&p.insertBefore(n,p.firstChild)});if(M){$b();Ib([M])}var b=[];$(p).find("g:data(gsvg)").each(function(){for(var d=this.attributes,n=d.length,m=0;m<n;m++)if(d[m].nodeName=="id"||d[m].nodeName=="style")n--;if(n<=0){d=this.firstChild;b.push(d);$(this).replaceWith(d)}});var c=this.svgToString(p,0);b.length&&$(b).each(function(){pa(this)});return c};this.svgToString=function(b,c){var d=[],n=svgedit.utilities.toXml,
m=u.baseUnit,A=RegExp("^-?[\\d\\.]+"+m+"$");if(b){T(b);var o=b.attributes,l,s,B=b.childNodes;for(s=0;s<c;s++)d.push(" ");d.push("<");d.push(b.nodeName);if(b.id==="svgcontent"){s=Ub();if(m!=="px"){s.w=svgedit.units.convertUnit(s.w,m)+m;s.h=svgedit.units.convertUnit(s.h,m)+m}d.push(' width="'+s.w+'" height="'+s.h+'" xmlns="'+i+'"');var w={};$(b).find("*").andSelf().each(function(){$.each(this.attributes,function(J,K){var P=K.namespaceURI;if(P&&!w[P]&&wa[P]!=="xmlns"&&wa[P]!=="xml"){w[P]=true;d.push(" xmlns:"+
wa[P]+'="'+P+'"')}})});s=o.length;for(m=["width","height","xmlns","x","y","viewBox","id","overflow"];s--;){l=o.item(s);var v=n(l.nodeValue);if(l.nodeName.indexOf("xmlns:")!==0)if(v!=""&&m.indexOf(l.localName)==-1)if(!l.namespaceURI||wa[l.namespaceURI]){d.push(" ");d.push(l.nodeName);d.push('="');d.push(v);d.push('"')}}}else{if(b.nodeName==="defs"&&!b.firstChild)return;var C=["-moz-math-font-style","_moz-math-font-style"];for(s=o.length-1;s>=0;s--){l=o.item(s);v=n(l.nodeValue);if(!(C.indexOf(l.localName)>=
0))if(v!="")if(v.indexOf("pointer-events")!==0)if(!(l.localName==="class"&&v.indexOf("se_")===0)){d.push(" ");if(l.localName==="d")v=La.convertPath(b,true);if(isNaN(v)){if(A.test(v))v=svgedit.units.shortFloat(v)+m}else v=svgedit.units.shortFloat(v);if(Ua.apply&&b.nodeName==="image"&&l.localName==="href"&&Ua.images&&Ua.images==="embed"){var F=Va[v];if(F)v=F}if(!l.namespaceURI||l.namespaceURI==i||wa[l.namespaceURI]){d.push(l.nodeName);d.push('="');d.push(v);d.push('"')}}}}if(b.hasChildNodes()){d.push(">");
c++;o=false;for(s=0;s<B.length;s++){m=B.item(s);switch(m.nodeType){case 1:d.push("\n");d.push(this.svgToString(B.item(s),c));break;case 3:m=m.nodeValue.replace(/^\s+|\s+$/g,"");if(m!=""){o=true;d.push(n(m)+"")}break;case 4:d.push("\n");d.push(Array(c+1).join(" "));d.push("<![CDATA[");d.push(m.nodeValue);d.push("]]\>");break;case 8:d.push("\n");d.push(Array(c+1).join(" "));d.push("<!--");d.push(m.data);d.push("--\>")}}c--;if(!o){d.push("\n");for(s=0;s<c;s++)d.push(" ")}d.push("</");d.push(b.nodeName);
d.push(">")}else d.push("/>")}return d.join("")};this.embedImage=function(b,c){$(new Image).load(function(){var d=document.createElement("canvas");d.width=this.width;d.height=this.height;d.getContext("2d").drawImage(this,0,0);try{var n=";svgedit_url="+encodeURIComponent(b);n=d.toDataURL().replace(";base64",n+";base64");Va[b]=n}catch(m){Va[b]=false}ub=b;c&&c(Va[b])}).attr("src",b)};this.setGoodImage=function(b){ub=b};this.open=function(){};this.save=function(b){Ta();b&&$.extend(Ua,b);Ua.apply=true;
b=this.svgCanvasToString();aa("saved",b)};this.rasterExport=function(){Ta();var b=[],c={feGaussianBlur:zb.exportNoBlur,foreignObject:zb.exportNoforeignObject,"[stroke-dasharray]":zb.exportNoDashArray},d=$(p);if(!("font"in $("<canvas>")[0].getContext("2d")))c.text=zb.exportNoText;$.each(c,function(n,m){d.find(n).length&&b.push(m)});c=this.svgCanvasToString();aa("exported",{svg:c,issues:b})};this.getSvgString=function(){Ua.apply=false;return this.svgCanvasToString()};this.randomizeIds=function(){arguments.length>
0&&arguments[0]==false?svgedit.draw.randomizeIds(false,D()):svgedit.draw.randomizeIds(true,D())};var bc=this.uniquifyElems=function(b){var c={},d=["filter","linearGradient","pattern","radialGradient","symbol","textPath","use"];svgedit.utilities.walkTree(b,function(l){if(l.nodeType==1){if(l.id){l.id in c||(c[l.id]={elem:null,attrs:[],hrefs:[]});c[l.id].elem=l}$.each(Pb,function(B,w){var v=l.getAttributeNode(w);if(v){var C=svgedit.utilities.getUrlFromAttr(v.value);if(C=C?C.substr(1):null){C in c||(c[C]=
{elem:null,attrs:[],hrefs:[]});c[C].attrs.push(v)}}});var s=svgedit.utilities.getHref(l);if(s&&d.indexOf(l.nodeName)>=0)if(s=s.substr(1)){s in c||(c[s]={elem:null,attrs:[],hrefs:[]});c[s].hrefs.push(l)}}});for(var n in c)if(n){var m=c[n].elem;if(m){b=ya();m.id=b;m=c[n].attrs;for(var A=m.length;A--;){var o=m[A];o.ownerElement.setAttribute(o.name,"url(#"+b+")")}m=c[n].hrefs;for(A=m.length;A--;)svgedit.utilities.setHref(m[A],"#"+b)}}},Tb=this.setUseData=function(b){var c=$(b);if(b.tagName!=="use")c=
c.find("use");c.each(function(){var d=U(this).substr(1);if(d=ja(d)){$(this).data("ref",d);if(d.tagName=="symbol"||d.tagName=="svg")$(this).data("symbol",d).data("ref",d)}})},gc=this.convertGradients=function(b){var c=$(b).find("linearGradient, radialGradient");if(!c.length&&svgedit.browser.isWebkit())c=$(b).find("*").filter(function(){return this.tagName.indexOf("Gradient")>=0});c.each(function(){if($(this).attr("gradientUnits")==="userSpaceOnUse"){var d=$(p).find('[fill="url(#'+this.id+')"],[stroke="url(#'+
this.id+')"]');if(d.length)if(d=svgedit.utilities.getBBox(d[0]))if(this.tagName==="linearGradient"){var n=$(this).attr(["x1","y1","x2","y2"]),m=this.gradientTransform.baseVal;if(m&&m.numberOfItems>0){var A=ga(m).matrix;m=ka(n.x1,n.y1,A);A=ka(n.x2,n.y2,A);n.x1=m.x;n.y1=m.y;n.x2=A.x;n.y2=A.y;this.removeAttribute("gradientTransform")}$(this).attr({x1:(n.x1-d.x)/d.width,y1:(n.y1-d.y)/d.height,x2:(n.x2-d.x)/d.width,y2:(n.y2-d.y)/d.height});this.removeAttribute("gradientUnits")}}})},kc=this.convertToGroup=
function(b){b||(b=I[0]);var c=$(b),d=new Ga,n;if(c.data("gsvg")){d=$(b.firstChild).attr(["x","y"]);$(b.firstChild.firstChild).unwrap();$(b).removeData("gsvg");n=ia(b);var m=g.createSVGTransform();m.setTranslate(d.x,d.y);n.appendItem(m);nb(b);aa("selected",[b])}else if(c.data("symbol")){b=c.data("symbol");n=c.attr("transform");m=c.attr(["x","y"]);var A=b.getAttribute("viewBox");if(A){A=A.split(" ");m.x-=+A[0];m.y-=+A[1]}n+=" translate("+(m.x||0)+","+(m.y||0)+")";m=c.prev();d.addSubCommand(new Oa(c[0],
c[0].nextSibling,c[0].parentNode));c.remove();A=$(p).find("use:data(symbol)").length;c=f.createElementNS(i,"g");for(var o=b.childNodes,l=0;l<o.length;l++)c.appendChild(o[l].cloneNode(true));if(svgedit.browser.isGecko()){o=$(ib()).children("linearGradient,radialGradient,pattern").clone();$(c).append(o)}n&&c.setAttribute("transform",n);n=b.parentNode;bc(c);svgedit.browser.isGecko()&&$(ib()).append($(c).find("linearGradient,radialGradient,pattern"));c.id=ya();m.after(c);if(n){if(!A){m=b.nextSibling;
n.removeChild(b);d.addSubCommand(new Oa(b,m,n))}d.addSubCommand(new Fa(c))}Tb(c);svgedit.browser.isGecko()?gc(ib()):gc(c);svgedit.utilities.walkTreePost(c,function(s){try{nb(s)}catch(B){console.log(B)}});$(c).find("a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use").each(function(){if(!this.id)this.id=ya()});Ib([c]);(b=ec(c,true))&&d.addSubCommand(b);Ca(d)}else console.log("Unexpected element to ungroup:",b)};this.setSvgString=function(b){try{var c=svgedit.utilities.text2xml(b);
this.prepareSvg(c);var d=new Ga("Change Source"),n=p.nextSibling,m=g.removeChild(p);d.addSubCommand(new Oa(m,n,g));p=f.adoptNode?f.adoptNode(c.documentElement):f.importNode(c.documentElement,true);g.appendChild(p);var A=$(p);e.current_drawing_=new svgedit.draw.Drawing(p,z);var o=D().getNonce();o?aa("setnonce",o):aa("unsetnonce");A.find("image").each(function(){var F=this;Yb(F);var J=U(this);if(J.indexOf("data:")===0){var K=J.match(/svgedit_url=(.*?);/);if(K){var P=decodeURIComponent(K[1]);$(new Image).load(function(){F.setAttributeNS("http://www.w3.org/1999/xlink",
"xlink:href",P)}).attr("src",P)}}e.embedImage(J)});A.find("svg").each(function(){if(!$(this).closest("defs").length){bc(this);var F=this.parentNode;if(F.childNodes.length===1&&F.nodeName==="g"){$(F).data("gsvg",this);F.id=F.id||ya()}else pa(this)}});svgedit.browser.isGecko()&&A.find("linearGradient, radialGradient, pattern").appendTo(ib());Tb(A);gc(A[0]);svgedit.utilities.walkTreePost(p,function(F){try{nb(F)}catch(J){console.log(J)}});var l={id:"svgcontent",overflow:u.show_outside_canvas?"visible":
"hidden"},s=false;if(A.attr("viewBox")){var B=A.attr("viewBox").split(" ");l.width=B[2];l.height=B[3]}else $.each(["width","height"],function(F,J){var K=A.attr(J);K||(K="100%");if((K+"").substr(-1)==="%")s=true;else l[J]=ha(J,K)});Vb();A.children().find("a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use").each(function(){if(!this.id)this.id=ya()});if(s){var w=getStrokedBBox();l.width=w.width+w.x;l.height=w.height+w.y}if(l.width<=0)l.width=100;if(l.height<=0)l.height=
100;A.attr(l);this.contentW=l.width;this.contentH=l.height;d.addSubCommand(new Fa(p));var v=A.attr(["width","height"]);d.addSubCommand(new Qa(g,v));q=1;svgedit.transformlist.resetListMap();Ta();svgedit.path.clearData();g.appendChild(Ha.selectorParentGroup);Ca(d);aa("changed",[p])}catch(C){console.log(C);return false}return true};this.importSvgString=function(b){try{var c=svgedit.utilities.encode64(b.length+b).substr(0,32),d=false;if(Cb[c])if($(Cb[c].symbol).parents("#svgroot").length)d=true;var n=
new Ga("Import SVG");if(d)var m=Cb[c].symbol,A=Cb[c].xform;else{var o=svgedit.utilities.text2xml(b);this.prepareSvg(o);var l;l=f.adoptNode?f.adoptNode(o.documentElement):f.importNode(o.documentElement,true);bc(l);var s=ha("width",l.getAttribute("width")),B=ha("height",l.getAttribute("height")),w=l.getAttribute("viewBox"),v=w?w.split(" "):[0,0,s,B];for(b=0;b<4;++b)v[b]=+v[b];p.getAttribute("width");var C=+p.getAttribute("height");A=B>s?"scale("+C/3/v[3]+")":"scale("+C/3/v[2]+")";A="translate(0) "+
A+" translate(0)";m=f.createElementNS(i,"symbol");var F=ib();for(svgedit.browser.isGecko()&&$(l).find("linearGradient, radialGradient, pattern").appendTo(F);l.firstChild;)m.appendChild(l.firstChild);var J=l.attributes;for(l=0;l<J.length;l++){var K=J[l];m.setAttribute(K.nodeName,K.nodeValue)}m.id=ya();Cb[c]={symbol:m,xform:A};ib().appendChild(m);n.addSubCommand(new Fa(m))}var P=f.createElementNS(i,"use");P.id=ya();Z(P,"#"+m.id);(M||D().getCurrentLayer()).appendChild(P);n.addSubCommand(new Fa(P));Ta();
P.setAttribute("transform",A);nb(P);$(P).data("symbol",m).data("ref",m);eb([P]);Ca(n);aa("changed",[p])}catch(ca){console.log(ca);return false}return true};var Vb=e.identifyLayers=function(){$b();D().identifyLayers()};this.createLayer=function(b){var c=new Ga("Create Layer");b=D().createLayer(b);c.addSubCommand(new Fa(b));Ca(c);Ta();aa("changed",[b])};this.cloneLayer=function(b){var c=new Ga("Duplicate Layer"),d=f.createElementNS(i,"g"),n=f.createElementNS(i,"title");n.textContent=b;d.appendChild(n);
n=D().getCurrentLayer();$(n).after(d);n=n.childNodes;for(var m=0;m<n.length;m++){var A=n[m];A.localName!="title"&&d.appendChild(V(A))}Ta();Vb();c.addSubCommand(new Fa(d));Ca(c);e.setCurrentLayer(b);aa("changed",[d])};this.deleteCurrentLayer=function(){var b=D().getCurrentLayer(),c=b.nextSibling,d=b.parentNode;if(b=D().deleteCurrentLayer()){var n=new Ga("Delete Layer");n.addSubCommand(new Oa(b,c,d));Ca(n);Ta();aa("changed",[d]);return true}return false};this.setCurrentLayer=function(b){(b=D().setCurrentLayer(svgedit.utilities.toXml(b)))&&
Ta();return b};this.renameCurrentLayer=function(b){var c=D();if(c.current_layer){var d=c.current_layer;if(!e.setCurrentLayer(b)){for(var n=new Ga("Rename Layer"),m=0;m<c.getNumLayers();++m)if(c.all_layers[m][1]==d)break;var A=c.getLayerName(m);c.all_layers[m][0]=svgedit.utilities.toXml(b);var o=d.childNodes.length;for(m=0;m<o;++m){var l=d.childNodes.item(m);if(l&&l.tagName=="title"){for(;l.firstChild;)l.removeChild(l.firstChild);l.textContent=b;n.addSubCommand(new Qa(l,{"#text":A}));Ca(n);aa("changed",
[d]);return true}}}c.current_layer=d}return false};this.setCurrentLayerPosition=function(b){var c=D();if(c.current_layer&&b>=0&&b<c.getNumLayers()){for(var d=0;d<c.getNumLayers();++d)if(c.all_layers[d][1]==c.current_layer)break;if(d==c.getNumLayers())return false;if(d!=b){var n=null,m=c.current_layer.nextSibling;if(b>d){if(b<c.getNumLayers()-1)n=c.all_layers[b+1][1]}else n=c.all_layers[b][1];p.insertBefore(c.current_layer,n);Ca(new Ma(c.current_layer,m,p));Vb();e.setCurrentLayer(c.getLayerName(b));
return true}}return false};this.setLayerVisibility=function(b,c){var d=D(),n=d.getLayerVisibility(b),m=d.setLayerVisibility(b,c);if(m)Ca(new Qa(m,{display:n?"inline":"none"},"Layer Visibility"));else return false;if(m==d.getCurrentLayer()){Ta();La.clear()}return true};this.moveSelectedToLayer=function(b){for(var c=null,d=D(),n=0;n<d.getNumLayers();++n)if(d.getLayerName(n)==b){c=d.all_layers[n][1];break}if(!c)return false;b=new Ga("Move Elements to Layer");d=I;for(n=d.length;n--;){var m=d[n];if(m){var A=
m.nextSibling,o=m.parentNode;c.appendChild(m);b.addSubCommand(new Ma(m,A,o))}}Ca(b);return true};this.mergeLayer=function(b){var c=new Ga("Merge Layer"),d=D(),n=$(d.current_layer).prev()[0];if(n){for(c.addSubCommand(new Oa(d.current_layer,d.current_layer.nextSibling,p));d.current_layer.firstChild;){var m=d.current_layer.firstChild;if(m.localName=="title"){c.addSubCommand(new Oa(m,m.nextSibling,d.current_layer));d.current_layer.removeChild(m)}else{var A=m.nextSibling;n.appendChild(m);c.addSubCommand(new Ma(m,
A,d.current_layer))}}p.removeChild(d.current_layer);if(!b){Ta();Vb();aa("changed",[p]);Ca(c)}d.current_layer=n;return c}};this.mergeAllLayers=function(){var b=new Ga("Merge all Layers"),c=D();for(c.current_layer=c.all_layers[c.getNumLayers()-1][1];$(p).children("g").length>1;)b.addSubCommand(e.mergeLayer(true));Ta();Vb();aa("changed",[p]);Ca(b)};var $b=this.leaveContext=function(){var b=Bb.length;if(b){for(var c=0;c<b;c++){var d=Bb[c],n=gb(d,"orig_opac");n!==1?d.setAttribute("opacity",n):d.removeAttribute("opacity");
d.setAttribute("style","pointer-events: inherit")}Bb=[];Ta(true);aa("contextset",null)}M=null},mc=this.setContext=function(b){$b();if(typeof b==="string")b=ja(b);M=b;$(b).parentsUntil("#svgcontent").andSelf().siblings().each(function(){var c=this.getAttribute("opacity")||1;gb(this,"orig_opac",c);this.setAttribute("opacity",c*0.33);this.setAttribute("style","pointer-events: none");Bb.push(this)});Ta();aa("contextset",M)};this.clear=function(){La.clear();Ta();e.clearSvgContentElement();e.current_drawing_=
new svgedit.draw.Drawing(p);e.createLayer("Layer 1");e.undoMgr.resetUndoStack();Ha.initGroup();za=Ha.getRubberBandBox();aa("cleared")};this.linkControlPoints=La.linkControlPoints;this.getContentElem=function(){return p};this.getRootElem=function(){return g};this.getSelectedElems=function(){return I};var Ub=this.getResolution=function(){var b=p.getAttribute("width")/q,c=p.getAttribute("height")/q;return{w:b,h:c,zoom:q}};this.getZoom=function(){return q};this.getVersion=function(){return"svgcanvas.js ($Rev: 2082 $)"};
this.setUiStrings=function(b){$.extend(zb,b.notification)};this.setConfig=function(b){$.extend(u,b)};this.getTitle=function(b){if(b=b||I[0]){b=$(b).data("gsvg")||$(b).data("symbol")||b;b=b.childNodes;for(var c=0;c<b.length;c++)if(b[c].nodeName=="title")return b[c].textContent;return""}};this.setGroupTitle=function(b){var c=I[0];c=$(c).data("gsvg")||c;var d=$(c).children("title"),n=new Ga("Set Label");if(b.length)if(d.length){d=d[0];n.addSubCommand(new Qa(d,{"#text":d.textContent}));d.textContent=
b}else{d=f.createElementNS(i,"title");d.textContent=b;$(c).prepend(d);n.addSubCommand(new Fa(d))}else{n.addSubCommand(new Oa(d[0],d.nextSibling,c));d.remove()}Ca(n)};this.getDocumentTitle=function(){return e.getTitle(p)};this.setDocumentTitle=function(b){for(var c=p.childNodes,d=false,n="",m=new Ga("Change Image Title"),A=0;A<c.length;A++)if(c[A].nodeName=="title"){d=c[A];n=d.textContent;break}if(!d){d=f.createElementNS(i,"title");p.insertBefore(d,p.firstChild)}if(b.length)d.textContent=b;else d.parentNode.removeChild(d);
m.addSubCommand(new Qa(d,{"#text":n}));Ca(m)};this.getEditorNS=function(b){b&&p.setAttribute("xmlns:se","http://svg-edit.googlecode.com");return"http://svg-edit.googlecode.com"};this.setResolution=function(b,c){var d=Ub(),n=d.w;d=d.h;var m;if(b=="fit"){var A=getStrokedBBox();if(A){m=new Ga("Fit Canvas to Content");var o=Lb();eb(o);var l=[],s=[];$.each(o,function(){l.push(A.x*-1);s.push(A.y*-1)});o=e.moveSelectedElements(l,s,true);m.addSubCommand(o);Ta();b=Math.round(A.width);c=Math.round(A.height)}else return false}if(b!=
n||c!=d){o=g.suspendRedraw(1E3);m||(m=new Ga("Change Image Dimensions"));b=ha("width",b);c=ha("height",c);p.setAttribute("width",b);p.setAttribute("height",c);this.contentW=b;this.contentH=c;m.addSubCommand(new Qa(p,{width:n,height:d}));p.setAttribute("viewBox",[0,0,b/q,c/q].join(" "));m.addSubCommand(new Qa(p,{viewBox:["0 0",n,d].join(" ")}));Ca(m);g.unsuspendRedraw(o);aa("changed",[p])}return true};this.getOffset=function(){return $(p).attr(["x","y"])};this.setBBoxZoom=function(b,c,d){var n=0.85,
m=function(A){if(!A)return false;var o=Math.min(Math.round(c/A.width*100*n)/100,Math.round(d/A.height*100*n)/100);e.setZoom(o);return{zoom:o,bbox:A}};if(typeof b=="object"){b=b;if(b.width==0||b.height==0){e.setZoom(b.zoom?b.zoom:q*b.factor);return{zoom:q,bbox:b}}return m(b)}switch(b){case "selection":if(!I[0])return;b=$.map(I,function(A){if(A)return A});b=getStrokedBBox(b);break;case "canvas":b=Ub();n=0.95;b={width:b.w,height:b.h,x:0,y:0};break;case "content":b=getStrokedBBox();break;case "layer":b=
getStrokedBBox(Lb(D().getCurrentLayer()));break;default:return}return m(b)};this.setZoom=function(b){var c=Ub();p.setAttribute("viewBox","0 0 "+c.w/b+" "+c.h/b);q=b;$.each(I,function(d,n){n&&Ha.requestSelector(n).resize()});La.zoomChange();pb("zoomChanged",b)};this.getMode=function(){return Ia};this.setMode=function(b){La.clear(true);fb.clear();$("#workarea").attr("class",b);cb=I[0]&&I[0].nodeName=="text"?ab:N;Ia=b};this.getColor=function(b){return cb[b]};this.setColor=function(b,c,d){N[b]=c;cb[b+
"_paint"]={type:"solidColor"};for(var n=[],m=I.length;m--;){var A=I[m];if(A)if(A.tagName=="g")svgedit.utilities.walkTree(A,function(o){o.nodeName!="g"&&n.push(o)});else if(b=="fill")A.tagName!="polyline"&&A.tagName!="line"&&n.push(A);else n.push(A)}if(n.length>0)if(d)Nb(b,c,n);else{jb(b,c,n);aa("changed",n)}};var ib=function(){var b=p.getElementsByTagNameNS(i,"defs");if(b.length>0)b=b[0];else{b=f.createElementNS(i,"defs");p.firstChild?p.insertBefore(b,p.firstChild.nextSibling):p.appendChild(b)}return b},
hc=this.setGradient=function(b){if(!(!cb[b+"_paint"]||cb[b+"_paint"].type=="solidColor")){var c=e[b+"Grad"],d=cc(c),n=ib();if(d)c=d;else{c=n.appendChild(f.importNode(c,true));c.id=ya()}e.setColor(b,"url(#"+c.id+")")}},cc=function(b){var c=ib();c=$(c).find("linearGradient, radialGradient");for(var d=c.length,n=["r","cx","cy","fx","fy"];d--;){var m=c[d];if(b.tagName=="linearGradient"){if(b.getAttribute("x1")!=m.getAttribute("x1")||b.getAttribute("y1")!=m.getAttribute("y1")||b.getAttribute("x2")!=m.getAttribute("x2")||
b.getAttribute("y2")!=m.getAttribute("y2"))continue}else{var A=$(b).attr(n),o=$(m).attr(n),l=false;$.each(n,function(F,J){if(A[J]!=o[J])l=true});if(l)continue}var s=b.getElementsByTagNameNS(i,"stop"),B=m.getElementsByTagNameNS(i,"stop");if(s.length==B.length){for(var w=s.length;w--;){var v=s[w],C=B[w];if(v.getAttribute("offset")!=C.getAttribute("offset")||v.getAttribute("stop-opacity")!=C.getAttribute("stop-opacity")||v.getAttribute("stop-color")!=C.getAttribute("stop-color"))break}if(w==-1)return m}}return null};
this.setPaint=function(b,c){var d=new $.jGraduate.Paint(c);this.setPaintOpacity(b,d.alpha/100,true);cb[b+"_paint"]=d;switch(d.type){case "solidColor":if(d.solidColor!="none")this.setColor(b,"#"+d.solidColor);else{this.setColor(b,"none");document.querySelector(b=="fill"?"#fill_color rect":"#stroke_color rect").setAttribute("fill","transparent")}break;case "linearGradient":case "radialGradient":e[b+"Grad"]=d[d.type];hc(b)}};this.getStrokeWidth=function(){return cb.stroke_width};this.setStrokeWidth=
function(b){if(b==0&&["line","path"].indexOf(Ia)>=0)e.setStrokeWidth(1);else{cb.stroke_width=b;for(var c=[],d=I.length;d--;){var n=I[d];if(n)n.tagName=="g"?svgedit.utilities.walkTree(n,function(m){m.nodeName!="g"&&c.push(m)}):c.push(n)}if(c.length>0){jb("stroke-width",b,c);aa("changed",I)}}};this.setStrokeAttr=function(b,c){N[b.replace("-","_")]=c;for(var d=[],n=I.length;n--;){var m=I[n];if(m)m.tagName=="g"?svgedit.utilities.walkTree(m,function(A){A.nodeName!="g"&&d.push(A)}):d.push(m)}if(d.length>
0){jb(b,c,d);aa("changed",I)}};this.getStyle=function(){return N};this.getOpacity=function(){return N.opacity};this.setOpacity=function(b){N.opacity=b;jb("opacity",b)};this.getFillOpacity=function(){return N.fill_opacity};this.getStrokeOpacity=function(){return N.stroke_opacity};this.setPaintOpacity=function(b,c,d){N[b+"_opacity"]=c;d?Nb(b+"-opacity",c):jb(b+"-opacity",c)};this.getBlur=function(b){var c=0;if(b)if(b.getAttribute("filter"))if(b=ja(b.id+"_blur"))c=b.firstChild.getAttribute("stdDeviation");
return c};(function(){function b(){var m=e.undoMgr.finishUndoableChange();c.addSubCommand(m);Ca(c);d=c=null}var c=null,d=null,n=false;e.setBlurNoUndo=function(m){if(d)if(m===0){Nb("filter","");n=true}else{var A=I[0];n&&Nb("filter","url(#"+A.id+"_blur)");if(svgedit.browser.isWebkit()){A.removeAttribute("filter");A.setAttribute("filter","url(#"+A.id+"_blur)")}Nb("stdDeviation",m,[d.firstChild]);e.setBlurOffsets(d,m)}else e.setBlur(m)};e.setBlurOffsets=function(m,A){if(A>3)la(m,{x:"-50%",y:"-50%",width:"200%",
height:"200%"},100);else if(!svgedit.browser.isWebkit()){m.removeAttribute("x");m.removeAttribute("y");m.removeAttribute("width");m.removeAttribute("height")}};e.setBlur=function(m,A){if(c)b();else{var o=I[0],l=o.id;d=ja(l+"_blur");m-=0;var s=new Ga;if(d){if(m===0)d=null}else{var B=ma({element:"feGaussianBlur",attr:{"in":"SourceGraphic",stdDeviation:m}});d=ma({element:"filter",attr:{id:l+"_blur"}});d.appendChild(B);ib().appendChild(d);s.addSubCommand(new Fa(d))}B={filter:o.getAttribute("filter")};
if(m===0){o.removeAttribute("filter");s.addSubCommand(new Qa(o,B))}else{jb("filter","url(#"+l+"_blur)");s.addSubCommand(new Qa(o,B));e.setBlurOffsets(d,m);c=s;e.undoMgr.beginUndoableChange("stdDeviation",[d?d.firstChild:null]);if(A){e.setBlurNoUndo(m);b()}}}}})();this.getBold=function(){var b=I[0];if(b!=null&&b.tagName=="text"&&I[1]==null)return b.getAttribute("font-weight")=="bold";return false};this.setBold=function(b){var c=I[0];if(c!=null&&c.tagName=="text"&&I[1]==null)jb("font-weight",b?"bold":
"normal");I[0].textContent||fb.setCursor()};this.getItalic=function(){var b=I[0];if(b!=null&&b.tagName=="text"&&I[1]==null)return b.getAttribute("font-style")=="italic";return false};this.setItalic=function(b){var c=I[0];if(c!=null&&c.tagName=="text"&&I[1]==null)jb("font-style",b?"italic":"normal");I[0].textContent||fb.setCursor()};this.getFontFamily=function(){return ab.font_family};this.setFontFamily=function(b){ab.font_family=b;jb("font-family",b);I[0]&&!I[0].textContent&&fb.setCursor()};this.setFontColor=
function(b){ab.fill=b;jb("fill",b)};this.getFontSize=function(){return ab.fill};this.getFontSize=function(){return ab.font_size};this.setFontSize=function(b){ab.font_size=b;jb("font-size",b);I[0].textContent||fb.setCursor()};this.getText=function(){var b=I[0];if(b==null)return"";return b.textContent};this.setTextContent=function(b){jb("#text",b);fb.init(b);fb.setCursor()};this.setImageURL=function(b){var c=I[0];if(c){var d=$(c).attr(["width","height"]);d=!d.width||!d.height;var n=U(c);if(n!==b)d=
true;else if(!d)return;var m=new Ga("Change Image URL");Z(c,b);m.addSubCommand(new Qa(c,{"#href":n}));d?$(new Image).load(function(){var A=$(c).attr(["width","height"]);$(c).attr({width:this.width,height:this.height});Ha.requestSelector(c).resize();m.addSubCommand(new Qa(c,A));Ca(m);aa("changed",[c])}).attr("src",b):Ca(m)}};this.setLinkURL=function(b){var c=I[0];if(c){if(c.tagName!=="a"){c=$(c).parents("a");if(c.length)c=c[0];else return}var d=U(c);if(d!==b){var n=new Ga("Change Link URL");Z(c,b);
n.addSubCommand(new Qa(c,{"#href":d}));Ca(n)}}};this.setRectRadius=function(b){var c=I[0];if(c!=null&&c.tagName=="rect"){var d=c.getAttribute("rx");if(d!=b){c.setAttribute("rx",b);c.setAttribute("ry",b);Ca(new Qa(c,{rx:d,ry:d},"Radius"));aa("changed",[c])}}};this.makeHyperlink=function(b){e.groupSelectedElements("a",b)};this.removeHyperlink=function(){e.ungroupSelectedElement()};this.setSegType=function(b){La.setSegType(b)};this.convertToPath=function(b,c){if(b==null)$.each(I,function(fa,R){R&&e.convertToPath(R)});
else{if(!c)var d=new Ga("Convert element to Path");var n=c?{}:{fill:N.fill,"fill-opacity":N.fill_opacity,stroke:N.stroke,"stroke-width":N.stroke_width,"stroke-dasharray":N.stroke_dasharray,"stroke-linejoin":N.stroke_linejoin,"stroke-linecap":N.stroke_linecap,"stroke-opacity":N.stroke_opacity,opacity:N.opacity,visibility:"hidden"};$.each(["marker-start","marker-end","marker-mid","filter","clip-path"],function(){if(b.getAttribute(this))n[this]=b.getAttribute(this)});var m=ma({element:"path",attr:n}),
A=b.getAttribute("transform");A&&m.setAttribute("transform",A);var o=b.id,l=b.parentNode;b.nextSibling?l.insertBefore(m,b):l.appendChild(m);var s="",B=function(fa){$.each(fa,function(R,W){var Y=W[1];s+=W[0];for(var na=0;na<Y.length;na+=2)s+=Y[na]+","+Y[na+1]+" "})},w=1.81;switch(b.tagName){case "ellipse":case "circle":var v=$(b).attr(["rx","ry","cx","cy"]),C=v.cx,F=v.cy,J=v.rx;v=v.ry;if(b.tagName=="circle")J=v=$(b).attr("r");B([["M",[C-J,F]],["C",[C-J,F-v/w,C-J/w,F-v,C,F-v]],["C",[C+J/w,F-v,C+J,F-
v/w,C+J,F]],["C",[C+J,F+v/w,C+J/w,F+v,C,F+v]],["C",[C-J/w,F+v,C-J,F+v/w,C-J,F]],["Z",[]]]);break;case "path":s=b.getAttribute("d");break;case "line":v=$(b).attr(["x1","y1","x2","y2"]);s="M"+v.x1+","+v.y1+"L"+v.x2+","+v.y2;break;case "polyline":case "polygon":s="M"+b.getAttribute("points");break;case "rect":v=$(b).attr(["rx","ry"]);J=v.rx;v=v.ry;var K=b.getBBox();C=K.x;F=K.y;var P=K.width;K=K.height;w=4-w;!J&&!v?B([["M",[C,F]],["L",[C+P,F]],["L",[C+P,F+K]],["L",[C,F+K]],["L",[C,F]],["Z",[]]]):B([["M",
[C,F+v]],["C",[C,F+v/w,C+J/w,F,C+J,F]],["L",[C+P-J,F]],["C",[C+P-J/w,F,C+P,F+v/w,C+P,F+v]],["L",[C+P,F+K-v]],["C",[C+P,F+K-v/w,C+P-J/w,F+K,C+P-J,F+K]],["L",[C+J,F+K]],["C",[C+J/w,F+K,C,F+K-v/w,C,F+K-v]],["L",[C,F+v]],["Z",[]]]);break;default:m.parentNode.removeChild(m)}s&&m.setAttribute("d",s);if(c){La.resetOrientation(m);d=false;try{d=m.getBBox()}catch(ca){}m.parentNode.removeChild(m);return d}else{if(A){A=ia(m);qa(A)&&La.resetOrientation(m)}d.addSubCommand(new Oa(b,b.nextSibling,l));d.addSubCommand(new Fa(m));
Ta();b.parentNode.removeChild(b);m.setAttribute("id",o);m.removeAttribute("visibility");eb([m],true);Ca(d)}}};var Nb=function(b,c,d){var n=g.suspendRedraw(1E3);Ia=="pathedit"&&La.moveNode(b,c);d=d||I;for(var m=d.length,A=["g","polyline","path"];m--;){var o=d[m];if(o!=null){Ia==="textedit"&&b!=="#text"&&o.textContent.length&&fb.toSelectMode(o);if((b==="x"||b==="y")&&A.indexOf(o.tagName)>=0){var l=getStrokedBBox([o]);e.moveSelectedElements((b==="x"?c-l.x:0)*q,(b==="y"?c-l.y:0)*q,true)}else{l=b==="#text"?
o.textContent:o.getAttribute(b);if(l==null)l="";if(l!==String(c)){if(b=="#text"){svgedit.utilities.getBBox(o);o.textContent=c;if(/rotate/.test(o.getAttribute("transform")))o=Eb(o)}else b=="#href"?Z(o,c):o.setAttribute(b,c);if(svgedit.browser.isGecko()&&o.nodeName==="text"&&/rotate/.test(o.getAttribute("transform")))if((c+"").indexOf("url")===0||["font-size","font-family","x","y"].indexOf(b)>=0&&o.textContent)o=Eb(o);I.indexOf(o)>=0&&setTimeout(function(){o.parentNode&&Ha.requestSelector(o).resize()},
0);l=ra(o);if(l!=0&&b!="transform")for(var s=ia(o),B=s.numberOfItems;B--;)if(s.getItem(B).type==4){s.removeItem(B);var w=svgedit.utilities.getBBox(o),v=ka(w.x+w.width/2,w.y+w.height/2,ga(s).matrix);w=v.x;v=v.y;var C=g.createSVGTransform();C.setRotate(l,w,v);s.insertItemBefore(C,B);break}}}}}g.unsuspendRedraw(n)},jb=this.changeSelectedAttribute=function(b,c,d){d=d||I;e.undoMgr.beginUndoableChange(b,d);Nb(b,c,d);b=e.undoMgr.finishUndoableChange();b.isEmpty()||Ca(b)};this.deleteSelectedElements=function(){for(var b=
new Ga("Delete Elements"),c=I.length,d=[],n=0;n<c;++n){var m=I[n];if(m==null)break;var A=m.parentNode,o=m;Ha.releaseSelector(o);svgedit.path.removePath_(o.id);if(A.tagName==="a"&&A.childNodes.length===1){o=A;A=A.parentNode}var l=o.nextSibling;o=A.removeChild(o);d.push(m);I[n]=null;b.addSubCommand(new Oa(o,l,A))}b.isEmpty()||Ca(b);aa("changed",d);Ta()};this.cutSelectedElements=function(){for(var b=new Ga("Cut Elements"),c=I.length,d=[],n=0;n<c;++n){var m=I[n];if(m==null)break;var A=m.parentNode,o=
m;Ha.releaseSelector(o);svgedit.path.removePath_(o.id);var l=o.nextSibling;o=A.removeChild(o);d.push(m);I[n]=null;b.addSubCommand(new Oa(o,l,A))}b.isEmpty()||Ca(b);aa("changed",d);Ta();e.clipBoard=d};this.copySelectedElements=function(){e.clipBoard=$.merge([],I)};this.pasteElements=function(b,c,d){var n=e.clipBoard,m=n.length;if(m){for(var A=[],o=new Ga("Paste elements");m--;){var l=n[m];if(l){var s=V(l);if(!ja(l.id))s.id=l.id;A.push(s);(M||D().getCurrentLayer()).appendChild(s);o.addSubCommand(new Fa(s))}}Ib(A);
if(b!="in_place"){if(xb==null){xb.x=0;xb.y=0}var B,w;if(b){if(b==="point"){B=c;w=d}}else{B=xb.x;w=xb.y}b=getStrokedBBox(A);var v=B-(b.x+b.width/2),C=w-(b.y+b.height/2),F=[],J=[];$.each(A,function(){F.push(v);J.push(C)});B=e.moveSelectedElements(F,J,false);o.addSubCommand(B)}Ca(o);aa("changed",A)}};this.groupSelectedElements=function(b){b||(b="g");var c="";switch(b){case "a":c="Make hyperlink";var d="";if(arguments.length>1)d=arguments[1];break;default:b="g";c="Group Elements"}c=new Ga(c);var n=ma({element:b,
attr:{id:ya()}});b==="a"&&Z(n,d);c.addSubCommand(new Fa(n));for(d=I.length;d--;){var m=I[d];if(m!=null){if(m.parentNode.tagName==="a"&&m.parentNode.childNodes.length===1)m=m.parentNode;var A=m.nextSibling,o=m.parentNode;n.appendChild(m);c.addSubCommand(new Ma(m,A,o))}}c.isEmpty()||Ca(c);Ib([n],true)};var ec=this.pushGroupProperties=function(b,c){var d=b.childNodes,n=d.length,m=b.getAttribute("transform"),A=ia(b),o=ga(A).matrix,l=new Ga("Push group properties"),s=0,B=ra(b),w=$(b).attr(["filter","opacity"]),
v,C;for(s=0;s<n;s++){var F=d[s];if(F.nodeType===1){if(w.opacity!==null&&w.opacity!==1){F.getAttribute("opacity");var J=Math.round((F.getAttribute("opacity")||1)*w.opacity*100)/100;jb("opacity",J,[F])}if(w.filter){var K=J=this.getBlur(F);C||(C=this.getBlur(b));if(J)J=C-0+(J-0);else if(J===0)J=C;if(K)v=Sa(F.getAttribute("filter"));else if(v){v=V(v);ib().appendChild(v)}else v=Sa(w.filter);v.id=F.id+"_"+(v.firstChild.tagName==="feGaussianBlur"?"blur":"filter");jb("filter","url(#"+v.id+")",[F]);if(J){jb("stdDeviation",
J,[v.firstChild]);e.setBlurOffsets(v,J)}}J=ia(F);if(~F.tagName.indexOf("Gradient"))J=null;if(J)if(F.tagName!=="defs")if(A.numberOfItems){if(B&&A.numberOfItems==1){var P=A.getItem(0).matrix,ca=g.createSVGMatrix();if(K=ra(F))ca=J.getItem(0).matrix;var fa=svgedit.utilities.getBBox(F),R=ga(J).matrix,W=ka(fa.x+fa.width/2,fa.y+fa.height/2,R);fa=B+K;R=g.createSVGTransform();R.setRotate(fa,W.x,W.y);P=X(P,ca,R.matrix.inverse());K&&J.removeItem(0);if(fa)J.numberOfItems?J.insertItemBefore(R,0):J.appendItem(R);
if(P.e||P.f){K=g.createSVGTransform();K.setTranslate(P.e,P.f);J.numberOfItems?J.insertItemBefore(K,0):J.appendItem(K)}}else{K=F.getAttribute("transform");P={};P.transform=K?K:"";K=g.createSVGTransform();P=ga(J).matrix;ca=P.inverse();P=X(ca,o,P);K.setMatrix(P);J.appendItem(K)}(F=nb(F))&&l.addSubCommand(F)}}}if(m){P={};P.transform=m;b.setAttribute("transform","");b.removeAttribute("transform");l.addSubCommand(new Qa(b,P))}if(c&&!l.isEmpty())return l};this.ungroupSelectedElement=function(){var b=I[0];
if($(b).data("gsvg")||$(b).data("symbol"))kc(b);else if(b.tagName==="use"){var c=ja(U(b).substr(1));$(b).data("symbol",c).data("ref",c);kc(b)}else{c=$(b).parents("a");if(c.length)b=c[0];if(b.tagName==="g"||b.tagName==="a"){c=new Ga("Ungroup Elements");var d=ec(b,true);d&&c.addSubCommand(d);d=b.parentNode;for(var n=b.nextSibling,m=Array(b.childNodes.length),A=0;b.firstChild;){var o=b.firstChild,l=o.nextSibling,s=o.parentNode;if(o.tagName==="title"){c.addSubCommand(new Oa(o,o.nextSibling,s));s.removeChild(o)}else{m[A++]=
o=d.insertBefore(o,n);c.addSubCommand(new Ma(o,l,s))}}Ta();n=b.nextSibling;b=d.removeChild(b);c.addSubCommand(new Oa(b,n,d));c.isEmpty()||Ca(c);eb(m)}}};this.moveToTopSelectedElement=function(){var b=I[0];if(b!=null){b=b;var c=b.parentNode,d=b.nextSibling;b=b.parentNode.appendChild(b);if(d!=b.nextSibling){Ca(new Ma(b,d,c,"top"));aa("changed",[b])}}};this.moveToBottomSelectedElement=function(){var b=I[0];if(b!=null){b=b;var c=b.parentNode,d=b.nextSibling,n=b.parentNode.firstChild;if(n.tagName=="title")n=
n.nextSibling;if(n.tagName=="defs")n=n.nextSibling;b=b.parentNode.insertBefore(b,n);if(d!=b.nextSibling){Ca(new Ma(b,d,c,"bottom"));aa("changed",[b])}}};this.moveUpDownSelected=function(b){var c=I[0];if(c){vb=[];var d,n,m=$(Rb(getStrokedBBox([c]))).toArray();b=="Down"&&m.reverse();$.each(m,function(){if(n){d=this;return false}else if(this==c)n=true});if(d){m=c.parentNode;var A=c.nextSibling;$(d)[b=="Down"?"before":"after"](c);if(A!=c.nextSibling){Ca(new Ma(c,A,m,"Move "+b));aa("changed",[c])}}}};
this.moveSelectedElements=function(b,c,d){if(b.constructor!=Array){b/=q;c/=q}d=d||true;for(var n=new Ga("position"),m=I.length;m--;){var A=I[m];if(A!=null){var o=g.createSVGTransform(),l=ia(A);b.constructor==Array?o.setTranslate(b[m],c[m]):o.setTranslate(b,c);l.numberOfItems?l.insertItemBefore(o,0):l.appendItem(o);(o=nb(A))&&n.addSubCommand(o);Ha.requestSelector(A).resize()}}if(!n.isEmpty()){d&&Ca(n);aa("changed",I);return n}};this.cloneSelectedElements=function(b,c){for(var d=new Ga("Clone Elements"),
n=I.length,m=0;m<n;++m){var A=I[m];if(A==null)break}n=I.slice(0,m);this.clearSelection(true);for(m=n.length;m--;){A=n[m]=V(n[m]);(M||D().getCurrentLayer()).appendChild(A);d.addSubCommand(new Fa(A))}if(!d.isEmpty()){eb(n.reverse());this.moveSelectedElements(b,c,false);Ca(d)}};this.alignSelectedElements=function(b,c){var d=[],n=Number.MAX_VALUE,m=Number.MIN_VALUE,A=Number.MAX_VALUE,o=Number.MIN_VALUE,l=Number.MIN_VALUE,s=Number.MIN_VALUE,B=I.length;if(B){for(var w=0;w<B;++w){if(I[w]==null)break;d[w]=
getStrokedBBox([I[w]]);switch(c){case "smallest":if((b=="l"||b=="c"||b=="r")&&(l==Number.MIN_VALUE||l>d[w].width)||(b=="t"||b=="m"||b=="b")&&(s==Number.MIN_VALUE||s>d[w].height)){n=d[w].x;A=d[w].y;m=d[w].x+d[w].width;o=d[w].y+d[w].height;l=d[w].width;s=d[w].height}break;case "largest":if((b=="l"||b=="c"||b=="r")&&(l==Number.MIN_VALUE||l<d[w].width)||(b=="t"||b=="m"||b=="b")&&(s==Number.MIN_VALUE||s<d[w].height)){n=d[w].x;A=d[w].y;m=d[w].x+d[w].width;o=d[w].y+d[w].height;l=d[w].width;s=d[w].height}break;
default:if(d[w].x<n)n=d[w].x;if(d[w].y<A)A=d[w].y;if(d[w].x+d[w].width>m)m=d[w].x+d[w].width;if(d[w].y+d[w].height>o)o=d[w].y+d[w].height}}if(c=="page"){A=n=0;m=e.contentW;o=e.contentH}l=Array(B);s=Array(B);for(w=0;w<B;++w){if(I[w]==null)break;var v=d[w];l[w]=0;s[w]=0;switch(b){case "l":l[w]=n-v.x;break;case "c":l[w]=(n+m)/2-(v.x+v.width/2);break;case "r":l[w]=m-(v.x+v.width);break;case "t":s[w]=A-v.y;break;case "m":s[w]=(A+o)/2-(v.y+v.height/2);break;case "b":s[w]=o-(v.y+v.height)}}this.moveSelectedElements(l,
s)}};this.contentW=Ub().w;this.contentH=Ub().h;this.updateCanvas=function(b,c){g.setAttribute("width",b);g.setAttribute("height",c);var d=$("#canvasBackground")[0],n=p.getAttribute("x"),m=p.getAttribute("y"),A=b/2-this.contentW*q/2,o=c/2-this.contentH*q/2;la(p,{width:this.contentW*q,height:this.contentH*q,x:A,y:o,viewBox:"0 0 "+this.contentW+" "+this.contentH});la(d,{width:p.getAttribute("width"),height:p.getAttribute("height"),x:A,y:o});(d=ja("background_image"))&&la(d,{width:"100%",height:"100%"});
Ha.selectorParentGroup.setAttribute("transform","translate("+A+","+o+")");return{x:A,y:o,old_x:n,old_y:m,d_x:A-n,d_y:o-m}};this.setBackground=function(b,c){var d=ja("canvasBackground"),n=$(d).find("rect")[0],m=ja("background_image");n.setAttribute("fill",b);if(c){if(!m){m=f.createElementNS(i,"image");la(m,{id:"background_image",width:"100%",height:"100%",preserveAspectRatio:"xMinYMin",style:"pointer-events:none"})}Z(m,c);d.appendChild(m)}else m&&m.parentNode.removeChild(m)};this.cycleElement=function(b){var c=
I[0],d=false,n=Lb(M||D().getCurrentLayer());if(n.length){if(c==null){b=b?n.length-1:0;d=n[b]}else for(var m=n.length;m--;)if(n[m]==c){b=b?m-1:m+1;if(b>=n.length)b=0;else if(b<0)b=n.length-1;d=n[b];break}Ib([d],true);aa("selected",I)}};this.clear();this.getPrivateMethods=function(){return{addCommandToHistory:Ca,setGradient:hc,addSvgElementFromJson:ma,assignAttributes:la,BatchCommand:Ga,call:aa,ChangeElementCommand:Qa,copyElem:V,ffClone:Eb,findDefs:ib,findDuplicateGradient:cc,getElem:ja,getId:ua,getIntersectionList:Rb,
getMouseTarget:Zb,getNextId:ya,getPathBBox:ea,getUrlFromAttr:Ra,hasMatrixTransform:qa,identifyLayers:Vb,InsertElementCommand:Fa,isIdentity:svgedit.math.isIdentity,logMatrix:tb,matrixMultiply:X,MoveElementCommand:Ma,preventClickDefault:Yb,recalculateAllSelectedDimensions:Ab,recalculateDimensions:nb,remapElement:Fb,RemoveElementCommand:Oa,removeUnusedDefElems:fc,round:Kb,runExtensions:pb,sanitizeSvg:Da,SVGEditTransformList:svgedit.transformlist.SVGTransformList,toString:toString,transformBox:svgedit.math.transformBox,
transformListToTransform:ga,transformPoint:ka,walkTree:svgedit.utilities.walkTree}}};(function(){document.addEventListener("touchstart",touchHandler,true);document.addEventListener("touchmove",touchHandler,true);document.addEventListener("touchend",touchHandler,true);document.addEventListener("touchcancel",touchHandler,true);if(!window.svgEditor)window.svgEditor=function(a){function H(D,q){var M=h.setSvgString(D)!==false;q=q||a.noop;M?q(true):a.alert(g.notification.errorLoadingSVG,function(){q(false)})}var h,i={},u=false,E={lang:"en",iconsize:"m",bkgd_color:"FFF",bkgd_url:"",img_save:"embed"},
e={},f={canvas_expansion:1.2,dimensions:[640,480],initFill:{color:"fff",opacity:1},initStroke:{width:1.5,color:"000",opacity:1},initOpacity:1,imgPath:"images/",langPath:"locale/",extPath:"extensions/",jGraduatePath:"jgraduate/images/",extensions:["ext-markers.js","ext-eyedropper.js","ext-shapes.js","ext-grid.js"],initTool:"select",wireframe:false,colorPickerCSS:false,gridSnapping:false,gridColor:"#000",baseUnit:"px",snappingStep:10,showRulers:true,show_outside_canvas:false},g=i.uiStrings={common:{ok:"OK",
cancel:"Cancel",key_up:"Up",key_down:"Down",key_backspace:"Backspace",key_del:"Del"},layers:{layer:"Layer"},notification:{invalidAttrValGiven:"Invalid value given",noContentToFitTo:"No content to fit to",dupeLayerName:"There is already a layer named that!",enterUniqueLayerName:"Please enter a unique layer name",enterNewLayerName:"Please enter the new layer name",layerHasThatName:"Layer already has that name",QmoveElemsToLayer:'Move selected elements to layer "%s"?',QwantToClear:"Do you want to clear the drawing?\nThis will also erase your undo history!",
QwantToOpen:"Do you want to open a new file?\nThis will also erase your undo history!",QerrorsRevertToSource:"There were parsing errors in your SVG source.\nRevert back to original SVG source?",QignoreSourceChanges:"Ignore changes made to SVG source?",featNotSupported:"Feature not supported",enterNewImgURL:"Enter the new image URL",defsFailOnSave:"NOTE: Due to a bug in your browser, this image may appear wrong (missing gradients or elements). It will however appear correct once actually saved.",loadingImage:"Loading image, please wait...",
saveFromBrowser:'Select "Save As..." in your browser to save this image as a %s file.',noteTheseIssues:"Also note the following issues: ",unsavedChanges:"There are unsaved changes.",enterNewLinkURL:"Enter the new hyperlink URL",errorLoadingSVG:"Error: Unable to load SVG data",URLloadFail:"Unable to load from URL",retrieving:'Retrieving "%s" ...'}};e={};var p={};i.curConfig=f;i.tool_scale=1;a.pref=function(D,q){if(q)e[D]=q;D="svg-edit-"+D;var M=location.hostname,ba=M&&M.indexOf(".")>=0,N=q!=undefined,
I=false;try{if(window.localStorage)I=localStorage}catch(ma){}try{if(window.globalStorage&&ba)I=globalStorage[M]}catch(ia){}if(I)if(N)I.setItem(D,q);else{if(I.getItem(D))return I.getItem(D)+""}else if(window.widget)if(N)widget.setPreferenceForKey(q,D);else return widget.preferenceForKey(D);else if(N){M=new Date;M.setTime(M.getTime()+31536E6);q=encodeURIComponent(q);document.cookie=D+"="+q+"; expires="+M.toUTCString()}else return(M=document.cookie.match(RegExp(D+"=([^;]+)")))?decodeURIComponent(M[1]):
""};i.setConfig=function(D){a.each(D,function(q,M){q in E&&a.pref(q,M)});a.extend(true,f,D);if(D.extensions)f.extensions=D.extensions};i.setCustomHandlers=function(D){i.ready(function(){if(D.open){a('#tool_open > input[type="file"]').remove();a("#tool_open").show();h.open=D.open}if(D.save){i.show_save_warning=false;h.bind("saved",D.save)}D.pngsave&&h.bind("exported",D.pngsave);p=D})};i.randomizeIds=function(){h.randomizeIds(arguments)};i.init=function(){function D(k,t){var G=k.id,L=G.split("_"),O=
L[0];L=L[1];t&&h.setStrokeAttr("stroke-"+O,L);ab();F("#cur_"+O,G,20);a(k).addClass("current").siblings().removeClass("current")}function q(k,t){a.pref("bkgd_color",k);a.pref("bkgd_url",t);h.setBackground(k,t)}function M(){var k=h.getHref(T);k=k.indexOf("data:")===0?"":k;a.prompt(g.notification.enterNewImgURL,k,function(t){t&&ub(t)})}function ba(){if(h.deleteCurrentLayer()){Ua();rb();a("#layerlist tr.layer").removeClass("layersel");a("#layerlist tr.layer:first").addClass("layersel")}}function N(){var k=
h.getCurrentDrawing().getCurrentLayerName()+" copy";a.prompt(g.notification.enterUniqueLayerName,k,function(t){if(t)if(h.getCurrentDrawing().hasLayer(t))a.alert(g.notification.dupeLayerName);else{h.cloneLayer(t);Ua();rb()}})}function I(k){var t=a("#layerlist tr.layersel").index(),G=h.getCurrentDrawing().getNumLayers();if(t>0||t<G-1){t+=k;h.setCurrentLayerPosition(G-t-1);rb()}}function ma(k,t){var G=document.getElementById("ruler_x_cursor"),L=document.getElementById("ruler_y_cursor"),O=document.getElementById("workarea"),
S=document.getElementById("title_show");a("#workarea").unbind("mousemove.rulers").bind("mousemove.rulers",function(Wb){Wb.stopPropagation();G.style.left=Wb.pageX-66+O.scrollLeft+"px";L.style.top=Wb.pageY-48+O.scrollTop+"px";Wb=Wb.target.getAttribute("title");typeof Wb!="undefined"&&Wb&&S.innerHTML(Wb)});t||(t=h.getZoom());k||(k=a("#svgcanvas"));for(var da=h.getContentElem(),oa=svgedit.units.getTypeMap()[f.baseUnit],xa=0;xa<2;xa++){var Ba=xa===0,sa=Ba?"x":"y",Ya=Ba?"width":"height",Za=da.getAttribute(sa)-
0;sa=a("#ruler_"+sa+" canvas:first");$hcanv=sa.clone();sa.replaceWith($hcanv);var Q=$hcanv[0];var ob=sa=k[Ya]()*2;Q.parentNode.style[Ya]=ob+"px";var $a=0,Ka,Ea=Q.getContext("2d");Ea.fillStyle="rgb(200,0,0)";Ea.fillRect(0,0,Q.width,Q.height);$hcanv.siblings().remove();if(sa>=3E4){var Pa=parseInt(sa/3E4)+1;Ka=Array(Pa);Ka[0]=Ea;for(var ta=1;ta<Pa;ta++){Q[Ya]=3E4;var bb=Q.cloneNode(true);Q.parentNode.appendChild(bb);Ka[ta]=bb.getContext("2d")}bb[Ya]=sa%3E4;sa=3E4}Q[Ya]=sa;Ya=oa*t;var hb=50/Ya;Q=1;for(ta=
0;ta<ic.length;ta++){Q=Pa=ic[ta];if(hb<=Pa)break}hb=Q*Ya;Ea.font="normal 9px 'Lucida Grande', sans-serif";Ea.fillStyle="#777";for(var sb=Za/Ya%Q*Ya,Xb=sb-hb;sb<ob;sb+=hb){Xb+=hb;ta=Math.round(sb)+0.5;if(Ba){Ea.moveTo(ta,15);Ea.lineTo(ta,0)}else{Ea.moveTo(15,ta);Ea.lineTo(0,ta)}Pa=(Xb-Za)/Ya;if(Q>=1)ta=Math.round(Pa);else{ta=(Q+"").split(".")[1].length;ta=Pa.toFixed(ta)-0}if(ta!==0&&ta!==1E3&&ta%1E3===0)ta=ta/1E3+"K";if(Ba){Ea.fillText(ta,sb+2,8);Ea.fillStyle="#777"}else{Pa=(ta+"").split("");for(ta=
0;ta<Pa.length;ta++){Ea.fillText(Pa[ta],1,sb+9+ta*9);Ea.fillStyle="#777"}}Pa=hb/10;for(ta=1;ta<10;ta++){var Db=Math.round(sb+Pa*ta)+0.5;if(Ka&&Db>sa){$a++;Ea.stroke();if($a>=Ka.length){ta=10;sb=ob;continue}Ea=Ka[$a];sb-=3E4;Db=Math.round(sb+Pa*ta)+0.5}var pc=ta%2?12:10;if(Ba){Ea.moveTo(Db,15);Ea.lineTo(Db,pc)}else{Ea.moveTo(15,Db);Ea.lineTo(pc,Db)}}}Ea.strokeStyle="#666";Ea.stroke()}}(function(){var k=window.opener;if(k)try{var t=k.document.createEvent("Event");t.initEvent("svgEditorReady",true,true);
k.document.documentElement.dispatchEvent(t)}catch(G){}})();(function(){var k=a.deparam.querystring(true);if(!a.isEmptyObject(k)){if(k.dimensions)k.dimensions=k.dimensions.split(",");if(k.extensions)k.extensions=k.extensions.split(",");if(k.bkgd_color)k.bkgd_color="#"+k.bkgd_color;svgEditor.setConfig(k);var t=k.source,G=a.param.querystring();if(!t)if(G.indexOf("source=data:")>=0)t=G.match(/source=(data:[^&]*)/)[1];if(t)if(t.indexOf("data:")===0){t=t.replace(/ /g,"+");i.loadFromDataURI(t)}else i.loadFromString(t);
else if(G.indexOf("paramurl=")!==-1)svgEditor.loadFromURL(G.substr(9));else k.url&&svgEditor.loadFromURL(k.url)}})();var ia=function(){a.each(f.extensions,function(){var t=this;a.getScript(f.extPath+t,function(G){if(!G){G=document.createElement("script");G.src=f.extPath+t;document.querySelector("head").appendChild(G)}})});var k=[];a("#lang_select option").each(function(){k.push(this.value)});i.putLocale(null,k)};document.location.protocol==="file:"?setTimeout(ia,100):ia();a.svgIcons(f.imgPath+"svg_edit_icons.svg",
{w:24,h:24,id_match:false,no_img:!svgedit.browser.isWebkit(),fallback_path:f.imgPath,fallback:{new_image:"clear.png",save:"save.png",open:"open.png",source:"source.png",docprops:"document-properties.png",wireframe:"wireframe.png",undo:"undo.png",redo:"redo.png",select:"select.png",select_node:"select_node.png",pencil:"fhpath.png",pen:"line.png",square:"square.png",rect:"rect.png",fh_rect:"freehand-square.png",circle:"circle.png",ellipse:"ellipse.png",fh_ellipse:"freehand-circle.png",path:"path.png",
text:"text.png",image:"image.png",zoom:"zoom.png",clone:"clone.png",node_clone:"node_clone.png","delete":"delete.png",node_delete:"node_delete.png",move_top:"move_top.png",move_bottom:"move_bottom.png",to_path:"to_path.png",link_controls:"link_controls.png",reorient:"reorient.png",align_left:"align-left.png",align_center:"align-center",align_right:"align-right",align_top:"align-top",align_middle:"align-middle",align_bottom:"align-bottom",go_up:"go-up.png",go_down:"go-down.png",ok:"save.png",cancel:"cancel.png",
arrow_right:"flyouth.png",arrow_down:"dropdown.gif"},placement:{"#tool_docprops > div":"docprops","#tool_select":"select","#tool_fhpath":"pencil","#tool_line":"pen","#tool_rect,#tools_rect_show":"rect","#tool_square":"square","#tool_fhrect":"fh_rect","#tool_ellipse,#tools_ellipse_show":"ellipse","#tool_circle":"circle","#tool_fhellipse":"fh_ellipse","#tool_path":"path","#tool_text,#layer_rename":"text","#tool_image":"image","#tool_zoom":"zoom","#tool_node_clone":"node_clone","#tool_node_delete":"node_delete",
"#tool_add_subpath":"add_subpath","#tool_openclose_path":"open_path","#tool_node_link":"link_controls","#tool_alignleft, #tool_posleft":"align_left","#tool_aligncenter, #tool_poscenter":"align_center","#tool_alignright, #tool_posright":"align_right","#tool_aligntop, #tool_postop":"align_top","#tool_alignmiddle, #tool_posmiddle":"align_middle","#tool_alignbottom, #tool_posbottom":"align_bottom","#cur_position":"align","#linecap_butt,#cur_linecap":"linecap_butt","#linecap_round":"linecap_round","#linecap_square":"linecap_square",
"#linejoin_miter,#cur_linejoin":"linejoin_miter","#linejoin_round":"linejoin_round","#linejoin_bevel":"linejoin_bevel","#url_notice":"warning","#layer_up":"go_up","#layer_down":"go_down","#layer_moreopts":"context_menu","#layerlist td.layervis":"eye","#tool_source_save,#tool_docprops_save,#tool_prefs_save":"ok","#tool_source_cancel,#tool_docprops_cancel,#tool_prefs_cancel":"cancel","#rwidthLabel, #iwidthLabel":"width","#rheightLabel, #iheightLabel":"height","#angleLabel":"angle","#linkLabel,#tool_make_link,#tool_make_link_multi":"globe_link",
"#zoomLabel":"zoom","#blurLabel":"blur",".flyout_arrow_horiz":"arrow_right","#palette .palette_item:first, #fill_bg, #stroke_bg":"no_color"},resize:{"#logo .svg_icon":32,".flyout_arrow_horiz .svg_icon":5,".layer_button .svg_icon, #layerlist td.layervis .svg_icon":14,"#main_button .dropdown .svg_icon":9,"#fill_bg .svg_icon, #stroke_bg .svg_icon":24,".palette_item:first .svg_icon":16,".toolbar_button button .svg_icon":16,".stroke_tool div div .svg_icon":20,"#tools_bottom label .svg_icon":18,"#zoom_dropdown .svg_icon":7},
callback:function(){a(".toolbar_button button > svg, .toolbar_button button > img").each(function(){a(this).parent().prepend(this)});var k=a("#tools_left");if(k.length!=0){k.offset();k.outerHeight()}a(".tools_flyout").each(function(){var t=a("#"+this.id+"_show"),G=t.attr("data-curopt");if(!t.children("svg, img").length){G=a(G).children().clone();if(G.length){G[0].removeAttribute("style");t.append(G)}}});svgEditor.runCallbacks();setTimeout(function(){a(".flyout_arrow_horiz:empty").each(function(){a(this).append(a.getSvgIcon("arrow_right").width(5).height(5))})},
1)}});i.canvas=h=new a.SvgCanvas(document.getElementById("svgcanvas"),f);i.show_save_warning=false;ia=navigator.platform.indexOf("Mac")>=0;var ka=navigator.userAgent.indexOf("AppleWebKit")>=0,X=ia?"meta+":"ctrl+",qa=h.pathActions,ga=h.undoMgr,Na=svgedit.utilities,va=f.imgPath+"placeholder.svg",ha=a("#workarea"),Ra=a("#cmenu_canvas");a("#cmenu_layers");var U=null,Z=1,ea="toolbars",ra="",ja={fill:null,stroke:null};(function(){a("#dialog_container").draggable({cancel:"#dialog_content, #dialog_buttons *",
containment:"window"});var k=a("#dialog_box"),t=a("#dialog_buttons"),G=function(L,O,S,da){a("#dialog_content").html("<p>"+O.replace(/\n/g,"</p><p>")+"</p>").toggleClass("prompt",L=="prompt");t.empty();var oa=a('<input type="button" value="'+g.common.ok+'">').appendTo(t);L!="alert"&&a('<input type="button" value="'+g.common.cancel+'">').appendTo(t).click(function(){k.hide();S(false)});if(L=="prompt"){var xa=a('<input type="text">').prependTo(t);xa.val(da||"");xa.bind("keydown","return",function(){oa.click()})}L==
"process"&&oa.hide();k.show();oa.click(function(){k.hide();var Ba=L=="prompt"?xa.val():true;S&&S(Ba)}).focus();L=="prompt"&&xa.focus()};a.alert=function(L,O){G("alert",L,O)};a.confirm=function(L,O){G("confirm",L,O)};a.process_cancel=function(L,O){G("process",L,O)};a.prompt=function(L,O,S){G("prompt",L,S,O)}})();var la=function(){var k=a(".tool_button_current");if(k.length&&k[0].id!=="tool_select"){k.removeClass("tool_button_current").addClass("tool_button");a("#tool_select").addClass("tool_button_current").removeClass("tool_button");
a("#styleoverrides").text("#svgcanvas svg *{cursor:move;pointer-events:all} #svgcanvas svg{cursor:default}")}h.setMode("select")},T=null,wa=false,Da=false,Ma=false,Fa=false,Oa="",Qa=a("title:first").text(),Ga=function(k,t,G){h.getResolution();a("#svgcanvas").position();if(t=h.setBBoxZoom(t,ha.width()-15,ha.height()-15)){k=t.zoom;t=t.bbox;if(k<0.0010)Ia({value:0.1});else{a("#zoom").val(k*100);G?Ob():Ob(false,{x:t.x*k+t.width*k/2,y:t.y*k+t.height*k/2});h.getMode()=="zoom"&&t.width&&la();m()}}};a("#cur_context_panel").delegate("a",
"click",function(){var k=a(this);k.attr("data-root")?h.leaveContext():h.setContext(k.text());return false});var Ca={},Ha=function(k){a.each(k,function(t,G){var L=a(t).children(),O=t+"_show",S=a(O),da=false;L.addClass("tool_button").unbind("click mousedown mouseup").each(function(Ba){var sa=G[Ba];Ca[sa.sel]=sa.fn;if(sa.isDefault)da=Ba;Ba=function(Ya){var Za=sa;if(Ya.type==="keydown"){var Q=a(Za.parent+"_show").hasClass("tool_button_current"),ob=a(Za.parent+"_show").attr("data-curopt");a.each(k[sa.parent],
function(Ka,Ea){if(Ea.sel==ob)Za=!Ya.shiftKey||!Q?Ea:k[sa.parent][Ka+1]||k[sa.parent][0]})}if(a(this).hasClass("disabled"))return false;db(O)&&Za.fn();var $a=Za.icon?a.getSvgIcon(Za.icon,true):a(Za.sel).children().eq(0).clone();$a[0].setAttribute("width",S.width());$a[0].setAttribute("height",S.height());S.children(":not(.flyout_arrow_horiz)").remove();S.append($a).attr("data-curopt",Za.sel)};a(this).mouseup(Ba);sa.key&&a(document).bind("keydown",sa.key[0]+" shift+"+sa.key[0],Ba)});if(da)S.attr("data-curopt",
G[da].sel);else S.attr("data-curopt")||S.attr("data-curopt",G[0].sel);var oa,xa=a(O).position();a(t).css({left:xa.left+34,top:xa.top+77});S.mousedown(function(Ba){a("#tools_shapelib").is(":visible")&&db(O,false);if(S.hasClass("disabled"))return false;var sa=a(t),Ya=xa.left+34,Za=sa.width()*-1,Q=sa.data("shown_popop")?200:0;oa=setTimeout(function(){S.data("isLibrary")?sa.css("left",Ya).show():sa.css("left",Za).show().animate({left:Ya},150);sa.data("shown_popop",true)},Q);Ba.preventDefault()}).mouseup(function(){clearTimeout(oa);
var Ba=a(this).attr("data-curopt");if(S.data("isLibrary")&&a(O.replace("_show","")).is(":visible"))db(O,true);else db(O)&&Ba in Ca&&Ca[Ba]()})});Pb()},Aa=function(k,t){return a("<div>",{"class":"tools_flyout",id:k}).appendTo("#svg_editor").append(t)},zb=function(){a(".tools_flyout").each(function(){var k=a("#"+this.id+"_show"),t=k.offset();k=k.outerWidth();a(this).css({left:(t.left+k)*Z,top:t.top})})},Pb=function(){a(".tools_flyout").each(function(){var k=a("#"+this.id+"_show");if(!k.data("isLibrary")){var t=
[];a(this).children().each(function(){t.push(this.title)});k[0].title=t.join(" / ")}})},gb,mb=function(k,t,G){var L=null;if(k.indexOf("url(#")===0){k=(k=h.getRefElem(k))?k.cloneNode(true):a("#"+G+"_color defs *")[0];L={alpha:t};L[k.tagName]=k}else L=k.indexOf("#")===0?{alpha:t,solidColor:k.substr(1)}:{alpha:t,solidColor:"none"};return new a.jGraduate.Paint(L)},Va=h.getResolution();if(f.baseUnit!=="px"){Va.w=svgedit.units.convertUnit(Va.w)+f.baseUnit;Va.h=svgedit.units.convertUnit(Va.h)+f.baseUnit}a(".canvas_width").val(Va.w);
a(".canvas_height").val(Va.h);a("#docprops_button").on("click",function(){o()});var ub=i.setImageURL=function(k){k||(k=va);h.setImageURL(k);a("#image_url").val(k);if(k.indexOf("data:")===0){a("#image_url").hide();a("#change_image_url").show()}else{h.embedImage(k,function(t){t?a("#url_notice").hide():a("#url_notice").show();va=k});a("#image_url").show();a("#change_image_url").hide()}},Bb=function(k){var t=Math.min(Math.max(12+k.value.length*6,50),300);a(k).width(t)},Ua=function(){var k=T;if(k!=null&&
!k.parentNode)k=null;var t=h.getCurrentDrawing().getCurrentLayerName(),G=h.getMode(),L=f.baseUnit!=="px"?f.baseUnit:null,O=G=="pathedit",S=a("#cmenu_canvas li");a("#selected_panel, #multiselected_panel, #g_panel, #path_panel, #rect_panel, #canvas_panel, #circle_panel,\t\t\t\t\t#ellipse_panel, #line_panel, #text_panel, #image_panel, #container_panel, #use_panel, #a_panel").hide();a(".menu_item","#edit_menu").addClass("disabled");a(".menu_item","#object_menu").addClass("disabled");!k&&!wa&&a("#canvas_panel").show();
if(k!=null){var da=k.nodeName,oa=h.getRotationAngle(k);a("#angle").val(Math.round(oa));oa=h.getBlur(k);a("#blur").val(oa);a("#blur_slider").slider("option","value",oa);h.addedNew&&da==="image"&&h.getHref(k).indexOf("data:")!==0&&M();if(!O&&G!="pathedit"){a("#selected_panel").show();a(".action_selected").removeClass("disabled");if(["line","circle","ellipse"].indexOf(da)>=0)a("#xy_panel").hide();else{var xa,Ba;if(["g","polyline","path"].indexOf(da)>=0){if(G=h.getStrokedBBox([k])){xa=G.x;Ba=G.y}}else{xa=
k.getAttribute("x");Ba=k.getAttribute("y")}if(L){xa=svgedit.units.convertUnit(xa);Ba=svgedit.units.convertUnit(Ba)}a("#selected_x").val(xa||0);a("#selected_y").val(Ba||0);a("#xy_panel").show()}["image","text","path","g","use"].indexOf(da)==-1&&a(".action_path_convert_selected").removeClass("disabled");da==="path"&&a(".action_path_selected").removeClass("disabled")}else{t=qa.getNodePoint();a("#tool_add_subpath").removeClass("push_button_pressed").addClass("tool_button");a("#tool_node_delete").toggleClass("disabled",
!qa.canDeleteNodes);F("#tool_openclose_path",qa.closed_subpath?"open_path":"close_path");if(t){O=a("#seg_type");if(L){t.x=svgedit.units.convertUnit(t.x);t.y=svgedit.units.convertUnit(t.y)}a("#path_node_x").val(t.x);a("#path_node_y").val(t.y);t.type?O.val(t.type).removeAttr("disabled"):O.val(4).attr("disabled","disabled")}return}L={g:[],a:[],rect:["rx","width","height"],image:["width","height"],circle:["cx","cy","r"],ellipse:["cx","cy","rx","ry"],line:["x1","y1","x2","y2"],text:[],use:[]};var sa=k.tagName;
a(k).data("gsvg")&&a("#g_panel").show();sa=="path"&&a("#path_panel").show();if(L[sa]){L=L[sa];a("#"+sa+"_panel").show();a.each(L,function(Ya,Za){var Q=k.getAttribute(Za);if(f.baseUnit!=="px"&&k[Za])Q=svgedit.units.convertUnit(k[Za].baseVal.value);a("#"+sa+"_"+Za).val(Q||0)});if(sa=="text"){a("#text_panel").css("display","inline");h.getItalic()?a("#tool_italic").addClass("push_button_pressed").removeClass("tool_button"):a("#tool_italic").removeClass("push_button_pressed").addClass("tool_button");h.getBold()?
a("#tool_bold").addClass("push_button_pressed").removeClass("tool_button"):a("#tool_bold").removeClass("push_button_pressed").addClass("tool_button");a("#font_family").val(k.getAttribute("font-family"));a("#font_size").val(k.getAttribute("font-size"));a("#text").val(k.textContent);h.addedNew&&setTimeout(function(){a("#text").focus().select()},100)}else if(sa=="image")ub(h.getHref(k));else if(sa==="g"||sa==="use"){a("#container_panel").show();a(".action_group_selected").removeClass("disabled");L=h.getTitle();
da=a("#g_title")[0];da.value=L;Bb(da);sa=="use"?da.setAttribute("disabled","disabled"):da.removeAttribute("disabled")}}S[(sa==="g"?"en":"dis")+"ableContextMenuItems"]("#ungroup");S[(sa==="g"||!wa?"dis":"en")+"ableContextMenuItems"]("#group")}else if(wa){a("#multiselected_panel").show();a(".action_multi_selected").removeClass("disabled");S.enableContextMenuItems("#group").disableContextMenuItems("#ungroup")}else S.disableContextMenuItems("#delete,#cut,#copy,#group,#ungroup,#move_front,#move_up,#move_down,#move_back");
ga.getUndoStackSize()>0?a("#tool_undo").removeClass("disabled"):a("#tool_undo").addClass("disabled");ga.getRedoStackSize()>0?a("#tool_redo").removeClass("disabled"):a("#tool_redo").addClass("disabled");h.addedNew=false;if(k&&!O||wa){a("#selLayerNames").removeAttr("disabled").val(t);Ra.enableContextMenuItems("#delete,#cut,#copy,#move_front,#move_up,#move_down,#move_back")}else a("#selLayerNames").attr("disabled","disabled")};a("#text").focus(function(){});a("#text").blur(function(){});h.bind("selected",
function(k,t){var G=h.getMode();G==="select"&&la();G=G=="pathedit";T=t.length==1||t[1]==null?t[0]:null;wa=t.length>=2&&t[1]!=null;if(T!=null)if(!G){if(T!=null)switch(T.tagName){case "use":case "image":case "foreignObject":break;case "g":case "a":for(var L=null,O=T.getElementsByTagName("*"),S=0,da=O.length;S<da;S++){var oa=O[S].getAttribute("stroke-width");if(S===0)L=oa;else if(L!==oa)L=null}a("#stroke_width").val(L===null?"":L);ja.fill.update(true);ja.stroke.update(true);break;default:ja.fill.update(true);
ja.stroke.update(true);a("#stroke_width").val(T.getAttribute("stroke-width")||1);a("#stroke_style").val(T.getAttribute("stroke-dasharray")||"none");L=T.getAttribute("stroke-linejoin")||"miter";a("#linejoin_"+L).length!=0&&D(a("#linejoin_"+L)[0]);L=T.getAttribute("stroke-linecap")||"butt";a("#linecap_"+L).length!=0&&D(a("#linecap_"+L)[0])}if(T!=null){L=(T.getAttribute("opacity")||1)*100;a("#group_opacity").val(L);a("#opac_slider").slider("option","value",L);a("#elem_id").val(T.id)}ac()}a("#path_node_panel").toggle(G);
a("#tools_bottom_2,#tools_bottom_3").toggle(!G);if(G){a(".tool_button_current").removeClass("tool_button_current").addClass("tool_button");a("#tool_select").addClass("tool_button_current").removeClass("tool_button");F("#tool_select","select_node");wa=false;if(t.length)T=t[0]}else F("#tool_select","select");Ua();h.runExtensions("selectedChanged",{elems:t,selectedElement:T,multiselected:wa})});h.bind("transition",function(k,t){var G=h.getMode(),L=t[0];if(L){wa=t.length>=2&&t[1]!=null;if(!wa)switch(G){case "rotate":G=
h.getRotationAngle(L);a("#angle").val(Math.round(G));a("#tool_reorient").toggleClass("disabled",G==0)}h.runExtensions("elementTransition",{elems:t})}});h.bind("changed",function(k,t){var G=h.getMode();G==="select"&&la();for(var L=0;L<t.length;++L){var O=t[L];if(O&&O.tagName==="svg"){rb();Ob()}else if(O&&T&&T.parentNode==null)T=O}i.show_save_warning=true;Ua();if(T&&G==="select"){ja.fill.update();ja.stroke.update()}h.runExtensions("elementChanged",{elems:t})});h.bind("saved",function(k,t){i.show_save_warning=
false;t='<?xml version="1.0"?>\n'+t;var G=navigator.userAgent;if(~G.indexOf("Chrome")&&a.browser.version>=533||~G.indexOf("MSIE"))A(0,true);else{var L=k.open("data:image/svg+xml;base64,"+Na.encode64(t)),O=a.pref("save_notice_done");if(O!=="all"){var S=g.notification.saveFromBrowser.replace("%s","SVG");if(G.indexOf("Gecko/")!==-1)if(t.indexOf("<defs")!==-1){S+="\n\n"+g.notification.defsFailOnSave;a.pref("save_notice_done","all");O="all"}else a.pref("save_notice_done","part");else a.pref("save_notice_done",
"all");O!=="part"&&L.alert(S)}}});h.bind("exported",function(k,t){var G=t.issues;a("#export_canvas").length||a("<canvas>",{id:"export_canvas"}).hide().appendTo("body");var L=a("#export_canvas")[0];L.width=h.contentW;L.height=h.contentH;canvg(L,t.svg,{renderCallback:function(){var O=L.toDataURL("image/png");U.location.href=O;if(a.pref("export_notice_done")!=="all"){O=g.notification.saveFromBrowser.replace("%s","PNG");if(G.length)O+="\n\n"+g.notification.noteTheseIssues+"\n \u2022 "+G.join("\n \u2022 ");
a.pref("export_notice_done","all");U.alert(O)}}})});h.bind("zoomed",Ga);h.bind("contextset",function(k,t){var G="";if(t){var L="";G='<a href="#" data-root="y">'+h.getCurrentDrawing().getCurrentLayerName()+"</a>";a(t).parentsUntil("#svgcontent > g").andSelf().each(function(){if(this.id){L+=" > "+this.id;G+=this!==t?' > <a href="#">'+this.id+"</a>":" > "+this.id}});Oa=L}else Oa=null;a("#cur_context_panel").toggle(!!t).html(G);w()});h.bind("extension_added",function(k,t){function G(){if(gb){clearTimeout(gb);
gb=null}O||(gb=setTimeout(function(){O=true;P(e.iconsize)},50))}var L=false,O=false,S=true,da=function(){if(t.callback&&!L&&S){L=true;t.callback()}},oa=[];t.context_tools&&a.each(t.context_tools,function(Za,Q){var ob=Q.container_id?' id="'+Q.container_id+'"':"",$a=a("#"+Q.panel);$a.length||($a=a("<div>",{id:Q.panel}).appendTo("#tools_top"));switch(Q.type){case "tool_button":var Ka='<div class="tool_button">'+Q.id+"</div>",Ea=a(Ka).appendTo($a);Q.events&&a.each(Q.events,function(bb,hb){a(Ea).bind(bb,
hb)});break;case "select":Ka="<label"+ob+'><select id="'+Q.id+'">';a.each(Q.options,function(bb,hb){Ka+='<option value="'+bb+'"'+(bb==Q.defval?" selected":"")+">"+hb+"</option>"});Ka+="</select></label>";var Pa=a(Ka).appendTo($a).find("select");a.each(Q.events,function(bb,hb){a(Pa).bind(bb,hb)});break;case "button-select":Ka='<div id="'+Q.id+'" class="dropdown toolset" title="'+Q.title+'"><div id="cur_'+Q.id+'" class="icon_label"></div><button></button></div>';ob=a('<ul id="'+Q.id+'_opts"></ul>').appendTo("#option_lists");
Q.colnum&&ob.addClass("optcols"+Q.colnum);a(Ka).appendTo($a).children();oa.push({elem:"#"+Q.id,list:"#"+Q.id+"_opts",title:Q.title,callback:Q.events.change,cur:"#cur_"+Q.id});break;case "input":Ka="<label"+ob+'><span id="'+Q.id+'_label">'+Q.label+':</span><input id="'+Q.id+'" title="'+Q.title+'" size="'+(Q.size||"4")+'" value="'+(Q.defval||"")+'" type="text"/></label>';var ta=a(Ka).appendTo($a).find("input");Q.spindata&&ta.SpinButton(Q.spindata);Q.events&&a.each(Q.events,function(bb,hb){ta.bind(bb,
hb)})}});if(t.buttons){var xa={},Ba={},sa=t.svgicons,Ya={};a.each(t.buttons,function(Za,Q){for(var ob,$a=Q.id,Ka=Za;a("#"+$a).length;)$a=Q.id+"_"+ ++Ka;if(sa){xa[$a]=Q.icon;Ka=Q.svgicon?Q.svgicon:Q.id;if(Q.type=="app_menu")Ba["#"+$a+" > div"]=Ka;else Ba["#"+$a]=Ka}else ob=Q.type=="menu"?"":a('<img src="'+Q.icon+'">');var Ea,Pa;switch(Q.type){case "mode_flyout":case "mode":Ea="tool_button";if(Q.cls)Ea+=" "+Q.cls;Pa="#tools_left";break;case "context":Ea="tool_button";Pa="#"+Q.panel;a(Pa).length||a("<div>",
{id:Q.panel}).appendTo("#tools_top");break;case "menu":Ea="menu_item tool_button";Pa="#"+(Q.after||Q.panel);break;case "app_menu":Ea="";Pa=Q.parent||"#main_menu ul";a(Pa).length||a("<div>",{id:Q.panel}).appendTo("#tools_top")}var ta=a(Q.list||Q.type=="app_menu"?"<li/>":"<div/>").attr("id",$a).attr("title",Q.title).addClass(Ea);if(!Q.includeWith&&!Q.list){if("position"in Q)a(Pa).children().eq(Q.position).before(ta);else Q.type!="menu"||!Q.after?ta.appendTo(Pa):a(Pa).after(ta);if(Q.type=="mode_flyout"){Ka=
a(ta);Ea=Ka.parent();if(!Ka.parent().hasClass("tools_flyout")){var bb=Ka[0].id.replace("tool_","tools_"),hb=Ka.clone().attr("id",bb+"_show").append(a("<div>",{"class":"flyout_arrow_horiz"}));Ka.before(hb);Ea=Aa(bb,Ka);Ea.data("isLibrary",true);hb.data("isLibrary",true)}Ba["#"+bb+"_show"]=Q.id;$a=Ya["#"+Ea[0].id]=[{sel:"#"+$a,fn:Q.events.click,icon:Q.id,isDefault:true},sb]}else if(Q.type=="app_menu"||Q.type=="menu")ta.append(Q.title)}else if(Q.list){ta.addClass("push_button");a("#"+Q.list+"_opts").append(ta);
if(Q.isDefault){a("#cur_"+Q.list).append(ta.children().clone());Ka=Q.svgicon?Q.svgicon:Q.id;Ba["#cur_"+Q.list]=Ka}}else if(Q.includeWith){Pa=Q.includeWith;Ka=a(Pa.button);Ea=Ka.parent();if(!Ka.parent().hasClass("tools_flyout")){bb=Ka[0].id.replace("tool_","tools_");hb=Ka.clone().attr("id",bb+"_show").append(a("<div>",{"class":"flyout_arrow_horiz"}));Ka.before(hb);Ea=Aa(bb,Ka)}var sb=nc.getButtonData(Pa.button);if(Pa.isDefault)Ba["#"+bb+"_show"]=Q.id;$a=Ya["#"+Ea[0].id]=[{sel:"#"+$a,fn:Q.events.click,
icon:Q.id,key:Q.key,isDefault:Q.includeWith?Q.includeWith.isDefault:0},sb];bb="position"in Pa?Pa.position:"last";sb=Ea.children().length;if(!isNaN(bb)&&bb>=0&&bb<sb)Ea.children().eq(bb).before(ta);else{Ea.append(ta);$a.reverse()}}sa||ta.append(ob);Q.list||a.each(Q.events,function(Xb,Db){if(Xb=="click")if(Q.type=="mode"){Q.includeWith?ta.bind(Xb,Db):ta.bind(Xb,function(){db(ta)&&Db()});if(Q.key){a(document).bind("keydown",Q.key,Db);Q.title&&ta.attr("title",Q.title+" ["+Q.key+"]")}}else ta.bind(Xb,
Db);else ta.bind(Xb,Db)});Ha(Ya)});a.each(oa,function(){lb(this.elem,this.list,this.callback,{seticon:true})});if(sa)S=false;a.svgIcons(sa,{w:24,h:24,id_match:false,no_img:!ka,fallback:xa,placement:Ba,callback:function(){e.iconsize&&e.iconsize!="m"&&G();S=true;da()}})}da()});h.textActions.setInputElem(a("#text")[0]);var Ja='<div class="palette_item" data-rgb="#none"></div>';a.each(["#000000","#3f3f3f","#7f7f7f","#bfbfbf","#ffffff","#ff0000","#ff7f00","#ffff00","#7fff00","#00ff00","#00ff7f","#00ffff",
"#007fff","#0000ff","#7f00ff","#ff00ff","#ff007f","#7f0000","#7f3f00","#7f7f00","#3f7f00","#007f00","#007f3f","#007f7f","#003f7f","#00007f","#3f007f","#7f007f","#7f003f","#ffaaaa","#ffd4aa","#ffffaa","#d4ffaa","#aaffaa","#aaffd4","#aaffff","#aad4ff","#aaaaff","#d4aaff","#ffaaff","#ffaad4"],function(k,t){Ja+='<div class="palette_item" style="background-color: '+t+';" data-rgb="'+t+'"></div>'});a("#palette").append(Ja);Ja="";a.each(["#FFF","#888","#000"],function(){Ja+='<div class="color_block" style="background-color:'+
this+';"></div>'});a("#bg_blocks").append(Ja);var Wa=a("#bg_blocks div");Wa.each(function(){a(this).click(function(){Wa.removeClass("cur_background");a(this).addClass("cur_background")})});if(a.pref("bkgd_color"))q(a.pref("bkgd_color"),a.pref("bkgd_url"));else a.pref("bkgd_url")&&q(E.bkgd_color,a.pref("bkgd_url"));if(a.pref("img_save")){e.img_save=a.pref("img_save");a("#image_save_opts input").val([e.img_save])}var Ia=function(k){var t=k.value/100;if(t<0.0010)k.value=0.1;else{k=h.getZoom();Ga(window,
{width:0,height:0,x:(ha[0].scrollLeft+ha.width()/2)/k,y:(ha[0].scrollTop+ha.height()/2)/k,zoom:t},true)}},kb=function(k,t){if(t==null)t=k.value;a("#group_opacity").val(t);if(!k||!k.handle)a("#opac_slider").slider("option","value",t);h.setOpacity(t/100)},Cb=function(k,t,G){if(t==null)t=k.value;a("#blur").val(t);var L=false;if(!k||!k.handle){a("#blur_slider").slider("option","value",t);L=true}G?h.setBlurNoUndo(t):h.setBlur(t,L)},ab=function(){window.opera&&a("<p/>").hide().appendTo("body").remove()};
a("#stroke_style").change(function(){h.setStrokeAttr("stroke-dasharray",a(this).val());ab()});a("#stroke_linejoin").change(function(){h.setStrokeAttr("stroke-linejoin",a(this).val());ab()});a("select").change(function(){a(this).blur()});var cb=false;a("#selLayerNames").change(function(){var k=this.options[this.selectedIndex].value,t=g.notification.QmoveElemsToLayer.replace("%s",k),G=function(L){if(L){cb=true;h.moveSelectedToLayer(k);h.clearSelection();rb()}};if(k)cb?G(true):a.confirm(t,G)});a("#font_family").change(function(){h.setFontFamily(this.value)});
a("#seg_type").change(function(){h.setSegType(a(this).val())});a("#text").keyup(function(){h.setTextContent(this.value)});a("#image_url").change(function(){ub(this.value)});a("#link_url").change(function(){this.value.length?h.setLinkURL(this.value):h.removeHyperlink()});a("#g_title").change(function(){h.setGroupTitle(this.value)});a(".attr_changer").change(function(){var k=this.getAttribute("data-attr"),t=this.value;if(svgedit.units.isValidUnit(k,t,T))this.blur();else{a.alert(g.notification.invalidAttrValGiven);
this.value=T.getAttribute(k);return false}if(k!=="id")if(isNaN(t))t=h.convertToNum(k,t);else if(f.baseUnit!=="px"){var G=svgedit.units.getTypeMap();if(T[k]||h.getMode()==="pathedit"||k==="x"||k==="y")t*=G[f.baseUnit]}if(k==="id"){k=T;h.clearSelection();k.id=t;h.addToSelection([k],true)}else h.changeSelectedAttribute(k,t);this.blur()});a("#palette").mouseover(function(){var k=a('<input type="hidden">');a(this).append(k);k.focus().remove()});a(".palette_item").mousedown(function(){var k=a("#tool_stroke").hasClass("active"),
t=k?"stroke":"fill",G=a(this).attr("data-rgb"),L=null;console.log(G);if(G==="transparent"||G==="initial"||G==="#none"){G="none";L=new a.jGraduate.Paint}else L=new a.jGraduate.Paint({alpha:100,solidColor:G.substr(1)});ja[t].setPaint(L);if(k){h.setColor("stroke",G);G!="none"&&h.getStrokeOpacity()!=1&&h.setPaintOpacity("stroke",1)}else{h.setColor("fill",G);G!="none"&&h.getFillOpacity()!=1&&h.setPaintOpacity("fill",1)}ac()}).bind("contextmenu",function(k){k.preventDefault()});a("#toggle_stroke_tools").toggle(function(){a(".stroke_tool").css("display",
"table-cell");a(this).addClass("expanded");na()},function(){a(".stroke_tool").css("display","none");a(this).removeClass("expanded");na()});var db=function(k,t){if(a(k).hasClass("disabled"))return false;if(a(k).parent().hasClass("tools_flyout"))return true;var G=G||"normal";t||a(".tools_flyout").fadeOut(G);a("#styleoverrides").text("");a(".tool_button_current").removeClass("tool_button_current").addClass("tool_button");a(k).addClass("tool_button_current").removeClass("tool_button");return true};(function(){var k=
null,t=null,G=ha[0],L=false,O=false;a("#svgcanvas").bind("mousemove mouseup",function(S){if(L!==false){G.scrollLeft-=S.clientX-k;G.scrollTop-=S.clientY-t;k=S.clientX;t=S.clientY;if(S.type==="mouseup")L=false;return false}}).mousedown(function(S){if(S.button===1||O===true){L=true;k=S.clientX;t=S.clientY;return false}});a(window).mouseup(function(){L=false});a(document).bind("keydown","space",function(S){h.spaceKey=O=true;S.preventDefault()}).bind("keyup","space",function(S){S.preventDefault();h.spaceKey=
O=false}).bind("keydown","alt",function(){h.getMode()==="zoom"&&ha.addClass("out")}).bind("keyup","alt",function(){h.getMode()==="zoom"&&ha.removeClass("out")})})();var za=a(".menu"),vb=function(k){k.target.style.background="#fff";setTimeout(function(){k.target.style.background="#ddd"},50);setTimeout(function(){k.target.style.background="#fff"},150);setTimeout(function(){k.target.style.background="#ddd"},200);setTimeout(function(){k.target.style.background=""},200);setTimeout(function(){a("#menu_bar").removeClass("active")},
220);return false};a(".menu_item").live("click",function(k){vb(k)});a("svg, body").on("click",function(k){if(!a(k.target).hasClass("menu_title")&&a("#menu_bar").hasClass("active"))if(!a(k.target).hasClass("disabled")&&a(k.target).hasClass("menu_item"))vb(k);else{a("#menu_bar").removeClass("active");a(".tools_flyout").hide();a("input").blur()}});a(".menu_title").on("click",function(){a("#menu_bar").toggleClass("active")});a(".menu_title").on("mouseover",function(){za.removeClass("open");a(this).parent().addClass("open")});
i.addDropDown=function(k,t,G){if(a(k).length!=0){var L=a(k).find("button"),O=a(k).find("ul").attr("id",a(k)[0].id+"-list");G||a("#option_lists").append(O);var S=false;G&&a(k).addClass("dropup");O.find("li").bind("mouseup",t);a(window).mouseup(function(){if(!S){L.removeClass("down");O.hide()}S=false});L.bind("mousedown",function(){if(L.hasClass("down")){L.removeClass("down");O.hide()}else{L.addClass("down");if(!G){var da=a(k).offset();O.css({top:da.top,left:da.left-110})}O.show();S=true}}).hover(function(){S=
true}).mouseout(function(){S=false})}};var lb=function(k,t,G,L){var O=a(k);t=a(t);var S=false,da=L.dropUp;da&&a(k).addClass("dropup");t.find("li").bind("mouseup",function(){if(L.seticon){F("#cur_"+O[0].id,a(this).children());a(this).addClass("current").siblings().removeClass("current")}G.apply(this,arguments)});a(window).mouseup(function(){if(!S){O.removeClass("down");t.hide();t.css({top:0,left:0})}S=false});t.height();a(k).bind("mousedown",function(){var oa=a(k).offset();if(da){oa.top-=t.height();
oa.left+=8}else oa.top+=a(k).height();a(t).offset(oa);if(O.hasClass("down")){O.removeClass("down");t.hide();t.css({top:0,left:0})}else{O.addClass("down");t.show();S=true;return false}}).hover(function(){S=true}).mouseout(function(){S=false});L.multiclick&&t.mousedown(function(){S=true})};i.addDropDown("#font_family_dropdown",function(){a(this).text();a("#font_family").val(a(this).text()).change()});i.addDropDown("#opacity_dropdown",function(){if(!a(this).find("div").length){var k=parseInt(a(this).text().split("%")[0]);
kb(false,k)}},false);a("#opac_slider").slider({start:function(){a("#opacity_dropdown li:not(.special)").hide()},stop:function(){a("#opacity_dropdown li").show();a(window).mouseup()},slide:function(k,t){kb(t)}});i.addDropDown("#blur_dropdown",a.noop);var xb=false;a("#blur_slider").slider({max:10,step:0.1,stop:function(k,t){xb=false;Cb(t);a("#blur_dropdown li").show();a(window).mouseup()},start:function(){xb=true},slide:function(k,t){Cb(t,null,xb)}});i.addDropDown("#zoom_dropdown",function(){var k=
a(this),t=k.attr("data-val");t?Ga(window,t):Ia({value:parseInt(k.text())})},true);lb("#stroke_linecap","#linecap_opts",function(){D(this,true)},{dropUp:true});lb("#stroke_linejoin","#linejoin_opts",function(){D(this,true)},{dropUp:true});a("div","#position_opts").each(function(){this.addEventListener("mouseup",function(){var k=this.id.replace("tool_pos","").charAt(0);h.alignSelectedElements(k,"page")})});(function(){var k,t=function(){a(k).blur()};a("#svg_editor").find("button, select, input:not(#text)").focus(function(){k=
this;ea="toolbars";ha.mousedown(t)}).blur(function(){ea="canvas";ha.unbind("mousedown",t);h.getMode()=="textedit"&&a("#text").focus()})})();var Jb=function(){if(db("#tool_select")){h.setMode("select");a("#styleoverrides").text("#svgcanvas svg *{cursor:move;pointer-events:all}, #svgcanvas svg{cursor:default}")}},pb=function(){db("#tool_fhpath")&&h.setMode("fhpath")},Kb=function(){db("#tool_line")&&h.setMode("line")},Rb=function(){db("#tool_rect")&&h.setMode("rect")},Lb=function(){db("#tool_ellipse")&&
h.setMode("ellipse")},Sb=function(){db("#tool_image")&&h.setMode("image")},pa=function(){db("#tool_zoom")&&h.setMode("zoom")},V=function(){if(db("#tool_zoom")){c();la()}},ua=function(){db("#tool_text")&&h.setMode("text")},ya=function(){db("#tool_path")&&h.setMode("path")},aa=function(){if(T!=null||wa)h.deleteSelectedElements()},Sa=function(){if(T!=null||wa)h.cutSelectedElements()},Eb=function(){if(T!=null||wa)h.copySelectedElements()},Ab=function(){var k=h.getZoom(),t=(ha[0].scrollLeft+ha.width()/
2)/k-h.contentW;k=(ha[0].scrollTop+ha.height()/2)/k-h.contentH;h.pasteElements("point",t,k)},wb=function(){T!=null&&h.moveToTopSelectedElement()},tb=function(){T!=null&&h.moveToBottomSelectedElement()},Fb=function(){T!=null&&h.moveUpDownSelected("Up")},Qb=function(){T!=null&&h.moveUpDownSelected("Down")},nb=function(){T!=null&&h.convertToPath()},Mb=function(){T!=null&&qa.reorient()},Ta=function(){if(T!=null||wa)a.prompt(g.notification.enterNewLinkURL,"http://",function(k){k&&h.makeHyperlink(k)})},
eb=function(k,t){if(T!=null||wa){if(f.gridSnapping){var G=h.getZoom()*f.snappingStep;k*=G;t*=G}h.moveSelectedElements(k,t)}},Ib=function(){var k=!a("#tool_node_link").hasClass("push_button_pressed");k?a("#tool_node_link").addClass("push_button_pressed").removeClass("tool_button"):a("#tool_node_link").removeClass("push_button_pressed").addClass("tool_button");qa.linkControlPoints(k)},Zb=function(){qa.getNodePoint()&&qa.clonePathNode()},Yb=function(){qa.getNodePoint()&&qa.deletePathNode()},fb=function(){var k=
a("#tool_add_subpath"),t=!k.hasClass("push_button_pressed");t?k.addClass("push_button_pressed").removeClass("tool_button"):k.removeClass("push_button_pressed").addClass("tool_button");qa.addSubPath(t)},La=function(){qa.opencloseSubPath()},fc=function(){h.cycleElement(1)},bc=function(){h.cycleElement(0)},Tb=function(k,t){if(!(T==null||wa)){k||(t*=-1);var G=a("#angle").val()*1+t;h.setRotationAngle(G);Ua()}},gc=function(){var k=f.dimensions;a.confirm(g.notification.QwantToClear,function(t){if(t){la();
h.clear();h.setResolution(k[0],k[1]);Ob(true);c();rb();Ua();ja.fill.prep();ja.stroke.prep();h.runExtensions("onNewDocument")}})},kc=function(){h.setBold(!h.getBold());Ua();return false},Vb=function(){h.setItalic(!h.getItalic());Ua();return false},$b=function(){if(!p.pngsave){var k=g.notification.loadingImage;U=window.open("data:text/html;charset=utf-8,<title>"+k+"</title><h1>"+k+"</h1>")}window.canvg?h.rasterExport():a.getScript("canvg/rgbcolor.js",function(){a.getScript("canvg/canvg.js",function(){h.rasterExport()})})},
mc=function(){h.open()},Ub=function(){},ib=function(k){var t=k.prev();t.css("background","#09f");setTimeout(function(){t.css("background","")},200)},hc=function(){if(ga.getUndoStackSize()>0){window.event.type==="keydown"&&ib(a("#edit_menu"));ga.undo();rb()}},cc=function(){if(ga.getRedoStackSize()>0){window.event.type==="keydown"&&ib(a("#edit_menu"));ga.redo();rb()}},Nb=function(){if(wa)h.groupSelectedElements();else T&&h.ungroupSelectedElement()},jb=function(){window.event.type==="keydown"&&ib(a("#edit_menu"));
h.cloneSelectedElements(20,20)},ec=function(){var k=this.id.replace("tool_align","").charAt(0);h.alignSelectedElements(k,a("#align_relative_to").val())},b=function(){var k=document.querySelector("#tool_stroke rect"),t=document.querySelector("#tool_fill rect"),G=t.getAttribute("fill"),L=k.getAttribute("fill");k=parseFloat(k.getAttribute("stroke-opacity"));if(isNaN(k))k=100;t=parseFloat(t.getAttribute("fill-opacity"));if(isNaN(t))t=100;L=mb(L,k,"stroke");G=mb(G,t,"fill");ja.fill.setPaint(L,true);ja.stroke.setPaint(G,
true)},c=function(k){var t=h.getResolution();k=k?t.zoom*k:1;a("#zoom").val(k*100);h.setZoom(k);m();Ob(true)},d=function(){!a("#tool_wireframe").hasClass("push_button_pressed")?a("#tool_wireframe").addClass("push_button_pressed"):a("#tool_wireframe").removeClass("push_button_pressed");ha.toggleClass("wireframe");if(!jc){var k=a("#wireframe_rules");k.length?k.empty():a('<style id="wireframe_rules"></style>').appendTo("head");m()}},n=function(){if(a("#tool_rulers").hasClass("push_button_pressed")){a("#tool_rulers").removeClass("push_button_pressed");
a("#show_rulers").attr("checked",false);f.showRulers=false}else{a("#tool_rulers").addClass("push_button_pressed");a("#show_rulers").attr("checked",true);f.showRulers=true}a("#rulers").toggle(!!f.showRulers)},m=function(){if(!jc){var k="#workarea.wireframe #svgcontent * { stroke-width: "+1/h.getZoom()+"px; }";a("#wireframe_rules").text(ha.hasClass("wireframe")?k:"")}},A=function(k,t){if(!Da){Da=true;a("#save_output_btns").toggle(!!t);a("#tool_source_back").toggle(!t);var G=ra=h.getSvgString();a("#svg_source_textarea").val(G);
a("#svg_source_editor").fadeIn();s();a("#svg_source_textarea").focus()}},o=function(){if(!Ma){Ma=true;a("#image_save_opts input").val([e.img_save]);var k=h.getResolution();if(f.baseUnit!=="px"){k.w=svgedit.units.convertUnit(k.w)+f.baseUnit;k.h=svgedit.units.convertUnit(k.h)+f.baseUnit}a(".canvas_width").val(k.w);a(".canvas_height").val(k.h);a("#canvas_title").val(h.getDocumentTitle());a("#svg_docprops").show()}},l=function(){if(!Fa){Fa=true;var k=a("#bg_blocks div"),t=a.pref("bkgd_color"),G=a.pref("bkgd_url");
k.each(function(){var L=a(this),O=L.css("background-color")==t;L.toggleClass("cur_background",O);O&&a("#canvas_bg_url").removeClass("cur_background")});t||k.eq(0).addClass("cur_background");G&&a("#canvas_bg_url").val(G);a("grid_snapping_step").attr("value",f.snappingStep);f.gridSnapping==true?a("#grid_snapping_on").attr("checked","checked"):a("#grid_snapping_on").removeAttr("checked");a("#svg_prefs").show()}},s=function(){var k=a("#svg_source_container").height()-50;a("#svg_source_textarea").css("height",
k)},B=function(){if(Da){var k=function(){h.clearSelection();fa();c();rb();w();ja.fill.prep();ja.stroke.prep()};h.setSvgString(a("#svg_source_textarea").val())?k():a.confirm(g.notification.QerrorsRevertToSource,function(t){if(!t)return false;k()});la()}},w=function(k){k=k||h.getDocumentTitle();k=Qa+(k?": "+k:"");a("title:first").text(k)},v=function(){var k=a("#canvas_width"),t=k.val(),G=a("#canvas_height"),L=G.val();if(t!="fit"&&!svgedit.units.isValidUnit("width",t)){a.alert(g.notification.invalidAttrValGiven);
k.parent().addClass("error");return false}k.parent().removeClass("error");if(L!="fit"&&!svgedit.units.isValidUnit("height",L)){a.alert(g.notification.invalidAttrValGiven);G.parent().addClass("error");return false}G.parent().removeClass("error");if(!h.setResolution(t,L)){a.alert(g.notification.noContentToFitTo);return false}e.img_save=a("#image_save_opts :checked").val();a.pref("img_save",e.img_save);Ob();R()},C=function(){var k=a("#bg_blocks div.cur_background").css("background-color")||"#FFF";q(k,
a("#canvas_bg_url").val());k=a("#lang_select").val();k!=e.lang&&i.putLocale(k);P(a("#iconsize").val());f.gridSnapping=a("#grid_snapping_on")[0].checked;f.snappingStep=a("#grid_snapping_step").val();f.showRulers=a("#show_rulers")[0].checked;a("#rulers").toggle(f.showRulers);f.showRulers&&ma();f.baseUnit=a("#base_unit").val();h.setConfig(f);Ob();W()},F=i.setIcon=function(k,t){var G=typeof t==="string"?a.getSvgIcon(t,true):t.clone();G?a(k).empty().append(G):console.log("NOTE: Icon image missing: "+t)},
J;J=function(){var k=/^(Moz|Webkit|Khtml|O|ms|Icab)(?=[A-Z])/,t=document.getElementsByTagName("script")[0],G;for(G in t.style)if(k.test(G))return G.match(k)[0];if("WebkitOpacity"in t.style)return"Webkit";if("KhtmlOpacity"in t.style)return"Khtml";return""}();var K=function(k,t){J.toLowerCase();var G=["top","left","bottom","right"];k.each(function(){for(var L=a(this),O=L.outerWidth()*(t-1),S=L.outerHeight()*(t-1),da=0;da<4;da++){var oa=G[da],xa=L.data("orig_margin-"+oa);if(xa==null){xa=parseInt(L.css("margin-"+
oa));L.data("orig_margin-"+oa,xa)}xa=xa*t;if(oa==="right")xa+=O;else if(oa==="bottom")xa+=S;L.css("margin-"+oa,xa)}})},P=i.setIconSize=function(k,t){if(!(k==e.size&&!t)){console.log("size",k);var G=a("#tools_top .toolset, #editor_panel > *, #history_panel > *,\t\t\t\t#main_button, #tools_left > *, #path_node_panel > *, #multiselected_panel > *,\t\t\t\t#g_panel > *, #tool_font_size > *, .tools_flyout"),L=1;L=typeof k=="number"?k:{s:0.75,m:1,l:1.25,xl:1.5}[k];i.tool_scale=Z=L;zb();var O=G.parents(":hidden");
O.css("visibility","hidden").show();K(G,L);O.css("visibility","visible").hide();a.pref("iconsize",k);a("#iconsize").val(k);O={"#tools_top":{left:50,height:72},"#tools_left":{width:31,top:74},"div#workarea":{left:38,top:74}};G=a("#tool_size_rules");if(G.length)G.empty();else G=a('<style id="tool_size_rules"></style>').appendTo("head");if(k!="m"){var S="";a.each(O,function(da,oa){da="#svg_editor "+da.replace(/,/g,", #svg_editor");S+=da+"{";a.each(oa,function(xa,Ba){if(typeof Ba==="number")var sa=Ba*
L+"px";else if(Ba[k]||Ba.all)sa=Ba[k]||Ba.all;S+=xa+":"+sa+";"});S+="}"});O="-"+J.toLowerCase()+"-";S+="#tools_top .toolset, #editor_panel > *, #history_panel > *,\t\t\t\t#main_button, #tools_left > *, #path_node_panel > *, #multiselected_panel > *,\t\t\t\t#g_panel > *, #tool_font_size > *, .tools_flyout{"+O+"transform: scale("+L+");} #svg_editor div.toolset .toolset {"+O+"transform: scale(1); margin: 1px !important;} #svg_editor .ui-slider {"+O+"transform: scale("+1/L+");}";G.text(S)}zb()}},ca=function(){a("#dialog_box").hide();
if(!Da&&!Ma&&!Fa)Oa&&h.leaveContext();else{if(Da)ra!==a("#svg_source_textarea").val()?a.confirm(g.notification.QignoreSourceChanges,function(k){k&&fa()}):fa();else if(Ma)R();else Fa&&W();na()}},fa=function(){a("#svg_source_editor").hide();Da=false;a("#svg_source_textarea").blur()},R=function(){a("#svg_docprops").hide();a("#canvas_width,#canvas_height").removeAttr("disabled");a("#resolution")[0].selectedIndex=0;a("#image_save_opts input").val([e.img_save]);Ma=false},W=function(){a("#svg_prefs").hide();
Fa=false},Y={width:a(window).width(),height:a(window).height()},na=a.noop,Xa;svgedit.browser.isIE()&&function(){na=function(){if(ha[0].scrollLeft===0&&ha[0].scrollTop===0){ha[0].scrollLeft=Xa.left;ha[0].scrollTop=Xa.top}};Xa={left:ha[0].scrollLeft,top:ha[0].scrollTop};a(window).resize(na);svgEditor.ready(function(){setTimeout(function(){na()},500)});ha.scroll(function(){Xa={left:ha[0].scrollLeft,top:ha[0].scrollTop}})}();a(window).resize(function(){Da&&s();a.each(Y,function(k,t){var G=a(window)[k]();
ha[0]["scroll"+(k==="width"?"Left":"Top")]-=(G-t)/2;Y[k]=G})});(function(){ha.scroll(function(){if(a("#ruler_x").length!=0)a("#ruler_x")[0].scrollLeft=ha[0].scrollLeft;if(a("#ruler_y").length!=0)a("#ruler_y")[0].scrollTop=ha[0].scrollTop})})();a("#url_notice").click(function(){a.alert(this.title)});a("#change_image_url").click(M);(function(){var k=["clear","open","save","source","delete","delete_multi","paste","clone","clone_multi","move_top","move_bottom"],t="";a.each(k,function(G,L){t+="#tool_"+
L+(G==k.length-1?",":"")});a(t).mousedown(function(){a(this).addClass("tool_button_current")}).bind("mousedown mouseout",function(){a(this).removeClass("tool_button_current")});a("#tool_undo, #tool_redo").mousedown(function(){a(this).hasClass("disabled")||a(this).addClass("tool_button_current")}).bind("mousedown mouseout",function(){a(this).removeClass("tool_button_current")})})();if(ia&&!window.opera){ia=["tool_clear","tool_save","tool_source","tool_undo","tool_redo","tool_clone"];for(Va=ia.length;Va--;){var qb=
document.getElementById(ia[Va]);if(qb!=null){var Hb=qb.title,yb=Hb.indexOf("Ctrl+");qb.title=[Hb.substr(0,yb),"Cmd+",Hb.substr(yb+5)].join("")}}}var Gb=function(k){var t=k.attr("id")=="stroke_color"?"stroke":"fill",G=ja[t].paint,L=t=="stroke"?"Pick a Stroke Paint and Opacity":"Pick a Fill Paint and Opacity";k=k.position();a("#color_picker").draggable({cancel:".jGraduate_tabs, .jGraduate_colPick, .jGraduate_gradPick, .jPicker",containment:"window"}).css(f.colorPickerCSS||{left:k.left,bottom:50-k.top}).jGraduate({paint:G,
window:{pickerTitle:L},images:{clientPath:f.jGraduatePath},newstop:"inverse"},function(O){G=new a.jGraduate.Paint(O);ja[t].setPaint(G);h.setPaint(t,G);a("#color_picker").hide()},function(){a("#color_picker").hide()})},ac=function(){var k=h.getColor("fill")=="none",t=h.getColor("stroke")=="none",G=["#tool_fhpath","#tool_line"],L=["#tools_rect .tool_button","#tools_ellipse .tool_button","#tool_text","#tool_path"];if(t)for(var O in G){var S=G[O];a(S).hasClass("tool_button_current")&&Jb();a(S).addClass("disabled")}else for(O in G){S=
G[O];a(S).removeClass("disabled")}if(t&&k)for(O in L){S=L[O];a(S).hasClass("tool_button_current")&&Jb();a(S).addClass("disabled")}else for(O in L){S=L[O];a(S).removeClass("disabled")}h.runExtensions("toolButtonStateUpdate",{nofill:k,nostroke:t});a(".tools_flyout").each(function(){var da=a("#"+this.id+"_show"),oa=false;a(this).children().each(function(){a(this).hasClass("disabled")||(oa=true)});da.toggleClass("disabled",!oa)});ab()};ia=function(k,t){var G=f[t==="fill"?"initFill":"initStroke"],L=(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg"><rect width="100%" height="100%"\t\t\t\t\tfill="#'+
G.color+'" opacity="'+G.opacity+'"/>\t\t\t\t\t<defs><linearGradient id="gradbox_"/></defs></svg>',"text/xml").documentElement;L=a(k)[0].appendChild(document.importNode(L,true));L.setAttribute("width",24.5);this.rect=L.firstChild;this.defs=L.getElementsByTagName("defs")[0];this.grad=this.defs.firstChild;this.paint=new a.jGraduate.Paint({solidColor:G.color});this.type=t;this.setPaint=function(O,S){this.paint=O;var da="none",oa=O.type,xa=O.alpha/100;switch(oa){case "solidColor":da="#"+O[oa];break;case "linearGradient":case "radialGradient":this.defs.removeChild(this.grad);
this.grad=this.defs.appendChild(O[oa]);da="url(#"+(this.grad.id="gradbox_"+this.type)+")"}this.rect.setAttribute("fill",da);this.rect.setAttribute("opacity",xa);if(S){h.setColor(this.type,da,true);h.setPaintOpacity(this.type,xa,true)}};this.update=function(O){if(T){var S=this.type;switch(T.tagName){case "use":case "image":case "foreignObject":return;case "g":case "a":for(var da=null,oa=T.getElementsByTagName("*"),xa=0,Ba=oa.length;xa<Ba;xa++){var sa=oa[xa].getAttribute(S);if(xa===0)da=sa;else if(da!==
sa){da=null;break}}if(da===null){oa=null;return}oa=da;da=1;break;default:da=parseFloat(T.getAttribute(S+"-opacity"));if(isNaN(da))da=1;oa=S==="fill"?"black":"none";oa=T.getAttribute(S)||oa}if(O){h.setColor(S,oa,true);h.setPaintOpacity(S,da,true)}da*=100;this.setPaint(mb(oa,da,S))}};this.prep=function(){switch(this.paint.type){case "linearGradient":case "radialGradient":var O=new a.jGraduate.Paint({copy:this.paint});h.setPaint(t,O)}}};ja.fill=new ia("#fill_color","fill");ja.stroke=new ia("#stroke_color",
"stroke");a("#stroke_width").val(f.initStroke.width);a("#group_opacity").val(f.initOpacity*100);ia=ja.fill.rect.cloneNode(false);ia.setAttribute("style","vector-effect:non-scaling-stroke");var jc=ia.style.vectorEffect==="non-scaling-stroke";ia.removeAttribute("style");ia=ja.fill.rect.ownerDocument.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");typeof ia.stdDeviationX==="undefined"&&a("#tool_blur").hide();a(ia).remove();setTimeout(function(){h.embedImage("images/placeholder.svg",function(k){if(!k){a("#image_save_opts [value=embed]").attr("disabled",
"disabled");a("#image_save_opts input").val(["ref"]);e.img_save="ref";a("#image_opt_embed").css("color","#666").attr("title",g.notification.featNotSupported)}})},1E3);a("#tool_fill").click(function(){if(a("#tool_fill").hasClass("active")){Gb(a("#fill_color"));ac()}else{a("#tool_fill").addClass("active");a("#tool_stroke").removeClass("active")}});a("#tool_stroke").click(function(){if(a("#tool_stroke").hasClass("active")){Gb(a("#stroke_color"));ac()}else{a("#tool_stroke").addClass("active");console.log(a("#tool_stroke"));
a("#tool_fill").removeClass("active")}});a("#group_opacityLabel").click(function(){a("#opacity_dropdown button").mousedown();a(window).mouseup()});a("#zoomLabel").click(function(){a("#zoom_dropdown button").mousedown();a(window).mouseup()});a("#tool_move_top").mousedown(function(k){a("#tools_stacking").show();k.preventDefault()});a(".layer_button").mousedown(function(){a(this).addClass("layer_buttonpressed")}).mouseout(function(){a(this).removeClass("layer_buttonpressed")}).mouseup(function(){a(this).removeClass("layer_buttonpressed")});
a(".push_button").mousedown(function(){a(this).hasClass("disabled")||a(this).addClass("push_button_pressed").removeClass("push_button")}).mouseout(function(){a(this).removeClass("push_button_pressed").addClass("push_button")}).mouseup(function(){a(this).removeClass("push_button_pressed").addClass("push_button")});a("#layer_new").click(function(){var k=h.getCurrentDrawing().getNumLayers();do var t=g.layers.layer+" "+ ++k;while(h.getCurrentDrawing().hasLayer(t));a.prompt(g.notification.enterUniqueLayerName,
t,function(G){if(G)if(h.getCurrentDrawing().hasLayer(G))a.alert(g.notification.dupeLayerName);else{h.createLayer(G);Ua();rb()}})});a("#layer_delete").click(ba);a("#layer_up").click(function(){I(-1)});a("#layer_down").click(function(){I(1)});a("#layer_rename").click(function(){a("#layerlist tr.layersel").prevAll();var k=a("#layerlist tr.layersel td.layername").text();a.prompt(g.notification.enterNewLayerName,"",function(t){if(t)if(k==t||h.getCurrentDrawing().hasLayer(t))a.alert(g.notification.layerHasThatName);
else{h.renameCurrentLayer(t);rb()}})});var dc=-1,lc=false,oc=false,qc=function(k){if(oc)if(dc!=-1){lc=true;k=dc-k.pageX;var t=a("#sidepanels"),G=parseInt(t.css("width"));if(G+k>300)k=300-G;else if(G+k<2)k=2-G;if(k!=0){dc-=k;G=a("#layerpanel");ha.css("right",parseInt(ha.css("right"))+k);t.css("width",parseInt(t.css("width"))+k);G.css("width",parseInt(G.css("width"))+k);t=a("#ruler_x");t.css("right",parseInt(t.css("right"))+k)}}};a("#sidepanel_handle").mousedown(function(k){dc=k.pageX;a(window).mousemove(qc);
oc=false;setTimeout(function(){oc=true},20)}).mouseup(function(){lc||rc();dc=-1;lc=false});a(window).mouseup(function(){dc=-1;lc=false;a("#svg_editor").unbind("mousemove",qc)});var rc=function(k){var t=parseInt(a("#sidepanels").css("width"));k=(t>2||k?2:150)-t;t=a("#sidepanels");var G=a("#layerpanel"),L=a("#ruler_x");ha.css("right",parseInt(ha.css("right"))+k);t.css("width",parseInt(t.css("width"))+k);G.css("width",parseInt(G.css("width"))+k);L.css("right",parseInt(L.css("right"))+k)},sc=function(k){for(var t=
Array(h.getCurrentDrawing().getNumLayers()),G=0;G<t.length;++G)t[G]=h.getCurrentDrawing().getLayerName(G);if(k)for(G=0;G<t.length;++G)t[G]!=k&&h.getCurrentDrawing().setLayerOpacity(t[G],0.5);else for(G=0;G<t.length;++G)h.getCurrentDrawing().setLayerOpacity(t[G],1)},rb=function(){var k=a("#layerlist tbody"),t=a("#selLayerNames");k.empty();t.empty();for(var G=h.getCurrentDrawing().getCurrentLayerName(),L=h.getCurrentDrawing().getNumLayers(),O=a.getSvgIcon("eye");L--;){var S=h.getCurrentDrawing().getLayerName(L),
da='<tr class="layer';if(S==G)da+=" layersel";da+='">';da+=h.getCurrentDrawing().getLayerVisibility(S)?'<td class="layervis"/><td class="layername" >'+S+"</td></tr>":'<td class="layervis layerinvis"/><td class="layername" >'+S+"</td></tr>";k.append(da);t.append('<option value="'+S+'">'+S+"</option>")}if(O!==undefined){O.clone();a("td.layervis",k).append(O.clone());a.resizeSvgIcons({"td.layervis .svg_icon":14})}a("#layerlist td.layername").mouseup(function(oa){a("#layerlist tr.layer").removeClass("layersel");
a(this.parentNode).addClass("layersel");h.setCurrentLayer(this.textContent);oa.preventDefault()}).mouseover(function(){a(this).css({"font-style":"italic",color:"blue"});sc(this.textContent)}).mouseout(function(){a(this).css({"font-style":"normal",color:"black"});sc()});a("#layerlist td.layervis").click(function(){var oa=a(this.parentNode).prevAll().length;oa=a("#layerlist tr.layer:eq("+oa+") td.layername").text();var xa=a(this).hasClass("layerinvis");h.setLayerVisibility(oa,xa);xa?a(this).removeClass("layerinvis"):
a(this).addClass("layerinvis")});for(t=5-a("#layerlist tr.layer").size();t-- >0;)k.append('<tr><td style="color:white">_</td><td/></tr>')};rb();a(window).bind("load resize",function(){ha.css("line-height",ha.height()+"px")});a("#resolution").change(function(){var k=a("#canvas_width,#canvas_height");if(this.selectedIndex)if(this.value=="content")k.val("fit").attr("disabled","disabled");else{var t=this.value.split("x");a("#canvas_width").val(t[0]);a("#canvas_height").val(t[1]);k.removeAttr("disabled")}else a("#canvas_width").val()==
"fit"&&k.removeAttr("disabled").val(100)});a("input,select").attr("autocomplete","off");var nc=function(){var k=[{sel:"#tool_select",fn:Jb,evt:"click",key:["V",true]},{sel:"#tool_fhpath",fn:pb,evt:"click",key:["Q",true]},{sel:"#tool_line",fn:Kb,evt:"click",key:["L",true]},{sel:"#tool_rect",fn:Rb,evt:"click",key:["R",true],icon:"rect"},{sel:"#tool_ellipse",fn:Lb,evt:"mouseup",key:["C",true],icon:"ellipse"},{sel:"#tool_path",fn:ya,evt:"click",key:["P",true]},{sel:"#tool_text",fn:ua,evt:"click",key:["T",
true]},{sel:"#tool_image",fn:Sb,evt:"mouseup"},{sel:"#tool_zoom",fn:pa,evt:"mouseup",key:["Z",true]},{sel:"#tool_clear",fn:gc,evt:"mouseup",key:[X+"N",true]},{sel:"#tool_save",fn:function(){Da?B():h.save({images:e.img_save,round_digits:6})},evt:"mouseup",key:[X+"S",true]},{sel:"#tool_export",fn:$b,evt:"mouseup"},{sel:"#tool_open",fn:mc,evt:"mouseup"},{sel:"#tool_import",fn:Ub,evt:"mouseup"},{sel:"#tool_source",fn:A,evt:"click",key:[X+"U",true]},{sel:"#tool_wireframe",fn:d,evt:"click"},{sel:"#tool_rulers",
fn:n,evt:"click"},{sel:"#tool_source_cancel,#svg_source_overlay,#tool_docprops_cancel,#tool_prefs_cancel",fn:ca,evt:"click",key:["esc",false,false],hidekey:true},{sel:"#tool_source_save",fn:B,evt:"click"},{sel:"#tool_docprops_save",fn:v,evt:"click"},{sel:"#tool_docprops",fn:o,evt:"mouseup"},{sel:"#tool_prefs_save",fn:C,evt:"click"},{sel:"#tool_prefs_option",fn:function(){l();return false},evt:"mouseup"},{sel:"#tool_delete,#tool_delete_multi",fn:aa,evt:"click",key:["del/backspace",true]},{sel:"#tool_reorient",
fn:Mb,evt:"click"},{sel:"#tool_node_link",fn:Ib,evt:"click"},{sel:"#tool_node_clone",fn:Zb,evt:"click"},{sel:"#tool_node_delete",fn:Yb,evt:"click"},{sel:"#tool_openclose_path",fn:La,evt:"click"},{sel:"#tool_add_subpath",fn:fb,evt:"click"},{sel:"#tool_move_top",fn:wb,evt:"click",key:X+"shift+up"},{sel:"#tool_move_bottom",fn:tb,evt:"click",key:X+"shift+down"},{sel:"#tool_move_up",fn:Fb,evt:"click",key:[X+"up",true]},{sel:"#tool_move_down",fn:Qb,evt:"click",key:[X+"down",true]},{sel:"#tool_topath",fn:nb,
evt:"click"},{sel:"#tool_make_link,#tool_make_link_multi",fn:Ta,evt:"click"},{sel:"#tool_undo",fn:hc,evt:"click",key:[X+"Z",true]},{sel:"#tool_redo",fn:cc,evt:"click",key:["Y",true]},{sel:"#tool_clone,#tool_clone_multi",fn:jb,evt:"click",key:[X+"D",true]},{sel:"#tool_group",fn:Nb,evt:"click",key:[X+"G",true]},{sel:"#tool_ungroup",fn:Nb,evt:"click",key:X+"shift+G"},{sel:"#tool_unlink_use",fn:Nb,evt:"click"},{sel:"[id^=tool_align]",fn:ec,evt:"click"},{sel:"#tool_switch",fn:b,evt:"click",key:["X",true]},
{sel:"#tool_bold",fn:kc,evt:"mousedown",key:[X+"B",true]},{sel:"#tool_italic",fn:Vb,evt:"mousedown",key:[X+"I",true]},{sel:"#copy_save_done",fn:ca,evt:"click"},{key:"ctrl+left",fn:function(){Tb(0,1)}},{key:"ctrl+right",fn:function(){Tb(1,1)}},{key:"ctrl+shift+left",fn:function(){Tb(0,5)}},{key:"ctrl+shift+right",fn:function(){Tb(1,5)}},{key:"shift+O",fn:bc},{key:"shift+P",fn:fc},{key:[X+"+",true],fn:function(){c(2)}},{key:[X+"-",true],fn:function(){c(0.5)}},{key:["up",true],fn:function(){eb(0,-1)}},
{key:["down",true],fn:function(){eb(0,1)}},{key:["left",true],fn:function(){eb(-1,0)}},{key:["right",true],fn:function(){eb(1,0)}},{key:"shift+up",fn:function(){eb(0,-10)}},{key:"shift+down",fn:function(){eb(0,10)}},{key:"shift+left",fn:function(){eb(-10,0)}},{key:"shift+right",fn:function(){eb(10,0)}},{key:["alt+up",true],fn:function(){h.cloneSelectedElements(0,-1)}},{key:["alt+down",true],fn:function(){h.cloneSelectedElements(0,1)}},{key:["alt+left",true],fn:function(){h.cloneSelectedElements(-1,
0)}},{key:["alt+right",true],fn:function(){h.cloneSelectedElements(1,0)}},{key:["alt+shift+up",true],fn:function(){h.cloneSelectedElements(0,-10)}},{key:["alt+shift+down",true],fn:function(){h.cloneSelectedElements(0,10)}},{key:["alt+shift+left",true],fn:function(){h.cloneSelectedElements(-10,0)}},{key:["alt+shift+right",true],fn:function(){h.cloneSelectedElements(10,0)}},{key:X+"A",fn:function(){h.selectAllInCurrentLayer()}},{key:X+"z",fn:hc},{key:X+"shift+z",fn:cc},{key:X+"y",fn:cc},{key:X+"x",
fn:Sa},{key:X+"c",fn:Eb},{key:X+"v",fn:Ab}],t={"4/Shift+4":"#tools_rect_show","5/Shift+5":"#tools_ellipse_show"};return{setAll:function(){var G={};a.each(k,function(L,O){if(O.sel){var S=a(O.sel);if(S.length==0)return true;if(O.evt){if(svgedit.browser.isTouch()&&O.evt==="click")O.evt="mousedown";S[O.evt](O.fn)}if(O.parent&&a(O.parent+"_show").length!=0){var da=a(O.parent);da.length||(da=Aa(O.parent.substr(1)));da.append(S);a.isArray(G[O.parent])||(G[O.parent]=[]);G[O.parent].push(O)}}if(O.key){var oa=
O.fn,xa=false;if(a.isArray(O.key)){da=O.key[0];if(O.key.length>1)xa=O.key[1]}else da=O.key;da+="";svgedit.browser.isMac&&da.indexOf("+")!=-1&&da.split("+")[0]=="ctrl"&&da.replace("ctrl","cmd");a.each(da.split("/"),function(sa,Ya){a(document).bind("keydown",Ya,function(Za){oa();xa&&Za.preventDefault();return false})});if(O.sel&&!O.hidekey&&S.attr("title")){var Ba=S.attr("title").split("[")[0]+" ("+da+")";t[da]=O.sel;S.parents("#main_menu").length||S.attr("title",Ba)}}});Ha(G);a(".attr_changer, #image_url").bind("keydown",
"return",function(L){a(this).change();L.preventDefault()});a(window).bind("keydown","tab",function(L){if(ea==="canvas"){L.preventDefault();fc()}}).bind("keydown","shift+tab",function(L){if(ea==="canvas"){L.preventDefault();bc()}});a("#tool_zoom").dblclick(V)},setTitles:function(){a.each(t,function(G,L){var O=a(L).parents("#main_menu").length;a(L).each(function(){var S=O?a(this).text().split(" [")[0]:this.title.split(" [")[0],da="";a.each(G.split("/"),function(oa,xa){var Ba=xa.split("+"),sa="";if(Ba.length>
1){sa=Ba[0]+"+";xa=Ba[1]}da+=(oa?"/":"")+sa+(g["key_"+xa]||xa)});if(O)this.lastChild.textContent=S+" ["+da+"]";else this.title=S+" ["+da+"]"})})},getButtonData:function(G){var L;a.each(k,function(O,S){if(S.sel===G)L=S});return L}}}();nc.setAll();i.ready(function(){var k=f.initTool,t=a("#tools_left, #svg_editor .tools_flyout"),G=t.find("#tool_"+k);k=t.find("#"+k);(G.length?G:k.length?k:a("#tool_select")).click().mouseup();f.wireframe&&a("#tool_wireframe").click();f.showlayers&&rc();a("#rulers").toggle(!!f.showRulers);
if(f.showRulers)a("#show_rulers")[0].checked=true;if(f.gridSnapping)a("#grid_snapping_on")[0].checked=true;f.baseUnit&&a("#base_unit").val(f.baseUnit);f.snappingStep&&a("#grid_snapping_step").val(f.snappingStep)});a("#rect_rx").SpinButton({min:0,max:1E3,step:1,callback:function(k){h.setRectRadius(k.value)}});a("#stroke_width").SpinButton({min:0,max:99,step:1,smallStep:0.1,callback:function(k){var t=k.value;if(t==0&&T&&["line","polyline"].indexOf(T.nodeName)>=0)t=k.value=1;h.setStrokeWidth(t)}});a("#angle").SpinButton({min:-180,
max:180,step:5,callback:function(k){h.setRotationAngle(k.value);a("#tool_reorient").toggleClass("disabled",k.value==0)}});a("#font_size").SpinButton({step:1,min:0.0010,stepfunc:function(k,t){var G=k.value-0,L=G+t,O=L>=G;if(t===0)return G;return G>=24?O?Math.round(G*1.1):Math.round(G/1.1):G<=1?O?G*2:G/2:L},callback:function(k){h.setFontSize(k.value)}});a("#group_opacity").SpinButton({step:5,min:0,max:100,callback:kb});a("#blur").SpinButton({step:0.1,min:0,max:10,callback:Cb});a("#zoom").SpinButton({min:0.0010,
max:1E4,step:50,stepfunc:function(k,t){var G=k.value-0;if(G===0)return 100;var L=G+t;if(t===0)return G;return G>=100?L:L>=G?G*2:G/2},callback:Ia}).val(h.getZoom()*100);a("#workarea").contextMenu({menu:"cmenu_canvas",inSpeed:0},function(k){switch(k){case "delete":aa();break;case "cut":Sa();break;case "copy":Eb();break;case "paste":h.pasteElements();break;case "paste_in_place":h.pasteElements("in_place");break;case "group":h.groupSelectedElements();break;case "ungroup":h.ungroupSelectedElement();break;
case "move_front":wb();break;case "move_up":T!=null&&h.moveUpDownSelected("Up");break;case "move_down":T!=null&&h.moveUpDownSelected("Down");break;case "move_back":tb();break;default:svgedit.contextmenu&&svgedit.contextmenu.hasCustomHandler(k)&&svgedit.contextmenu.getCustomHandler(k).call()}h.clipBoard.length&&Ra.enableContextMenuItems("#paste,#paste_in_place")});ia=function(k){switch(k){case "dupe":N();break;case "delete":ba();break;case "merge_down":if(a("#layerlist tr.layersel").index()!=h.getCurrentDrawing().getNumLayers()-
1){h.mergeLayer();Ua();rb()}break;case "merge_all":h.mergeAllLayers();Ua();rb()}};a("#layerlist").contextMenu({menu:"cmenu_layers",inSpeed:0},ia);a("#layer_moreopts").contextMenu({menu:"cmenu_layers",inSpeed:0,allowLeft:true},ia);a(".contextMenu li").mousedown(function(k){k.preventDefault()});a("#cmenu_canvas li").disableContextMenu();Ra.enableContextMenuItems("#delete,#cut,#copy");window.onbeforeunload=function(){if(ga.getUndoStackSize()===0)i.show_save_warning=false;if(!f.no_save_warning&&i.show_save_warning)return g.notification.unsavedChanges};
i.openPrep=function(k){a("#main_menu").hide();ga.getUndoStackSize()===0?k(true):a.confirm(g.notification.QwantToOpen,k)};if(window.FileReader){ia=a('<input type="file">').change(function(){var k=this;i.openPrep(function(t){if(t){h.clear();if(k.files.length==1){t=new FileReader;t.onloadend=function(G){H(G.target.result);Ob()};t.readAsText(k.files[0])}}})});a("#tool_open").show().prepend(ia);ia=a('<input type="file">').change(function(){a("#main_menu").hide();if(this.files.length==1){var k=new FileReader;
k.onloadend=function(t){h.importSvgString(t.target.result,true);Ob()};k.readAsText(this.files[0])}});a("#tool_import").show().prepend(ia)}var Ob=i.updateCanvas=function(k,t){var G=ha.width(),L=ha.height(),O=G,S=L,da=h.getZoom(),oa=a("#svgcanvas"),xa={x:ha[0].scrollLeft+O/2,y:ha[0].scrollTop+S/2},Ba=f.canvas_expansion;G=Math.max(O,h.contentW*da*Ba);L=Math.max(S,h.contentH*da*Ba);G==O&&L==S?ha.css("overflow","hidden"):ha.css("overflow","scroll");Ba=oa.height()/2;var sa=oa.width()/2;oa.width(G).height(L);
var Ya=L/2,Za=G/2,Q=h.updateCanvas(G,L),ob=Za/sa;G=G/2-O/2;L=L/2-S/2;if(t){t.x+=Q.x;t.y+=Q.y}else t={x:Za+(xa.x-sa)*ob,y:Ya+(xa.y-Ba)*ob};if(k)if(h.contentW>ha.width()){ha[0].scrollLeft=Q.x-10;ha[0].scrollTop=Q.y-10}else{ha[0].scrollLeft=G;ha[0].scrollTop=L}else{ha[0].scrollLeft=t.x-O/2;ha[0].scrollTop=t.y-S/2}if(f.showRulers){ma(oa,da);ha.scroll()}},ic=[];for(Va=0.1;Va<1E5;Va*=10){ic.push(1*Va);ic.push(2*Va);ic.push(5*Va)}Ob(true);try{var tc=function(k){if(window.JSON&&JSON.stringify)return JSON.stringify(k);
var t=arguments.callee;if(typeof k=="boolean"||typeof k=="number")return k+"";else if(typeof k=="string")return'"'+k.replace(/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,function(O){return"\\u"+("0000"+O.charCodeAt(0).toString(16)).slice(-4)})+'"';else if(k.length){for(var G=0;G<k.length;G++)k[G]=t(k[G]);return"["+k.join(",")+"]"}else{G=[];for(var L in k)G.push(t(L)+":"+t(k[L]));return"{"+G.join(",")+"}"}};window.addEventListener("message",
function(k){var t=parseInt(k.data.substr(0,k.data.indexOf(";")));try{k.source.postMessage("SVGe"+t+";"+tc(eval(k.data)),"*")}catch(G){k.source.postMessage("SVGe"+t+";error:"+G.message,"*")}},false)}catch(uc){window.embed_error=uc}a(function(){window.svgCanvas=h;h.ready=svgEditor.ready});i.setLang=function(k,t){a.pref("lang",k);a("#lang_select").val(k);if(t){var G=a("#layerlist tr.layersel td.layername").text()==g.common.layer+" 1";a.extend(g,t);h.setUiStrings(t);nc.setTitles();if(G){h.renameCurrentLayer(g.common.layer+
" 1");rb()}h.runExtensions("langChanged",k);Pb();a.each({"#stroke_color":"#tool_stroke .icon_label, #tool_stroke .color_block","#fill_color":"#tool_fill label, #tool_fill .color_block","#linejoin_miter":"#cur_linejoin","#linecap_butt":"#cur_linecap"},function(L,O){a(O).attr("title",a(L)[0].title)});a("#multiselected_panel div[id^=tool_align]").each(function(){a("#tool_pos"+this.id.substr(10))[0].title=this.title})}}};var z=[];i.ready=function(D){u?D():z.push(D)};i.runCallbacks=function(){a.each(z,
function(){this()});u=true};i.loadFromString=function(D){i.ready(function(){H(D)})};i.disableUI=function(){};i.loadFromURL=function(D,q){q||(q={});var M=q.cache,ba=q.callback;i.ready(function(){a.ajax({url:D,dataType:"text",cache:!!M,success:function(N){H(N,ba)},error:function(N,I,ma){N.status!=404&&N.responseText?H(N.responseText,ba):a.alert(g.notification.URLloadFail+": \n"+ma+"",ba)}})})};i.loadFromDataURI=function(D){i.ready(function(){var q=D.substring(26);H(svgedit.utilities.decode64(q))})};
i.addExtension=function(){var D=arguments;a(function(){h&&h.addExtension.apply(this,D)})};return i}(jQuery);$(svgEditor.init)})();svgedit=svgedit||{};
(function(){var a=this;if(!svgedit.contextmenu)svgedit.contextmenu={};a.contextMenuExtensions={};svgEditor.ready(function(){for(menuItem in contextMenuExtensions){var H=contextMenuExtensions[menuItem];Object.keys(a.contextMenuExtensions).length==0&&$("#cmenu_canvas").append("<li class='separator'>");var h=H.shortcut||"";$("#cmenu_canvas").append("<li class='disabled'><a href='#"+H.id+"'>"+H.label+"<span class='shortcut'>"+h+"</span></a></li>")}});svgedit.contextmenu.resetCustomMenus=function(){a.contextMenuExtensions=
{}};svgedit.contextmenu.add=function(H){if(H&&H.id&&H.label&&H.action&&typeof H.action=="function")if(H.id in a.contextMenuExtensions)console.error('Cannot add extension "'+H.id+'", an extension by that name already exists"');else{console.log("Registed contextmenu item: {id:"+H.id+", label:"+H.label+"}");a.contextMenuExtensions[H.id]=H}else console.error("Menu items must be defined and have at least properties: id, label, action, where action must be a function")};svgedit.contextmenu.hasCustomHandler=
function(H){return a.contextMenuExtensions[H]&&true};svgedit.contextmenu.getCustomHandler=function(H){return a.contextMenuExtensions[H].action}})();var svgEditor=function(a,H){function h(u,E,e){var f=a("#svg_editor").parent(),g;for(g in E){var p=E[g];p||console.log(g);if(e)g="#"+g;if(f.find(g).length){var z=f.find(g)[0];switch(u){case "content":for(var D=0;D<z.childNodes.length;D++){var q=z.childNodes[D];if(q.nodeType===3&&q.textContent.replace(/\s/g,"")){q.textContent=p;break}}break;case "title":z.title=p}}else console.log("Missing: "+g)}}var i;H.readLang=function(u){var E=H.canvas.runExtensions("addlangData",i,true);a.each(E,function(ba,N){if(N.data)u=
a.merge(u,N.data)});if(u.tools){var e=u.tools;E=u.properties;var f=u.config,g=u.layers,p=u.common,z=u.ui;h("content",{copyrightLabel:u.misc.powered_by,curve_segments:E.curve_segments,fitToContent:e.fitToContent,fit_to_all:e.fit_to_all,fit_to_canvas:e.fit_to_canvas,fit_to_layer_content:e.fit_to_layer_content,fit_to_sel:e.fit_to_sel,icon_large:f.icon_large,icon_medium:f.icon_medium,icon_small:f.icon_small,icon_xlarge:f.icon_xlarge,image_opt_embed:f.image_opt_embed,image_opt_ref:f.image_opt_ref,includedImages:f.included_images,
largest_object:e.largest_object,layersLabel:g.layers,page:e.page,relativeToLabel:e.relativeTo,selLayerLabel:g.move_elems_to,selectedPredefined:f.select_predefined,selected_objects:e.selected_objects,smallest_object:e.smallest_object,straight_segments:E.straight_segments,svginfo_bg_url:f.editor_img_url+":",svginfo_bg_note:f.editor_bg_note,svginfo_change_background:f.background,svginfo_dim:f.doc_dims,svginfo_editor_prefs:f.editor_prefs,svginfo_height:p.height,svginfo_icons:f.icon_size,svginfo_image_props:f.image_props,
svginfo_lang:f.language,svginfo_title:f.doc_title,svginfo_width:p.width,tool_docprops_cancel:p.cancel,tool_docprops_save:p.ok,tool_source_cancel:p.cancel,tool_source_save:p.ok,tool_prefs_cancel:p.cancel,tool_prefs_save:p.ok,sidepanel_handle:g.layers.split("").join(" "),tool_clear:e.new_doc,tool_docprops:e.docprops,tool_export:e.export_png,tool_import:e.import_doc,tool_imagelib:e.imagelib,tool_open:e.open_doc,tool_save:e.save_doc,svginfo_units_rulers:f.units_and_rulers,svginfo_rulers_onoff:f.show_rulers,
svginfo_unit:f.base_unit,svginfo_grid_settings:f.grid,svginfo_snap_onoff:f.snapping_onoff,svginfo_snap_step:f.snapping_stepsize},true);var D={},q;for(q in u.shape_cats)D['#shape_cats [data-cat="'+q+'"]']=u.shape_cats[q];setTimeout(function(){h("content",D)},2E3);var M={};a.each(["cut","copy","paste","paste_in_place","delete","group","ungroup","move_front","move_up","move_down","move_back"],function(){M['#cmenu_canvas a[href="#'+this+'"]']=e[this]});a.each(["dupe","merge_down","merge_all"],function(){M['#cmenu_layers a[href="#'+
this+'"]']=g[this]});M['#cmenu_layers a[href="#delete"]']=g.del;h("content",M);h("title",{align_relative_to:e.align_relative_to,circle_cx:E.circle_cx,circle_cy:E.circle_cy,circle_r:E.circle_r,cornerRadiusLabel:E.corner_radius,ellipse_cx:E.ellipse_cx,ellipse_cy:E.ellipse_cy,ellipse_rx:E.ellipse_rx,ellipse_ry:E.ellipse_ry,fill_color:E.fill_color,font_family:E.font_family,idLabel:E.id,image_height:E.image_height,image_url:E.image_url,image_width:E.image_width,layer_delete:g.del,layer_down:g.move_down,
layer_new:g["new"],layer_rename:g.rename,layer_moreopts:p.more_opts,layer_up:g.move_up,line_x1:E.line_x1,line_x2:E.line_x2,line_y1:E.line_y1,line_y2:E.line_y2,linecap_butt:E.linecap_butt,linecap_round:E.linecap_round,linecap_square:E.linecap_square,linejoin_bevel:E.linejoin_bevel,linejoin_miter:E.linejoin_miter,linejoin_round:E.linejoin_round,main_icon:e.main_menu,mode_connect:e.mode_connect,tools_shapelib_show:e.mode_shapelib,palette:z.palette_info,zoom_panel:z.zoom_level,path_node_x:E.node_x,path_node_y:E.node_y,
rect_height_tool:E.rect_height,rect_width_tool:E.rect_width,seg_type:E.seg_type,selLayerNames:g.move_selected,selected_x:E.pos_x,selected_y:E.pos_y,stroke_color:E.stroke_color,stroke_style:E.stroke_style,stroke_width:E.stroke_width,svginfo_title:f.doc_title,text:E.text_contents,toggle_stroke_tools:z.toggle_stroke_tools,tool_add_subpath:e.add_subpath,tool_alignbottom:e.align_bottom,tool_aligncenter:e.align_center,tool_alignleft:e.align_left,tool_alignmiddle:e.align_middle,tool_alignright:e.align_right,
tool_aligntop:e.align_top,tool_angle:E.angle,tool_blur:E.blur,tool_bold:E.bold,tool_circle:e.mode_circle,tool_clone:e.clone,tool_clone_multi:e.clone,tool_delete:e.del,tool_delete_multi:e.del,tool_ellipse:e.mode_ellipse,tool_eyedropper:e.mode_eyedropper,tool_fhellipse:e.mode_fhellipse,tool_fhpath:e.mode_fhpath,tool_fhrect:e.mode_fhrect,tool_font_size:E.font_size,tool_group:e.group,tool_make_link:e.make_link,tool_link_url:e.set_link_url,tool_image:e.mode_image,tool_italic:E.italic,tool_line:e.mode_line,
tool_move_bottom:e.move_bottom,tool_move_top:e.move_top,tool_node_clone:e.node_clone,tool_node_delete:e.node_delete,tool_node_link:e.node_link,tool_opacity:E.opacity,tool_openclose_path:e.openclose_path,tool_path:e.mode_path,tool_position:e.align_to_page,tool_rect:e.mode_rect,tool_redo:e.redo,tool_reorient:e.reorient_path,tool_select:e.mode_select,tool_source:e.source_save,tool_square:e.mode_square,tool_text:e.mode_text,tool_topath:e.to_path,tool_undo:e.undo,tool_ungroup:e.ungroup,tool_wireframe:e.wireframe_mode,
view_grid:e.toggle_grid,tool_zoom:e.mode_zoom,url_notice:e.no_embed},true);H.setLang(i,u)}};H.putLocale=function(u,E){if(u)i=u;else{i=a.pref("lang");if(!i){if(navigator.userLanguage)i=navigator.userLanguage;else if(navigator.language)i=navigator.language;if(i=="")return}console.log("Lang: "+i);if(a.inArray(i,E)==-1&&i!=="test")i="en";if(i.indexOf("en")==0)return}var e=H.curConfig.langPath+"lang."+i+".js";a.getScript(e,function(f){if(!f){f=document.createElement("script");f.src=e;document.querySelector("head").appendChild(f)}})};
return H}(jQuery,svgEditor);
